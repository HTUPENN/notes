2025å¹´09æœˆ09æ—¥ æ˜ŸæœŸäºŒ
è¾“å…¥å…³é”®å­—ä»¥æœç´¢
search


è°­è±ª
arrow_drop_down


é¦–é¡µ

å·¥ä½œå°

é›†å›¢é—¨æˆ·

å…šçš„å»ºè®¾

ä¼ä¸šæ–‡åŒ–

æ™ºæ”¹æ•°è½¬

ç²¾ç›Šç®¡ç†

è´¨é‡ç®¡ç†
å…¬å¸æ–°é—»è§†é¢‘æ–°é—»
ä¸œé”…æ–°é—»ç¬¬2290æœŸ2025-09-03
ä¸œé”…æ–°é—»ç¬¬2289æœŸ2025-09-03
ä¸œé”…æ–°é—»ç¬¬2288æœŸ2025-08-25
ä¸œé”…æ–°é—»ç¬¬2287æœŸ2025-08-25
ä¸œé”…æ–°é—»ç¬¬2286æœŸ2025-07-25
ä¸œé”…æ–°é—»ç¬¬2285æœŸ2025-07-25
ä¸œé”…æ–°é—»ç¬¬2284æœŸ2025-07-25
ä¸œé”…æ–°é—»ç¬¬2283æœŸ2025-07-25
å›½å†…é¦–å°ç™¾ä¸‡è¤ç…¤å‘ç”µæœºç»„â€”â€”è‹èƒ½é”¡æ—éƒ­å‹’1å·æœºç»„é¦–æ¬¡å¹¶ç½‘å‘ç”µ...
ç½—ä¹¾å®œåˆ°ä¸œæ–¹é”…ç‚‰è°ƒç ”
å…¨å›½æœ€å¤§â€œç«ç”µ+ç†”ç›â€å‚¨çƒ­é¡¹ç›®æ­£å¼æŠ•è¿
ä¸œæ–¹é”…ç‚‰å¬å¼€ç²¾ç›Šç®¡ç†åŠå¹´å·¥ä½œä¼šè®®
å¼ å°‘å³°èµ´å±±è¥¿å‰å¿è°ƒç ”ä¹¡æ‘æŒ¯å…´å¸®æ‰¶å·¥ä½œ
ä¸œæ–¹é”…ç‚‰å¬å¼€2025å¹´å¹´ä¸­è´¨é‡å·¥ä½œä¼š
å›½å†…é¦–å°ç™¾ä¸‡å¯¹å†²å¡”å¼ç‚‰å…³é”®éƒ¨ä»¶å®Œå·¥å‘è¿
chevron_leftchevron_right
â—
â—
â—
â—
â—
â—
â—
å…¬å¸æ–‡ä»¶
å…³äºå°¹åšç­‰3äººä»»èŒçš„é€šçŸ¥
     679
2025-09-08
å…³äºå°å‘ã€Šä¸œæ–¹é”…ç‚‰å‹åŠ›å®¹å™¨ç±»äº§å“å¼‚åœ°åˆ¶é€ åŸºåœ°ç®¡ç†æ–¹æ¡ˆã€‹çš„é€šçŸ¥
     197
2025-09-08
å…³äºå°å‘ã€Šä¸œæ–¹é”…ç‚‰2025å¹´â€œè´¨é‡æœˆâ€æ´»åŠ¨æ–¹æ¡ˆã€‹çš„é€šçŸ¥
     277
2025-09-08
å…³äºå¯¹éƒ‘éº’è¿çºªé—®é¢˜çš„å¤„ç†é€šæŠ¥
     1545
2025-09-05
å…³äºå°å‘ã€Šä¸œæ–¹é”…ç‚‰èŒå·¥â€œä½“é‡ç®¡ç†â€ä¸‰å¹´è¡ŒåŠ¨æ–¹æ¡ˆã€‹çš„é€šçŸ¥
     1281
2025-09-03
å…³äºå°å‘ã€Šä¸œæ–¹é”…ç‚‰ç¢±æ€§ç”µè§£æ§½äº§å“äº§å‡ºç®¡ç†æ–¹æ¡ˆï¼ˆè¯•è¡Œï¼‰ã€‹çš„é€šçŸ¥
     532
2025-08-27
å…³äºè°ƒæ•´å…¬å¸é¢†å¯¼åŠæ€»ç»ç†åŠ©ç†ã€æ€»æ³•å¾‹é¡¾é—®å·¥ä½œåˆ†å·¥çš„é€šçŸ¥
     587
2025-08-22
å…¬å¸é€šå‘Š
é€šçŸ¥ 
é€šå‘Š 
å…¬ç¤º 
å¯äº‹ 
å…¶å®ƒ
ã€é€šçŸ¥ã€‘å…³äºè§„èŒƒå‘å¸ƒä¸œé”…ä¿¡æ¯æ¸¯å…¬å…±ä¿¡æ¯çš„é€šçŸ¥
     432
2025-08-26
ã€é€šçŸ¥ã€‘å…³äºæ–°ç‰ˆä¸œé”…ä¿¡æ¯æ¸¯åŠæœåŠ¡ä¸€ç«™é€šæ¨¡å—ä¸Šçº¿çš„é€šçŸ¥
     598
2025-08-22
ã€é€šçŸ¥ã€‘å…³äºå‘å¸ƒ2025å¹´ç¬¬äºŒè½®å·¡å¯Ÿâ€œäºŒç»´ç â€çš„é€šçŸ¥
     108
2025-08-22
ã€é€šçŸ¥ã€‘äº§ä¸šå’Œå¸‚åœºå¼€å‘ä¸­å¿ƒè¥é”€å²—æ‹›è˜å¯äº‹
     307
2025-09-08
ã€å…¬ç¤ºã€‘å…³äº2026å¹´åº¦â€œç›éƒ½ç™¾åƒä¸‡è‹±æ‰è®¡åˆ’â€é’å¹´äººæ‰ï¼ˆæŠ€æœ¯æŠ€èƒ½é¢†åŸŸï¼‰æ¨èäººé€‰çš„å…¬ç¤º
     245
2025-09-08
ã€é€šçŸ¥ã€‘å…³äºé‡æ–°ä»»å‘½å‹åŠ›å®¹å™¨è®¾è®¡åŠå®¡æ‰¹äººå‘˜çš„é€šçŸ¥
     105
2025-09-08
ã€é€šå‘Šã€‘å…³äºä¿®è®¢å‘å¸ƒã€Šä¾›åº”å•†å¼€å‘ä¸ç®¡ç†è§„å®šã€‹çš„é€šçŸ¥
     51
2025-09-05
ä¼šè®®é€šçŸ¥

ã€2025-09-15 09:00ã€‘
å…³äºå‚åŠ é›†å›¢å…¬å¸ç¬¬ä¹å±Šç§‘æŠ€åˆ›æ–°å¤§ä¼šã€ä¸­å¤®ä¼ä¸šå…ˆè¿›ç”µåŠ›è£…å¤‡åˆ›æ–°è”åˆä½“å¹´åº¦ä¼šè®®çš„é€šçŸ¥
     206
2025-09-08

ã€2025-09-12 10:00ã€‘
å…³äºå¬å¼€2025å¹´9æœˆâ€œä¸¤é‡‘â€å‹é™ã€é£é™©ç®¡æ§å’Œé™æœ¬æ²»äºâ€œä¸‰åˆä¸€â€å·¥ä½œä¼šçš„é€šçŸ¥
     64
2025-09-08

ã€2025-09-09 09:00ã€‘
å…³äºå¬å¼€ä¸œæ–¹é”…ç‚‰â€œä¸‰é“é˜²çº¿â€å»ºè®¾å·¥ä½œæ¨è¿›ä¼šçš„é€šçŸ¥
     321
2025-09-08

ã€2025-09-03 10:00ã€‘
å…³äºç»„ç»‡æ”¶å¬æ”¶çœ‹çºªå¿µä¸­å›½äººæ°‘æŠ—æ—¥æˆ˜äº‰æš¨ä¸–ç•Œåæ³•è¥¿æ–¯æˆ˜äº‰èƒœåˆ©80å‘¨å¹´å¤§ä¼šçš„é€šçŸ¥
     2206
2025-08-28

ã€2025-09-03 09:00ã€‘
å…³äºè°ƒæ•´ç»„ç»‡æ”¶å¬æ”¶çœ‹çºªå¿µä¸­å›½äººæ°‘æŠ—æ—¥æˆ˜äº‰æš¨ä¸–ç•Œåæ³•è¥¿æ–¯æˆ˜äº‰èƒœåˆ©80å‘¨å¹´å¤§ä¼šæ—¶é—´çš„é€šçŸ¥
     597
2025-09-02

ã€2025-09-02 09:30ã€‘
æ‹›è¿œ1ã€2å·æœºç»„ç¨³å‹å™¨åˆ¶é€ å¼€å·¥ä¼š
     166
2025-08-29

ã€2025-08-28 14:00ã€‘
å…³äºå¬å¼€2025å¹´9æœˆä»½å®‰å…¨è´¨é‡ç”Ÿäº§ä¼šçš„ä¼šè®®é€šçŸ¥
     282
2025-08-26
ä¿¡æ¯ç³»ç»Ÿ

ç»¼åˆç®¡ç†ä¿¡æ¯ç³»ç»Ÿ

è®¾è®¡å·¥è‰ºä¸€ä½“åŒ–ç³»ç»Ÿ

æ™ºæ…§èƒ½æºç®¡ç†ç³»ç»Ÿ

è£…å¤‡ç®¡ç†ä¿¡æ¯ç³»ç»Ÿ

WMSä»“å­˜ç®¡ç†ç³»ç»Ÿ

å®‰å…¨éšæ‚£ç®¡ç†ç³»ç»Ÿ

è§†é¢‘ç›‘æ§ç³»ç»Ÿ

æµç¨‹ç®¡ç†å¹³å°

æ•°å­—æ¡£æ¡ˆé¦†

PLMç³»ç»Ÿ

å†…éƒ¨ç”µå­é‚®ç®±
å¾…åŠ
MISå¾…åŠ
é›†å›¢å¾…åŠ

æš‚æ— æ•°æ®~


â—
â—
å­¦ä¹ å›­åœ°
ã€å­¦ä¹ å›­åœ°ã€‘å…šå§”ä¹¦è®°ã€è‘£äº‹é•¿æ—å…‰å¹³åœ¨ä¸œæ–¹é”…ç‚‰2025å¹´å¹´ä¸­å·¥ä½œä¼šä¸Šçš„è®²è¯
     134
2025-08-06
ã€å­¦ä¹ å›­åœ°ã€‘å…šå§”ä¹¦è®°ã€è‘£äº‹é•¿æ—å…‰å¹³åœ¨ä¸œæ–¹é”…ç‚‰å·¥ä¼šåå››å±Šä¸€æ¬¡ä¼šå‘˜ä»£è¡¨å¤§ä¼šä¸Šçš„è®²è¯
     34
2025-08-06
ã€å­¦ä¹ å›­åœ°ã€‘å…šå§”å‰¯ä¹¦è®°ã€çºªå§”ä¹¦è®°ã€å·¥ä¼šä¸»å¸­èƒ¡æˆ˜åˆ©åœ¨ä¸œæ–¹é”…ç‚‰å·¥ä¼šåå››å±Šä¸€æ¬¡ä¼šå‘˜ä»£è¡¨å¤§ä¼šä¸Šçš„å·¥ä½œæŠ¥å‘Š
     31
2025-08-06
ã€å­¦ä¹ å›­åœ°ã€‘å…šå§”ä¹¦è®°ã€è‘£äº‹é•¿æ—å…‰å¹³åœ¨ä¸œæ–¹é”…ç‚‰2025å¹´å…šçš„å»ºè®¾æš¨å…šé£å»‰æ”¿å»ºè®¾å’Œåè…è´¥å·¥ä½œä¼šä¸Šçš„è®²è¯
     19
2025-08-06
ã€å­¦ä¹ å›­åœ°ã€‘å…šå§”å‰¯ä¹¦è®°èƒ¡æˆ˜åˆ©åœ¨2025å¹´å…šçš„å»ºè®¾æš¨å…šé£å»‰æ”¿å»ºè®¾å’Œåè…è´¥å·¥ä½œä¼šè®®ä¸Šçš„å…šå»ºå·¥ä½œæŠ¥å‘Š
     21
2025-08-06
ã€å­¦ä¹ å›­åœ°ã€‘çºªå§”ä¹¦è®°èƒ¡æˆ˜åˆ©åœ¨ä¸œæ–¹é”…ç‚‰2025å¹´å…šçš„å»ºè®¾æš¨å…šé£å»‰æ”¿å»ºè®¾å’Œåè…è´¥å·¥ä½œä¼šè®®ä¸Šçš„çºªæ£€å·¥ä½œæŠ¥å‘Š
     33
2025-07-26
ã€å­¦ä¹ å›­åœ°ã€‘æ€»ç»ç†ã€å…šå§”å‰¯ä¹¦è®°è‚ç«‹åœ¨ä¸œæ–¹é”…ç‚‰ç¬¬åä¸‰å±Šä¸€æ¬¡èŒå·¥ä»£è¡¨å¤§ä¼šæš¨2025å¹´åº¦å·¥ä½œä¼šä¸Šçš„å·¥ä½œæŠ¥å‘Š
     65
2025-07-25
åœ¨çº¿æŸ¥è¯¢

åœ¨çº¿ç¿»è¯‘

èœè°±

ç»„ç»‡æœºæ„

å·¥æ ‡ç½‘

æ ‡å‡†åˆ†äº«ç½‘

åŠå…¬æŒ‡å—

å¸¸è§é—®é¢˜è§£ç­”

è¯šä¿¡åˆè§„
åŸºå±‚åœ¨çº¿

é¡¹ç›®ä¸­å¿ƒ

å®¹å™¨äºŒåˆ†å‚

è£…å¤‡éƒ¨

ææ–™ç ”å‘éƒ¨

è”ç®±åˆ†å‚

å·¥è‰ºç ”å‘éƒ¨

å¾·é˜³åˆ¶é€ åŸºåœ°

äº§ä¸šå¼€å‘ä¸­å¿ƒ

ç¯å¢ƒå®‰å…¨éƒ¨
åŸ¹è®­é€šçŸ¥

ã€2025-09-12 10:00ã€‘
å…³äºä¸¾åŠä¸œæ–¹é”…ç‚‰ç‡ƒçƒ§åç¢³æ•é›†åŠåˆ©ç”¨æŠ€æœ¯çŸ¥è¯†åŸ¹è®­çš„é€šçŸ¥
     8
2025-09-09

ã€2025-09-10 08:40ã€‘
å…³äºå¼€å±•ä¸œæ–¹é”…ç‚‰2025å¹´ç²¾ç›Šç®¡ç†DFSSè®¾è®¡ã€éªŒè¯é˜¶æ®µåŸ¹è®­çš„é€šçŸ¥
     64
2025-09-08

ã€2025-09-09 09:00ã€‘
å…³äºä¸¾åŠå¸åº“ç³»ç»Ÿèµ„é‡‘è®¡åˆ’ç®¡ç†åŸ¹è®­çš„é€šçŸ¥
     208
2025-09-03

ã€2025-09-06 09:00ã€‘
å…³äºä¸¾åŠèƒ½æºæ¸…æ´ä½ç¢³çƒ­è½¬åŒ–åˆ©ç”¨æŠ€æœ¯ä¸è£…å¤‡å››å·çœé‡ç‚¹å®éªŒå®¤2025å¹´åº¦ä¸“é¢˜è®²åº§æš¨æ€»å¸ˆå…¬å¼€è¯¾ç¬¬ä¸‰è¯¾çš„é€šçŸ¥
     331
2025-09-03

ã€2025-09-05 09:00ã€‘
å…³äºä¸¾åŠ2025å¹´EPCé¡¹ç›®ç®¡ç†äººæ‰åŸ¹å…» ç¬¬ä¸€é˜¶æ®µä¸“é¢˜åŸ¹è®­çš„é€šçŸ¥
     464
2025-09-01

ã€2025-09-02 08:30ã€‘
å…³äºå¼€å±•ä¸œæ–¹é”…ç‚‰2025å¹´ç²¾ç›Šç®¡ç†å†…è®­å¸ˆåŸ¹è®­çš„é€šçŸ¥
     269
2025-08-31

ã€2025-08-29 09:00ã€‘
å…³äºä¸¾åŠäººå·¥æ™ºèƒ½è®²åº§äº¤æµçš„é€šçŸ¥
     470
2025-08-27
å¾®ä¿¡å…¬ä¼—å·

ä¸œæ–¹é”…ç‚‰

ä¸œé”…å¾®è®¯

ä¸œæ–¹ç”µæ°”åŠå…¬

ä¸œé”…æ™ºæ…§å®‰å…¨
å†å²ç‰ˆæœ¬
2007ç‰ˆä¸œé”…ä¿¡æ¯æ¸¯
2015ç‰ˆä¸œé”…ä¿¡æ¯æ¸¯
KOAåŠå…¬ç³»ç»Ÿ
å¸¸ç”¨é“¾æ¥
å›½å®¶å‘å±•å’Œæ”¹é©å§”å‘˜ä¼š
ç§‘å­¦æŠ€æœ¯éƒ¨
å·¥ä¸šå’Œä¿¡æ¯åŒ–éƒ¨
è´¢æ”¿éƒ¨
ç”Ÿæ€ç¯å¢ƒéƒ¨
å›½å®¶æ ¸å®‰å…¨å±€
å›½åŠ¡é™¢å›½æœ‰èµ„äº§ç›‘ç£ç®¡ç†å§”å‘˜ä¼š
å›½å®¶ç»Ÿè®¡å±€
å›½å®¶èƒ½æºå±€
å…±äº§å…šå‘˜ç½‘
å»ºè¨€çŒ®ç­–
æˆ‘ä¸ºæ”¹é©çŒ®è®¡ç­–
æˆ‘ä¸ºç¾¤ä¼—åŠå®äº‹
ä¸ºåŸºå±‚å‡è´Ÿ
ä¸¾æŠ¥
çºªå§”ä¸¾æŠ¥ç”µè¯å’Œé‚®ç®±
ç‰ˆæƒæ‰€æœ‰ï¼šä¸œæ–¹ç”µæ°”é›†å›¢ä¸œæ–¹é”…ç‚‰è‚¡ä»½æœ‰é™å…¬å¸



gpt-oss:120b




Loading...
profile
gpt-oss:120b
æ€è€ƒç”¨æ—¶ 0 ç§’
ğŸ“‹ Python list å¸¸ç”¨æ–¹æ³•é€ŸæŸ¥è¡¨
ä¸‹é¢åˆ—å‡º å†…ç½®åˆ—è¡¨ (list) æ‰€æä¾›çš„å…¨éƒ¨å…¬å¼€æ–¹æ³•ï¼ŒåŒ…å«åŠŸèƒ½è¯´æ˜ã€å¸¸è§ç”¨æ³•ç¤ºä¾‹ä»¥åŠå¸¸è§çš„å‘/æ³¨æ„ç‚¹ã€‚
ä»£ç å‡å¯åœ¨äº¤äº’å¼è§£é‡Šå™¨æˆ– Jupyter Notebook ä¸­ç›´æ¥è¿è¡Œã€‚ 

æ–¹æ³•
åŠŸèƒ½
å¸¸ç”¨è¯­æ³•
ç¤ºä¾‹
å¤‡æ³¨ / å¸¸è§å‘
append(x)	
åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å•ä¸ªå…ƒç´  x	
lst.append(item)	
lst=[1,2]; lst.append(3) # [1,2,3]	
O(1) æ—¶é—´å¤æ‚åº¦
extend(iterable)	
ç”¨å¯è¿­ä»£å¯¹è±¡çš„æ¯ä¸ªå…ƒç´ æ‰©å±•åˆ—è¡¨	
lst.extend(other)	
lst=[1]; lst.extend([2,3]) # [1,2,3]	
ç­‰ä»·äº lst += otherï¼Œä¸è¦å†™æˆ lst.append(other)ï¼ˆä¼šæŠŠæ•´ä¸ªå¯¹è±¡å½“æˆä¸€ä¸ªå…ƒç´ ï¼‰
insert(i, x)	
åœ¨ç´¢å¼• i ä½ç½®æ’å…¥å…ƒç´  xï¼Œåé¢çš„å…ƒç´ å³ç§»	
lst.insert(idx, item)	
lst=[1,3]; lst.insert(1,2) # [1,2,3]	
è´Ÿç´¢å¼•åŒæ ·æœ‰æ•ˆï¼›O(n) å¤æ‚åº¦
remove(x)	
åˆ é™¤åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªå€¼ç­‰äº x çš„å…ƒç´ 	
lst.remove(item)	
lst=[1,2,2,3]; lst.remove(2) # [1,2,3]	
è‹¥ä¸å­˜åœ¨æŠ› ValueError
pop([i])	
åˆ é™¤å¹¶è¿”å›ç´¢å¼• i å¤„çš„å…ƒç´ ï¼Œé»˜è®¤ i=-1ï¼ˆå¼¹å‡ºæœ«å°¾ï¼‰	
item = lst.pop(idx)	
lst=[1,2,3]; lst.pop() # è¿”å› 3ï¼Œåˆ—è¡¨å˜ä¸º [1,2]	
ç©ºåˆ—è¡¨è°ƒç”¨ä¼šæŠ› IndexError
clear()	
åˆ é™¤åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ ï¼Œå¾—åˆ°ç©ºåˆ—è¡¨	
lst.clear()	
lst=[1,2]; lst.clear() # []	
ç­‰ä»·äº del lst[:]
index(x, start=0, end=len(lst))	
è¿”å›å€¼ç­‰äº x çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ï¼Œå¯é€‰æœç´¢åŒºé—´	
pos = lst.index(item, start, end)	
lst=[1,2,3]; lst.index(2) # 1	
è‹¥ä¸å­˜åœ¨æŠ› ValueError
count(x)	
ç»Ÿè®¡åˆ—è¡¨ä¸­å€¼ç­‰äº x çš„å…ƒç´ ä¸ªæ•°	
n = lst.count(item)	
lst=[1,2,2,3]; lst.count(2) # 2	
O(n)
sort(key=None, reverse=False)	
åŸåœ°æ’åºï¼Œè¿”å› None	
lst.sort(key=func, reverse=True)	
lst=[3,1,2]; lst.sort() # [1,2,3]	
æ³¨æ„ï¼šlist.sort() ä¼šä¿®æ”¹åŸåˆ—è¡¨ï¼Œè‹¥éœ€è¦ä¿ç•™åŸåˆ—è¡¨è¯·ä½¿ç”¨ sorted(lst)
reverse()	
åŸåœ°ç¿»è½¬åˆ—è¡¨é¡ºåº	
lst.reverse()	
lst=[1,2,3]; lst.reverse() # [3,2,1]	
åŒæ ·è¿”å› Noneï¼Œä¸ç”Ÿæˆæ–°åˆ—è¡¨
copy()	
è¿”å›åˆ—è¡¨çš„æµ…æ‹·è´ï¼ˆç­‰ä»·äº lst[:]ï¼‰	
new_lst = lst.copy()	
a=[1,2]; b=a.copy(); b.append(3) # a=[1,2], b=[1,2,3]	
è‹¥åˆ—è¡¨å†…éƒ¨è¿˜æœ‰å¯å˜å¯¹è±¡ï¼Œéœ€è¦ copy.deepcopy
__len__() / len(lst)	
è¿”å›åˆ—è¡¨é•¿åº¦	
n = len(lst)	
len([1,2,3]) # 3	
ä¸æ˜¯æ–¹æ³•ï¼Œä½†å¸¸ç”¨
__getitem__(i) / lst[i]	
å–å…ƒç´ æˆ–åˆ‡ç‰‡	
item = lst[i]	
lst=[1,2,3]; lst[0] # 1	
æ”¯æŒè´Ÿç´¢å¼•ã€æ­¥é•¿åˆ‡ç‰‡
__setitem__(i, x) / lst[i] = x	
æ›¿æ¢æŒ‡å®šä½ç½®çš„å…ƒç´ 	
lst[i] = val	
lst[1]=9 # [1,9,3]	
åŒæ ·æ”¯æŒåˆ‡ç‰‡èµ‹å€¼ lst[1:3]=[8,8]
__delitem__(i) / del lst[i]	
åˆ é™¤æŒ‡å®šä½ç½®æˆ–åˆ‡ç‰‡	
del lst[i]	
del lst[0] # åˆ é™¤é¦–å…ƒç´ 	
__contains__(x) / x in lst	
åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨åˆ—è¡¨ä¸­	
x in lst	
2 in [1,2,3] # True	
O(n) çº¿æ€§æœç´¢
__iter__() / for x in lst:	
è¿­ä»£åˆ—è¡¨	
for v in lst: ...	
for v in [1,2]: print(v)	
ğŸ›  å¸¸è§å®ç”¨æŠ€å·§
1ï¸âƒ£ åˆ—è¡¨æ¨å¯¼å¼ï¼ˆList Comprehensionï¼‰
è¯­æ³•ï¼š[expr for item in iterable if condition]

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
# 1~10 çš„å¹³æ–¹ï¼Œåªä¿ç•™å¶æ•°
evens_sq = [x**2 for x in range(1, 11) if x % 2 == 0]
# è¾“å‡º: [4, 16, 36, 64, 100]
2ï¸âƒ£ åˆ—è¡¨åˆ‡ç‰‡ï¼ˆSliceï¼‰
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
lst = list(range(10))   # [0,1,2,3,4,5,6,7,8,9]

# å‰ 5 é¡¹
first5 = lst[:5]        # [0,1,2,3,4]

# ä»ç¬¬ 3 é¡¹å¼€å§‹åˆ°å€’æ•°ç¬¬ 2 é¡¹
mid = lst[2:-1]         # [2,3,4,5,6,7,8]

# æ­¥é•¿ 2ï¼ˆå–å¶æ•°ç´¢å¼•ï¼‰
step2 = lst[::2]        # [0,2,4,6,8]

# é€†åº
rev = lst[::-1]         # [9,8,7,6,5,4,3,2,1,0]
3ï¸âƒ£ â€œå»é‡ + ä¿æŒé¡ºåºâ€
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
âŒ„
def uniq_keep_order(seq):
    seen = set()
    return [x for x in seq if not (x in seen or seen.add(x))]

print(uniq_keep_order([1,2,2,3,1,4]))  # [1,2,3,4]
4ï¸âƒ£ ç”¨ list.extend æ›¿ä»£ +=ï¼ˆå¯è¯»æ€§æ›´å¥½ï¼‰
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
a = [1, 2]
b = [3, 4]
a.extend(b)   # a -> [1,2,3,4]
# a += b  ä¹Ÿè¡Œï¼Œä½†åœ¨é˜…è¯»æ—¶ä¸æ˜“ç«‹å³çœ‹å‡ºæ˜¯â€œæ‰©å±•â€è€Œéâ€œé‡æ–°èµ‹å€¼â€
5ï¸âƒ£ å¿«é€Ÿç”Ÿæˆå›ºå®šå€¼åˆ—è¡¨
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
zeros = [0] * 10          # [0,0,0,0,0,0,0,0,0,0]
ones  = [1] * 5           # [1,1,1,1,1]
âš ï¸ æ³¨æ„ï¼šå¦‚æœåˆ—è¡¨å†…éƒ¨çš„å…ƒç´ æ˜¯ å¯å˜å¯¹è±¡ï¼Œ[obj] * n ä¼šåˆ›å»º n ä¸ªå¯¹åŒä¸€å¯¹è±¡çš„å¼•ç”¨ï¼Œä¿®æ”¹å…¶ä¸­ä¸€ä¸ªä¼šå½±å“å…¨éƒ¨ã€‚ä¾‹å¦‚ï¼š 

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
inner = [0]
lst = [inner] * 3   # ä¸‰ä¸ªå…ƒç´ æŒ‡å‘åŒä¸€ä¸ªåˆ—è¡¨
lst[0].append(1)    # æ‰€æœ‰å­åˆ—è¡¨éƒ½ä¼šå˜æˆ [0,1]
6ï¸âƒ£ â€œç¿»è½¬ + è¿‡æ»¤â€ å¸¸ç”¨ç»„åˆ
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
# å–å€’æ•°ç¬¬ 2 åˆ°ç¬¬ 5ï¼ˆå€’åºï¼‰ä¸”å¤§äº 10 çš„å…ƒç´ 
result = [x for x in lst[-5:-1][::-1] if x > 10]
ğŸ“¦ ä¸å…¶ä»–å®¹å™¨çš„å¯¹æ¯”
å®¹å™¨
æ˜¯å¦æœ‰åº
æ˜¯å¦å¯å˜
å…³é”®ç‰¹æ€§
é€‚ç”¨åœºæ™¯
list	
âœ…	
âœ…	
æ”¯æŒéšæœºè®¿é—®ã€åˆ‡ç‰‡ã€å¿«é€Ÿè¿½åŠ 	
éœ€è¦é¡ºåºå­˜å‚¨ã€é¢‘ç¹éå†ã€å¶å°”æ’å…¥/åˆ é™¤
tuple	
âœ…	
âŒ	
ä¸å¯å˜ï¼Œå“ˆå¸Œå¯ç”¨ä½œå­—å…¸é”®	
å¸¸é‡åºåˆ—ã€å‡½æ•°è¿”å›å¤šå€¼
set	
âŒ	
âœ…	
å»é‡ã€é›†åˆè¿ç®— O(1) æŸ¥æ‰¾	
å»é‡ã€æˆå‘˜æ£€æµ‹ã€æ•°å­¦é›†åˆæ“ä½œ
dict	
âœ… (Pythonâ€¯3.7+)	
âœ…	
é”®å€¼æ˜ å°„ï¼Œé”®å”¯ä¸€	
å¿«é€ŸæŸ¥æ‰¾ã€å…³è”æ•°æ®
ğŸ§© å°ç»ƒä¹ ï¼ˆè‡ªæµ‹ï¼‰
ç”¨ä¸‹é¢çš„åˆ—è¡¨å®Œæˆ æ‰€æœ‰ æ³¨é‡Šä¸­çš„ä»»åŠ¡ï¼Œå°½é‡åªä½¿ç”¨åˆ—è¡¨è‡ªå¸¦çš„æ–¹æ³•ï¼ˆä¸è¦å¯¼å…¥é¢å¤–æ¨¡å—ï¼‰ã€‚ 

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
data = [5, 2, 9, 2, 7, 5, 1, 3]

# 1. åˆ é™¤ç¬¬ä¸€ä¸ªå‡ºç°çš„ 2
# 2. åœ¨æœ«å°¾è¿½åŠ  10
# 3. æŠŠ 7 æ›¿æ¢æˆ 8
# 4. æŠŠåˆ—è¡¨å€’åº
# 5. ç»Ÿè®¡ 5 å‡ºç°äº†å‡ æ¬¡
# 6. ç”Ÿæˆä¸€ä¸ªæ–°åˆ—è¡¨ï¼Œåªä¿ç•™å¥‡æ•°ä¸”å»é‡ï¼Œä¿æŒåŸé¡ºåº
å‚è€ƒç­”æ¡ˆï¼ˆä»…ä¾›æ£€éªŒï¼‰

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
âŒ„
# 1
data.remove(2)

# 2
data.append(10)

# 3
idx = data.index(7)
data[idx] = 8

# 4
data.reverse()

# 5
cnt_five = data.count(5)

# 6
def uniq_keep_order(seq):
    seen = set()
    return [x for x in seq if not (x in seen or seen.add(x))]

odd_unique = uniq_keep_order([x for x in data if x % 2 == 1])
print(odd_unique)   # ç¤ºä¾‹è¾“å‡º: [5, 9, 1, 3]
ğŸ“š æ¨èé˜…è¯» & è¿›é˜¶
å®˜æ–¹æ–‡æ¡£ â€“ list ç« èŠ‚ï¼šhttps://docs.python.org/3/tutorial/datastructures.html#more-on-lists
PEP 8 â€“ ä»£ç é£æ ¼æŒ‡å—ï¼Œä¿æŒåˆ—è¡¨æ“ä½œçš„å¯è¯»æ€§ã€‚
ã€ŠEffective Pythonã€‹ï¼ˆç¬¬äºŒç‰ˆï¼‰â€“ ç¬¬ 12 æ¡ â€œPrefer list comprehensions over map and filterâ€ã€‚
itertools â€“ å½“åˆ—è¡¨æ“ä½œå˜å¾—æ›´å¤æ‚ï¼ˆå¦‚æ— é™è¿­ä»£ã€ç¬›å¡å°”ç§¯ï¼‰æ—¶ï¼Œç”¨å®ƒå¯ä»¥å†™å‡ºæ›´é«˜æ•ˆã€æ›´ç®€æ´çš„ä»£ç ã€‚
åªè¦ç†Ÿç»ƒæŒæ¡ä¸Šè¡¨çš„è¿™äº›æ–¹æ³•ï¼Œä½ å°±èƒ½åœ¨æ—¥å¸¸å¼€å‘ã€æ•°æ®æ¸…æ´—ã€ç®—æ³•å®ç°ç­‰åœºæ™¯ä¸­è‡ªå¦‚åœ°ä½¿ç”¨ Python åˆ—è¡¨äº†ã€‚ç¥ç¼–ç æ„‰å¿« ğŸš€ 

<details type="reasoning" done="true" duration="0"> <summary>Thought for 0 seconds</summary> > The user says "listæ–¹æ³•". Likely they want methods of Python list. Provide description of list methods with examples. Probably Chinese. Provide table of methods, usage, examples. Also include tips and common patterns. </details> ## ğŸ“‹ Python `list` å¸¸ç”¨æ–¹æ³•é€ŸæŸ¥è¡¨ > ä¸‹é¢åˆ—å‡º **å†…ç½®åˆ—è¡¨ (`list`)** æ‰€æä¾›çš„å…¨éƒ¨å…¬å¼€æ–¹æ³•ï¼ŒåŒ…å«åŠŸèƒ½è¯´æ˜ã€å¸¸è§ç”¨æ³•ç¤ºä¾‹ä»¥åŠå¸¸è§çš„å‘/æ³¨æ„ç‚¹ã€‚ > ä»£ç å‡å¯åœ¨äº¤äº’å¼è§£é‡Šå™¨æˆ– Jupyter Notebook ä¸­ç›´æ¥è¿è¡Œã€‚ | æ–¹æ³• | åŠŸèƒ½ | å¸¸ç”¨è¯­æ³• | ç¤ºä¾‹ | å¤‡æ³¨ / å¸¸è§å‘ | |------|------|----------|------|--------------| | `append(x)` | åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å•ä¸ªå…ƒç´  `x` | `lst.append(item)` | `lst=[1,2]; lst.append(3) # [1,2,3]` | O(1) æ—¶é—´å¤æ‚åº¦ | | `extend(iterable)` | ç”¨å¯è¿­ä»£å¯¹è±¡çš„æ¯ä¸ªå…ƒç´ æ‰©å±•åˆ—è¡¨ | `lst.extend(other)` | `lst=[1]; lst.extend([2,3]) # [1,2,3]` | ç­‰ä»·äº `lst += other`ï¼Œ**ä¸è¦**å†™æˆ `lst.append(other)`ï¼ˆä¼šæŠŠæ•´ä¸ªå¯¹è±¡å½“æˆä¸€ä¸ªå…ƒç´ ï¼‰ | | `insert(i, x)` | åœ¨ç´¢å¼• `i` ä½ç½®æ’å…¥å…ƒç´  `x`ï¼Œåé¢çš„å…ƒç´ å³ç§» | `lst.insert(idx, item)` | `lst=[1,3]; lst.insert(1,2) # [1,2,3]` | è´Ÿç´¢å¼•åŒæ ·æœ‰æ•ˆï¼›O(n) å¤æ‚åº¦ | | `remove(x)` | åˆ é™¤åˆ—è¡¨ä¸­**ç¬¬ä¸€ä¸ª**å€¼ç­‰äº `x` çš„å…ƒç´  | `lst.remove(item)` | `lst=[1,2,2,3]; lst.remove(2) # [1,2,3]` | è‹¥ä¸å­˜åœ¨æŠ› `ValueError` | | `pop([i])` | åˆ é™¤å¹¶è¿”å›ç´¢å¼• `i` å¤„çš„å…ƒç´ ï¼Œé»˜è®¤ `i=-1`ï¼ˆå¼¹å‡ºæœ«å°¾ï¼‰ | `item = lst.pop(idx)` | `lst=[1,2,3]; lst.pop() # è¿”å› 3ï¼Œåˆ—è¡¨å˜ä¸º [1,2]` | ç©ºåˆ—è¡¨è°ƒç”¨ä¼šæŠ› `IndexError` | | `clear()` | åˆ é™¤åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ ï¼Œå¾—åˆ°ç©ºåˆ—è¡¨ | `lst.clear()` | `lst=[1,2]; lst.clear() # []` | ç­‰ä»·äº `del lst[:]` | | `index(x, start=0, end=len(lst))` | è¿”å›å€¼ç­‰äº `x` çš„**ç¬¬ä¸€ä¸ª**å…ƒç´ çš„ç´¢å¼•ï¼Œå¯é€‰æœç´¢åŒºé—´ | `pos = lst.index(item, start, end)` | `lst=[1,2,3]; lst.index(2) # 1` | è‹¥ä¸å­˜åœ¨æŠ› `ValueError` | | `count(x)` | ç»Ÿè®¡åˆ—è¡¨ä¸­å€¼ç­‰äº `x` çš„å…ƒç´ ä¸ªæ•° | `n = lst.count(item)` | `lst=[1,2,2,3]; lst.count(2) # 2` | O(n) | | `sort(key=None, reverse=False)` | åŸåœ°æ’åºï¼Œè¿”å› `None` | `lst.sort(key=func, reverse=True)` | `lst=[3,1,2]; lst.sort() # [1,2,3]` | **æ³¨æ„**ï¼š`list.sort()` **ä¼šä¿®æ”¹åŸåˆ—è¡¨**ï¼Œè‹¥éœ€è¦ä¿ç•™åŸåˆ—è¡¨è¯·ä½¿ç”¨ `sorted(lst)` | | `reverse()` | åŸåœ°ç¿»è½¬åˆ—è¡¨é¡ºåº | `lst.reverse()` | `lst=[1,2,3]; lst.reverse() # [3,2,1]` | åŒæ ·è¿”å› `None`ï¼Œä¸ç”Ÿæˆæ–°åˆ—è¡¨ | | `copy()` | è¿”å›åˆ—è¡¨çš„**æµ…æ‹·è´**ï¼ˆç­‰ä»·äº `lst[:]`ï¼‰ | `new_lst = lst.copy()` | `a=[1,2]; b=a.copy(); b.append(3) # a=[1,2], b=[1,2,3]` | è‹¥åˆ—è¡¨å†…éƒ¨è¿˜æœ‰å¯å˜å¯¹è±¡ï¼Œéœ€è¦ `copy.deepcopy` | | `__len__()` / `len(lst)` | è¿”å›åˆ—è¡¨é•¿åº¦ | `n = len(lst)` | `len([1,2,3]) # 3` | ä¸æ˜¯æ–¹æ³•ï¼Œä½†å¸¸ç”¨ | | `__getitem__(i)` / `lst[i]` | å–å…ƒç´ æˆ–åˆ‡ç‰‡ | `item = lst[i]` | `lst=[1,2,3]; lst[0] # 1` | æ”¯æŒè´Ÿç´¢å¼•ã€æ­¥é•¿åˆ‡ç‰‡ | | `__setitem__(i, x)` / `lst[i] = x` | æ›¿æ¢æŒ‡å®šä½ç½®çš„å…ƒç´  | `lst[i] = val` | `lst[1]=9 # [1,9,3]` | åŒæ ·æ”¯æŒåˆ‡ç‰‡èµ‹å€¼ `lst[1:3]=[8,8]` | | `__delitem__(i)` / `del lst[i]` | åˆ é™¤æŒ‡å®šä½ç½®æˆ–åˆ‡ç‰‡ | `del lst[i]` | `del lst[0] # åˆ é™¤é¦–å…ƒç´ ` | | | `__contains__(x)` / `x in lst` | åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨åˆ—è¡¨ä¸­ | `x in lst` | `2 in [1,2,3] # True` | O(n) çº¿æ€§æœç´¢ | | `__iter__()` / `for x in lst:` | è¿­ä»£åˆ—è¡¨ | `for v in lst: ...` | `for v in [1,2]: print(v)` | | --- ## ğŸ›  å¸¸è§å®ç”¨æŠ€å·§ ### 1ï¸âƒ£ åˆ—è¡¨æ¨å¯¼å¼ï¼ˆList Comprehensionï¼‰ **è¯­æ³•**ï¼š`[expr for item in iterable if condition]` ```python # 1~10 çš„å¹³æ–¹ï¼Œåªä¿ç•™å¶æ•° evens_sq = [x**2 for x in range(1, 11) if x % 2 == 0] # è¾“å‡º: [4, 16, 36, 64, 100] ``` ### 2ï¸âƒ£ åˆ—è¡¨åˆ‡ç‰‡ï¼ˆSliceï¼‰ ```python lst = list(range(10)) # [0,1,2,3,4,5,6,7,8,9] # å‰ 5 é¡¹ first5 = lst[:5] # [0,1,2,3,4] # ä»ç¬¬ 3 é¡¹å¼€å§‹åˆ°å€’æ•°ç¬¬ 2 é¡¹ mid = lst[2:-1] # [2,3,4,5,6,7,8] # æ­¥é•¿ 2ï¼ˆå–å¶æ•°ç´¢å¼•ï¼‰ step2 = lst[::2] # [0,2,4,6,8] # é€†åº rev = lst[::-1] # [9,8,7,6,5,4,3,2,1,0] ``` ### 3ï¸âƒ£ â€œå»é‡ + ä¿æŒé¡ºåºâ€ ```python def uniq_keep_order(seq): seen = set() return [x for x in seq if not (x in seen or seen.add(x))] print(uniq_keep_order([1,2,2,3,1,4])) # [1,2,3,4] ``` ### 4ï¸âƒ£ ç”¨ `list.extend` æ›¿ä»£ `+=`ï¼ˆå¯è¯»æ€§æ›´å¥½ï¼‰ ```python a = [1, 2] b = [3, 4] a.extend(b) # a -> [1,2,3,4] # a += b ä¹Ÿè¡Œï¼Œä½†åœ¨é˜…è¯»æ—¶ä¸æ˜“ç«‹å³çœ‹å‡ºæ˜¯â€œæ‰©å±•â€è€Œéâ€œé‡æ–°èµ‹å€¼â€ ``` ### 5ï¸âƒ£ å¿«é€Ÿç”Ÿæˆå›ºå®šå€¼åˆ—è¡¨ ```python zeros = [0] * 10 # [0,0,0,0,0,0,0,0,0,0] ones = [1] * 5 # [1,1,1,1,1] ``` > âš ï¸ **æ³¨æ„**ï¼šå¦‚æœåˆ—è¡¨å†…éƒ¨çš„å…ƒç´ æ˜¯ **å¯å˜å¯¹è±¡**ï¼Œ`[obj] * n` ä¼šåˆ›å»º *n* ä¸ªå¯¹åŒä¸€å¯¹è±¡çš„å¼•ç”¨ï¼Œä¿®æ”¹å…¶ä¸­ä¸€ä¸ªä¼šå½±å“å…¨éƒ¨ã€‚ä¾‹å¦‚ï¼š ```python inner = [0] lst = [inner] * 3 # ä¸‰ä¸ªå…ƒç´ æŒ‡å‘åŒä¸€ä¸ªåˆ—è¡¨ lst[0].append(1) # æ‰€æœ‰å­åˆ—è¡¨éƒ½ä¼šå˜æˆ [0,1] ``` ### 6ï¸âƒ£ â€œç¿»è½¬ + è¿‡æ»¤â€ å¸¸ç”¨ç»„åˆ ```python # å–å€’æ•°ç¬¬ 2 åˆ°ç¬¬ 5ï¼ˆå€’åºï¼‰ä¸”å¤§äº 10 çš„å…ƒç´  result = [x for x in lst[-5:-1][::-1] if x > 10] ``` --- ## ğŸ“¦ ä¸å…¶ä»–å®¹å™¨çš„å¯¹æ¯” | å®¹å™¨ | æ˜¯å¦æœ‰åº | æ˜¯å¦å¯å˜ | å…³é”®ç‰¹æ€§ | é€‚ç”¨åœºæ™¯ | |------|----------|----------|----------|----------| | `list` | âœ… | âœ… | æ”¯æŒéšæœºè®¿é—®ã€åˆ‡ç‰‡ã€å¿«é€Ÿè¿½åŠ  | éœ€è¦é¡ºåºå­˜å‚¨ã€é¢‘ç¹éå†ã€å¶å°”æ’å…¥/åˆ é™¤ | | `tuple` | âœ… | âŒ | ä¸å¯å˜ï¼Œå“ˆå¸Œå¯ç”¨ä½œå­—å…¸é”® | å¸¸é‡åºåˆ—ã€å‡½æ•°è¿”å›å¤šå€¼ | | `set` | âŒ | âœ… | å»é‡ã€é›†åˆè¿ç®— O(1) æŸ¥æ‰¾ | å»é‡ã€æˆå‘˜æ£€æµ‹ã€æ•°å­¦é›†åˆæ“ä½œ | | `dict` | âœ… (Pythonâ€¯3.7+) | âœ… | é”®å€¼æ˜ å°„ï¼Œé”®å”¯ä¸€ | å¿«é€ŸæŸ¥æ‰¾ã€å…³è”æ•°æ® | --- ## ğŸ§© å°ç»ƒä¹ ï¼ˆè‡ªæµ‹ï¼‰ > ç”¨ä¸‹é¢çš„åˆ—è¡¨å®Œæˆ **æ‰€æœ‰** æ³¨é‡Šä¸­çš„ä»»åŠ¡ï¼Œå°½é‡åªä½¿ç”¨åˆ—è¡¨è‡ªå¸¦çš„æ–¹æ³•ï¼ˆä¸è¦å¯¼å…¥é¢å¤–æ¨¡å—ï¼‰ã€‚ ```python data = [5, 2, 9, 2, 7, 5, 1, 3] # 1. åˆ é™¤ç¬¬ä¸€ä¸ªå‡ºç°çš„ 2 # 2. åœ¨æœ«å°¾è¿½åŠ  10 # 3. æŠŠ 7 æ›¿æ¢æˆ 8 # 4. æŠŠåˆ—è¡¨å€’åº # 5. ç»Ÿè®¡ 5 å‡ºç°äº†å‡ æ¬¡ # 6. ç”Ÿæˆä¸€ä¸ªæ–°åˆ—è¡¨ï¼Œåªä¿ç•™å¥‡æ•°ä¸”å»é‡ï¼Œä¿æŒåŸé¡ºåº ``` **å‚è€ƒç­”æ¡ˆï¼ˆä»…ä¾›æ£€éªŒï¼‰** ```python # 1 data.remove(2) # 2 data.append(10) # 3 idx = data.index(7) data[idx] = 8 # 4 data.reverse() # 5 cnt_five = data.count(5) # 6 def uniq_keep_order(seq): seen = set() return [x for x in seq if not (x in seen or seen.add(x))] odd_unique = uniq_keep_order([x for x in data if x % 2 == 1]) print(odd_unique) # ç¤ºä¾‹è¾“å‡º: [5, 9, 1, 3] ``` --- ## ğŸ“š æ¨èé˜…è¯» & è¿›é˜¶ 1. **å®˜æ–¹æ–‡æ¡£** â€“ `list` ç« èŠ‚ï¼šhttps://docs.python.org/3/tutorial/datastructures.html#more-on-lists 2. **PEP 8** â€“ ä»£ç é£æ ¼æŒ‡å—ï¼Œä¿æŒåˆ—è¡¨æ“ä½œçš„å¯è¯»æ€§ã€‚ 3. **ã€ŠEffective Pythonã€‹**ï¼ˆç¬¬äºŒç‰ˆï¼‰â€“ ç¬¬ 12 æ¡ â€œPrefer list comprehensions over map and filterâ€ã€‚ 4. **`itertools`** â€“ å½“åˆ—è¡¨æ“ä½œå˜å¾—æ›´å¤æ‚ï¼ˆå¦‚æ— é™è¿­ä»£ã€ç¬›å¡å°”ç§¯ï¼‰æ—¶ï¼Œç”¨å®ƒå¯ä»¥å†™å‡ºæ›´é«˜æ•ˆã€æ›´ç®€æ´çš„ä»£ç ã€‚ > åªè¦ç†Ÿç»ƒæŒæ¡ä¸Šè¡¨çš„è¿™äº›æ–¹æ³•ï¼Œä½ å°±èƒ½åœ¨æ—¥å¸¸å¼€å‘ã€æ•°æ®æ¸…æ´—ã€ç®—æ³•å®ç°ç­‰åœºæ™¯ä¸­è‡ªå¦‚åœ°ä½¿ç”¨ Python åˆ—è¡¨äº†ã€‚ç¥ç¼–ç æ„‰å¿« ğŸš€
è¡¨æ ¼è½¬æ¢ä¸ºå¯ä»¥notionç›´æ¥å¤åˆ¶çš„

profile
gpt-oss:120b
æ€è€ƒç”¨æ—¶ 2 ç§’
ä¸‹é¢çš„æ‰€æœ‰è¡¨æ ¼å‡é‡‡ç”¨ Markdown è¡¨æ ¼è¯­æ³•ï¼ˆ| åˆ†å‰²ã€--- åˆ†éš”æ ‡é¢˜ï¼‰ï¼Œç›´æ¥ å¤åˆ¶ç²˜è´´ åˆ° Notion é¡µé¢åï¼ŒNotion ä¼šè‡ªåŠ¨æ¸²æŸ“ä¸ºå¯ç¼–è¾‘çš„è¡¨æ ¼ã€‚

1ï¸âƒ£ list å¸¸ç”¨æ–¹æ³•é€ŸæŸ¥è¡¨
æ–¹æ³•
åŠŸèƒ½
å¸¸ç”¨è¯­æ³•
ç¤ºä¾‹
å¤‡æ³¨ / å¸¸è§å‘
append(x)	
åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å•ä¸ªå…ƒç´  x	
lst.append(item)	
lst=[1,2]; lst.append(3) # [1,2,3]	
O(1) æ—¶é—´å¤æ‚åº¦
extend(iterable)	
ç”¨å¯è¿­ä»£å¯¹è±¡çš„æ¯ä¸ªå…ƒç´ æ‰©å±•åˆ—è¡¨	
lst.extend(other)	
lst=[1]; lst.extend([2,3]) # [1,2,3]	
ç­‰ä»·äº lst += otherï¼Œä¸è¦å†™æˆ lst.append(other)ï¼ˆä¼šæŠŠæ•´ä¸ªå¯¹è±¡å½“æˆä¸€ä¸ªå…ƒç´ ï¼‰
insert(i, x)	
åœ¨ç´¢å¼• i ä½ç½®æ’å…¥å…ƒç´  xï¼Œåé¢çš„å…ƒç´ å³ç§»	
lst.insert(idx, item)	
lst=[1,3]; lst.insert(1,2) # [1,2,3]	
è´Ÿç´¢å¼•åŒæ ·æœ‰æ•ˆï¼›O(n) å¤æ‚åº¦
remove(x)	
åˆ é™¤åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªå€¼ç­‰äº x çš„å…ƒç´ 	
lst.remove(item)	
lst=[1,2,2,3]; lst.remove(2) # [1,2,3]	
è‹¥ä¸å­˜åœ¨æŠ› ValueError
pop([i])	
åˆ é™¤å¹¶è¿”å›ç´¢å¼• i å¤„çš„å…ƒç´ ï¼Œé»˜è®¤ i=-1ï¼ˆå¼¹å‡ºæœ«å°¾ï¼‰	
item = lst.pop(idx)	
lst=[1,2,3]; lst.pop() # è¿”å› 3ï¼Œåˆ—è¡¨å˜ä¸º [1,2]	
ç©ºåˆ—è¡¨è°ƒç”¨ä¼šæŠ› IndexError
clear()	
åˆ é™¤åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ ï¼Œå¾—åˆ°ç©ºåˆ—è¡¨	
lst.clear()	
lst=[1,2]; lst.clear() # []	
ç­‰ä»·äº del lst[:]
index(x, start=0, end=len(lst))	
è¿”å›å€¼ç­‰äº x çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ï¼Œå¯é€‰æœç´¢åŒºé—´	
pos = lst.index(item, start, end)	
lst=[1,2,3]; lst.index(2) # 1	
è‹¥ä¸å­˜åœ¨æŠ› ValueError
count(x)	
ç»Ÿè®¡åˆ—è¡¨ä¸­å€¼ç­‰äº x çš„å…ƒç´ ä¸ªæ•°	
n = lst.count(item)	
lst=[1,2,2,3]; lst.count(2) # 2	
O(n)
sort(key=None, reverse=False)	
åŸåœ°æ’åºï¼Œè¿”å› None	
lst.sort(key=func, reverse=True)	
lst=[3,1,2]; lst.sort() # [1,2,3]	
æ³¨æ„ï¼šlist.sort() ä¼šä¿®æ”¹åŸåˆ—è¡¨ï¼Œè‹¥éœ€è¦ä¿ç•™åŸåˆ—è¡¨è¯·ä½¿ç”¨ sorted(lst)
reverse()	
åŸåœ°ç¿»è½¬åˆ—è¡¨é¡ºåº	
lst.reverse()	
lst=[1,2,3]; lst.reverse() # [3,2,1]	
åŒæ ·è¿”å› Noneï¼Œä¸ç”Ÿæˆæ–°åˆ—è¡¨
copy()	
è¿”å›åˆ—è¡¨çš„æµ…æ‹·è´ï¼ˆç­‰ä»·äº lst[:]ï¼‰	
new_lst = lst.copy()	
a=[1,2]; b=a.copy(); b.append(3) # a=[1,2], b=[1,2,3]	
è‹¥åˆ—è¡¨å†…éƒ¨è¿˜æœ‰å¯å˜å¯¹è±¡ï¼Œéœ€è¦ copy.deepcopy
len(lst)	
è¿”å›åˆ—è¡¨é•¿åº¦ï¼ˆä¸æ˜¯æ–¹æ³•ï¼‰	
n = len(lst)	
len([1,2,3]) # 3	
lst[i] / lst[i:j:k]	
å–å…ƒç´ æˆ–åˆ‡ç‰‡	
item = lst[i]	
lst=[1,2,3]; lst[0] # 1	
æ”¯æŒè´Ÿç´¢å¼•ã€æ­¥é•¿åˆ‡ç‰‡
lst[i] = x	
æ›¿æ¢æŒ‡å®šä½ç½®çš„å…ƒç´ 	
lst[i] = val	
lst[1]=9 # [1,9,3]	
åŒæ ·æ”¯æŒåˆ‡ç‰‡èµ‹å€¼ lst[1:3]=[8,8]
del lst[i]	
åˆ é™¤æŒ‡å®šä½ç½®æˆ–åˆ‡ç‰‡	
del lst[i]	
del lst[0] # åˆ é™¤é¦–å…ƒç´ 	
x in lst	
åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨åˆ—è¡¨ä¸­	
x in lst	
2 in [1,2,3] # True	
O(n) çº¿æ€§æœç´¢
for x in lst:	
è¿­ä»£åˆ—è¡¨	
for v in lst: ...	
for v in [1,2]: print(v)	
list(iterable)	
å°†å¯è¿­ä»£å¯¹è±¡è½¬æ¢ä¸ºåˆ—è¡¨	
lst = list(some_iterable)	
list('abc') # ['a','b','c']	
2ï¸âƒ£ å¸¸ç”¨å®ç”¨æŠ€å·§ï¼ˆä»£ç å—ä¿æŒåŸæ ·ï¼‰
åˆ—è¡¨æ¨å¯¼å¼
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
# 1~10 çš„å¹³æ–¹ï¼Œåªä¿ç•™å¶æ•°
evens_sq = [x**2 for x in range(1, 11) if x % 2 == 0]
# -> [4, 16, 36, 64, 100]
åˆ—è¡¨åˆ‡ç‰‡
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
lst = list(range(10))   # [0,1,2,3,4,5,6,7,8,9]

first5 = lst[:5]        # [0,1,2,3,4]
mid    = lst[2:-1]      # [2,3,4,5,6,7,8]
step2  = lst[::2]       # [0,2,4,6,8]
rev    = lst[::-1]      # [9,8,7,6,5,4,3,2,1,0]
å»é‡å¹¶ä¿æŒé¡ºåº
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
âŒ„
def uniq_keep_order(seq):
    seen = set()
    return [x for x in seq if not (x in seen or seen.add(x))]

print(uniq_keep_order([1,2,2,3,1,4]))  # [1,2,3,4]
ç”¨ extend æ›¿ä»£ +=
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
a = [1, 2]
b = [3, 4]
a.extend(b)   # a -> [1,2,3,4]
# a += b  ä¹Ÿè¡Œï¼Œä½†é˜…è¯»æ—¶ä¸æ˜“ç«‹å³çœ‹å‡ºæ˜¯â€œæ‰©å±•â€
å¿«é€Ÿç”Ÿæˆå›ºå®šå€¼åˆ—è¡¨
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
zeros = [0] * 10          # [0,0,0,0,0,0,0,0,0,0]
ones  = [1] * 5           # [1,1,1,1,1]
âš ï¸ æ³¨æ„ï¼šå¦‚æœåˆ—è¡¨å†…éƒ¨çš„å…ƒç´ æ˜¯å¯å˜å¯¹è±¡ï¼Œ[obj] * n ä¼šåˆ›å»º n ä¸ªå¯¹åŒä¸€å¯¹è±¡çš„å¼•ç”¨ï¼Œä¿®æ”¹å…¶ä¸­ä¸€ä¸ªä¼šå½±å“å…¨éƒ¨ã€‚ä¾‹å¦‚ï¼š 

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
inner = [0]
lst   = [inner] * 3   # ä¸‰ä¸ªå…ƒç´ æŒ‡å‘åŒä¸€ä¸ªåˆ—è¡¨
lst[0].append(1)      # æ‰€æœ‰å­åˆ—è¡¨éƒ½ä¼šå˜æˆ [0,1]
â€œç¿»è½¬ + è¿‡æ»¤â€ ç»„åˆ
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
# å–å€’æ•°ç¬¬ 2~ç¬¬ 5ï¼ˆå€’åºï¼‰ä¸”å¤§äº 10 çš„å…ƒç´ 
result = [x for x in lst[-5:-1][::-1] if x > 10]
3ï¸âƒ£ ä¸å…¶ä»–å®¹å™¨çš„å¯¹æ¯”è¡¨
å®¹å™¨
æ˜¯å¦æœ‰åº
æ˜¯å¦å¯å˜
å…³é”®ç‰¹æ€§
é€‚ç”¨åœºæ™¯
list	
âœ…	
âœ…	
æ”¯æŒéšæœºè®¿é—®ã€åˆ‡ç‰‡ã€å¿«é€Ÿè¿½åŠ 	
éœ€è¦é¡ºåºå­˜å‚¨ã€é¢‘ç¹éå†ã€å¶å°”æ’å…¥/åˆ é™¤
tuple	
âœ…	
âŒ	
ä¸å¯å˜ï¼Œå“ˆå¸Œå¯ç”¨ä½œå­—å…¸é”®	
å¸¸é‡åºåˆ—ã€å‡½æ•°è¿”å›å¤šå€¼
set	
âŒ	
âœ…	
å»é‡ã€é›†åˆè¿ç®— O(1) æŸ¥æ‰¾	
å»é‡ã€æˆå‘˜æ£€æµ‹ã€æ•°å­¦é›†åˆæ“ä½œ
dict	
âœ… (Pythonâ€¯3.7+)	
âœ…	
é”®å€¼æ˜ å°„ï¼Œé”®å”¯ä¸€	
å¿«é€ŸæŸ¥æ‰¾ã€å…³è”æ•°æ®
4ï¸âƒ£ å°ç»ƒä¹ ï¼ˆè‡ªæµ‹ï¼‰
ç”¨ä¸‹é¢çš„åˆ—è¡¨å®Œæˆ æ‰€æœ‰ æ³¨é‡Šä¸­çš„ä»»åŠ¡ï¼Œå°½é‡åªä½¿ç”¨åˆ—è¡¨è‡ªå¸¦çš„æ–¹æ³•ï¼ˆä¸è¦å¯¼å…¥é¢å¤–æ¨¡å—ï¼‰ã€‚ 

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
data = [5, 2, 9, 2, 7, 5, 1, 3]

# 1. åˆ é™¤ç¬¬ä¸€ä¸ªå‡ºç°çš„ 2
# 2. åœ¨æœ«å°¾è¿½åŠ  10
# 3. æŠŠ 7 æ›¿æ¢æˆ 8
# 4. æŠŠåˆ—è¡¨å€’åº
# 5. ç»Ÿè®¡ 5 å‡ºç°äº†å‡ æ¬¡
# 6. ç”Ÿæˆä¸€ä¸ªæ–°åˆ—è¡¨ï¼Œåªä¿ç•™å¥‡æ•°ä¸”å»é‡ï¼Œä¿æŒåŸé¡ºåº
å‚è€ƒç­”æ¡ˆï¼ˆä»…ä¾›æ£€éªŒï¼‰

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
âŒ„
# 1
data.remove(2)

# 2
data.append(10)

# 3
idx = data.index(7)
data[idx] = 8

# 4
data.reverse()

# 5
cnt_five = data.count(5)

# 6
def uniq_keep_order(seq):
    seen = set()
    return [x for x in seq if not (x in seen or seen.add(x))]

odd_unique = uniq_keep_order([x for x in data if x % 2 == 1])
print(odd_unique)   # ç¤ºä¾‹è¾“å‡º: [5, 9, 1, 3]
5ï¸âƒ£ ä¸å…¶ä»–å®¹å™¨çš„å¯¹æ¯”ï¼ˆMarkdown è¡¨æ ¼ï¼‰
å®¹å™¨
æ˜¯å¦æœ‰åº
æ˜¯å¦å¯å˜
å…³é”®ç‰¹æ€§
é€‚ç”¨åœºæ™¯
list	
âœ…	
âœ…	
æ”¯æŒéšæœºè®¿é—®ã€åˆ‡ç‰‡ã€å¿«é€Ÿè¿½åŠ 	
éœ€è¦é¡ºåºå­˜å‚¨ã€é¢‘ç¹éå†ã€å¶å°”æ’å…¥/åˆ é™¤
tuple	
âœ…	
âŒ	
ä¸å¯å˜ï¼Œå“ˆå¸Œå¯ç”¨ä½œå­—å…¸é”®	
å¸¸é‡åºåˆ—ã€å‡½æ•°è¿”å›å¤šå€¼
set	
âŒ	
âœ…	
å»é‡ã€é›†åˆè¿ç®— O(1) æŸ¥æ‰¾	
å»é‡ã€æˆå‘˜æ£€æµ‹ã€æ•°å­¦é›†åˆæ“ä½œ
dict	
âœ… (Pythonâ€¯3.7+)	
âœ…	
é”®å€¼æ˜ å°„ï¼Œé”®å”¯ä¸€	
å¿«é€ŸæŸ¥æ‰¾ã€å…³è”æ•°æ®
6ï¸âƒ£ æ¨èé˜…è¯» & è¿›é˜¶ï¼ˆå¯ç›´æ¥å¤åˆ¶åˆ° Notionï¼‰
ç¼–å·
èµ„æº
é“¾æ¥
1	
å®˜æ–¹æ–‡æ¡£ â€“ list ç« èŠ‚	
https://docs.python.org/3/tutorial/datastructures.html#more-on-lists
2	
PEP 8 â€“ ä»£ç é£æ ¼æŒ‡å—	
https://peps.python.org/pep-0008/
3	
ã€ŠEffective Pythonã€‹â€‘ ç¬¬ 12 æ¡ â€œPrefer list comprehensions over map and filterâ€	
https://effectivepython.com/
4	
itertools â€“ é«˜çº§è¿­ä»£å·¥å…·	
https://docs.python.org/3/library/itertools.html
ä½¿ç”¨æ–¹æ³•

é€‰ä¸­éœ€è¦çš„è¡¨æ ¼ï¼ˆåŒ…æ‹¬æ ‡é¢˜è¡Œå’Œåˆ†éš”è¡Œ ---ï¼‰ï¼ŒCtrlâ€¯+C å¤åˆ¶ã€‚
åœ¨ Notion é¡µé¢ç©ºç™½å¤„ Ctrlâ€¯+â€¯V ç²˜è´´ã€‚
Notion ä¼šè‡ªåŠ¨æŠŠ Markdown è¡¨æ ¼è½¬ä¸º Notion åŸç”Ÿçš„è¡¨æ ¼å—ï¼Œä½ å¯ä»¥ç›´æ¥ç¼–è¾‘ã€æ·»åŠ æˆ–åˆ é™¤è¡Œ/åˆ—ã€‚
ç¥ä½ åœ¨ Notion ä¸­ä½¿ç”¨è¿™äº›è¡¨æ ¼é¡ºæ‰‹é«˜æ•ˆ ğŸš€ï¼

<details type="reasoning" done="true" duration="2"> <summary>Thought for 2 seconds</summary> > User wants the table (the previous answer) converted into a format that can be directly copied into Notion. Notion supports markdown tables, but with pipe syntax. Notion can paste markdown tables and will convert. So need to output tables in markdown format. The previous answer contains several tables. Need to ensure they are plain markdown (with headers). Provide the tables separately. Also need to maybe keep code blocks. So produce markdown tables that can be copied-pasted into Notion. Provide all tables: list methods, comparison table, etc. Ensure no extra formatting that breaks Notion. Probably just plain markdown. > > Let's produce final answer with markdown tables. </details> ä¸‹é¢çš„æ‰€æœ‰è¡¨æ ¼å‡é‡‡ç”¨ **Markdown è¡¨æ ¼è¯­æ³•**ï¼ˆ`|` åˆ†å‰²ã€`---` åˆ†éš”æ ‡é¢˜ï¼‰ï¼Œç›´æ¥ **å¤åˆ¶ç²˜è´´** åˆ° Notion é¡µé¢åï¼ŒNotion ä¼šè‡ªåŠ¨æ¸²æŸ“ä¸ºå¯ç¼–è¾‘çš„è¡¨æ ¼ã€‚ --- ## 1ï¸âƒ£ `list` å¸¸ç”¨æ–¹æ³•é€ŸæŸ¥è¡¨ | æ–¹æ³• | åŠŸèƒ½ | å¸¸ç”¨è¯­æ³• | ç¤ºä¾‹ | å¤‡æ³¨ / å¸¸è§å‘ | |------|------|----------|------|--------------| | `append(x)` | åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å•ä¸ªå…ƒç´  `x` | `lst.append(item)` | `lst=[1,2]; lst.append(3) # [1,2,3]` | O(1) æ—¶é—´å¤æ‚åº¦ | | `extend(iterable)` | ç”¨å¯è¿­ä»£å¯¹è±¡çš„æ¯ä¸ªå…ƒç´ æ‰©å±•åˆ—è¡¨ | `lst.extend(other)` | `lst=[1]; lst.extend([2,3]) # [1,2,3]` | ç­‰ä»·äº `lst += other`ï¼Œ**ä¸è¦**å†™æˆ `lst.append(other)`ï¼ˆä¼šæŠŠæ•´ä¸ªå¯¹è±¡å½“æˆä¸€ä¸ªå…ƒç´ ï¼‰ | | `insert(i, x)` | åœ¨ç´¢å¼• `i` ä½ç½®æ’å…¥å…ƒç´  `x`ï¼Œåé¢çš„å…ƒç´ å³ç§» | `lst.insert(idx, item)` | `lst=[1,3]; lst.insert(1,2) # [1,2,3]` | è´Ÿç´¢å¼•åŒæ ·æœ‰æ•ˆï¼›O(n) å¤æ‚åº¦ | | `remove(x)` | åˆ é™¤åˆ—è¡¨ä¸­**ç¬¬ä¸€ä¸ª**å€¼ç­‰äº `x` çš„å…ƒç´  | `lst.remove(item)` | `lst=[1,2,2,3]; lst.remove(2) # [1,2,3]` | è‹¥ä¸å­˜åœ¨æŠ› `ValueError` | | `pop([i])` | åˆ é™¤å¹¶è¿”å›ç´¢å¼• `i` å¤„çš„å…ƒç´ ï¼Œé»˜è®¤ `i=-1`ï¼ˆå¼¹å‡ºæœ«å°¾ï¼‰ | `item = lst.pop(idx)` | `lst=[1,2,3]; lst.pop() # è¿”å› 3ï¼Œåˆ—è¡¨å˜ä¸º [1,2]` | ç©ºåˆ—è¡¨è°ƒç”¨ä¼šæŠ› `IndexError` | | `clear()` | åˆ é™¤åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ ï¼Œå¾—åˆ°ç©ºåˆ—è¡¨ | `lst.clear()` | `lst=[1,2]; lst.clear() # []` | ç­‰ä»·äº `del lst[:]` | | `index(x, start=0, end=len(lst))` | è¿”å›å€¼ç­‰äº `x` çš„**ç¬¬ä¸€ä¸ª**å…ƒç´ çš„ç´¢å¼•ï¼Œå¯é€‰æœç´¢åŒºé—´ | `pos = lst.index(item, start, end)` | `lst=[1,2,3]; lst.index(2) # 1` | è‹¥ä¸å­˜åœ¨æŠ› `ValueError` | | `count(x)` | ç»Ÿè®¡åˆ—è¡¨ä¸­å€¼ç­‰äº `x` çš„å…ƒç´ ä¸ªæ•° | `n = lst.count(item)` | `lst=[1,2,2,3]; lst.count(2) # 2` | O(n) | | `sort(key=None, reverse=False)` | åŸåœ°æ’åºï¼Œè¿”å› `None` | `lst.sort(key=func, reverse=True)` | `lst=[3,1,2]; lst.sort() # [1,2,3]` | **æ³¨æ„**ï¼š`list.sort()` **ä¼šä¿®æ”¹åŸåˆ—è¡¨**ï¼Œè‹¥éœ€è¦ä¿ç•™åŸåˆ—è¡¨è¯·ä½¿ç”¨ `sorted(lst)` | | `reverse()` | åŸåœ°ç¿»è½¬åˆ—è¡¨é¡ºåº | `lst.reverse()` | `lst=[1,2,3]; lst.reverse() # [3,2,1]` | åŒæ ·è¿”å› `None`ï¼Œä¸ç”Ÿæˆæ–°åˆ—è¡¨ | | `copy()` | è¿”å›åˆ—è¡¨çš„**æµ…æ‹·è´**ï¼ˆç­‰ä»·äº `lst[:]`ï¼‰ | `new_lst = lst.copy()` | `a=[1,2]; b=a.copy(); b.append(3) # a=[1,2], b=[1,2,3]` | è‹¥åˆ—è¡¨å†…éƒ¨è¿˜æœ‰å¯å˜å¯¹è±¡ï¼Œéœ€è¦ `copy.deepcopy` | | `len(lst)` | è¿”å›åˆ—è¡¨é•¿åº¦ï¼ˆä¸æ˜¯æ–¹æ³•ï¼‰ | `n = len(lst)` | `len([1,2,3]) # 3` | | | `lst[i]` / `lst[i:j:k]` | å–å…ƒç´ æˆ–åˆ‡ç‰‡ | `item = lst[i]` | `lst=[1,2,3]; lst[0] # 1` | æ”¯æŒè´Ÿç´¢å¼•ã€æ­¥é•¿åˆ‡ç‰‡ | | `lst[i] = x` | æ›¿æ¢æŒ‡å®šä½ç½®çš„å…ƒç´  | `lst[i] = val` | `lst[1]=9 # [1,9,3]` | åŒæ ·æ”¯æŒåˆ‡ç‰‡èµ‹å€¼ `lst[1:3]=[8,8]` | | `del lst[i]` | åˆ é™¤æŒ‡å®šä½ç½®æˆ–åˆ‡ç‰‡ | `del lst[i]` | `del lst[0] # åˆ é™¤é¦–å…ƒç´ ` | | | `x in lst` | åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨åˆ—è¡¨ä¸­ | `x in lst` | `2 in [1,2,3] # True` | O(n) çº¿æ€§æœç´¢ | | `for x in lst:` | è¿­ä»£åˆ—è¡¨ | `for v in lst: ...` | `for v in [1,2]: print(v)` | | | `list(iterable)` | å°†å¯è¿­ä»£å¯¹è±¡è½¬æ¢ä¸ºåˆ—è¡¨ | `lst = list(some_iterable)` | `list('abc') # ['a','b','c']` | | --- ## 2ï¸âƒ£ å¸¸ç”¨å®ç”¨æŠ€å·§ï¼ˆä»£ç å—ä¿æŒåŸæ ·ï¼‰ ### åˆ—è¡¨æ¨å¯¼å¼ ```python # 1~10 çš„å¹³æ–¹ï¼Œåªä¿ç•™å¶æ•° evens_sq = [x**2 for x in range(1, 11) if x % 2 == 0] # -> [4, 16, 36, 64, 100] ``` ### åˆ—è¡¨åˆ‡ç‰‡ ```python lst = list(range(10)) # [0,1,2,3,4,5,6,7,8,9] first5 = lst[:5] # [0,1,2,3,4] mid = lst[2:-1] # [2,3,4,5,6,7,8] step2 = lst[::2] # [0,2,4,6,8] rev = lst[::-1] # [9,8,7,6,5,4,3,2,1,0] ``` ### å»é‡å¹¶ä¿æŒé¡ºåº ```python def uniq_keep_order(seq): seen = set() return [x for x in seq if not (x in seen or seen.add(x))] print(uniq_keep_order([1,2,2,3,1,4])) # [1,2,3,4] ``` ### ç”¨ `extend` æ›¿ä»£ `+=` ```python a = [1, 2] b = [3, 4] a.extend(b) # a -> [1,2,3,4] # a += b ä¹Ÿè¡Œï¼Œä½†é˜…è¯»æ—¶ä¸æ˜“ç«‹å³çœ‹å‡ºæ˜¯â€œæ‰©å±•â€ ``` ### å¿«é€Ÿç”Ÿæˆå›ºå®šå€¼åˆ—è¡¨ ```python zeros = [0] * 10 # [0,0,0,0,0,0,0,0,0,0] ones = [1] * 5 # [1,1,1,1,1] ``` > âš ï¸ **æ³¨æ„**ï¼šå¦‚æœåˆ—è¡¨å†…éƒ¨çš„å…ƒç´ æ˜¯å¯å˜å¯¹è±¡ï¼Œ`[obj] * n` ä¼šåˆ›å»º *n* ä¸ªå¯¹åŒä¸€å¯¹è±¡çš„å¼•ç”¨ï¼Œä¿®æ”¹å…¶ä¸­ä¸€ä¸ªä¼šå½±å“å…¨éƒ¨ã€‚ä¾‹å¦‚ï¼š ```python inner = [0] lst = [inner] * 3 # ä¸‰ä¸ªå…ƒç´ æŒ‡å‘åŒä¸€ä¸ªåˆ—è¡¨ lst[0].append(1) # æ‰€æœ‰å­åˆ—è¡¨éƒ½ä¼šå˜æˆ [0,1] ``` ### â€œç¿»è½¬ + è¿‡æ»¤â€ ç»„åˆ ```python # å–å€’æ•°ç¬¬ 2~ç¬¬ 5ï¼ˆå€’åºï¼‰ä¸”å¤§äº 10 çš„å…ƒç´  result = [x for x in lst[-5:-1][::-1] if x > 10] ``` --- ## 3ï¸âƒ£ ä¸å…¶ä»–å®¹å™¨çš„å¯¹æ¯”è¡¨ | å®¹å™¨ | æ˜¯å¦æœ‰åº | æ˜¯å¦å¯å˜ | å…³é”®ç‰¹æ€§ | é€‚ç”¨åœºæ™¯ | |------|----------|----------|----------|----------| | `list` | âœ… | âœ… | æ”¯æŒéšæœºè®¿é—®ã€åˆ‡ç‰‡ã€å¿«é€Ÿè¿½åŠ  | éœ€è¦é¡ºåºå­˜å‚¨ã€é¢‘ç¹éå†ã€å¶å°”æ’å…¥/åˆ é™¤ | | `tuple` | âœ… | âŒ | ä¸å¯å˜ï¼Œå“ˆå¸Œå¯ç”¨ä½œå­—å…¸é”® | å¸¸é‡åºåˆ—ã€å‡½æ•°è¿”å›å¤šå€¼ | | `set` | âŒ | âœ… | å»é‡ã€é›†åˆè¿ç®— O(1) æŸ¥æ‰¾ | å»é‡ã€æˆå‘˜æ£€æµ‹ã€æ•°å­¦é›†åˆæ“ä½œ | | `dict` | âœ… (Pythonâ€¯3.7+) | âœ… | é”®å€¼æ˜ å°„ï¼Œé”®å”¯ä¸€ | å¿«é€ŸæŸ¥æ‰¾ã€å…³è”æ•°æ® | --- ## 4ï¸âƒ£ å°ç»ƒä¹ ï¼ˆè‡ªæµ‹ï¼‰ > ç”¨ä¸‹é¢çš„åˆ—è¡¨å®Œæˆ **æ‰€æœ‰** æ³¨é‡Šä¸­çš„ä»»åŠ¡ï¼Œå°½é‡åªä½¿ç”¨åˆ—è¡¨è‡ªå¸¦çš„æ–¹æ³•ï¼ˆä¸è¦å¯¼å…¥é¢å¤–æ¨¡å—ï¼‰ã€‚ ```python data = [5, 2, 9, 2, 7, 5, 1, 3] # 1. åˆ é™¤ç¬¬ä¸€ä¸ªå‡ºç°çš„ 2 # 2. åœ¨æœ«å°¾è¿½åŠ  10 # 3. æŠŠ 7 æ›¿æ¢æˆ 8 # 4. æŠŠåˆ—è¡¨å€’åº # 5. ç»Ÿè®¡ 5 å‡ºç°äº†å‡ æ¬¡ # 6. ç”Ÿæˆä¸€ä¸ªæ–°åˆ—è¡¨ï¼Œåªä¿ç•™å¥‡æ•°ä¸”å»é‡ï¼Œä¿æŒåŸé¡ºåº ``` **å‚è€ƒç­”æ¡ˆï¼ˆä»…ä¾›æ£€éªŒï¼‰** ```python # 1 data.remove(2) # 2 data.append(10) # 3 idx = data.index(7) data[idx] = 8 # 4 data.reverse() # 5 cnt_five = data.count(5) # 6 def uniq_keep_order(seq): seen = set() return [x for x in seq if not (x in seen or seen.add(x))] odd_unique = uniq_keep_order([x for x in data if x % 2 == 1]) print(odd_unique) # ç¤ºä¾‹è¾“å‡º: [5, 9, 1, 3] ``` --- ## 5ï¸âƒ£ ä¸å…¶ä»–å®¹å™¨çš„å¯¹æ¯”ï¼ˆMarkdown è¡¨æ ¼ï¼‰ | å®¹å™¨ | æ˜¯å¦æœ‰åº | æ˜¯å¦å¯å˜ | å…³é”®ç‰¹æ€§ | é€‚ç”¨åœºæ™¯ | |------|----------|----------|----------|----------| | `list` | âœ… | âœ… | æ”¯æŒéšæœºè®¿é—®ã€åˆ‡ç‰‡ã€å¿«é€Ÿè¿½åŠ  | éœ€è¦é¡ºåºå­˜å‚¨ã€é¢‘ç¹éå†ã€å¶å°”æ’å…¥/åˆ é™¤ | | `tuple` | âœ… | âŒ | ä¸å¯å˜ï¼Œå“ˆå¸Œå¯ç”¨ä½œå­—å…¸é”® | å¸¸é‡åºåˆ—ã€å‡½æ•°è¿”å›å¤šå€¼ | | `set` | âŒ | âœ… | å»é‡ã€é›†åˆè¿ç®— O(1) æŸ¥æ‰¾ | å»é‡ã€æˆå‘˜æ£€æµ‹ã€æ•°å­¦é›†åˆæ“ä½œ | | `dict` | âœ… (Pythonâ€¯3.7+) | âœ… | é”®å€¼æ˜ å°„ï¼Œé”®å”¯ä¸€ | å¿«é€ŸæŸ¥æ‰¾ã€å…³è”æ•°æ® | --- ## 6ï¸âƒ£ æ¨èé˜…è¯» & è¿›é˜¶ï¼ˆå¯ç›´æ¥å¤åˆ¶åˆ° Notionï¼‰ | ç¼–å· | èµ„æº | é“¾æ¥ | |------|------|------| | 1 | å®˜æ–¹æ–‡æ¡£ â€“ `list` ç« èŠ‚ | <https://docs.python.org/3/tutorial/datastructures.html#more-on-lists> | | 2 | PEP 8 â€“ ä»£ç é£æ ¼æŒ‡å— | <https://peps.python.org/pep-0008/> | | 3 | ã€ŠEffective Pythonã€‹â€‘ ç¬¬ 12 æ¡ â€œPrefer list comprehensions over map and filterâ€ | <https://effectivepython.com/> | | 4 | `itertools` â€“ é«˜çº§è¿­ä»£å·¥å…· | <https://docs.python.org/3/library/itertools.html> | --- **ä½¿ç”¨æ–¹æ³•** 1. é€‰ä¸­éœ€è¦çš„è¡¨æ ¼ï¼ˆåŒ…æ‹¬æ ‡é¢˜è¡Œå’Œåˆ†éš”è¡Œ `---`ï¼‰ï¼Œ**Ctrlâ€¯+C** å¤åˆ¶ã€‚ 2. åœ¨ Notion é¡µé¢ç©ºç™½å¤„ **Ctrlâ€¯+â€¯V** ç²˜è´´ã€‚ 3. Notion ä¼šè‡ªåŠ¨æŠŠ Markdown è¡¨æ ¼è½¬ä¸º Notion åŸç”Ÿçš„è¡¨æ ¼å—ï¼Œä½ å¯ä»¥ç›´æ¥ç¼–è¾‘ã€æ·»åŠ æˆ–åˆ é™¤è¡Œ/åˆ—ã€‚ ç¥ä½ åœ¨ Notion ä¸­ä½¿ç”¨è¿™äº›è¡¨æ ¼é¡ºæ‰‹é«˜æ•ˆ ğŸš€ï¼
ç›´æ¥è¾“å‡ºMarkdown è¯­æ³•

profile
gpt-oss:120b
æ€è€ƒç”¨æ—¶ 1 ç§’
ä¸‹é¢æ˜¯å…¨éƒ¨ Markdown è¯­æ³•çš„è¡¨æ ¼å’Œä»£ç å—ï¼Œç›´æ¥å¤åˆ¶ç²˜è´´åˆ° Notionï¼ˆæˆ–ä»»ä½•æ”¯æŒ Markdown çš„ç¼–è¾‘å™¨ï¼‰å³å¯å¾—åˆ°æ¸²æŸ“åçš„è¡¨æ ¼ã€‚

1ï¸âƒ£ list å¸¸ç”¨æ–¹æ³•é€ŸæŸ¥è¡¨
markdown

æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
âŒ„
| æ–¹æ³• | åŠŸèƒ½ | å¸¸ç”¨è¯­æ³• | ç¤ºä¾‹ | å¤‡æ³¨ / å¸¸è§å‘ |
|------|------|----------|------|--------------|
| `append(x)` | åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å•ä¸ªå…ƒç´  `x` | `lst.append(item)` | `lst=[1,2]; lst.append(3)  # [1,2,3]` | O(1) æ—¶é—´å¤æ‚åº¦ |
| `extend(iterable)` | ç”¨å¯è¿­ä»£å¯¹è±¡çš„æ¯ä¸ªå…ƒç´ æ‰©å±•åˆ—è¡¨ | `lst.extend(other)` | `lst=[1]; lst.extend([2,3])  # [1,2,3]` | ç­‰ä»·äº `lst += other`ï¼Œ**ä¸è¦**å†™æˆ `lst.append(other)`ï¼ˆä¼šæŠŠæ•´ä¸ªå¯¹è±¡å½“æˆä¸€ä¸ªå…ƒç´ ï¼‰ |
| `insert(i, x)` | åœ¨ç´¢å¼• `i` ä½ç½®æ’å…¥å…ƒç´  `x`ï¼Œåé¢çš„å…ƒç´ å³ç§» | `lst.insert(idx, item)` | `lst=[1,3]; lst.insert(1,2)  # [1,2,3]` | è´Ÿç´¢å¼•åŒæ ·æœ‰æ•ˆï¼›O(n) å¤æ‚åº¦ |
| `remove(x)` | åˆ é™¤åˆ—è¡¨ä¸­**ç¬¬ä¸€ä¸ª**å€¼ç­‰äº `x` çš„å…ƒç´  | `lst.remove(item)` | `lst=[1,2,2,3]; lst.remove(2)  # [1,2,3]` | è‹¥ä¸å­˜åœ¨æŠ› `ValueError` |
| `pop([i])` | åˆ é™¤å¹¶è¿”å›ç´¢å¼• `i` å¤„çš„å…ƒç´ ï¼Œé»˜è®¤ `i=-1`ï¼ˆå¼¹å‡ºæœ«å°¾ï¼‰ | `item = lst.pop(idx)` | `lst=[1,2,3]; lst.pop()  # è¿”å› 3ï¼Œåˆ—è¡¨å˜ä¸º [1,2]` | ç©ºåˆ—è¡¨è°ƒç”¨ä¼šæŠ› `IndexError` |
| `clear()` | åˆ é™¤åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ ï¼Œå¾—åˆ°ç©ºåˆ—è¡¨ | `lst.clear()` | `lst=[1,2]; lst.clear()  # []` | ç­‰ä»·äº `del lst[:]` |
| `index(x, start=0, end=len(lst))` | è¿”å›å€¼ç­‰äº `x` çš„**ç¬¬ä¸€ä¸ª**å…ƒç´ çš„ç´¢å¼•ï¼Œå¯é€‰æœç´¢åŒºé—´ | `pos = lst.index(item, start, end)` | `lst=[1,2,3]; lst.index(2)  # 1` | è‹¥ä¸å­˜åœ¨æŠ› `ValueError` |
| `count(x)` | ç»Ÿè®¡åˆ—è¡¨ä¸­å€¼ç­‰äº `x` çš„å…ƒç´ ä¸ªæ•° | `n = lst.count(item)` | `lst=[1,2,2,3]; lst.count(2)  # 2` | O(n) |
| `sort(key=None, reverse=False)` | åŸåœ°æ’åºï¼Œè¿”å› `None` | `lst.sort(key=func, reverse=True)` | `lst=[3,1,2]; lst.sort()  # [1,2,3]` | **æ³¨æ„**ï¼š`list.sort()` **ä¼šä¿®æ”¹åŸåˆ—è¡¨**ï¼Œè‹¥éœ€è¦ä¿ç•™åŸåˆ—è¡¨è¯·ä½¿ç”¨ `sorted(lst)` |
| `reverse()` | åŸåœ°ç¿»è½¬åˆ—è¡¨é¡ºåº | `lst.reverse()` | `lst=[1,2,3]; lst.reverse()  # [3,2,1]` | åŒæ ·è¿”å› `None`ï¼Œä¸ç”Ÿæˆæ–°åˆ—è¡¨ |
| `copy()` | è¿”å›åˆ—è¡¨çš„**æµ…æ‹·è´**ï¼ˆç­‰ä»·äº `lst[:]`ï¼‰ | `new_lst = lst.copy()` | `a=[1,2]; b=a.copy(); b.append(3)  # a=[1,2], b=[1,2,3]` | è‹¥åˆ—è¡¨å†…éƒ¨è¿˜æœ‰å¯å˜å¯¹è±¡ï¼Œéœ€è¦ `copy.deepcopy` |
| `len(lst)` | è¿”å›åˆ—è¡¨é•¿åº¦ï¼ˆä¸æ˜¯æ–¹æ³•ï¼‰ | `n = len(lst)` | `len([1,2,3])  # 3` |  |
| `lst[i]` / `lst[i:j:k]` | å–å…ƒç´ æˆ–åˆ‡ç‰‡ | `item = lst[i]` | `lst=[1,2,3]; lst[0]  # 1` | æ”¯æŒè´Ÿç´¢å¼•ã€æ­¥é•¿åˆ‡ç‰‡ |
| `lst[i] = x` | æ›¿æ¢æŒ‡å®šä½ç½®çš„å…ƒç´  | `lst[i] = val` | `lst[1]=9  # [1,9,3]` | åŒæ ·æ”¯æŒåˆ‡ç‰‡èµ‹å€¼ `lst[1:3]=[8,8]` |
| `del lst[i]` | åˆ é™¤æŒ‡å®šä½ç½®æˆ–åˆ‡ç‰‡ | `del lst[i]` | `del lst[0]  # åˆ é™¤é¦–å…ƒç´ ` |  |
| `x in lst` | åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨åˆ—è¡¨ä¸­ | `x in lst` | `2 in [1,2,3]  # True` | O(n) çº¿æ€§æœç´¢ |
| `for x in lst:` | è¿­ä»£åˆ—è¡¨ | `for v in lst: ...` | `for v in [1,2]: print(v)` |  |
| `list(iterable)` | å°†å¯è¿­ä»£å¯¹è±¡è½¬æ¢ä¸ºåˆ—è¡¨ | `lst = list(some_iterable)` | `list('abc')  # ['a','b','c']` |  |
2ï¸âƒ£ å¸¸ç”¨å®ç”¨æŠ€å·§ï¼ˆä»£ç å—ï¼‰
markdown

æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
âŒ„
âŒ„
#### åˆ—è¡¨æ¨å¯¼å¼
```python
# 1~10 çš„å¹³æ–¹ï¼Œåªä¿ç•™å¶æ•°
evens_sq = [x**2 for x in range(1, 11) if x % 2 == 0]
# -> [4, 16, 36, 64, 100]
åˆ—è¡¨åˆ‡ç‰‡
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
lst = list(range(10))   # [0,1,2,3,4,5,6,7,8,9]

first5 = lst[:5]        # [0,1,2,3,4]
mid    = lst[2:-1]      # [2,3,4,5,6,7,8]
step2  = lst[::2]       # [0,2,4,6,8]
rev    = lst[::-1]      # [9,8,7,6,5,4,3,2,1,0]
å»é‡å¹¶ä¿æŒé¡ºåº
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
âŒ„
def uniq_keep_order(seq):
    seen = set()
    return [x for x in seq if not (x in seen or seen.add(x))]

print(uniq_keep_order([1,2,2,3,1,4]))  # [1,2,3,4]
ç”¨ extend æ›¿ä»£
<details type="reasoning" done="true" duration="1"> <summary>Thought for 1 seconds</summary> > The user wants "ç›´æ¥è¾“å‡ºMarkdown è¯­æ³•". Likely they want the markdown tables directly, no extra explanation. Provide the markdown code for the list methods table, tips maybe, but likely just the tables. Provide markdown code blocks with tables. Let's output the markdown for the list methods, and maybe other tables. Provide as raw markdown. </details> ä¸‹é¢æ˜¯å…¨éƒ¨ **Markdown** è¯­æ³•çš„è¡¨æ ¼å’Œä»£ç å—ï¼Œç›´æ¥å¤åˆ¶ç²˜è´´åˆ° Notionï¼ˆæˆ–ä»»ä½•æ”¯æŒ Markdown çš„ç¼–è¾‘å™¨ï¼‰å³å¯å¾—åˆ°æ¸²æŸ“åçš„è¡¨æ ¼ã€‚ --- ### 1ï¸âƒ£ `list` å¸¸ç”¨æ–¹æ³•é€ŸæŸ¥è¡¨ ```markdown | æ–¹æ³• | åŠŸèƒ½ | å¸¸ç”¨è¯­æ³• | ç¤ºä¾‹ | å¤‡æ³¨ / å¸¸è§å‘ | |------|------|----------|------|--------------| | `append(x)` | åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å•ä¸ªå…ƒç´  `x` | `lst.append(item)` | `lst=[1,2]; lst.append(3) # [1,2,3]` | O(1) æ—¶é—´å¤æ‚åº¦ | | `extend(iterable)` | ç”¨å¯è¿­ä»£å¯¹è±¡çš„æ¯ä¸ªå…ƒç´ æ‰©å±•åˆ—è¡¨ | `lst.extend(other)` | `lst=[1]; lst.extend([2,3]) # [1,2,3]` | ç­‰ä»·äº `lst += other`ï¼Œ**ä¸è¦**å†™æˆ `lst.append(other)`ï¼ˆä¼šæŠŠæ•´ä¸ªå¯¹è±¡å½“æˆä¸€ä¸ªå…ƒç´ ï¼‰ | | `insert(i, x)` | åœ¨ç´¢å¼• `i` ä½ç½®æ’å…¥å…ƒç´  `x`ï¼Œåé¢çš„å…ƒç´ å³ç§» | `lst.insert(idx, item)` | `lst=[1,3]; lst.insert(1,2) # [1,2,3]` | è´Ÿç´¢å¼•åŒæ ·æœ‰æ•ˆï¼›O(n) å¤æ‚åº¦ | | `remove(x)` | åˆ é™¤åˆ—è¡¨ä¸­**ç¬¬ä¸€ä¸ª**å€¼ç­‰äº `x` çš„å…ƒç´  | `lst.remove(item)` | `lst=[1,2,2,3]; lst.remove(2) # [1,2,3]` | è‹¥ä¸å­˜åœ¨æŠ› `ValueError` | | `pop([i])` | åˆ é™¤å¹¶è¿”å›ç´¢å¼• `i` å¤„çš„å…ƒç´ ï¼Œé»˜è®¤ `i=-1`ï¼ˆå¼¹å‡ºæœ«å°¾ï¼‰ | `item = lst.pop(idx)` | `lst=[1,2,3]; lst.pop() # è¿”å› 3ï¼Œåˆ—è¡¨å˜ä¸º [1,2]` | ç©ºåˆ—è¡¨è°ƒç”¨ä¼šæŠ› `IndexError` | | `clear()` | åˆ é™¤åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ ï¼Œå¾—åˆ°ç©ºåˆ—è¡¨ | `lst.clear()` | `lst=[1,2]; lst.clear() # []` | ç­‰ä»·äº `del lst[:]` | | `index(x, start=0, end=len(lst))` | è¿”å›å€¼ç­‰äº `x` çš„**ç¬¬ä¸€ä¸ª**å…ƒç´ çš„ç´¢å¼•ï¼Œå¯é€‰æœç´¢åŒºé—´ | `pos = lst.index(item, start, end)` | `lst=[1,2,3]; lst.index(2) # 1` | è‹¥ä¸å­˜åœ¨æŠ› `ValueError` | | `count(x)` | ç»Ÿè®¡åˆ—è¡¨ä¸­å€¼ç­‰äº `x` çš„å…ƒç´ ä¸ªæ•° | `n = lst.count(item)` | `lst=[1,2,2,3]; lst.count(2) # 2` | O(n) | | `sort(key=None, reverse=False)` | åŸåœ°æ’åºï¼Œè¿”å› `None` | `lst.sort(key=func, reverse=True)` | `lst=[3,1,2]; lst.sort() # [1,2,3]` | **æ³¨æ„**ï¼š`list.sort()` **ä¼šä¿®æ”¹åŸåˆ—è¡¨**ï¼Œè‹¥éœ€è¦ä¿ç•™åŸåˆ—è¡¨è¯·ä½¿ç”¨ `sorted(lst)` | | `reverse()` | åŸåœ°ç¿»è½¬åˆ—è¡¨é¡ºåº | `lst.reverse()` | `lst=[1,2,3]; lst.reverse() # [3,2,1]` | åŒæ ·è¿”å› `None`ï¼Œä¸ç”Ÿæˆæ–°åˆ—è¡¨ | | `copy()` | è¿”å›åˆ—è¡¨çš„**æµ…æ‹·è´**ï¼ˆç­‰ä»·äº `lst[:]`ï¼‰ | `new_lst = lst.copy()` | `a=[1,2]; b=a.copy(); b.append(3) # a=[1,2], b=[1,2,3]` | è‹¥åˆ—è¡¨å†…éƒ¨è¿˜æœ‰å¯å˜å¯¹è±¡ï¼Œéœ€è¦ `copy.deepcopy` | | `len(lst)` | è¿”å›åˆ—è¡¨é•¿åº¦ï¼ˆä¸æ˜¯æ–¹æ³•ï¼‰ | `n = len(lst)` | `len([1,2,3]) # 3` | | | `lst[i]` / `lst[i:j:k]` | å–å…ƒç´ æˆ–åˆ‡ç‰‡ | `item = lst[i]` | `lst=[1,2,3]; lst[0] # 1` | æ”¯æŒè´Ÿç´¢å¼•ã€æ­¥é•¿åˆ‡ç‰‡ | | `lst[i] = x` | æ›¿æ¢æŒ‡å®šä½ç½®çš„å…ƒç´  | `lst[i] = val` | `lst[1]=9 # [1,9,3]` | åŒæ ·æ”¯æŒåˆ‡ç‰‡èµ‹å€¼ `lst[1:3]=[8,8]` | | `del lst[i]` | åˆ é™¤æŒ‡å®šä½ç½®æˆ–åˆ‡ç‰‡ | `del lst[i]` | `del lst[0] # åˆ é™¤é¦–å…ƒç´ ` | | | `x in lst` | åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨åˆ—è¡¨ä¸­ | `x in lst` | `2 in [1,2,3] # True` | O(n) çº¿æ€§æœç´¢ | | `for x in lst:` | è¿­ä»£åˆ—è¡¨ | `for v in lst: ...` | `for v in [1,2]: print(v)` | | | `list(iterable)` | å°†å¯è¿­ä»£å¯¹è±¡è½¬æ¢ä¸ºåˆ—è¡¨ | `lst = list(some_iterable)` | `list('abc') # ['a','b','c']` | | ``` --- ### 2ï¸âƒ£ å¸¸ç”¨å®ç”¨æŠ€å·§ï¼ˆä»£ç å—ï¼‰ ```markdown #### åˆ—è¡¨æ¨å¯¼å¼ ```python # 1~10 çš„å¹³æ–¹ï¼Œåªä¿ç•™å¶æ•° evens_sq = [x**2 for x in range(1, 11) if x % 2 == 0] # -> [4, 16, 36, 64, 100] ``` #### åˆ—è¡¨åˆ‡ç‰‡ ```python lst = list(range(10)) # [0,1,2,3,4,5,6,7,8,9] first5 = lst[:5] # [0,1,2,3,4] mid = lst[2:-1] # [2,3,4,5,6,7,8] step2 = lst[::2] # [0,2,4,6,8] rev = lst[::-1] # [9,8,7,6,5,4,3,2,1,0] ``` #### å»é‡å¹¶ä¿æŒé¡ºåº ```python def uniq_keep_order(seq): seen = set() return [x for x in seq if not (x in seen or seen.add(x))] print(uniq_keep_order([1,2,2,3,1,4])) # [1,2,3,4] ``` #### ç”¨ `extend` æ›¿ä»£
pythonè¿›ç¨‹é€šä¿¡

profile
gpt-oss:120b
æ€è€ƒç”¨æ—¶ 2 ç§’
ğŸ Python è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰å…¨æ”»ç•¥
ç›®æ ‡ï¼šå¿«é€Ÿäº†è§£åœ¨ Python ä¸­ä¸åŒè¿›ç¨‹ä¹‹é—´å¦‚ä½•ä¼ é€’æ•°æ®ã€åŒæ­¥çŠ¶æ€ã€å…±äº«èµ„æºï¼Œå¹¶æä¾›å¯ç›´æ¥è¿è¡Œçš„ç¤ºä¾‹ä»£ç ã€‚
é€‚ç”¨èŒƒå›´ï¼šmultiprocessingï¼ˆè·¨å¹³å°çš„å¤šè¿›ç¨‹åº“ï¼‰+ æ ‡å‡†åº“ socketã€queueã€multiprocessing.shared_memoryï¼ˆPythonâ€¯3.8+ï¼‰+ ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ ZeroMQã€Redisï¼‰çš„å¸¸è§ä½¿ç”¨åœºæ™¯ã€‚ 

1ï¸âƒ£ ä¸ºä»€ä¹ˆéœ€è¦è¿›ç¨‹é—´é€šä¿¡ï¼Ÿ
åœºæ™¯
è¿›ç¨‹ VS çº¿ç¨‹
éœ€è¦çš„ IPC æ‰‹æ®µ
CPUâ€‘å¯†é›†å‹è®¡ç®—ï¼ˆåˆ©ç”¨å¤šæ ¸ï¼‰	
å¤šè¿›ç¨‹ï¼ˆæ¯ä¸ªè¿›ç¨‹ç‹¬ç«‹çš„ GILï¼‰	
Pipeã€Queueã€å…±äº«å†…å­˜ã€Manager
å¤§é‡æ•°æ®å…±äº«ï¼ˆå›¾ç‰‡ã€çŸ©é˜µï¼‰	
å¤šè¿›ç¨‹	
å…±äº«å†…å­˜ (shared_memoryã€Value/Array)
è·¨æœºå™¨/è·¨è¯­è¨€åä½œ	
å¤šè¿›ç¨‹æˆ–å¤šä¸»æœº	
å¥—æ¥å­—ã€HTTPã€ZeroMQã€Redisã€RabbitMQ ç­‰
éœ€è¦åŒæ­¥/äº’æ–¥	
å¤šè¿›ç¨‹	
Lockã€Eventã€Conditionã€Barrier
åŠ¨æ€ä»»åŠ¡è°ƒåº¦ï¼ˆç”Ÿäº§è€…â€‘æ¶ˆè´¹è€…ï¼‰	
å¤šè¿›ç¨‹	
Queueã€JoinableQueueã€Pool.apply_async
æ ¸å¿ƒåŸåˆ™ï¼šæ•°æ®çš„å¯åºåˆ—åŒ–ï¼ˆpickleï¼‰æ˜¯å¤§å¤šæ•° IPC æ‰‹æ®µçš„å‰æï¼Œé™¤éä½¿ç”¨å…±äº«å†…å­˜æˆ–ä¸“é—¨çš„äºŒè¿›åˆ¶åè®®ã€‚ 

2ï¸âƒ£ multiprocessing æ¨¡å—çš„å‡ å¤§é€šä¿¡å·¥å…·
multiprocessing æ˜¯ Python æ ‡å‡†åº“ï¼Œè·¨å¹³å°ï¼ˆWindowsã€Linuxã€macOSï¼‰å®ç°äº†è¿›ç¨‹åˆ›å»ºã€åŒæ­¥ã€å…±äº«ç­‰åŠŸèƒ½ã€‚ 

2.1 Pipe â€”â€” åŒå‘ç®¡é“
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
from multiprocessing import Process, Pipe

def worker(conn):
    # æ”¶åˆ°ä¸»è¿›ç¨‹å‘é€çš„æ•°å­—ï¼Œè®¡ç®—å¹³æ–¹åè¿”å›
    while True:
        msg = conn.recv()                # é˜»å¡ç­‰å¾…
        if msg == "STOP":
            break
        conn.send(msg ** 2)

if __name__ == "__main__":
    parent_conn, child_conn = Pipe()      # åˆ›å»ºä¸€å¯¹è¿æ¥å¯¹è±¡
    p = Process(target=worker, args=(child_conn,))
    p.start()

    for i in range(5):
        parent_conn.send(i)              # å‘é€æ•°æ®åˆ°å­è¿›ç¨‹
        print(f"{i}^2 = {parent_conn.recv()}")  # æ¥æ”¶å­è¿›ç¨‹è¿”å›

    parent_conn.send("STOP")             # ç»“æŸä¿¡å·
    p.join()
ç‰¹ç‚¹ï¼š
åŒå‘ï¼ˆé»˜è®¤ duplex=Trueï¼‰ï¼Œä¹Ÿå¯ä»¥è®¾ duplex=False å˜æˆå•å‘ã€‚
é€‚åˆç‚¹å¯¹ç‚¹çš„å°‘é‡æ•°æ®äº¤æ¢ï¼Œå¼€é”€å°ã€‚
åªèƒ½åœ¨çˆ¶å­è¿›ç¨‹ä¹‹é—´ä½¿ç”¨ï¼ˆä¸é€‚ç”¨äºå¤šè¿›ç¨‹ç½‘ç»œæ‹“æ‰‘ï¼‰ã€‚
2.2 Queue â€”â€” ç”Ÿäº§è€…â€‘æ¶ˆè´¹è€…å®‰å…¨é˜Ÿåˆ—
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
from multiprocessing import Process, Queue
import time, random

def producer(q, n):
    for i in range(n):
        item = random.randint(1, 100)
        q.put(item)                     # æ”¾å…¥é˜Ÿåˆ—ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰
        print(f"Producer put {item}")
        time.sleep(0.1)

def consumer(q):
    while True:
        item = q.get()                  # é˜»å¡å–å‡º
        if item is None:                # çº¦å®šçš„ç»“æŸæ ‡è®°
            break
        print(f"Consumer got {item}")

if __name__ == "__main__":
    q = Queue()
    p = Process(target=producer, args=(q, 10))
    c = Process(target=consumer, args=(q,))
    p.start(); c.start()
    p.join()
    q.put(None)      # ç»™æ¶ˆè´¹è€…å‘é€ç»ˆæ­¢ä¿¡å·
    c.join()
ç‰¹ç‚¹ï¼š
åŸºäºåº•å±‚ Pipe + Lock å®ç°ï¼Œæ”¯æŒ å¤šç”Ÿäº§è€…â€‘å¤šæ¶ˆè´¹è€…ã€‚
è‡ªåŠ¨åºåˆ—åŒ–ï¼ˆpickleï¼‰ï¼Œä¸é€‚åˆæ”¾å…¥ ä¸å¯ pickle çš„å¯¹è±¡ï¼ˆå¦‚æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„ã€socketï¼‰ã€‚
JoinableQueue è¿˜èƒ½åœ¨ task_done() / join() ä¹‹é—´å®ç°ä»»åŠ¡å®Œæˆçš„åŒæ­¥ã€‚
2.3 Manager â€”â€” å…±äº«å¯¹è±¡ï¼ˆåˆ—è¡¨ã€å­—å…¸ã€Namespaceï¼‰
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
âŒ„
âŒ„
âŒ„
from multiprocessing import Process, Manager

def worker(d, lst, i):
    d[i] = i * i
    lst.append(i)

if __name__ == "__main__":
    with Manager() as mgr:
        shared_dict = mgr.dict()
        shared_list = mgr.list()
        procs = [Process(target=worker, args=(shared_dict, shared_list, i))
                 for i in range(5)]
        for p in procs: p.start()
        for p in procs: p.join()

        print("dict:", dict(shared_dict))
        print("list:", list(shared_list))
ç‰¹ç‚¹ï¼š
é€šè¿‡ æœåŠ¡å™¨è¿›ç¨‹ï¼ˆManagerï¼‰åœ¨è¿›ç¨‹é—´ä»£ç†å¯¹è±¡ï¼Œå®ç°å‡ ä¹æ‰€æœ‰å¯å˜å®¹å™¨çš„å…±äº«ã€‚
é€‚ç”¨äº å¤æ‚ç»“æ„ï¼ˆåµŒå¥— dict/listï¼‰ä½†æ€§èƒ½ä¸å¦‚ Queue/Pipeï¼ˆæ¯ä¸€æ¬¡è®¿é—®éƒ½ä¼šç»è¿‡ç½‘ç»œ RPCï¼‰ã€‚
2.4 Value / Array â€”â€” åŸå­å…±äº«å†…å­˜
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
âŒ„
âŒ„
âŒ„
âŒ„
from multiprocessing import Process, Value, Array

def inc(counter):
    for _ in range(1000):
        with counter.get_lock():        # åŸå­åŠ é”
            counter.value += 1

if __name__ == "__main__":
    cnt = Value('i', 0)   # 'i' = signed int, åˆå§‹å€¼ 0
    procs = [Process(target=inc, args=(cnt,)) for _ in range(4)]
    for p in procs: p.start()
    for p in procs: p.join()
    print("final count =", cnt.value)   # 4000
ç‰¹ç‚¹ï¼š
åªé€‚åˆ å•ä¸ªæ ‡é‡ æˆ– ä¸€ç»´æ•°ç»„ï¼ˆArray('d', [0.0]*10)ï¼‰ã€‚
å¿…é¡»ä½¿ç”¨åŒæ­¥åŸè¯­ï¼ˆget_lock()ï¼‰æ¥ä¿è¯åŸå­æ€§ã€‚
åºåˆ—åŒ–æˆæœ¬ä¸º 0ï¼Œå› ä¸ºæ•°æ®ç›´æ¥å­˜æ”¾åœ¨å…±äº«å†…å­˜ä¸­ã€‚
2.4 shared_memoryï¼ˆPythonâ€¯3.8+ï¼‰â€”â€” çœŸæ­£çš„é›¶æ‹·è´å…±äº«
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
âŒ„
âŒ„
âŒ„
# è¿›ç¨‹ Aï¼šåˆ›å»ºå…±äº«å†…å­˜å—å¹¶å†™å…¥ NumPy æ•°ç»„
import numpy as np
from multiprocessing import Process
from multiprocessing import shared_memory

def writer():
    a = np.arange(10, dtype=np.int64)
    shm = shared_memory.SharedMemory(create=True, size=a.nbytes, name='my_shm')
    buf = np.ndarray(a.shape, dtype=a.dtype, buffer=shm.buf)
    buf[:] = a[:]                        # ç›´æ¥å†™å…¥å…±äº«å†…å­˜
    print("writer: data written")
    # å­è¿›ç¨‹è¯»å–åè‡ªè¡Œ unlinkï¼Œçˆ¶è¿›ç¨‹è¿™é‡Œä¸ close/unlinkï¼Œç•™ç»™å­è¿›ç¨‹
    # shm.close()  # è‹¥åœ¨æ­¤å…³é—­ï¼Œå­è¿›ç¨‹ä»èƒ½é€šè¿‡ name è®¿é—®

def reader():
    # é€šè¿‡åå­—æ‰“å¼€å·²æœ‰å…±äº«å†…å­˜
    existing = shared_memory.SharedMemory(name='my_shm')
    b = np.ndarray((10,), dtype=np.int64, buffer=existing.buf)
    print("reader sees:", b)
    existing.close()
    existing.unlink()                    # æœ€åä¸€ä¸ªä½¿ç”¨è€…è´Ÿè´£é‡Šæ”¾

if __name__ == '__main__':
    p1 = Process(target=writer)
    p2 = Process(target=reader)
    p1.start(); p1.join()
    p2.start(); p2.join()
ç‰¹ç‚¹ï¼š
é›¶æ‹·è´ï¼šæ•°æ®åœ¨å¤šä¸ªè¿›ç¨‹é—´å…±äº«åŒä¸€å—ç‰©ç†å†…å­˜ï¼Œé€‚åˆå¤§çŸ©é˜µã€å›¾åƒã€éŸ³è§†é¢‘å¸§ã€‚
åªèƒ½å…±äº« äºŒè¿›åˆ¶/NumPy ä¹‹ç±»çš„ è¿ç»­å†…å­˜ å¯¹è±¡ã€‚
éœ€è¦è‡ªè¡Œç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼ˆunlinkï¼‰ï¼Œå¦åˆ™ä¼šç•™ä¸‹ç³»ç»Ÿæ®‹ç•™çš„å…±äº«å—ã€‚
3ï¸âƒ£ åŸºäºå¥—æ¥å­—ï¼ˆSocketï¼‰çš„è·¨æœºå™¨/è·¨è¯­è¨€é€šä¿¡
å¥—æ¥å­—æ˜¯æœ€é€šç”¨çš„ IPC æ‰‹æ®µï¼Œé€‚ç”¨äº åŒæœºå¤šè¿›ç¨‹ã€è·¨ä¸»æœºï¼Œä»¥åŠ ä¸åŒè¯­è¨€ï¼ˆC/C++ã€Javaã€Goã€Node.jsï¼‰ä¹‹é—´çš„äº¤äº’ã€‚

3.1 ç®€å• TCP ç¤ºä¾‹ï¼ˆPython3ï¼‰
æœåŠ¡å™¨ï¼ˆçˆ¶è¿›ç¨‹ï¼‰

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
âŒ„
âŒ„
âŒ„
âŒ„
# server.py
import socket
import struct

def start_server(host='127.0.0.1', port=6000):
    srv = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    srv.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
    srv.bind((host, port))
    srv.listen()
    print(f"Listening on {host}:{port}")

    conn, addr = srv.accept()
    print("Connected by", addr)

    while True:
        # è¯»å– 4 å­—èŠ‚æ•´æ•°ï¼ˆç½‘ç»œå­—èŠ‚åºï¼‰
        data = conn.recv(4)
        if not data:
            break
        n = struct.unpack('!i', data)[0]   # '!i' = bigâ€‘endian signed int
        print("recv:", n)
        conn.sendall(struct.pack('!i', n * n))

    conn.close()
    srv.close()

if __name__ == '__main__':
    start_server()
å®¢æˆ·ç«¯ï¼ˆå­è¿›ç¨‹ï¼‰

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
âŒ„
âŒ„
âŒ„
# client.py
import socket, struct, time

def client(host='127.0.0.1', port=6000):
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((host, port))
    for i in range(5):
        s.sendall(struct.pack('!i', i))
        res = s.recv(4)
        print(f"{i}^2 = {struct.unpack('!i', res)[0]}")
        time.sleep(0.2)
    s.close()

if __name__ == '__main__':
    client()
ä¼˜ç‚¹ï¼š
å®Œå…¨è·¨å¹³å°ã€è·¨è¯­è¨€ã€‚
å¯é…åˆ select/poll/asyncio å®ç° éé˜»å¡ã€äº‹ä»¶é©±åŠ¨ã€‚
ç¼ºç‚¹ï¼š
éœ€è¦è‡ªè¡Œå¤„ç† åºåˆ—åŒ–åè®®ï¼ˆå¦‚ structã€jsonã€msgpackï¼‰ï¼Œæ¯” Queue æ›´åº•å±‚ã€‚
3.2 multiprocessing.connectionï¼ˆæ›´é«˜å±‚çš„ socket/pipeï¼‰
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
from multiprocessing.connection import Listener, Client

def server():
    address = ('localhost', 6001)          # åªåœ¨æœ¬æœºå¯è¾¾
    listener = Listener(address, authkey=b'secret')
    conn = listener.accept()
    print('Connection accepted')
    while True:
        try:
            msg = conn.recv()
            if msg == 'STOP':
                break
            conn.send(msg * 2)
        except EOFError:
            break
    conn.close()
    listener.close()

def client():
    address = ('localhost', 6001)
    conn = Client(address, authkey=b'secret')
    for i in range(5):
        conn.send(i)
        print('reply:', conn.recv())
    conn.send('STOP')
    conn.close()

if __name__ == '__main__':
    from multiprocessing import Process
    p = Process(target=server); p.start()
    client()
    p.join()
ç‰¹ç‚¹ï¼š
åŸºäº socket å®ç°ï¼Œä½†æä¾›äº† pickle è‡ªåŠ¨åºåˆ—åŒ– ä¸ å¯é€‰è®¤è¯ (authkey)ã€‚
é€‚åˆ æœ¬æœº æˆ– å±€åŸŸç½‘ çš„è½»é‡çº§ RPC åœºæ™¯ã€‚
4ï¸âƒ£ è¿›ç¨‹åŒæ­¥/äº’æ–¥ï¼ˆé…åˆé€šä¿¡ï¼‰
åŒæ­¥åŸè¯­
ç”¨é€”
ç¤ºä¾‹
Lock / RLock	
äº’æ–¥è®¿é—®å…±äº«èµ„æº	
with lock:
Event	
å•å‘ä¿¡å·ï¼ˆå¦‚â€œä»»åŠ¡å·²å‡†å¤‡å¥½â€ï¼‰	
event.set()/event.wait()
Condition	
å¤æ‚çš„ç”Ÿäº§è€…â€‘æ¶ˆè´¹è€…ï¼ˆå¯æŒ‡å®šæ¡ä»¶ï¼‰	
cond.wait()/cond.notify_all()
Barrier	
å¤šè¿›ç¨‹åœ¨åŒä¸€ç‚¹â€œé›†åˆâ€åç»§ç»­	
barrier.wait()
Semaphore / BoundedSemaphore	
é™åˆ¶å¹¶å‘æ•°ï¼ˆå¦‚åŒæ—¶åªèƒ½æœ‰ N ä¸ªå­è¿›ç¨‹è®¿é—®å¤–éƒ¨ APIï¼‰	
sem.acquire()/sem.release()
å°æŠ€å·§ï¼šåœ¨ä½¿ç”¨ Queue/Pipe æ—¶ï¼Œä¸å¿…é¢å¤–åŠ é”â€”â€”å®ƒä»¬å†…éƒ¨å·²ç»å®ç°äº†å®‰å…¨çš„ Lockï¼Œé™¤éä½ åœ¨åŒä¸€è¿æ¥å¯¹è±¡ä¸Šè¿›è¡Œæ··åˆè¯»å†™ï¼ˆè¿™ä¼šå¯¼è‡´æ­»é”ï¼‰ï¼Œæ­¤æ—¶å»ºè®®ä½¿ç”¨ å•ç‹¬çš„è¯»å†™ç«¯ï¼ˆå¦‚ Pipe(duplex=False)ï¼‰æˆ– ä¸¤æ¡é€šé“ã€‚ 

5ï¸âƒ£ å¸¸è§å‘ & æ€§èƒ½è°ƒä¼˜
ç—‡çŠ¶
å¯èƒ½çš„æ ¹æœ¬åŸå› 
è§£å†³åŠæ³•
pickle æŠ¥é”™ â€œCan't pickle local object â€¦â€	
ä¼ é€’çš„å¯¹è±¡æ˜¯ å±€éƒ¨å‡½æ•°/ç±» æˆ– lambda	
å°†å¯¹è±¡æå‡åˆ°æ¨¡å—é¡¶å±‚ï¼Œæˆ–æ‰‹åŠ¨å®ç° __reduce__ï¼›æˆ–è€…æ”¹ç”¨ å…±äº«å†…å­˜ï¼ˆä¸éœ€è¦åºåˆ—åŒ–ï¼‰ã€‚
ç¨‹åºåœ¨ Windows ä¸Š fork å¤±è´¥	
Windows åªèƒ½ spawnï¼Œå­è¿›ç¨‹ä¸ä¼šç»§æ‰¿çˆ¶è¿›ç¨‹çš„å…¨å±€å˜é‡	
æŠŠæ‰€æœ‰èµ„æºåˆ›å»ºæ”¾åœ¨ if __name__ == '__main__': é‡Œï¼›ä½¿ç”¨ multiprocessing.set_start_method('spawn')ï¼ˆé»˜è®¤ï¼‰ã€‚
Queue é˜Ÿåˆ—å¡ä½ä¸åŠ¨	
æ¶ˆè´¹è€…è¿›ç¨‹æ„å¤–é€€å‡ºæˆ– æœªå‘é€ç»“æŸæ ‡è®°	
ä½¿ç”¨ JoinableQueue + task_done()/join()ï¼Œæˆ–æ˜¾å¼å‘é€ None/ç‰¹æ®Šå¯¹è±¡ä½œä¸ºç»ˆæ­¢ä¿¡å·ã€‚
å¤§é‡æ•°æ®ä¼ é€’æ…¢ï¼ˆæ¯æ¬¡ put/send éƒ½å¾ˆæ…¢ï¼‰	
æ•°æ®è¢« pickle å† copyï¼Œç½‘ç»œ/ç®¡é“å¸¦å®½å—é™	
æ”¹ç”¨ å…±äº«å†…å­˜ (shared_memoryã€Value/Array) æˆ– å†…å­˜æ˜ å°„æ–‡ä»¶ (mmap).
è¿›ç¨‹æ³„æ¼ï¼ˆæ®‹ç•™çš„å­è¿›ç¨‹ï¼‰	
çˆ¶è¿›ç¨‹å¼‚å¸¸é€€å‡ºã€å­è¿›ç¨‹æœª join()	
ç”¨ try/finally åŒ…è£… Process å¯åŠ¨ï¼Œæˆ–ä½¿ç”¨ daemon=Trueï¼ˆä»…åœ¨ä¸éœ€è¦å­è¿›ç¨‹æ¸…ç†èµ„æºæ—¶ï¼‰ã€‚
æ­»é”ï¼ˆä¸¤ä¸ªè¿›ç¨‹äº’ç›¸ç­‰å¾…ï¼‰	
åŒæ—¶è·å–å¤šä¸ª Lockï¼Œé¡ºåºä¸ç»Ÿä¸€	
ç»Ÿä¸€é”é¡ºåºï¼ˆå¦‚æ€»æ˜¯å…ˆæ‹¿ lock_a å† lock_bï¼‰ï¼Œæˆ–ä½¿ç”¨ RLockã€‚
å…±äº«å†…å­˜ç¢ç‰‡åŒ–/æ³„æ¼	
shared_memory.SharedMemory æ²¡æœ‰ unlink()	
æœ€åä½¿ç”¨ shm.close(); shm.unlink()ï¼Œæˆ–ç”¨ with è¯­å¥ç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼ˆPythonâ€¯3.9+ï¼‰ã€‚
6ï¸âƒ£ è¿›é˜¶ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆå¯è·¨æœºå™¨/è·¨è¯­è¨€ï¼‰
ä¸­é—´ä»¶
é€‚ç”¨åœºæ™¯
ç®€å• PYTHON ç¤ºä¾‹
ZeroMQ (pyzmq)	
é«˜ååã€ä½å»¶è¿Ÿã€ç‚¹å¯¹ç‚¹/å‘å¸ƒâ€‘è®¢é˜…/è¯·æ±‚â€‘å“åº”	
python\nimport zmq\nctx = zmq.Context()\n# æœåŠ¡å™¨\nsock = ctx.socket(zmq.REP)\nsock.bind('tcp://*:5555')\nwhile True:\n msg = sock.recv()\n sock.send(b'ACK:' + msg)\n
Redis (redis-py)	
æŒä¹…åŒ–ã€å¹¿æ’­ã€ä»»åŠ¡é˜Ÿåˆ—ã€åˆ†å¸ƒå¼é”	
python\nimport redis, json\nr = redis.Redis()\nr.lpush('task_queue', json.dumps({'id':1}))\nmsg = json.loads(r.rpop('task_queue'))\n
RabbitMQ (pika)	
å¯é çš„æ¶ˆæ¯æŠ•é€’ã€äº‹åŠ¡ã€è·¯ç”±	
python\nimport pika\nconn = pika.BlockingConnection(pika.ConnectionParameters('localhost'))\nch = conn.channel()\nch.queue_declare('hello')\nch.basic_publish(exchange='', routing_key='hello', body='world')\n
gRPC (grpcio)	
å¼ºç±»å‹ã€è·¨è¯­è¨€ã€æ”¯æŒæµå¼ RPC	
éœ€è¦å…ˆå®šä¹‰ .protoï¼Œç”Ÿæˆ Python stubï¼Œå†è°ƒç”¨ã€‚
é€‰å‹å»ºè®®ï¼š 

åŒæœºå¤šè¿›ç¨‹ â†’ multiprocessingï¼ˆPipe/Queue/å…±äº«å†…å­˜ï¼‰
è·¨æœºã€è·¨è¯­è¨€ â†’ ZeroMQï¼ˆè½»é‡ï¼‰æˆ– Redis/RabbitMQï¼ˆå¯é ã€æŒä¹…ï¼‰
éœ€è¦é«˜ååã€äºŒè¿›åˆ¶åè®® â†’ gRPCï¼ˆGoogle Protocol Buffersï¼‰
7ï¸âƒ£ å®Œæ•´ç¤ºä¾‹ï¼šå¤šè¿›ç¨‹å›¾åƒå¤„ç†ç®¡çº¿ï¼ˆPipeâ€¯+â€¯shared_memoryï¼‰
ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº† çˆ¶è¿›ç¨‹ è¯»å–å›¾ç‰‡æ–‡ä»¶ï¼ˆç”¨ Pillowï¼‰ï¼ŒæŠŠåŸå§‹ numpy æ•°ç»„æ”¾è¿›å…±äº«å†…å­˜ï¼Œå­è¿›ç¨‹ è¯»å–å…±äº«å†…å­˜è¿›è¡Œç°åº¦åŒ–å¹¶æŠŠç»“æœå†™å›çˆ¶è¿›ç¨‹çš„ Queueã€‚æ•´ä¸ªé“¾è·¯ä¸è¿›è¡Œä»»ä½• pickleï¼Œåªæœ‰ä¸€æ¬¡å†…å­˜æ‹·è´ï¼ˆå…±äº«å†…å­˜ï¼‰ã€‚ 

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
# pip install pillow numpy
import numpy as np
from PIL import Image
from multiprocessing import Process, Queue, shared_memory
import os, time

def producer(img_path, shm_name, shape, dtype, q):
    """è¯»å–å›¾ç‰‡ â†’ å¤åˆ¶åˆ°å…±äº«å†…å­˜ â†’ æŠŠ shm åå­—å‘ç»™å­è¿›ç¨‹"""
    img = Image.open(img_path).convert('RGB')
    arr = np.asarray(img, dtype=dtype)
    shm = shared_memory.SharedMemory(name=shm_name, create=True, size=arr.nbytes)
    buf = np.ndarray(shape, dtype=dtype, buffer=shm.buf)
    buf[:] = arr[:]                     # ç›´æ¥å†™å…¥å…±äº«å†…å­˜
    q.put(shm_name)                     # æŠŠå…±äº«å—çš„åå­—äº¤ç»™æ¶ˆè´¹è€…
    shm.close()                         # è¿™é‡Œä¸ unlinkï¼Œå­è¿›ç¨‹è´Ÿè´£

def consumer(q, out_dir):
    """ä»é˜Ÿåˆ—æ‹¿åˆ° shm åå­— â†’ è¯»å– â†’ ç°åº¦åŒ– â†’ ä¿å­˜"""
    while True:
        name = q.get()
        if name is None:                # ç»“æŸæ ‡è®°
            break
        # æ‰“å¼€å·²æœ‰å…±äº«å†…å­˜å—
        existing = shared_memory.SharedMemory(name=name)
        # å‡è®¾æˆ‘ä»¬äº‹å…ˆçŸ¥é“ shape/dtypeï¼ˆè¿™é‡Œç¡¬ç¼–ç æ¼”ç¤ºï¼‰
        shape = (256, 256, 3)            # éœ€è¦å’Œ producer ä¿æŒä¸€è‡´
        dtype = np.uint8
        img = np.ndarray(shape, dtype=dtype, buffer=existing.buf)

        # ------- ä¸šåŠ¡å¤„ç†ï¼ˆç°åº¦åŒ–ï¼‰ -------
        gray = np.dot(img[..., :3], [0.2989, 0.5870, 0.1140]).astype(np.uint8)

        # ä¿å­˜ä¸ºæ–‡ä»¶
        out_path = os.path.join(out_dir, f'gray_{name}.png')
        Image.fromarray(gray).save(out_path)
        print('saved', out_path)

        existing.close()
        existing.unlink()                # é‡Šæ”¾å…±äº«å—

if __name__ == '__main__':
    IMG_PATH = 'test.jpg'               # <-- æ¢æˆä½ è‡ªå·±çš„å›¾ç‰‡è·¯å¾„
    OUT_DIR = './output'
    os.makedirs(OUT_DIR, exist_ok=True)

    # å‡è®¾å›¾ç‰‡å·²è¢« resize ä¸º 256x256ï¼ˆæ¼”ç¤ºç”¨ï¼‰ï¼Œå®é™…ç”Ÿäº§ä¸­å¯åŠ¨æ€è·å– shape
    SHM_NAME = 'img_shm'
    SHAPE = (256, 256, 3)
    DTYPE = np.uint8

    q = Queue()
    p_prod = Process(target=producer, args=(IMG_PATH, SHM_NAME, SHAPE, DTYPE, q))
    p_cons = Process(target=consumer, args=(q, OUT_DIR))

    p_prod.start()
    p_cons.start()
    p_prod.join()

    q.put(None)          # å‘é€ç»ˆæ­¢ä¿¡å·
    p_cons.join()
è¦ç‚¹å›é¡¾ï¼š

å…±äº«å†…å­˜ï¼šshared_memory.SharedMemory åªéœ€è¦ä¸€æ¬¡åˆ›å»º/æ‰“å¼€ï¼Œæ‰€æœ‰è¿›ç¨‹çœ‹åˆ°åŒä¸€å—ç‰©ç†å†…å­˜ï¼Œé›¶æ‹·è´ã€‚
åŒæ­¥ï¼šä½¿ç”¨ Queue åªè´Ÿè´£ â€œè°å…ˆå¤„ç†â€ çš„è°ƒåº¦ï¼ŒçœŸæ­£çš„æ•°æ®åœ¨å…±äº«å†…å­˜é‡Œã€‚
èµ„æºå›æ”¶ï¼šæœ€åä¸€å®šè¦ unlink() å…±äº«å—ï¼Œå¦åˆ™ç³»ç»Ÿä¼šç•™ä¸‹å­¤å„¿å…±äº«å†…å­˜å¯¹è±¡ã€‚
8ï¸âƒ£ å°ç»“ & æ¨èå®è·µ
ä»»åŠ¡
æ¨èå·¥å…·
ä¸ºä»€ä¹ˆ
ç‚¹å¯¹ç‚¹å°‘é‡æ•°æ®	
Pipeï¼ˆæˆ– socketpairï¼‰	
å¼€é”€æœ€å°ã€å®ç°æœ€ç®€å•
ç”Ÿäº§è€…â€‘æ¶ˆè´¹è€…ã€ä»»åŠ¡é˜Ÿåˆ—	
multiprocessing.Queue / JoinableQueue	
è‡ªåŠ¨åºåˆ—åŒ–ã€çº¿ç¨‹å®‰å…¨ã€æ”¯æŒå¤šè¿›ç¨‹
å¤æ‚/åµŒå¥—ç»“æ„å…±äº«	
Manager().dict()/list()/Namespace	
é€šè¿‡æœåŠ¡å™¨è¿›ç¨‹ä»£ç†ï¼Œä½¿ç”¨æ–¹ä¾¿
å¤§å—æ•°ç»„/çŸ©é˜µå…±äº«	
shared_memory / Value / Array	
é›¶æ‹·è´ã€æä½å»¶è¿Ÿ
è·¨æœºå™¨/è·¨è¯­è¨€	
socket / ZeroMQ / Redis / gRPC	
ç½‘ç»œåè®®ã€æŒä¹…åŒ–ã€è¯­è¨€æ— å…³
éœ€è¦é”/ä¿¡å·	
Lockã€Eventã€Conditionã€Barrier	
é˜²æ­¢ç«äº‰ã€å®ç°åŒæ­¥ç‚¹
å¸¸ç”¨ä»£ç æ¨¡æ¿ï¼ˆå¯ç›´æ¥ç²˜è´´ï¼‰
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
# ---------- è¿›ç¨‹åˆ›å»º ----------
from multiprocessing import Process, Queue, Pipe, Lock, Event, Manager, Value, Array
# ---------- è¿›ç¨‹é€šä¿¡ ----------
#   Pipe   -> parent_conn, child_conn = Pipe()
#   Queue  -> q = Queue()
#   Manager-> mgr = Manager(); shared_dict = mgr.dict()
#   Value/Array -> v = Value('i', 0); a = Array('d', [0.0]*10)
#   shared_memory (py3.8+) -> from multiprocessing import shared_memory
# ---------- åŒæ­¥åŸè¯­ ----------
#   lock = Lock(); event = Event(); cond = Condition()
åªè¦æŠŠä¸Šé¢çš„ æ¨¡æ¿ ä¸å®é™…ä¸šåŠ¡é€»è¾‘ï¼ˆè¯»å–ã€è®¡ç®—ã€å†™å›ï¼‰ç»„åˆèµ·æ¥ï¼Œå°±èƒ½è½»æ¾æ­å»ºå‡ºå¯é ã€å¯ç»´æŠ¤çš„å¤šè¿›ç¨‹ç³»ç»Ÿã€‚ç¥ä½ ç©è½¬ Python è¿›ç¨‹é€šä¿¡ ğŸš€ï¼

<details type="reasoning" done="true" duration="2"> <summary>Thought for 2 seconds</summary> > The user asks "pythonè¿›ç¨‹é€šä¿¡". They likely want information about inter-process communication (IPC) in Python. Need to provide details on multiprocessing module, Pipe, Queue, shared memory, Manager, sockets, multiprocessing.shared_memory (Python 3.8+), and maybe third-party like multiprocessing.connection, multiprocessing.managers, and also using threading or async. Provide code examples. Should be in Chinese. Probably they want a guide. > > Will output structured answer with sections: basics, Pipe, Queue, Manager, Value/Array, shared_memory, sockets, example codes, best practices, pitfalls. Also mention using multiprocessing vs threading. Provide some reference. > > Will produce final answer in Chinese. </details> # ğŸ Python è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰å…¨æ”»ç•¥ > **ç›®æ ‡**ï¼šå¿«é€Ÿäº†è§£åœ¨ Python ä¸­ä¸åŒè¿›ç¨‹ä¹‹é—´å¦‚ä½•ä¼ é€’æ•°æ®ã€åŒæ­¥çŠ¶æ€ã€å…±äº«èµ„æºï¼Œå¹¶æä¾›å¯ç›´æ¥è¿è¡Œçš„ç¤ºä¾‹ä»£ç ã€‚ > **é€‚ç”¨èŒƒå›´**ï¼š`multiprocessing`ï¼ˆè·¨å¹³å°çš„å¤šè¿›ç¨‹åº“ï¼‰+ æ ‡å‡†åº“ `socket`ã€`queue`ã€`multiprocessing.shared_memory`ï¼ˆPythonâ€¯3.8+ï¼‰+ ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ `ZeroMQ`ã€`Redis`ï¼‰çš„å¸¸è§ä½¿ç”¨åœºæ™¯ã€‚ --- ## 1ï¸âƒ£ ä¸ºä»€ä¹ˆéœ€è¦è¿›ç¨‹é—´é€šä¿¡ï¼Ÿ | åœºæ™¯ | è¿›ç¨‹ vs çº¿ç¨‹ | éœ€è¦çš„ IPC æ‰‹æ®µ | |------|--------------|----------------| | CPUâ€‘å¯†é›†å‹è®¡ç®—ï¼ˆåˆ©ç”¨å¤šæ ¸ï¼‰ | å¤šè¿›ç¨‹ï¼ˆæ¯ä¸ªè¿›ç¨‹ç‹¬ç«‹çš„ GILï¼‰ | `Pipe`ã€`Queue`ã€å…±äº«å†…å­˜ã€`Manager` | | å¤§é‡æ•°æ®å…±äº«ï¼ˆå›¾ç‰‡ã€çŸ©é˜µï¼‰ | å¤šè¿›ç¨‹ | å…±äº«å†…å­˜ (`shared_memory`ã€`Value/Array`) | | è·¨æœºå™¨/è·¨è¯­è¨€åä½œ | å¤šè¿›ç¨‹æˆ–å¤šä¸»æœº | å¥—æ¥å­—ã€HTTPã€ZeroMQã€Redisã€RabbitMQ ç­‰ | | éœ€è¦åŒæ­¥/äº’æ–¥ | å¤šè¿›ç¨‹ | `Lock`ã€`Event`ã€`Condition`ã€`Barrier` | | åŠ¨æ€ä»»åŠ¡è°ƒåº¦ï¼ˆç”Ÿäº§è€…â€‘æ¶ˆè´¹è€…ï¼‰ | å¤šè¿›ç¨‹ | `Queue`ã€`JoinableQueue`ã€`Pool.apply_async` | > **æ ¸å¿ƒåŸåˆ™**ï¼š**æ•°æ®çš„å¯åºåˆ—åŒ–**ï¼ˆpickleï¼‰æ˜¯å¤§å¤šæ•° IPC æ‰‹æ®µçš„å‰æï¼Œé™¤éä½¿ç”¨å…±äº«å†…å­˜æˆ–ä¸“é—¨çš„äºŒè¿›åˆ¶åè®®ã€‚ --- ## 2ï¸âƒ£ `multiprocessing` æ¨¡å—çš„å‡ å¤§é€šä¿¡å·¥å…· > `multiprocessing` æ˜¯ Python æ ‡å‡†åº“ï¼Œè·¨å¹³å°ï¼ˆWindowsã€Linuxã€macOSï¼‰å®ç°äº†è¿›ç¨‹åˆ›å»ºã€åŒæ­¥ã€å…±äº«ç­‰åŠŸèƒ½ã€‚ ### 2.1 `Pipe` â€”â€” åŒå‘ç®¡é“ ```python from multiprocessing import Process, Pipe def worker(conn): # æ”¶åˆ°ä¸»è¿›ç¨‹å‘é€çš„æ•°å­—ï¼Œè®¡ç®—å¹³æ–¹åè¿”å› while True: msg = conn.recv() # é˜»å¡ç­‰å¾… if msg == "STOP": break conn.send(msg ** 2) if __name__ == "__main__": parent_conn, child_conn = Pipe() # åˆ›å»ºä¸€å¯¹è¿æ¥å¯¹è±¡ p = Process(target=worker, args=(child_conn,)) p.start() for i in range(5): parent_conn.send(i) # å‘é€æ•°æ®åˆ°å­è¿›ç¨‹ print(f"{i}^2 = {parent_conn.recv()}") # æ¥æ”¶å­è¿›ç¨‹è¿”å› parent_conn.send("STOP") # ç»“æŸä¿¡å· p.join() ``` - **ç‰¹ç‚¹**ï¼š - åŒå‘ï¼ˆé»˜è®¤ `duplex=True`ï¼‰ï¼Œä¹Ÿå¯ä»¥è®¾ `duplex=False` å˜æˆå•å‘ã€‚ - é€‚åˆç‚¹å¯¹ç‚¹çš„å°‘é‡æ•°æ®äº¤æ¢ï¼Œå¼€é”€å°ã€‚ - åªèƒ½åœ¨çˆ¶å­è¿›ç¨‹ä¹‹é—´ä½¿ç”¨ï¼ˆä¸é€‚ç”¨äºå¤šè¿›ç¨‹ç½‘ç»œæ‹“æ‰‘ï¼‰ã€‚ ### 2.2 `Queue` â€”â€” ç”Ÿäº§è€…â€‘æ¶ˆè´¹è€…å®‰å…¨é˜Ÿåˆ— ```python from multiprocessing import Process, Queue import time, random def producer(q, n): for i in range(n): item = random.randint(1, 100) q.put(item) # æ”¾å…¥é˜Ÿåˆ—ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ print(f"Producer put {item}") time.sleep(0.1) def consumer(q): while True: item = q.get() # é˜»å¡å–å‡º if item is None: # çº¦å®šçš„ç»“æŸæ ‡è®° break print(f"Consumer got {item}") if __name__ == "__main__": q = Queue() p = Process(target=producer, args=(q, 10)) c = Process(target=consumer, args=(q,)) p.start(); c.start() p.join() q.put(None) # ç»™æ¶ˆè´¹è€…å‘é€ç»ˆæ­¢ä¿¡å· c.join() ``` - **ç‰¹ç‚¹**ï¼š - åŸºäºåº•å±‚ `Pipe` + `Lock` å®ç°ï¼Œæ”¯æŒ **å¤šç”Ÿäº§è€…â€‘å¤šæ¶ˆè´¹è€…**ã€‚ - è‡ªåŠ¨åºåˆ—åŒ–ï¼ˆpickleï¼‰ï¼Œä¸é€‚åˆæ”¾å…¥ **ä¸å¯ pickle** çš„å¯¹è±¡ï¼ˆå¦‚æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„ã€socketï¼‰ã€‚ - `JoinableQueue` è¿˜èƒ½åœ¨ `task_done()` / `join()` ä¹‹é—´å®ç°ä»»åŠ¡å®Œæˆçš„åŒæ­¥ã€‚ ### 2.3 `Manager` â€”â€” å…±äº«å¯¹è±¡ï¼ˆåˆ—è¡¨ã€å­—å…¸ã€Namespaceï¼‰ ```python from multiprocessing import Process, Manager def worker(d, lst, i): d[i] = i * i lst.append(i) if __name__ == "__main__": with Manager() as mgr: shared_dict = mgr.dict() shared_list = mgr.list() procs = [Process(target=worker, args=(shared_dict, shared_list, i)) for i in range(5)] for p in procs: p.start() for p in procs: p.join() print("dict:", dict(shared_dict)) print("list:", list(shared_list)) ``` - **ç‰¹ç‚¹**ï¼š - é€šè¿‡ **æœåŠ¡å™¨è¿›ç¨‹**ï¼ˆManagerï¼‰åœ¨è¿›ç¨‹é—´ä»£ç†å¯¹è±¡ï¼Œå®ç°å‡ ä¹æ‰€æœ‰å¯å˜å®¹å™¨çš„å…±äº«ã€‚ - é€‚ç”¨äº **å¤æ‚ç»“æ„**ï¼ˆåµŒå¥— dict/listï¼‰ä½†æ€§èƒ½ä¸å¦‚ `Queue`/`Pipe`ï¼ˆæ¯ä¸€æ¬¡è®¿é—®éƒ½ä¼šç»è¿‡ç½‘ç»œ RPCï¼‰ã€‚ ### 2.4 `Value` / `Array` â€”â€” åŸå­å…±äº«å†…å­˜ ```python from multiprocessing import Process, Value, Array def inc(counter): for _ in range(1000): with counter.get_lock(): # åŸå­åŠ é” counter.value += 1 if __name__ == "__main__": cnt = Value('i', 0) # 'i' = signed int, åˆå§‹å€¼ 0 procs = [Process(target=inc, args=(cnt,)) for _ in range(4)] for p in procs: p.start() for p in procs: p.join() print("final count =", cnt.value) # 4000 ``` - **ç‰¹ç‚¹**ï¼š - åªé€‚åˆ **å•ä¸ªæ ‡é‡** æˆ– **ä¸€ç»´æ•°ç»„**ï¼ˆ`Array('d', [0.0]*10)`ï¼‰ã€‚ - å¿…é¡»ä½¿ç”¨åŒæ­¥åŸè¯­ï¼ˆ`get_lock()`ï¼‰æ¥ä¿è¯åŸå­æ€§ã€‚ - åºåˆ—åŒ–æˆæœ¬ä¸º **0**ï¼Œå› ä¸ºæ•°æ®ç›´æ¥å­˜æ”¾åœ¨å…±äº«å†…å­˜ä¸­ã€‚ ### 2.4 `shared_memory`ï¼ˆPythonâ€¯3.8+ï¼‰â€”â€” çœŸæ­£çš„é›¶æ‹·è´å…±äº« ```python # è¿›ç¨‹ Aï¼šåˆ›å»ºå…±äº«å†…å­˜å—å¹¶å†™å…¥ NumPy æ•°ç»„ import numpy as np from multiprocessing import Process from multiprocessing import shared_memory def writer(): a = np.arange(10, dtype=np.int64) shm = shared_memory.SharedMemory(create=True, size=a.nbytes, name='my_shm') buf = np.ndarray(a.shape, dtype=a.dtype, buffer=shm.buf) buf[:] = a[:] # ç›´æ¥å†™å…¥å…±äº«å†…å­˜ print("writer: data written") # å­è¿›ç¨‹è¯»å–åè‡ªè¡Œ unlinkï¼Œçˆ¶è¿›ç¨‹è¿™é‡Œä¸ close/unlinkï¼Œç•™ç»™å­è¿›ç¨‹ # shm.close() # è‹¥åœ¨æ­¤å…³é—­ï¼Œå­è¿›ç¨‹ä»èƒ½é€šè¿‡ name è®¿é—® def reader(): # é€šè¿‡åå­—æ‰“å¼€å·²æœ‰å…±äº«å†…å­˜ existing = shared_memory.SharedMemory(name='my_shm') b = np.ndarray((10,), dtype=np.int64, buffer=existing.buf) print("reader sees:", b) existing.close() existing.unlink() # æœ€åä¸€ä¸ªä½¿ç”¨è€…è´Ÿè´£é‡Šæ”¾ if __name__ == '__main__': p1 = Process(target=writer) p2 = Process(target=reader) p1.start(); p1.join() p2.start(); p2.join() ``` - **ç‰¹ç‚¹**ï¼š - **é›¶æ‹·è´**ï¼šæ•°æ®åœ¨å¤šä¸ªè¿›ç¨‹é—´å…±äº«åŒä¸€å—ç‰©ç†å†…å­˜ï¼Œé€‚åˆå¤§çŸ©é˜µã€å›¾åƒã€éŸ³è§†é¢‘å¸§ã€‚ - åªèƒ½å…±äº« **äºŒè¿›åˆ¶/NumPy** ä¹‹ç±»çš„ **è¿ç»­å†…å­˜** å¯¹è±¡ã€‚ - éœ€è¦è‡ªè¡Œç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼ˆ`unlink`ï¼‰ï¼Œå¦åˆ™ä¼šç•™ä¸‹ç³»ç»Ÿæ®‹ç•™çš„å…±äº«å—ã€‚ --- ## 3ï¸âƒ£ åŸºäºå¥—æ¥å­—ï¼ˆSocketï¼‰çš„è·¨æœºå™¨/è·¨è¯­è¨€é€šä¿¡ å¥—æ¥å­—æ˜¯æœ€é€šç”¨çš„ IPC æ‰‹æ®µï¼Œé€‚ç”¨äº **åŒæœºå¤šè¿›ç¨‹**ã€**è·¨ä¸»æœº**ï¼Œä»¥åŠ **ä¸åŒè¯­è¨€**ï¼ˆC/C++ã€Javaã€Goã€Node.jsï¼‰ä¹‹é—´çš„äº¤äº’ã€‚ ### 3.1 ç®€å• TCP ç¤ºä¾‹ï¼ˆPython3ï¼‰ **æœåŠ¡å™¨ï¼ˆçˆ¶è¿›ç¨‹ï¼‰** ```python # server.py import socket import struct def start_server(host='127.0.0.1', port=6000): srv = socket.socket(socket.AF_INET, socket.SOCK_STREAM) srv.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1) srv.bind((host, port)) srv.listen() print(f"Listening on {host}:{port}") conn, addr = srv.accept() print("Connected by", addr) while True: # è¯»å– 4 å­—èŠ‚æ•´æ•°ï¼ˆç½‘ç»œå­—èŠ‚åºï¼‰ data = conn.recv(4) if not data: break n = struct.unpack('!i', data)[0] # '!i' = bigâ€‘endian signed int print("recv:", n) conn.sendall(struct.pack('!i', n * n)) conn.close() srv.close() if __name__ == '__main__': start_server() ``` **å®¢æˆ·ç«¯ï¼ˆå­è¿›ç¨‹ï¼‰** ```python # client.py import socket, struct, time def client(host='127.0.0.1', port=6000): s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((host, port)) for i in range(5): s.sendall(struct.pack('!i', i)) res = s.recv(4) print(f"{i}^2 = {struct.unpack('!i', res)[0]}") time.sleep(0.2) s.close() if __name__ == '__main__': client() ``` - **ä¼˜ç‚¹**ï¼š - å®Œå…¨è·¨å¹³å°ã€è·¨è¯­è¨€ã€‚ - å¯é…åˆ `select`/`poll`/`asyncio` å®ç° **éé˜»å¡**ã€**äº‹ä»¶é©±åŠ¨**ã€‚ - **ç¼ºç‚¹**ï¼š - éœ€è¦è‡ªè¡Œå¤„ç† **åºåˆ—åŒ–åè®®**ï¼ˆå¦‚ `struct`ã€`json`ã€`msgpack`ï¼‰ï¼Œæ¯” `Queue` æ›´åº•å±‚ã€‚ ### 3.2 `multiprocessing.connection`ï¼ˆæ›´é«˜å±‚çš„ socket/pipeï¼‰ ```python from multiprocessing.connection import Listener, Client def server(): address = ('localhost', 6001) # åªåœ¨æœ¬æœºå¯è¾¾ listener = Listener(address, authkey=b'secret') conn = listener.accept() print('Connection accepted') while True: try: msg = conn.recv() if msg == 'STOP': break conn.send(msg * 2) except EOFError: break conn.close() listener.close() def client(): address = ('localhost', 6001) conn = Client(address, authkey=b'secret') for i in range(5): conn.send(i) print('reply:', conn.recv()) conn.send('STOP') conn.close() if __name__ == '__main__': from multiprocessing import Process p = Process(target=server); p.start() client() p.join() ``` - **ç‰¹ç‚¹**ï¼š - åŸºäº `socket` å®ç°ï¼Œä½†æä¾›äº† **pickle è‡ªåŠ¨åºåˆ—åŒ–** ä¸ **å¯é€‰è®¤è¯** (`authkey`)ã€‚ - é€‚åˆ **æœ¬æœº** æˆ– **å±€åŸŸç½‘** çš„è½»é‡çº§ RPC åœºæ™¯ã€‚ --- ## 4ï¸âƒ£ è¿›ç¨‹åŒæ­¥/äº’æ–¥ï¼ˆé…åˆé€šä¿¡ï¼‰ | åŒæ­¥åŸè¯­ | ç”¨é€” | ç¤ºä¾‹ | |----------|------|------| | `Lock` / `RLock` | äº’æ–¥è®¿é—®å…±äº«èµ„æº | `with lock:` | | `Event` | å•å‘ä¿¡å·ï¼ˆå¦‚â€œä»»åŠ¡å·²å‡†å¤‡å¥½â€ï¼‰ | `event.set()/event.wait()` | | `Condition` | å¤æ‚çš„ç”Ÿäº§è€…â€‘æ¶ˆè´¹è€…ï¼ˆå¯æŒ‡å®šæ¡ä»¶ï¼‰ | `cond.wait()/cond.notify_all()` | | `Barrier` | å¤šè¿›ç¨‹åœ¨åŒä¸€ç‚¹â€œé›†åˆâ€åç»§ç»­ | `barrier.wait()` | | `Semaphore` / `BoundedSemaphore` | é™åˆ¶å¹¶å‘æ•°ï¼ˆå¦‚åŒæ—¶åªèƒ½æœ‰ N ä¸ªå­è¿›ç¨‹è®¿é—®å¤–éƒ¨ APIï¼‰ | `sem.acquire()/sem.release()` | > **å°æŠ€å·§**ï¼šåœ¨ä½¿ç”¨ `Queue`/`Pipe` æ—¶ï¼Œ**ä¸å¿…é¢å¤–åŠ é”**â€”â€”å®ƒä»¬å†…éƒ¨å·²ç»å®ç°äº†å®‰å…¨çš„ `Lock`ï¼Œé™¤éä½ åœ¨åŒä¸€è¿æ¥å¯¹è±¡ä¸Šè¿›è¡Œ**æ··åˆè¯»å†™**ï¼ˆè¿™ä¼šå¯¼è‡´æ­»é”ï¼‰ï¼Œæ­¤æ—¶å»ºè®®ä½¿ç”¨ **å•ç‹¬çš„è¯»å†™ç«¯**ï¼ˆå¦‚ `Pipe(duplex=False)`ï¼‰æˆ– **ä¸¤æ¡é€šé“**ã€‚ --- ## 5ï¸âƒ£ å¸¸è§å‘ & æ€§èƒ½è°ƒä¼˜ | ç—‡çŠ¶ | å¯èƒ½çš„æ ¹æœ¬åŸå›  | è§£å†³åŠæ³• | |------|----------------|----------| | `pickle` æŠ¥é”™ **â€œCan't pickle local object â€¦â€** | ä¼ é€’çš„å¯¹è±¡æ˜¯ **å±€éƒ¨å‡½æ•°/ç±»** æˆ– **lambda** | å°†å¯¹è±¡æå‡åˆ°æ¨¡å—é¡¶å±‚ï¼Œæˆ–æ‰‹åŠ¨å®ç° `__reduce__`ï¼›æˆ–è€…æ”¹ç”¨ **å…±äº«å†…å­˜**ï¼ˆä¸éœ€è¦åºåˆ—åŒ–ï¼‰ã€‚ | | ç¨‹åºåœ¨ **Windows** ä¸Š `fork` å¤±è´¥ | Windows åªèƒ½ `spawn`ï¼Œå­è¿›ç¨‹ä¸ä¼šç»§æ‰¿çˆ¶è¿›ç¨‹çš„å…¨å±€å˜é‡ | æŠŠæ‰€æœ‰èµ„æºåˆ›å»ºæ”¾åœ¨ `if __name__ == '__main__':` é‡Œï¼›ä½¿ç”¨ `multiprocessing.set_start_method('spawn')`ï¼ˆé»˜è®¤ï¼‰ã€‚ | | `Queue` é˜Ÿåˆ—å¡ä½ä¸åŠ¨ | æ¶ˆè´¹è€…è¿›ç¨‹æ„å¤–é€€å‡ºæˆ– **æœªå‘é€ç»“æŸæ ‡è®°** | ä½¿ç”¨ `JoinableQueue` + `task_done()/join()`ï¼Œæˆ–æ˜¾å¼å‘é€ `None`/ç‰¹æ®Šå¯¹è±¡ä½œä¸ºç»ˆæ­¢ä¿¡å·ã€‚ | | å¤§é‡æ•°æ®ä¼ é€’æ…¢ï¼ˆæ¯æ¬¡ `put`/`send` éƒ½å¾ˆæ…¢ï¼‰ | æ•°æ®è¢« **pickle** å† **copy**ï¼Œç½‘ç»œ/ç®¡é“å¸¦å®½å—é™ | æ”¹ç”¨ **å…±äº«å†…å­˜** (`shared_memory`ã€`Value/Array`) æˆ– **å†…å­˜æ˜ å°„æ–‡ä»¶** (`mmap`). | | è¿›ç¨‹æ³„æ¼ï¼ˆæ®‹ç•™çš„å­è¿›ç¨‹ï¼‰ | çˆ¶è¿›ç¨‹å¼‚å¸¸é€€å‡ºã€å­è¿›ç¨‹æœª `join()` | ç”¨ `try/finally` åŒ…è£… `Process` å¯åŠ¨ï¼Œæˆ–ä½¿ç”¨ `daemon=True`ï¼ˆä»…åœ¨**ä¸éœ€è¦**å­è¿›ç¨‹æ¸…ç†èµ„æºæ—¶ï¼‰ã€‚ | | æ­»é”ï¼ˆä¸¤ä¸ªè¿›ç¨‹äº’ç›¸ç­‰å¾…ï¼‰ | åŒæ—¶è·å–å¤šä¸ª `Lock`ï¼Œé¡ºåºä¸ç»Ÿä¸€ | **ç»Ÿä¸€é”é¡ºåº**ï¼ˆå¦‚æ€»æ˜¯å…ˆæ‹¿ `lock_a` å† `lock_b`ï¼‰ï¼Œæˆ–ä½¿ç”¨ **`RLock`**ã€‚ | | å…±äº«å†…å­˜ç¢ç‰‡åŒ–/æ³„æ¼ | `shared_memory.SharedMemory` æ²¡æœ‰ `unlink()` | æœ€åä½¿ç”¨ `shm.close(); shm.unlink()`ï¼Œæˆ–ç”¨ `with` è¯­å¥ç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼ˆPythonâ€¯3.9+ï¼‰ã€‚ | --- ## 6ï¸âƒ£ è¿›é˜¶ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆå¯è·¨æœºå™¨/è·¨è¯­è¨€ï¼‰ | ä¸­é—´ä»¶ | é€‚ç”¨åœºæ™¯ | ç®€å• Python ç¤ºä¾‹ | |--------|----------|-----------------| | **ZeroMQ** (`pyzmq`) | é«˜ååã€ä½å»¶è¿Ÿã€ç‚¹å¯¹ç‚¹/å‘å¸ƒâ€‘è®¢é˜…/è¯·æ±‚â€‘å“åº” | ```python\nimport zmq\nctx = zmq.Context()\n# æœåŠ¡å™¨\nsock = ctx.socket(zmq.REP)\nsock.bind('tcp://*:5555')\nwhile True:\n msg = sock.recv()\n sock.send(b'ACK:' + msg)\n``` | | **Redis** (`redis-py`) | æŒä¹…åŒ–ã€å¹¿æ’­ã€ä»»åŠ¡é˜Ÿåˆ—ã€åˆ†å¸ƒå¼é” | ```python\nimport redis, json\nr = redis.Redis()\nr.lpush('task_queue', json.dumps({'id':1}))\nmsg = json.loads(r.rpop('task_queue'))\n``` | | **RabbitMQ** (`pika`) | å¯é çš„æ¶ˆæ¯æŠ•é€’ã€äº‹åŠ¡ã€è·¯ç”± | ```python\nimport pika\nconn = pika.BlockingConnection(pika.ConnectionParameters('localhost'))\nch = conn.channel()\nch.queue_declare('hello')\nch.basic_publish(exchange='', routing_key='hello', body='world')\n``` | | **gRPC** (`grpcio`) | å¼ºç±»å‹ã€è·¨è¯­è¨€ã€æ”¯æŒæµå¼ RPC | éœ€è¦å…ˆå®šä¹‰ `.proto`ï¼Œç”Ÿæˆ Python stubï¼Œå†è°ƒç”¨ã€‚| > **é€‰å‹å»ºè®®**ï¼š - **åŒæœºå¤šè¿›ç¨‹** â†’ `multiprocessing`ï¼ˆPipe/Queue/å…±äº«å†…å­˜ï¼‰ - **è·¨æœºã€è·¨è¯­è¨€** â†’ `ZeroMQ`ï¼ˆè½»é‡ï¼‰æˆ– `Redis/RabbitMQ`ï¼ˆå¯é ã€æŒä¹…ï¼‰ - **éœ€è¦é«˜ååã€äºŒè¿›åˆ¶åè®®** â†’ `gRPC`ï¼ˆGoogle Protocol Buffersï¼‰ --- ## 7ï¸âƒ£ å®Œæ•´ç¤ºä¾‹ï¼šå¤šè¿›ç¨‹å›¾åƒå¤„ç†ç®¡çº¿ï¼ˆPipeâ€¯+â€¯shared_memoryï¼‰ > ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº† **çˆ¶è¿›ç¨‹** è¯»å–å›¾ç‰‡æ–‡ä»¶ï¼ˆç”¨ `Pillow`ï¼‰ï¼ŒæŠŠåŸå§‹ `numpy` æ•°ç»„æ”¾è¿›å…±äº«å†…å­˜ï¼Œ**å­è¿›ç¨‹** è¯»å–å…±äº«å†…å­˜è¿›è¡Œç°åº¦åŒ–å¹¶æŠŠç»“æœå†™å›çˆ¶è¿›ç¨‹çš„ `Queue`ã€‚æ•´ä¸ªé“¾è·¯ä¸è¿›è¡Œä»»ä½• pickleï¼Œåªæœ‰ä¸€æ¬¡å†…å­˜æ‹·è´ï¼ˆå…±äº«å†…å­˜ï¼‰ã€‚ ```python # pip install pillow numpy import numpy as np from PIL import Image from multiprocessing import Process, Queue, shared_memory import os, time def producer(img_path, shm_name, shape, dtype, q): """è¯»å–å›¾ç‰‡ â†’ å¤åˆ¶åˆ°å…±äº«å†…å­˜ â†’ æŠŠ shm åå­—å‘ç»™å­è¿›ç¨‹""" img = Image.open(img_path).convert('RGB') arr = np.asarray(img, dtype=dtype) shm = shared_memory.SharedMemory(name=shm_name, create=True, size=arr.nbytes) buf = np.ndarray(shape, dtype=dtype, buffer=shm.buf) buf[:] = arr[:] # ç›´æ¥å†™å…¥å…±äº«å†…å­˜ q.put(shm_name) # æŠŠå…±äº«å—çš„åå­—äº¤ç»™æ¶ˆè´¹è€… shm.close() # è¿™é‡Œä¸ unlinkï¼Œå­è¿›ç¨‹è´Ÿè´£ def consumer(q, out_dir): """ä»é˜Ÿåˆ—æ‹¿åˆ° shm åå­— â†’ è¯»å– â†’ ç°åº¦åŒ– â†’ ä¿å­˜""" while True: name = q.get() if name is None: # ç»“æŸæ ‡è®° break # æ‰“å¼€å·²æœ‰å…±äº«å†…å­˜å— existing = shared_memory.SharedMemory(name=name) # å‡è®¾æˆ‘ä»¬äº‹å…ˆçŸ¥é“ shape/dtypeï¼ˆè¿™é‡Œç¡¬ç¼–ç æ¼”ç¤ºï¼‰ shape = (256, 256, 3) # éœ€è¦å’Œ producer ä¿æŒä¸€è‡´ dtype = np.uint8 img = np.ndarray(shape, dtype=dtype, buffer=existing.buf) # ------- ä¸šåŠ¡å¤„ç†ï¼ˆç°åº¦åŒ–ï¼‰ ------- gray = np.dot(img[..., :3], [0.2989, 0.5870, 0.1140]).astype(np.uint8) # ä¿å­˜ä¸ºæ–‡ä»¶ out_path = os.path.join(out_dir, f'gray_{name}.png') Image.fromarray(gray).save(out_path) print('saved', out_path) existing.close() existing.unlink() # é‡Šæ”¾å…±äº«å— if __name__ == '__main__': IMG_PATH = 'test.jpg' # <-- æ¢æˆä½ è‡ªå·±çš„å›¾ç‰‡è·¯å¾„ OUT_DIR = './output' os.makedirs(OUT_DIR, exist_ok=True) # å‡è®¾å›¾ç‰‡å·²è¢« resize ä¸º 256x256ï¼ˆæ¼”ç¤ºç”¨ï¼‰ï¼Œå®é™…ç”Ÿäº§ä¸­å¯åŠ¨æ€è·å– shape SHM_NAME = 'img_shm' SHAPE = (256, 256, 3) DTYPE = np.uint8 q = Queue() p_prod = Process(target=producer, args=(IMG_PATH, SHM_NAME, SHAPE, DTYPE, q)) p_cons = Process(target=consumer, args=(q, OUT_DIR)) p_prod.start() p_cons.start() p_prod.join() q.put(None) # å‘é€ç»ˆæ­¢ä¿¡å· p_cons.join() ``` **è¦ç‚¹å›é¡¾**ï¼š 1. **å…±äº«å†…å­˜**ï¼š`shared_memory.SharedMemory` åªéœ€è¦ä¸€æ¬¡åˆ›å»º/æ‰“å¼€ï¼Œæ‰€æœ‰è¿›ç¨‹çœ‹åˆ°åŒä¸€å—ç‰©ç†å†…å­˜ï¼Œé›¶æ‹·è´ã€‚ 2. **åŒæ­¥**ï¼šä½¿ç”¨ `Queue` åªè´Ÿè´£ **â€œè°å…ˆå¤„ç†â€** çš„è°ƒåº¦ï¼ŒçœŸæ­£çš„æ•°æ®åœ¨å…±äº«å†…å­˜é‡Œã€‚ 3. **èµ„æºå›æ”¶**ï¼šæœ€åä¸€å®šè¦ `unlink()` å…±äº«å—ï¼Œå¦åˆ™ç³»ç»Ÿä¼šç•™ä¸‹å­¤å„¿å…±äº«å†…å­˜å¯¹è±¡ã€‚ --- ## 8ï¸âƒ£ å°ç»“ & æ¨èå®è·µ | ä»»åŠ¡ | æ¨èå·¥å…· | ä¸ºä»€ä¹ˆ | |------|----------|--------| | **ç‚¹å¯¹ç‚¹å°‘é‡æ•°æ®** | `Pipe`ï¼ˆæˆ– `socketpair`ï¼‰ | å¼€é”€æœ€å°ã€å®ç°æœ€ç®€å• | | **ç”Ÿäº§è€…â€‘æ¶ˆè´¹è€…ã€ä»»åŠ¡é˜Ÿåˆ—** | `multiprocessing.Queue` / `JoinableQueue` | è‡ªåŠ¨åºåˆ—åŒ–ã€çº¿ç¨‹å®‰å…¨ã€æ”¯æŒå¤šè¿›ç¨‹ | | **å¤æ‚/åµŒå¥—ç»“æ„å…±äº«** | `Manager().dict()/list()/Namespace` | é€šè¿‡æœåŠ¡å™¨è¿›ç¨‹ä»£ç†ï¼Œä½¿ç”¨æ–¹ä¾¿ | | **å¤§å—æ•°ç»„/çŸ©é˜µå…±äº«** | `shared_memory` / `Value` / `Array` | é›¶æ‹·è´ã€æä½å»¶è¿Ÿ | | **è·¨æœºå™¨/è·¨è¯­è¨€** | `socket` / `ZeroMQ` / `Redis` / `gRPC` | ç½‘ç»œåè®®ã€æŒä¹…åŒ–ã€è¯­è¨€æ— å…³ | | **éœ€è¦é”/ä¿¡å·** | `Lock`ã€`Event`ã€`Condition`ã€`Barrier` | é˜²æ­¢ç«äº‰ã€å®ç°åŒæ­¥ç‚¹ | ### å¸¸ç”¨ä»£ç æ¨¡æ¿ï¼ˆå¯ç›´æ¥ç²˜è´´ï¼‰ ```python # ---------- è¿›ç¨‹åˆ›å»º ---------- from multiprocessing import Process, Queue, Pipe, Lock, Event, Manager, Value, Array # ---------- è¿›ç¨‹é€šä¿¡ ---------- # Pipe -> parent_conn, child_conn = Pipe() # Queue -> q = Queue() # Manager-> mgr = Manager(); shared_dict = mgr.dict() # Value/Array -> v = Value('i', 0); a = Array('d', [0.0]*10) # shared_memory (py3.8+) -> from multiprocessing import shared_memory # ---------- åŒæ­¥åŸè¯­ ---------- # lock = Lock(); event = Event(); cond = Condition() ``` åªè¦æŠŠä¸Šé¢çš„ **æ¨¡æ¿** ä¸å®é™…ä¸šåŠ¡é€»è¾‘ï¼ˆè¯»å–ã€è®¡ç®—ã€å†™å›ï¼‰ç»„åˆèµ·æ¥ï¼Œå°±èƒ½è½»æ¾æ­å»ºå‡ºå¯é ã€å¯ç»´æŠ¤çš„å¤šè¿›ç¨‹ç³»ç»Ÿã€‚ç¥ä½ ç©è½¬ Python è¿›ç¨‹é€šä¿¡ ğŸš€ï¼
æˆ‘ç°åœ¨æœ‰ä¸€ä¸ªmp4æ–‡ä»¶ï¼Œæˆ‘éœ€è¦ç”¨pythonæŠŠé‡Œé¢çš„ä¸œè¥¿è½¬æ¢ä¸ºtxt

profile
gpt-oss:120b
æ€è€ƒç”¨æ—¶ 1 ç§’
ä¸‹é¢ç»™å‡º å®Œæ•´ã€å¯ç›´æ¥è¿è¡Œ çš„ Python ç¤ºä¾‹ï¼Œå¸®åŠ©ä½ æŠŠä¸€ä¸ª MP4 è§†é¢‘æ–‡ä»¶ é‡Œçš„ è¯­éŸ³å†…å®¹ï¼ˆæˆ–å­—å¹•ã€å…ƒæ•°æ®ï¼‰å…¨éƒ¨è½¬æˆ çº¯æ–‡æœ¬ï¼ˆ.txtï¼‰ã€‚
ç¤ºä¾‹åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼š

æ­¥éª¤
ä½œç”¨
å…³é”®å·¥å…·
1ï¸âƒ£ æŠŠ MP4 æ‹†æˆ éŸ³é¢‘ï¼ˆWAV/MP3ï¼‰	
è§†é¢‘æœ¬èº«æ˜¯äºŒè¿›åˆ¶å›¾åƒæµï¼Œå¿…é¡»å…ˆæŠŠå£°éŸ³æå–å‡ºæ¥	
ffmpegï¼ˆå‘½ä»¤è¡Œï¼‰
2ï¸âƒ£ åˆ‡åˆ† é•¿éŸ³é¢‘ä¸ºè‹¥å¹² çŸ­ç‰‡æ®µï¼ˆé¿å…ä¸€æ¬¡æ€§å–‚ç»™æ¨¡å‹å¤ªå¤§ï¼‰	
å¤§æ–‡ä»¶ä¸€æ¬¡æ€§è¯†åˆ«ä¼šå ç”¨å¤§é‡æ˜¾å­˜/å†…å­˜	
pydub
3ï¸âƒ£ è°ƒç”¨ è¯­éŸ³â€‘è½¬â€‘æ–‡å­—æ¨¡å‹ è¿›è¡Œè¯†åˆ«	
æ¨èä½¿ç”¨ OpenAI Whisperï¼ˆæœ¬åœ°ç¦»çº¿ï¼‰æˆ– speech_recognition + Google APIï¼ˆåœ¨çº¿ï¼‰	
whisperã€torchã€speech_recognition
4ï¸âƒ£ æŠŠè¯†åˆ«ç»“æœå†™å…¥ .txt æ–‡ä»¶	
å®Œæ•´çš„æ–‡å­—è¾“å‡º	
æ ‡å‡† I/O
å¦‚æœä½ åªæƒ³æŠ½å–è§†é¢‘çš„å…ƒæ•°æ®ï¼ˆæ—¶é•¿ã€åˆ†è¾¨ç‡ã€ç ç‡ç­‰ï¼‰ï¼Œè¯·ç›´æ¥è·³åˆ° â€œå…ƒæ•°æ®æå–â€ é‚£ä¸€èŠ‚ï¼›
å¦‚æœä½ å·²æœ‰å¤–éƒ¨å­—å¹•æ–‡ä»¶ï¼ˆ.srt/.assï¼‰ï¼Œåªéœ€è¦æŠŠå®ƒè½¬æˆ txtï¼Œè¿™é‡Œä¹Ÿæä¾›äº†å¿«æ·è„šæœ¬ã€‚ 

ğŸ“¦ ç¯å¢ƒå‡†å¤‡
ç³»ç»Ÿè¦æ±‚ï¼š 

Windows / macOS / Linuxï¼ˆå‡å¯ï¼‰
å·²å®‰è£… FFmpegï¼ˆç¡®ä¿ ffmpeg å’Œ ffprobe èƒ½åœ¨ç»ˆç«¯/å‘½ä»¤æç¤ºç¬¦ç›´æ¥è°ƒç”¨ï¼‰
Python 3.9+ï¼ˆå»ºè®® 3.10/3.11ï¼‰
GPUï¼ˆå¯é€‰ï¼‰â€”â€”å¦‚æœæœ‰ NVIDIA GPUï¼ŒWhisper ä¼šå¿«å¾ˆå¤šï¼›æ²¡æœ‰ä¹Ÿå¯ä»¥åœ¨ CPU ä¸Šè·‘ï¼Œåªæ˜¯æ…¢ä¸€ç‚¹ã€‚
1ï¸âƒ£ å®‰è£… FFmpeg
å¹³å°
å®‰è£…æ–¹å¼
Windows	
ä¸‹è½½ https://ffmpeg.org/download.html#build-windows æä¾›çš„ zipï¼Œè§£å‹åæŠŠ bin ç›®å½•åŠ å…¥ç³»ç»Ÿ PATHã€‚
macOS	
brew install ffmpeg
Linux (Debian/Ubuntu)	
sudo apt-get install ffmpeg
éªŒè¯ï¼šæ‰“å¼€ç»ˆç«¯ï¼Œæ‰§è¡Œ ffmpeg -versionï¼Œèƒ½çœ‹åˆ°ç‰ˆæœ¬ä¿¡æ¯å³è¡¨ç¤ºæˆåŠŸã€‚ 

2ï¸âƒ£ å®‰è£… Python åŒ…
bash

æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
python -m venv venv
source venv/bin/activate   # Windows: venv\Scripts\activate

# å¿…è¦ä¾èµ–
pip install -U pip setuptools wheel

# æ ¸å¿ƒåº“
pip install pydub tqdm

# è¯­éŸ³è¯†åˆ«ï¼ˆä¸¤ç§æ–¹æ¡ˆä»»é€‰å…¶ä¸€ï¼‰
# æ–¹æ¡ˆ Aï¼šOpenAI Whisperï¼ˆç¦»çº¿ï¼Œæ•ˆæœå¥½ï¼‰
pip install -U "openai-whisper[torch]"   # è‡ªåŠ¨å®‰è£… torchï¼ˆCPU or GPUï¼‰

# æ–¹æ¡ˆ Bï¼šGoogle Speechâ€‘Recognitionï¼ˆåœ¨çº¿ï¼Œéœ€è¦ç½‘ç»œï¼‰
pip install speechrecognition
# æ–¹æ¡ˆ B éœ€è¦é¢å¤–çš„ audio backendï¼ˆå¦‚ PyAudioï¼‰ï¼š
pip install pyaudio   # Windows ç”¨æˆ·å¯ç›´æ¥ pipï¼ŒLinux éœ€å…ˆ apt-get install portaudio19-dev
æç¤ºï¼šå¦‚æœä½ çš„æœºå™¨ä¸Šå·²ç»è£…æœ‰ torchï¼Œç›´æ¥ pip install openai-whisper å³å¯ï¼›å¦åˆ™ä¸Šé¢ä¸€æ¡ä¼šè‡ªåŠ¨å¸®ä½ è£…å¯¹åº”çš„ CPU/GPU ç‰ˆæœ¬ã€‚ 

ğŸ› ï¸ å®Œæ•´è„šæœ¬ï¼ˆWhisper ç¦»çº¿ç‰ˆï¼‰
é€‚ç”¨äºï¼š 

éœ€è¦é«˜è´¨é‡è½¬å†™ï¼ˆä¸­æ–‡ã€è‹±æ–‡ã€æ—¥æ–‡ç­‰å¤šè¯­è¨€ï¼‰
æœ¬åœ°ç¦»çº¿ã€æ— éœ€ç½‘ç»œ
æ”¯æŒ GPU åŠ é€Ÿï¼ˆå¦‚æœæœ‰ï¼‰
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
âŒ„
âŒ„
âŒ„
âŒ„
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
video_to_text.py

æŠŠ MP4 è§†é¢‘ä¸­çš„è¯­éŸ³è½¬æˆçº¯æ–‡æœ¬ï¼ˆ.txtï¼‰ï¼Œ
ä½¿ç”¨ ffmpeg æŠ½å–éŸ³é¢‘ + OpenAI Whisper è¿›è¡Œè¯†åˆ«ã€‚
"""

import argparse
import os
import sys
import subprocess
import math
import shutil
from pathlib import Path
from tqdm import tqdm
from pydub import AudioSegment
import whisper
import torch

# -------------------------- è¾…åŠ©å‡½æ•° -------------------------- #

def check_ffmpeg():
    """ç¡®ä¿ç³»ç»Ÿèƒ½æ‰¾åˆ° ffmpeg/ffprobeï¼Œå¯ç›´æ¥è¿è¡Œçš„ç®€æ˜“æ£€æŸ¥ã€‚"""
    for exe in ("ffmpeg", "ffprobe"):
        if shutil.which(exe) is None:
            sys.exit(f"âŒ æœªæ‰¾åˆ° {exe}ï¼Œè¯·å…ˆå®‰è£…å¹¶æŠŠå…¶æ‰€åœ¨ç›®å½•åŠ å…¥ PATHã€‚")
    return True


def extract_audio(mp4_path: Path, out_wav: Path, codec: str = "pcm_s16le", sr: int = 16000):
    """
    ä½¿ç”¨ ffmpeg æŠŠ MP4 è½¬æˆå•å£°é“ 16k
<details type="reasoning" done="true" duration="1"> <summary>Thought for 1 seconds</summary> > User wants to convert mp4 file contents to txt using Python. Likely they want extract video frames as text? Or audio? "é‡Œé¢çš„ä¸œè¥¿è½¬æ¢ä¸ºtxt" could mean transcribe audio to text, or extract subtitles? Probably they want speech-to-text from video. Provide solution using speech recognition, ffmpeg to extract audio, then speech recognition (like Whisper). Provide code and steps. Also discuss extracting metadata (ffprobe). Provide script. Also handle large file, chunking. Provide requirements. </details> ä¸‹é¢ç»™å‡º **å®Œæ•´ã€å¯ç›´æ¥è¿è¡Œ** çš„ Python ç¤ºä¾‹ï¼Œå¸®åŠ©ä½ æŠŠä¸€ä¸ª **MP4 è§†é¢‘æ–‡ä»¶** é‡Œçš„ **è¯­éŸ³å†…å®¹**ï¼ˆæˆ–å­—å¹•ã€å…ƒæ•°æ®ï¼‰å…¨éƒ¨è½¬æˆ **çº¯æ–‡æœ¬ï¼ˆ.txtï¼‰**ã€‚ ç¤ºä¾‹åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼š | æ­¥éª¤ | ä½œç”¨ | å…³é”®å·¥å…· | |------|------|----------| | 1ï¸âƒ£ æŠŠ MP4 æ‹†æˆ **éŸ³é¢‘**ï¼ˆWAV/MP3ï¼‰ | è§†é¢‘æœ¬èº«æ˜¯äºŒè¿›åˆ¶å›¾åƒæµï¼Œå¿…é¡»å…ˆæŠŠå£°éŸ³æå–å‡ºæ¥ | `ffmpeg`ï¼ˆå‘½ä»¤è¡Œï¼‰ | | 2ï¸âƒ£ **åˆ‡åˆ†** é•¿éŸ³é¢‘ä¸ºè‹¥å¹² **çŸ­ç‰‡æ®µ**ï¼ˆé¿å…ä¸€æ¬¡æ€§å–‚ç»™æ¨¡å‹å¤ªå¤§ï¼‰ | å¤§æ–‡ä»¶ä¸€æ¬¡æ€§è¯†åˆ«ä¼šå ç”¨å¤§é‡æ˜¾å­˜/å†…å­˜ | `pydub` | | 3ï¸âƒ£ è°ƒç”¨ **è¯­éŸ³â€‘è½¬â€‘æ–‡å­—æ¨¡å‹** è¿›è¡Œè¯†åˆ« | æ¨èä½¿ç”¨ OpenAI **Whisper**ï¼ˆæœ¬åœ°ç¦»çº¿ï¼‰æˆ– `speech_recognition` + Google APIï¼ˆåœ¨çº¿ï¼‰ | `whisper`ã€`torch`ã€`speech_recognition` | | 4ï¸âƒ£ æŠŠè¯†åˆ«ç»“æœå†™å…¥ **.txt** æ–‡ä»¶ | å®Œæ•´çš„æ–‡å­—è¾“å‡º | æ ‡å‡† I/O | > **å¦‚æœä½ åªæƒ³æŠ½å–è§†é¢‘çš„å…ƒæ•°æ®ï¼ˆæ—¶é•¿ã€åˆ†è¾¨ç‡ã€ç ç‡ç­‰ï¼‰**ï¼Œè¯·ç›´æ¥è·³åˆ° **â€œå…ƒæ•°æ®æå–â€** é‚£ä¸€èŠ‚ï¼› > **å¦‚æœä½ å·²æœ‰å¤–éƒ¨å­—å¹•æ–‡ä»¶ï¼ˆ.srt/.assï¼‰**ï¼Œåªéœ€è¦æŠŠå®ƒè½¬æˆ txtï¼Œè¿™é‡Œä¹Ÿæä¾›äº†å¿«æ·è„šæœ¬ã€‚ --- ## ğŸ“¦ ç¯å¢ƒå‡†å¤‡ > **ç³»ç»Ÿè¦æ±‚**ï¼š > - Windows / macOS / Linuxï¼ˆå‡å¯ï¼‰ > - å·²å®‰è£… **FFmpeg**ï¼ˆç¡®ä¿ `ffmpeg` å’Œ `ffprobe` èƒ½åœ¨ç»ˆç«¯/å‘½ä»¤æç¤ºç¬¦ç›´æ¥è°ƒç”¨ï¼‰ > - Python **3.9+**ï¼ˆå»ºè®® 3.10/3.11ï¼‰ > - GPUï¼ˆå¯é€‰ï¼‰â€”â€”å¦‚æœæœ‰ NVIDIA GPUï¼ŒWhisper ä¼šå¿«å¾ˆå¤šï¼›æ²¡æœ‰ä¹Ÿå¯ä»¥åœ¨ CPU ä¸Šè·‘ï¼Œåªæ˜¯æ…¢ä¸€ç‚¹ã€‚ ### 1ï¸âƒ£ å®‰è£… FFmpeg | å¹³å° | å®‰è£…æ–¹å¼ | |------|----------| | **Windows** | ä¸‹è½½ https://ffmpeg.org/download.html#build-windows æä¾›çš„ zipï¼Œè§£å‹åæŠŠ `bin` ç›®å½•åŠ å…¥ç³»ç»Ÿ `PATH`ã€‚ | | **macOS** | `brew install ffmpeg` | | **Linux (Debian/Ubuntu)** | `sudo apt-get install ffmpeg` | > **éªŒè¯**ï¼šæ‰“å¼€ç»ˆç«¯ï¼Œæ‰§è¡Œ `ffmpeg -version`ï¼Œèƒ½çœ‹åˆ°ç‰ˆæœ¬ä¿¡æ¯å³è¡¨ç¤ºæˆåŠŸã€‚ ### 2ï¸âƒ£ å®‰è£… Python åŒ… ```bash # åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰ python -m venv venv source venv/bin/activate # Windows: venv\Scripts\activate # å¿…è¦ä¾èµ– pip install -U pip setuptools wheel # æ ¸å¿ƒåº“ pip install pydub tqdm # è¯­éŸ³è¯†åˆ«ï¼ˆä¸¤ç§æ–¹æ¡ˆä»»é€‰å…¶ä¸€ï¼‰ # æ–¹æ¡ˆ Aï¼šOpenAI Whisperï¼ˆç¦»çº¿ï¼Œæ•ˆæœå¥½ï¼‰ pip install -U "openai-whisper[torch]" # è‡ªåŠ¨å®‰è£… torchï¼ˆCPU or GPUï¼‰ # æ–¹æ¡ˆ Bï¼šGoogle Speechâ€‘Recognitionï¼ˆåœ¨çº¿ï¼Œéœ€è¦ç½‘ç»œï¼‰ pip install speechrecognition # æ–¹æ¡ˆ B éœ€è¦é¢å¤–çš„ audio backendï¼ˆå¦‚ PyAudioï¼‰ï¼š pip install pyaudio # Windows ç”¨æˆ·å¯ç›´æ¥ pipï¼ŒLinux éœ€å…ˆ apt-get install portaudio19-dev ``` > **æç¤º**ï¼šå¦‚æœä½ çš„æœºå™¨ä¸Šå·²ç»è£…æœ‰ `torch`ï¼Œç›´æ¥ `pip install openai-whisper` å³å¯ï¼›å¦åˆ™ä¸Šé¢ä¸€æ¡ä¼šè‡ªåŠ¨å¸®ä½ è£…å¯¹åº”çš„ CPU/GPU ç‰ˆæœ¬ã€‚ --- ## ğŸ› ï¸ å®Œæ•´è„šæœ¬ï¼ˆWhisper ç¦»çº¿ç‰ˆï¼‰ > **é€‚ç”¨äº**ï¼š > - éœ€è¦é«˜è´¨é‡è½¬å†™ï¼ˆä¸­æ–‡ã€è‹±æ–‡ã€æ—¥æ–‡ç­‰å¤šè¯­è¨€ï¼‰ > - æœ¬åœ°ç¦»çº¿ã€æ— éœ€ç½‘ç»œ > - æ”¯æŒ GPU åŠ é€Ÿï¼ˆå¦‚æœæœ‰ï¼‰ ```python #!/usr/bin/env python3 # -*- coding: utf-8 -*- """ video_to_text.py æŠŠ MP4 è§†é¢‘ä¸­çš„è¯­éŸ³è½¬æˆçº¯æ–‡æœ¬ï¼ˆ.txtï¼‰ï¼Œ ä½¿ç”¨ ffmpeg æŠ½å–éŸ³é¢‘ + OpenAI Whisper è¿›è¡Œè¯†åˆ«ã€‚ """ import argparse import os import sys import subprocess import math import shutil from pathlib import Path from tqdm import tqdm from pydub import AudioSegment import whisper import torch # -------------------------- è¾…åŠ©å‡½æ•° -------------------------- # def check_ffmpeg(): """ç¡®ä¿ç³»ç»Ÿèƒ½æ‰¾åˆ° ffmpeg/ffprobeï¼Œå¯ç›´æ¥è¿è¡Œçš„ç®€æ˜“æ£€æŸ¥ã€‚""" for exe in ("ffmpeg", "ffprobe"): if shutil.which(exe) is None: sys.exit(f"âŒ æœªæ‰¾åˆ° {exe}ï¼Œè¯·å…ˆå®‰è£…å¹¶æŠŠå…¶æ‰€åœ¨ç›®å½•åŠ å…¥ PATHã€‚") return True def extract_audio(mp4_path: Path, out_wav: Path, codec: str = "pcm_s16le", sr: int = 16000): """ ä½¿ç”¨ ffmpeg æŠŠ MP4 è½¬æˆå•å£°é“ 16k
ç”¨pythonè¿›è¡Œå¤åˆ¶è¿™ä¸ªæ–‡ä»¶

profile
gpt-oss:120b
æ€è€ƒç”¨æ—¶ 1 ç§’
ä¸‹é¢ç»™å‡º Python å¤åˆ¶æ–‡ä»¶çš„å‡ ç§å¸¸ç”¨å†™æ³•ï¼Œä»æœ€ç®€æ´çš„ shutil.copy åˆ°å¸¦è¿›åº¦æ¡ã€è·¨å¹³å°çš„å¤§æ–‡ä»¶é«˜é€Ÿæ‹·è´å®ç°ï¼Œå…¨éƒ¨é…æœ‰å¯ç›´æ¥è¿è¡Œçš„ç¤ºä¾‹ä»£ç ã€‚ä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚æŒ‘é€‰åˆé€‚çš„æ–¹å¼ã€‚

ğŸ¯ ç›®æ ‡
åœºæ™¯
æ¨èå®ç°
å…³é”®ç‚¹
ä¸€æ¬¡æ€§å¤åˆ¶å°æ–‡ä»¶	
shutil.copy / Path.renameï¼ˆåŒç›˜ç§»åŠ¨ï¼‰	
ä»£ç æœ€ç®€ã€è‡ªåŠ¨ä¿ç•™æƒé™
ä¿ç•™å®Œæ•´å…ƒæ•°æ®ï¼ˆæ—¶é—´æˆ³ã€æƒé™ã€ACLï¼‰	
shutil.copy2	
ä¸ç³»ç»Ÿ cp -p è¡Œä¸ºç›¸åŒ
æ˜¾ç¤ºå¤åˆ¶è¿›åº¦	
æ‰‹åŠ¨åˆ†å—è¯»å– + tqdm è¿›åº¦æ¡	
é€‚åˆ 100â€¯MBâ€‘å‡ â€¯GB çš„æ–‡ä»¶
è¶…å¤§æ–‡ä»¶ï¼ˆ>â€¯10â€¯GBï¼‰æˆ–é«˜å¹¶å‘æ‹·è´	
mmap / å¤šè¿›ç¨‹åˆ†å—æ‹·è´	
é›¶æ‹·è´æˆ–å¹¶è¡Œæå‡åå
è·¨å¹³å°ï¼ˆWindowsâ€¯/â€¯Linuxâ€¯/â€¯macOSï¼‰	
ç»Ÿä¸€ä½¿ç”¨ pathlib + shutil	
åªè¦ Python è§£é‡Šå™¨æœ¬èº«æ”¯æŒå³å¯
å¤åˆ¶åˆ°åŒä¸€ç›®å½•ä¸‹æ”¹å	
shutil.copy + ç›®æ ‡è·¯å¾„	
åªæ”¹æ–‡ä»¶åä¸æ”¹ç›®å½•
1ï¸âƒ£ æœ€ç®€æ´ï¼šshutil.copy / shutil.copy2
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
import shutil
from pathlib import Path

def copy_simple(src: str, dst: str):
    """
    ç›´æ¥å¤åˆ¶æ–‡ä»¶ï¼ˆä¸ä¿ç•™å…ƒæ•°æ®ï¼‰ã€‚
    å¦‚æœ dst æ˜¯ç›®å½•ï¼Œåˆ™æ–‡ä»¶ä¼šæ”¾è¿›è¯¥ç›®å½•å¹¶ä¿æŒåŸæ–‡ä»¶åã€‚
    """
    src_path = Path(src)
    dst_path = Path(dst)

    # ç›®æ ‡æ˜¯ç›®å½• â†’ è‡ªåŠ¨æ‹¼æ¥æ–‡ä»¶å
    if dst_path.is_dir():
        dst_path = dst_path / src_path.name

    shutil.copy(src_path, dst_path)          # åªæ‹·è´å†…å®¹
    print(f"âœ… å·²å¤åˆ¶ {src_path} â†’ {dst_path}")

def copy_with_meta(src: str, dst: str):
    """
    å¤åˆ¶æ–‡ä»¶å¹¶å®Œæ•´ä¿ç•™å…ƒæ•°æ®ï¼ˆåˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ã€æƒé™ï¼‰ã€‚
    ç›¸å½“äº Linux ä¸‹ `cp -p`ã€macOS/Windows ä¸‹çš„ â€œä¿ç•™å±æ€§â€ã€‚
    """
    src_path = Path(src)
    dst_path = Path(dst)

    if dst_path.is_dir():
        dst_path = dst_path / src_path.name

    shutil.copy2(src_path, dst_path)         # åŒæ—¶å¤åˆ¶æƒé™ã€æ—¶é—´æˆ³ç­‰
    print(f"âœ… å·²å®Œæ•´å¤åˆ¶ï¼ˆä¿ç•™å…ƒæ•°æ®ï¼‰{src_path} â†’ {dst_path}")

# ------------------- ç”¨æ³•ç¤ºä¾‹ ------------------- #
if __name__ == "__main__":
    copy_simple("example.mp4", "backup/example_copy.mp4")
    copy_with_meta("example.mp4", "backup/example_copy2.mp4")
æ³¨æ„ï¼š 

shutil.copy ä¼šåœ¨å¤åˆ¶å è‡ªåŠ¨åˆ›å»ºç›®æ ‡æ–‡ä»¶çš„å†™æƒé™ï¼Œä½†ä¸ä¼šä¿ç•™åŸæ–‡ä»¶çš„ ä¿®æ”¹æ—¶é—´ã€è®¿é—®æ—¶é—´ã€‚
shutil.copy2 ä¼šä¿ç•™ æƒé™ã€ä¿®æ”¹æ—¶é—´ã€è®¿é—®æ—¶é—´ï¼ˆåœ¨ Windows ä¸Šä¹Ÿä¼šä¿ç•™ æ–‡ä»¶å±æ€§ï¼‰ï¼Œä½†ä¸ä¿è¯å¤åˆ¶ ACLï¼ˆå¦‚ NTFS çš„ç‰¹æ®Šæƒé™ï¼‰ï¼Œå¦‚æœéœ€è¦æ›´ç»†ç²’åº¦çš„ ACLï¼Œè¯·ä½¿ç”¨ os.system("xcopy ...") æˆ–ç¬¬ä¸‰æ–¹åº“ pywin32ï¼ˆä»… Windowsï¼‰ã€‚
2ï¸âƒ£ å¸¦è¿›åº¦æ¡çš„åˆ†å—å¤åˆ¶ï¼ˆæ¨èç”¨äºå‡ ç™¾ MBâ€‘å‡  GB çš„æ–‡ä»¶ï¼‰
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
import os
from pathlib import Path
from tqdm import tqdm

def copy_with_progress(src: str, dst: str, buf_size: int = 4 * 1024 * 1024):
    """
    æŒ‰å—è¯»å–å¹¶å†™å…¥ï¼Œå®æ—¶æ˜¾ç¤º tqdm è¿›åº¦æ¡ã€‚
    - buf_sizeï¼šæ¯æ¬¡è¯»å†™çš„å­—èŠ‚æ•°ï¼Œé»˜è®¤ 4â€¯MiBï¼ˆå¯æ ¹æ®ç£ç›˜/ç½‘ç»œè°ƒä¼˜ï¼‰ã€‚
    """
    src_path = Path(src)
    dst_path = Path(dst)

    if dst_path.is_dir():
        dst_path = dst_path / src_path.name

    total_size = src_path.stat().st_size
    copied = 0

    with src_path.open("rb") as f_src, dst_path.open("wb") as f_dst, tqdm(
        total=total_size, unit="B", unit_scale=True, unit_divisor=1024,
        desc=f"å¤åˆ¶ {src_path.name}"
    ) as pbar:
        while True:
            chunk = f_src.read(buf_size)
            if not chunk:
                break
            f_dst.write(chunk)
            copied += len(chunk)
            pbar.update(len(chunk))

    # åŒæ­¥æ–‡ä»¶å±æ€§ï¼ˆæ—¶é—´æˆ³ã€æƒé™ï¼‰â€”â€”å¯é€‰
    shutil.copystat(src_path, dst_path)

    print(f"\nâœ… å¤åˆ¶å®Œæˆï¼Œå¤§å° {copied:,} å­—èŠ‚ â†’ {dst_path}")

# ------------------- ç”¨æ³•ç¤ºä¾‹ ------------------- #
if __name__ == "__main__":
    copy_with_progress("example.mp4", "backup/example_copy_progress.mp4")
ä¸ºä»€ä¹ˆè¦è‡ªå·±åˆ†å—ï¼Ÿ

shutil.copyfileobj ä¹Ÿå¯ä»¥åˆ†å—ï¼Œä½†ä¸è‡ªå¸¦è¿›åº¦æ¡ï¼›è‡ªå·±å†™å¾ªç¯å¯ä»¥éšæ—¶åŠ å…¥ æ—¥å¿—ã€æ ¡éªŒã€åŠ å¯† ç­‰é¢å¤–é€»è¾‘ã€‚
tqdm ä¼šè‡ªåŠ¨è®¡ç®— ä¼ è¾“é€Ÿç‡ã€å·²ç”¨æ—¶é—´ã€é¢„è®¡å‰©ä½™æ—¶é—´ï¼Œæå¤§æå‡ç”¨æˆ·ä½“éªŒã€‚
3ï¸âƒ£ è¶…å¤§æ–‡ä»¶çš„ é›¶æ‹·è´ï¼ˆmmapï¼‰
mmap åœ¨åº•å±‚åˆ©ç”¨æ“ä½œç³»ç»Ÿçš„ å†…å­˜æ˜ å°„ï¼ˆmemoryâ€‘mapped fileï¼‰æŠ€æœ¯ï¼Œè¯»å–å’Œå†™å…¥éƒ½ä¸éœ€è¦é¢å¤–çš„ç”¨æˆ·ç©ºé—´æ‹·è´ï¼Œé€‚åˆ å•è¿›ç¨‹ã€å•æ ¸ ç¯å¢ƒä¸‹çš„ GB çº§åˆ« æ–‡ä»¶æ‹·è´ã€‚
ï¼ˆåœ¨ Windows ä¸ŠåŒæ ·å¯ç”¨ï¼Œåªè¦æ–‡ä»¶ç³»ç»Ÿæ”¯æŒæ˜ å°„å³å¯ï¼‰ 

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
import mmap
from pathlib import Path

def copy_mmap(src: str, dst: str):
    src_path = Path(src)
    dst_path = Path(dst)

    if dst_path.is_dir():
        dst_path = dst_path / src_path.name

    # 1ï¸âƒ£ å…ˆåˆ›å»ºç›®æ ‡æ–‡ä»¶å¹¶é¢„åˆ†é…åŒæ ·å¤§å°
    with src_path.open("rb") as f_src, dst_path.open("wb") as f_dst:
        f_dst.truncate(src_path.stat().st_size)   # é¢„åˆ†é…ç£ç›˜ç©ºé—´

    # 2ï¸âƒ£ ä½¿ç”¨ mmap åŒæ—¶æ˜ å°„è¯»å†™
    with open(src_path, "rb") as f_src, open(dst_path, "r+b") as f_dst:
        # å‚æ•° 0 è¡¨ç¤ºæ˜ å°„æ•´ä¸ªæ–‡ä»¶
        with mmap.mmap(f_src.fileno(), 0, access=mmap.ACCESS_READ) as src_map, \
             mmap.mmap(f_dst.fileno(), 0, access=mmap.ACCESS_WRITE) as dst_map:
            dst_map[:] = src_map[:]   # ä¸€è¡Œä»£ç å®Œæˆæ‹·è´ï¼ˆåº•å±‚æ˜¯å†…æ ¸çº§æ‹·è´ï¼‰

    print(f"âœ… mmap é›¶æ‹·è´å®Œæˆ â†’ {dst_path}")

# ------------------- ç”¨æ³•ç¤ºä¾‹ ------------------- #
if __name__ == "__main__":
    copy_mmap("example.mp4", "backup/example_copy_mmap.mp4")
ä¼˜ç‚¹

é€Ÿåº¦å¿«ï¼ˆå‡ ä¹åªå—ç£ç›˜ååé™åˆ¶ï¼‰
å†…å­˜å ç”¨ä½ï¼ˆåªæ˜ å°„ä¸€æ¬¡ï¼Œä¸éœ€è¦åœ¨ Python é‡ŒæŒæœ‰æ•´ä¸ªæ–‡ä»¶ï¼‰
ç¼ºç‚¹

åªèƒ½åœ¨ åŒä¸€å°æœºå™¨å†…éƒ¨ä½¿ç”¨ï¼Œè·¨ç½‘ç»œéœ€è¦å…ˆæŠŠæ–‡ä»¶æ˜ å°„åˆ°ç½‘ç»œå…±äº«ç›˜ã€‚
å¯¹ æå°æ–‡ä»¶ æ²¡æœ‰ä¼˜åŠ¿ï¼Œåè€Œå¤šäº†æ‰“å¼€æ˜ å°„çš„å¼€é”€ã€‚
4ï¸âƒ£ å¤šè¿›ç¨‹å¹¶è¡Œåˆ†å—å¤åˆ¶ï¼ˆé€‚åˆ å¤šæ ¸æœåŠ¡å™¨ æˆ– ç½‘ç»œç£ç›˜ï¼‰
ä¸‹é¢çš„å®ç°æŠŠæ–‡ä»¶åˆ’åˆ†ä¸ºè‹¥å¹² ç­‰å¤§å°å—ï¼Œæ¯å—äº¤ç»™ç‹¬ç«‹çš„å­è¿›ç¨‹å¹¶è¡Œè¯»å–/å†™å…¥ã€‚é€‚åˆ 10â€¯GBâ€‘æ•°ç™¾â€¯GB çš„è§†é¢‘ã€å¤‡ä»½é•œåƒç­‰åœºæ™¯ã€‚

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
import os
import math
from pathlib import Path
from multiprocessing import Process, Queue, cpu_count
from tqdm import tqdm

def _worker_copy(src_path: Path, dst_path: Path, start: int, size: int, q: Queue):
    """å­è¿›ç¨‹å®é™…æ‰§è¡Œåˆ†å—å¤åˆ¶"""
    with src_path.open("rb") as f_src, dst_path.open("r+b") as f_dst:
        f_src.seek(start)
        f_dst.seek(start)
        remaining = size
        buf = 1024 * 1024  # 1â€¯MiB ç¼“å†²åŒº
        while remaining:
            read_len = min(buf, remaining)
            data = f_src.read(read_len)
            f_dst.write(data)
            remaining -= read_len
    q.put(start)   # æŠŠå·²ç»å®Œæˆçš„å—èµ·å§‹ä½ç½®å›æŠ¥ç»™ä¸»è¿›ç¨‹ï¼ˆç”¨äºè¿›åº¦æ˜¾ç¤ºï¼‰

def parallel_copy(src: str, dst: str, block_size: int = 64 * 1024 * 1024):
    """
    å¤šè¿›ç¨‹å¹¶è¡Œå¤åˆ¶å¤§æ–‡ä»¶ã€‚
    - block_sizeï¼šæ¯ä¸ªå­è¿›ç¨‹è´Ÿè´£çš„å—å¤§å°ï¼ˆé»˜è®¤ 64â€¯MiBï¼Œå¯è‡ªè¡Œè°ƒèŠ‚ï¼‰ã€‚
    - ä½¿ç”¨ cpu_count() è®¡ç®—å¹¶è¡Œåº¦ã€‚
    """
    src_path = Path(src)
    dst_path = Path(dst)

    if dst_path.is_dir():
        dst_path = dst_path / src_path.name

    total_size = src_path.stat().st_size

    # 1ï¸âƒ£ é¢„å…ˆåˆ›å»ºç›®æ ‡æ–‡ä»¶å¹¶åˆ†é…åŒæ ·å¤§å°
    with dst_path.open("wb") as f:
        f.truncate(total_size)

    # 2ï¸âƒ£ è®¡ç®—å—æ•°
    blocks = math.ceil(total_size / block_size)

    # 3ï¸âƒ£ å¯åŠ¨å­è¿›ç¨‹
    q = Queue()
    processes = []
    for i in range(blocks):
        start = i * block_size
        size = min(block_size, total_size - start)
        p = Process(target=_worker_copy,
                    args=(src_path, dst_path, start, size, q),
                    daemon=False)
        p.start()
        processes.append(p)

    # 4ï¸âƒ£ ä¸»è¿›ç¨‹æ˜¾ç¤ºè¿›åº¦æ¡
    with tqdm(total=total_size, unit="B", unit_scale=True,
              desc=f"å¹¶è¡Œå¤åˆ¶ {src_path.name}", ncols=80) as pbar:
        completed = 0
        while completed < total_size:
            finished_start = q.get()          # é˜Ÿåˆ—é‡Œæ˜¯å—çš„èµ·å§‹åç§»
            # è®¡ç®—æœ¬å—å¤§å°ï¼ˆæœ€åä¸€å—å¯èƒ½å°äº block_sizeï¼‰
            finished_size = min(block_size, total_size - finished_start)
            completed += finished_size
            pbar.update(finished_size)

    # 5ï¸âƒ£ ç­‰å¾…æ‰€æœ‰å­è¿›ç¨‹ç»“æŸ
    for p in processes:
        p.join()

    print(f"\nâœ… å¹¶è¡Œå¤åˆ¶å®Œæˆ â†’ {dst_path}")

# ------------------- ç”¨æ³•ç¤ºä¾‹ ------------------- #
if __name__ == "__main__":
    parallel_copy("example.mp4", "backup/example_parallel_copy.mp4")
è°ƒä¼˜å»ºè®®

å‚æ•°
è¯´æ˜
æ¨èå€¼
block_size	
æ¯ä¸ªå­è¿›ç¨‹ä¸€æ¬¡è¯»å–çš„å­—èŠ‚æ•°	
SSDâ€¯â†’â€¯64â€¯MiB128â€¯MiBï¼›æœºæ¢°ç¡¬ç›˜â€¯â†’â€¯32â€¯MiB64â€¯MiB
cpu_count()	
å¹¶å‘å­è¿›ç¨‹æ•°ï¼ˆé»˜è®¤ç­‰äº CPU æ ¸å¿ƒæ•°ï¼‰	
è‹¥ç£ç›˜æ˜¯ RAID/NVMeï¼Œå¯ä»¥æŠŠè¿›ç¨‹æ•°è°ƒåˆ° 2â€¯~â€¯4 å€ çš„ CPU æ ¸å¿ƒæ•°ä»¥æå‡ I/O å¹¶å‘
daemon	
å­è¿›ç¨‹æ˜¯å¦éšä¸»è¿›ç¨‹é€€å‡ºè€Œå¼ºåˆ¶ç»ˆæ­¢	
è‹¥å¤åˆ¶è¿‡ç¨‹å¿…é¡» å®Œæ•´ï¼ˆé¿å…åŠæˆå“ï¼‰ï¼Œè¯·ä¿æŒ daemon=False å¹¶æ‰‹åŠ¨ join()ï¼›è‹¥åªåšä¸´æ—¶æ‹·è´ï¼Œå¯è®¾ daemon=True åŠ é€Ÿé€€å‡º
ğŸ“‚ å®é™…ä½¿ç”¨æ¡ˆä¾‹ï¼ˆæŠŠ MP4 å¤åˆ¶åˆ°å¦ä¸€ä¸ªç›®å½•ï¼‰
å‡è®¾ä½ æœ‰ä¸€ä¸ªåŸå§‹è§†é¢‘ source/video.mp4ï¼Œæƒ³æŠŠå®ƒ å®Œæ•´å¤åˆ¶ åˆ° backup/ ç›®å½•å¹¶åœ¨æ§åˆ¶å°çœ‹åˆ°è¿›åº¦æ¡ï¼š

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
from pathlib import Path
import shutil
from tqdm import tqdm

def copy_file_with_progress(src: str, dst_dir: str, bufsize: int = 4 * 1024 * 1024):
    """
    ç®€å•ç‰ˆï¼šåˆ†å—è¯»å–+tqdm è¿›åº¦æ¡ + shutil.copymodeï¼ˆä¿ç•™æƒé™ï¼‰ã€‚
    é€‚åˆ 100â€¯MBâ€‘å‡ â€¯GB çš„å¸¸è§„æ–‡ä»¶ã€‚
    """
    src_path = Path(src)
    dst_dir = Path(dst_dir)
    dst_dir.mkdir(parents=True, exist_ok=True)
    dst_path = dst_dir / src_path.name

    total = src_path.stat().st_size
    with src_path.open('rb') as f_src, dst_path.open('wb') as f_dst, tqdm(
            total=total, unit='B', unit_scale=True, desc=f'å¤åˆ¶ {src_path.name}'
    ) as pbar:
        while True:
            data = f_src.read(bufsize)
            if not data:
                break
            f_dst.write(data)
            pbar.update(len(data))

    # å¤åˆ¶æ–‡ä»¶æƒé™ã€æ—¶é—´æˆ³ï¼ˆå¯é€‰ï¼‰
    shutil.copymode(src_path, dst_path)
    shutil.copystat(src_path, dst_path)   # åŒæ—¶ä¿ç•™è®¿é—®/ä¿®æ”¹æ—¶é—´

    print(f"âœ… å¤åˆ¶å®Œæˆ â†’ {dst_path}")

# ------------------- ç”¨æ³• ------------------- #
if __name__ == '__main__':
    copy_file_with_progress('source/video.mp4', 'backup')
ğŸ“Œ å°ç»“ & å¸¸è§é—®é¢˜
é—®é¢˜
è§£å†³æ–¹æ¡ˆ
â€œå¤åˆ¶åæ–‡ä»¶å¤§å°ä¸å¯¹â€	
1ï¸âƒ£ ç¡®è®¤æ˜¯å¦ä½¿ç”¨äº† äºŒè¿›åˆ¶æ¨¡å¼ï¼ˆ'rb' / 'wb'ï¼‰<br>2ï¸âƒ£ å¯¹ Windows ä¸Šçš„ æ–‡æœ¬æ–‡ä»¶ï¼ˆCRLFï¼‰è¯·ä¸€å®šä½¿ç”¨äºŒè¿›åˆ¶æ¨¡å¼ï¼Œå¦åˆ™ä¼šè‡ªåŠ¨è½¬æ¢å¯¼è‡´å¤§å°å˜åŒ–
â€œå¤åˆ¶åæƒé™ä¸¢å¤±â€	
ä½¿ç”¨ shutil.copy2 æˆ–åœ¨å¤åˆ¶åæ‰‹åŠ¨ shutil.copymode(src, dst)
â€œå¤åˆ¶å¤§æ–‡ä»¶éå¸¸æ…¢â€	
â‘  æ£€æŸ¥ç£ç›˜æ˜¯å¦ä¸º æœºæ¢° HDDï¼ˆç“¶é¢ˆåœ¨ I/Oï¼‰<br>â‘¡ ä½¿ç”¨ mmap æˆ– å¤šè¿›ç¨‹åˆ†å—ï¼ˆä¸Šé¢çš„ parallel_copyï¼‰<br>â‘¢ è‹¥æ˜¯ç½‘ç»œç£ç›˜ï¼ˆNASã€SMBï¼‰ï¼Œè€ƒè™‘ å…ˆæŠŠæ–‡ä»¶å…ˆæ‹‰åˆ°æœ¬åœ° å†å¤åˆ¶
â€œå¤åˆ¶è¿‡ç¨‹è¢«æ„å¤–ä¸­æ–­ï¼Œç•™ä¸‹æ®‹ç¼ºæ–‡ä»¶â€	
å¤åˆ¶å‰å…ˆåˆ›å»º ä¸´æ—¶æ–‡ä»¶ï¼ˆå¦‚ dst_path.with_suffix('.part')ï¼‰ï¼Œå¤åˆ¶æˆåŠŸå os.replace(tmp, dst_path)ï¼Œè¿™æ ·å³ä½¿ä¸­é€”å¼‚å¸¸ä¹Ÿä¸ä¼šç•™ä¸‹ä¸å®Œæ•´çš„ç›®æ ‡æ–‡ä»¶
â€œè·¨ç›˜ç§»åŠ¨ï¼ˆåŒä¸€å°æœºå™¨ä¸åŒåˆ†åŒºï¼‰æƒ³ä¿ç•™å…ƒæ•°æ®â€	
shutil.moveï¼ˆä¼šè‡ªåŠ¨è°ƒç”¨ç³»ç»Ÿçš„ rename/moveï¼‰ï¼Œä½†è·¨åˆ†åŒºä¼šé€€åŒ–ä¸ºå¤åˆ¶+åˆ é™¤ï¼Œå»ºè®®ä»ä½¿ç”¨ shutil.copy2 å† os.remove(src)ï¼Œä¿è¯å±æ€§å®Œæ•´
â€œéœ€è¦å¤åˆ¶ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼ˆé€’å½’ï¼‰â€	
shutil.copytree(src_dir, dst_dir, dirs_exist_ok=True)ï¼ˆPythonâ€¯3.8+ï¼‰<br>æˆ–æ‰‹åŠ¨éå† Path.rglob("*") å¹¶é€ä¸ª copy2
ğŸš€ å¿«é€Ÿä¸Šæ‰‹
bash

æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
# 1ï¸âƒ£ åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆå¯é€‰ï¼‰
python -m venv venv
source venv/bin/activate   # Windows: venv\Scripts\activate

# 2ï¸âƒ£ å®‰è£… tqdmï¼ˆè¿›åº¦æ¡åº“ï¼‰å’Œ pydubï¼ˆå¦‚æœéœ€è¦éŸ³é¢‘åˆ‡ç‰‡ï¼‰
pip install tqdm pydub

# 3ï¸âƒ£ è¿è¡Œä½ é€‰ä¸­çš„è„šæœ¬
python copy_file_with_progress.py   # æˆ–è€… python video_to_text.py ï¼ˆå‰é¢ç»™çš„ MP4 â†’ txt ç¤ºä¾‹ï¼‰
ä¸€å¥è¯æ€»ç»“ï¼š 

å°æ–‡ä»¶ â†’ shutil.copy2ï¼ˆä¿ç•™å±æ€§ï¼‰
æƒ³è¦è¿›åº¦ â†’ åˆ†å—è¯»å– + tqdm
å¤§æ–‡ä»¶/é«˜åå â†’ mmap æˆ– å¤šè¿›ç¨‹åˆ†å—ï¼ˆparallel_copyï¼‰
è¿™æ ·ï¼Œä½ å°±å¯ä»¥ç”¨ Python è½»æ¾ã€å¯é åœ°æŠŠä»»æ„ MP4ï¼ˆæˆ–å…¶ä»–ä»»æ„æ–‡ä»¶ï¼‰å¤åˆ¶åˆ°ç›®æ ‡ä½ç½®äº†ã€‚ç¥ä½ ç©å¾—å¼€å¿ƒ ğŸ‰!

<details type="reasoning" done="true" duration="1"> <summary>Thought for 1 seconds</summary> > User says "ç”¨pythonè¿›è¡Œå¤åˆ¶è¿™ä¸ªæ–‡ä»¶". They want to copy a file using Python. Probably they refer to the previous context about MP4 file? They might want to copy the file (the MP4) using Python. Provide code using shutil.copy, copy2, etc., handling large files, progress bar, possibly using pathlib. Also discuss binary copy with buffers, memory-mapped copy, multiprocessing for large files. Provide examples. > > Will answer in Chinese, include code snippets. </details> ä¸‹é¢ç»™å‡º **Python å¤åˆ¶æ–‡ä»¶çš„å‡ ç§å¸¸ç”¨å†™æ³•**ï¼Œä»æœ€ç®€æ´çš„ `shutil.copy` åˆ°å¸¦è¿›åº¦æ¡ã€è·¨å¹³å°çš„å¤§æ–‡ä»¶é«˜é€Ÿæ‹·è´å®ç°ï¼Œå…¨éƒ¨é…æœ‰å¯ç›´æ¥è¿è¡Œçš„ç¤ºä¾‹ä»£ç ã€‚ä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚æŒ‘é€‰åˆé€‚çš„æ–¹å¼ã€‚ --- ## ğŸ¯ ç›®æ ‡ | åœºæ™¯ | æ¨èå®ç° | å…³é”®ç‚¹ | |------|----------|--------| | **ä¸€æ¬¡æ€§å¤åˆ¶å°æ–‡ä»¶** | `shutil.copy` / `Path.rename`ï¼ˆåŒç›˜ç§»åŠ¨ï¼‰ | ä»£ç æœ€ç®€ã€è‡ªåŠ¨ä¿ç•™æƒé™ | | **ä¿ç•™å®Œæ•´å…ƒæ•°æ®ï¼ˆæ—¶é—´æˆ³ã€æƒé™ã€ACLï¼‰** | `shutil.copy2` | ä¸ç³»ç»Ÿ `cp -p` è¡Œä¸ºç›¸åŒ | | **æ˜¾ç¤ºå¤åˆ¶è¿›åº¦** | æ‰‹åŠ¨åˆ†å—è¯»å– + `tqdm` è¿›åº¦æ¡ | é€‚åˆ 100â€¯MBâ€‘å‡ â€¯GB çš„æ–‡ä»¶ | | **è¶…å¤§æ–‡ä»¶ï¼ˆ>â€¯10â€¯GBï¼‰æˆ–é«˜å¹¶å‘æ‹·è´** | `mmap` / å¤šè¿›ç¨‹åˆ†å—æ‹·è´ | é›¶æ‹·è´æˆ–å¹¶è¡Œæå‡åå | | **è·¨å¹³å°ï¼ˆWindowsâ€¯/â€¯Linuxâ€¯/â€¯macOSï¼‰** | ç»Ÿä¸€ä½¿ç”¨ `pathlib` + `shutil` | åªè¦ Python è§£é‡Šå™¨æœ¬èº«æ”¯æŒå³å¯ | | **å¤åˆ¶åˆ°åŒä¸€ç›®å½•ä¸‹æ”¹å** | `shutil.copy` + ç›®æ ‡è·¯å¾„ | åªæ”¹æ–‡ä»¶åä¸æ”¹ç›®å½• | --- ## 1ï¸âƒ£ æœ€ç®€æ´ï¼š`shutil.copy` / `shutil.copy2` ```python import shutil from pathlib import Path def copy_simple(src: str, dst: str): """ ç›´æ¥å¤åˆ¶æ–‡ä»¶ï¼ˆä¸ä¿ç•™å…ƒæ•°æ®ï¼‰ã€‚ å¦‚æœ dst æ˜¯ç›®å½•ï¼Œåˆ™æ–‡ä»¶ä¼šæ”¾è¿›è¯¥ç›®å½•å¹¶ä¿æŒåŸæ–‡ä»¶åã€‚ """ src_path = Path(src) dst_path = Path(dst) # ç›®æ ‡æ˜¯ç›®å½• â†’ è‡ªåŠ¨æ‹¼æ¥æ–‡ä»¶å if dst_path.is_dir(): dst_path = dst_path / src_path.name shutil.copy(src_path, dst_path) # åªæ‹·è´å†…å®¹ print(f"âœ… å·²å¤åˆ¶ {src_path} â†’ {dst_path}") def copy_with_meta(src: str, dst: str): """ å¤åˆ¶æ–‡ä»¶å¹¶å®Œæ•´ä¿ç•™å…ƒæ•°æ®ï¼ˆåˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ã€æƒé™ï¼‰ã€‚ ç›¸å½“äº Linux ä¸‹ `cp -p`ã€macOS/Windows ä¸‹çš„ â€œä¿ç•™å±æ€§â€ã€‚ """ src_path = Path(src) dst_path = Path(dst) if dst_path.is_dir(): dst_path = dst_path / src_path.name shutil.copy2(src_path, dst_path) # åŒæ—¶å¤åˆ¶æƒé™ã€æ—¶é—´æˆ³ç­‰ print(f"âœ… å·²å®Œæ•´å¤åˆ¶ï¼ˆä¿ç•™å…ƒæ•°æ®ï¼‰{src_path} â†’ {dst_path}") # ------------------- ç”¨æ³•ç¤ºä¾‹ ------------------- # if __name__ == "__main__": copy_simple("example.mp4", "backup/example_copy.mp4") copy_with_meta("example.mp4", "backup/example_copy2.mp4") ``` > **æ³¨æ„**ï¼š > - `shutil.copy` ä¼šåœ¨å¤åˆ¶å **è‡ªåŠ¨åˆ›å»ºç›®æ ‡æ–‡ä»¶çš„å†™æƒé™**ï¼Œä½†ä¸ä¼šä¿ç•™åŸæ–‡ä»¶çš„ **ä¿®æ”¹æ—¶é—´ã€è®¿é—®æ—¶é—´**ã€‚ > - `shutil.copy2` ä¼šä¿ç•™ **æƒé™ã€ä¿®æ”¹æ—¶é—´ã€è®¿é—®æ—¶é—´**ï¼ˆåœ¨ Windows ä¸Šä¹Ÿä¼šä¿ç•™ **æ–‡ä»¶å±æ€§**ï¼‰ï¼Œä½†ä¸ä¿è¯å¤åˆ¶ **ACL**ï¼ˆå¦‚ NTFS çš„ç‰¹æ®Šæƒé™ï¼‰ï¼Œå¦‚æœéœ€è¦æ›´ç»†ç²’åº¦çš„ ACLï¼Œè¯·ä½¿ç”¨ `os.system("xcopy ...")` æˆ–ç¬¬ä¸‰æ–¹åº“ `pywin32`ï¼ˆä»… Windowsï¼‰ã€‚ --- ## 2ï¸âƒ£ å¸¦è¿›åº¦æ¡çš„åˆ†å—å¤åˆ¶ï¼ˆæ¨èç”¨äºå‡ ç™¾ MBâ€‘å‡  GB çš„æ–‡ä»¶ï¼‰ ```python import os from pathlib import Path from tqdm import tqdm def copy_with_progress(src: str, dst: str, buf_size: int = 4 * 1024 * 1024): """ æŒ‰å—è¯»å–å¹¶å†™å…¥ï¼Œå®æ—¶æ˜¾ç¤º tqdm è¿›åº¦æ¡ã€‚ - buf_sizeï¼šæ¯æ¬¡è¯»å†™çš„å­—èŠ‚æ•°ï¼Œé»˜è®¤ 4â€¯MiBï¼ˆå¯æ ¹æ®ç£ç›˜/ç½‘ç»œè°ƒä¼˜ï¼‰ã€‚ """ src_path = Path(src) dst_path = Path(dst) if dst_path.is_dir(): dst_path = dst_path / src_path.name total_size = src_path.stat().st_size copied = 0 with src_path.open("rb") as f_src, dst_path.open("wb") as f_dst, tqdm( total=total_size, unit="B", unit_scale=True, unit_divisor=1024, desc=f"å¤åˆ¶ {src_path.name}" ) as pbar: while True: chunk = f_src.read(buf_size) if not chunk: break f_dst.write(chunk) copied += len(chunk) pbar.update(len(chunk)) # åŒæ­¥æ–‡ä»¶å±æ€§ï¼ˆæ—¶é—´æˆ³ã€æƒé™ï¼‰â€”â€”å¯é€‰ shutil.copystat(src_path, dst_path) print(f"\nâœ… å¤åˆ¶å®Œæˆï¼Œå¤§å° {copied:,} å­—èŠ‚ â†’ {dst_path}") # ------------------- ç”¨æ³•ç¤ºä¾‹ ------------------- # if __name__ == "__main__": copy_with_progress("example.mp4", "backup/example_copy_progress.mp4") ``` **ä¸ºä»€ä¹ˆè¦è‡ªå·±åˆ†å—ï¼Ÿ** - `shutil.copyfileobj` ä¹Ÿå¯ä»¥åˆ†å—ï¼Œä½†ä¸è‡ªå¸¦è¿›åº¦æ¡ï¼›è‡ªå·±å†™å¾ªç¯å¯ä»¥éšæ—¶åŠ å…¥ **æ—¥å¿—ã€æ ¡éªŒã€åŠ å¯†** ç­‰é¢å¤–é€»è¾‘ã€‚ - `tqdm` ä¼šè‡ªåŠ¨è®¡ç®— **ä¼ è¾“é€Ÿç‡**ã€**å·²ç”¨æ—¶é—´**ã€**é¢„è®¡å‰©ä½™æ—¶é—´**ï¼Œæå¤§æå‡ç”¨æˆ·ä½“éªŒã€‚ --- ## 3ï¸âƒ£ è¶…å¤§æ–‡ä»¶çš„ **é›¶æ‹·è´**ï¼ˆ`mmap`ï¼‰ > `mmap` åœ¨åº•å±‚åˆ©ç”¨æ“ä½œç³»ç»Ÿçš„ **å†…å­˜æ˜ å°„**ï¼ˆmemoryâ€‘mapped fileï¼‰æŠ€æœ¯ï¼Œè¯»å–å’Œå†™å…¥éƒ½ä¸éœ€è¦é¢å¤–çš„ç”¨æˆ·ç©ºé—´æ‹·è´ï¼Œé€‚åˆ **å•è¿›ç¨‹**ã€**å•æ ¸** ç¯å¢ƒä¸‹çš„ **GB çº§åˆ«** æ–‡ä»¶æ‹·è´ã€‚ > ï¼ˆåœ¨ Windows ä¸ŠåŒæ ·å¯ç”¨ï¼Œåªè¦æ–‡ä»¶ç³»ç»Ÿæ”¯æŒæ˜ å°„å³å¯ï¼‰ ```python import mmap from pathlib import Path def copy_mmap(src: str, dst: str): src_path = Path(src) dst_path = Path(dst) if dst_path.is_dir(): dst_path = dst_path / src_path.name # 1ï¸âƒ£ å…ˆåˆ›å»ºç›®æ ‡æ–‡ä»¶å¹¶é¢„åˆ†é…åŒæ ·å¤§å° with src_path.open("rb") as f_src, dst_path.open("wb") as f_dst: f_dst.truncate(src_path.stat().st_size) # é¢„åˆ†é…ç£ç›˜ç©ºé—´ # 2ï¸âƒ£ ä½¿ç”¨ mmap åŒæ—¶æ˜ å°„è¯»å†™ with open(src_path, "rb") as f_src, open(dst_path, "r+b") as f_dst: # å‚æ•° 0 è¡¨ç¤ºæ˜ å°„æ•´ä¸ªæ–‡ä»¶ with mmap.mmap(f_src.fileno(), 0, access=mmap.ACCESS_READ) as src_map, \ mmap.mmap(f_dst.fileno(), 0, access=mmap.ACCESS_WRITE) as dst_map: dst_map[:] = src_map[:] # ä¸€è¡Œä»£ç å®Œæˆæ‹·è´ï¼ˆåº•å±‚æ˜¯å†…æ ¸çº§æ‹·è´ï¼‰ print(f"âœ… mmap é›¶æ‹·è´å®Œæˆ â†’ {dst_path}") # ------------------- ç”¨æ³•ç¤ºä¾‹ ------------------- # if __name__ == "__main__": copy_mmap("example.mp4", "backup/example_copy_mmap.mp4") ``` **ä¼˜ç‚¹** - **é€Ÿåº¦å¿«**ï¼ˆå‡ ä¹åªå—ç£ç›˜ååé™åˆ¶ï¼‰ - **å†…å­˜å ç”¨ä½**ï¼ˆåªæ˜ å°„ä¸€æ¬¡ï¼Œä¸éœ€è¦åœ¨ Python é‡ŒæŒæœ‰æ•´ä¸ªæ–‡ä»¶ï¼‰ **ç¼ºç‚¹** - åªèƒ½åœ¨ **åŒä¸€å°æœºå™¨**å†…éƒ¨ä½¿ç”¨ï¼Œè·¨ç½‘ç»œéœ€è¦å…ˆæŠŠæ–‡ä»¶æ˜ å°„åˆ°ç½‘ç»œå…±äº«ç›˜ã€‚ - å¯¹ **æå°æ–‡ä»¶** æ²¡æœ‰ä¼˜åŠ¿ï¼Œåè€Œå¤šäº†æ‰“å¼€æ˜ å°„çš„å¼€é”€ã€‚ --- ## 4ï¸âƒ£ å¤šè¿›ç¨‹å¹¶è¡Œåˆ†å—å¤åˆ¶ï¼ˆé€‚åˆ **å¤šæ ¸æœåŠ¡å™¨** æˆ– **ç½‘ç»œç£ç›˜**ï¼‰ ä¸‹é¢çš„å®ç°æŠŠæ–‡ä»¶åˆ’åˆ†ä¸ºè‹¥å¹² **ç­‰å¤§å°å—**ï¼Œæ¯å—äº¤ç»™ç‹¬ç«‹çš„å­è¿›ç¨‹å¹¶è¡Œè¯»å–/å†™å…¥ã€‚é€‚åˆ **10â€¯GBâ€‘æ•°ç™¾â€¯GB** çš„è§†é¢‘ã€å¤‡ä»½é•œåƒç­‰åœºæ™¯ã€‚ ```python import os import math from pathlib import Path from multiprocessing import Process, Queue, cpu_count from tqdm import tqdm def _worker_copy(src_path: Path, dst_path: Path, start: int, size: int, q: Queue): """å­è¿›ç¨‹å®é™…æ‰§è¡Œåˆ†å—å¤åˆ¶""" with src_path.open("rb") as f_src, dst_path.open("r+b") as f_dst: f_src.seek(start) f_dst.seek(start) remaining = size buf = 1024 * 1024 # 1â€¯MiB ç¼“å†²åŒº while remaining: read_len = min(buf, remaining) data = f_src.read(read_len) f_dst.write(data) remaining -= read_len q.put(start) # æŠŠå·²ç»å®Œæˆçš„å—èµ·å§‹ä½ç½®å›æŠ¥ç»™ä¸»è¿›ç¨‹ï¼ˆç”¨äºè¿›åº¦æ˜¾ç¤ºï¼‰ def parallel_copy(src: str, dst: str, block_size: int = 64 * 1024 * 1024): """ å¤šè¿›ç¨‹å¹¶è¡Œå¤åˆ¶å¤§æ–‡ä»¶ã€‚ - block_sizeï¼šæ¯ä¸ªå­è¿›ç¨‹è´Ÿè´£çš„å—å¤§å°ï¼ˆé»˜è®¤ 64â€¯MiBï¼Œå¯è‡ªè¡Œè°ƒèŠ‚ï¼‰ã€‚ - ä½¿ç”¨ cpu_count() è®¡ç®—å¹¶è¡Œåº¦ã€‚ """ src_path = Path(src) dst_path = Path(dst) if dst_path.is_dir(): dst_path = dst_path / src_path.name total_size = src_path.stat().st_size # 1ï¸âƒ£ é¢„å…ˆåˆ›å»ºç›®æ ‡æ–‡ä»¶å¹¶åˆ†é…åŒæ ·å¤§å° with dst_path.open("wb") as f: f.truncate(total_size) # 2ï¸âƒ£ è®¡ç®—å—æ•° blocks = math.ceil(total_size / block_size) # 3ï¸âƒ£ å¯åŠ¨å­è¿›ç¨‹ q = Queue() processes = [] for i in range(blocks): start = i * block_size size = min(block_size, total_size - start) p = Process(target=_worker_copy, args=(src_path, dst_path, start, size, q), daemon=False) p.start() processes.append(p) # 4ï¸âƒ£ ä¸»è¿›ç¨‹æ˜¾ç¤ºè¿›åº¦æ¡ with tqdm(total=total_size, unit="B", unit_scale=True, desc=f"å¹¶è¡Œå¤åˆ¶ {src_path.name}", ncols=80) as pbar: completed = 0 while completed < total_size: finished_start = q.get() # é˜Ÿåˆ—é‡Œæ˜¯å—çš„èµ·å§‹åç§» # è®¡ç®—æœ¬å—å¤§å°ï¼ˆæœ€åä¸€å—å¯èƒ½å°äº block_sizeï¼‰ finished_size = min(block_size, total_size - finished_start) completed += finished_size pbar.update(finished_size) # 5ï¸âƒ£ ç­‰å¾…æ‰€æœ‰å­è¿›ç¨‹ç»“æŸ for p in processes: p.join() print(f"\nâœ… å¹¶è¡Œå¤åˆ¶å®Œæˆ â†’ {dst_path}") # ------------------- ç”¨æ³•ç¤ºä¾‹ ------------------- # if __name__ == "__main__": parallel_copy("example.mp4", "backup/example_parallel_copy.mp4") ``` **è°ƒä¼˜å»ºè®®** | å‚æ•° | è¯´æ˜ | æ¨èå€¼ | |------|------|--------| | `block_size` | æ¯ä¸ªå­è¿›ç¨‹ä¸€æ¬¡è¯»å–çš„å­—èŠ‚æ•° | SSDâ€¯â†’â€¯64â€¯MiB~128â€¯MiBï¼›æœºæ¢°ç¡¬ç›˜â€¯â†’â€¯32â€¯MiB~64â€¯MiB | | `cpu_count()` | å¹¶å‘å­è¿›ç¨‹æ•°ï¼ˆé»˜è®¤ç­‰äº CPU æ ¸å¿ƒæ•°ï¼‰ | è‹¥ç£ç›˜æ˜¯ **RAID/NVMe**ï¼Œå¯ä»¥æŠŠè¿›ç¨‹æ•°è°ƒåˆ° **2â€¯~â€¯4 å€** çš„ CPU æ ¸å¿ƒæ•°ä»¥æå‡ I/O å¹¶å‘ | | `daemon` | å­è¿›ç¨‹æ˜¯å¦éšä¸»è¿›ç¨‹é€€å‡ºè€Œå¼ºåˆ¶ç»ˆæ­¢ | è‹¥å¤åˆ¶è¿‡ç¨‹å¿…é¡» **å®Œæ•´**ï¼ˆé¿å…åŠæˆå“ï¼‰ï¼Œè¯·ä¿æŒ `daemon=False` å¹¶æ‰‹åŠ¨ `join()`ï¼›è‹¥åªåšä¸´æ—¶æ‹·è´ï¼Œå¯è®¾ `daemon=True` åŠ é€Ÿé€€å‡º | --- ## ğŸ“‚ å®é™…ä½¿ç”¨æ¡ˆä¾‹ï¼ˆæŠŠ MP4 å¤åˆ¶åˆ°å¦ä¸€ä¸ªç›®å½•ï¼‰ å‡è®¾ä½ æœ‰ä¸€ä¸ªåŸå§‹è§†é¢‘ `source/video.mp4`ï¼Œæƒ³æŠŠå®ƒ **å®Œæ•´å¤åˆ¶** åˆ° `backup/` ç›®å½•å¹¶åœ¨æ§åˆ¶å°çœ‹åˆ°è¿›åº¦æ¡ï¼š ```python from pathlib import Path import shutil from tqdm import tqdm def copy_file_with_progress(src: str, dst_dir: str, bufsize: int = 4 * 1024 * 1024): """ ç®€å•ç‰ˆï¼šåˆ†å—è¯»å–+tqdm è¿›åº¦æ¡ + shutil.copymodeï¼ˆä¿ç•™æƒé™ï¼‰ã€‚ é€‚åˆ 100â€¯MBâ€‘å‡ â€¯GB çš„å¸¸è§„æ–‡ä»¶ã€‚ """ src_path = Path(src) dst_dir = Path(dst_dir) dst_dir.mkdir(parents=True, exist_ok=True) dst_path = dst_dir / src_path.name total = src_path.stat().st_size with src_path.open('rb') as f_src, dst_path.open('wb') as f_dst, tqdm( total=total, unit='B', unit_scale=True, desc=f'å¤åˆ¶ {src_path.name}' ) as pbar: while True: data = f_src.read(bufsize) if not data: break f_dst.write(data) pbar.update(len(data)) # å¤åˆ¶æ–‡ä»¶æƒé™ã€æ—¶é—´æˆ³ï¼ˆå¯é€‰ï¼‰ shutil.copymode(src_path, dst_path) shutil.copystat(src_path, dst_path) # åŒæ—¶ä¿ç•™è®¿é—®/ä¿®æ”¹æ—¶é—´ print(f"âœ… å¤åˆ¶å®Œæˆ â†’ {dst_path}") # ------------------- ç”¨æ³• ------------------- # if __name__ == '__main__': copy_file_with_progress('source/video.mp4', 'backup') ``` --- ## ğŸ“Œ å°ç»“ & å¸¸è§é—®é¢˜ | é—®é¢˜ | è§£å†³æ–¹æ¡ˆ | |------|----------| | **â€œå¤åˆ¶åæ–‡ä»¶å¤§å°ä¸å¯¹â€** | 1ï¸âƒ£ ç¡®è®¤æ˜¯å¦ä½¿ç”¨äº† **äºŒè¿›åˆ¶æ¨¡å¼**ï¼ˆ`'rb'` / `'wb'`ï¼‰<br>2ï¸âƒ£ å¯¹ Windows ä¸Šçš„ **æ–‡æœ¬æ–‡ä»¶**ï¼ˆCRLFï¼‰è¯·ä¸€å®šä½¿ç”¨äºŒè¿›åˆ¶æ¨¡å¼ï¼Œå¦åˆ™ä¼šè‡ªåŠ¨è½¬æ¢å¯¼è‡´å¤§å°å˜åŒ– | | **â€œå¤åˆ¶åæƒé™ä¸¢å¤±â€** | ä½¿ç”¨ `shutil.copy2` æˆ–åœ¨å¤åˆ¶åæ‰‹åŠ¨ `shutil.copymode(src, dst)` | | **â€œå¤åˆ¶å¤§æ–‡ä»¶éå¸¸æ…¢â€** | â‘  æ£€æŸ¥ç£ç›˜æ˜¯å¦ä¸º **æœºæ¢° HDD**ï¼ˆç“¶é¢ˆåœ¨ I/Oï¼‰<br>â‘¡ ä½¿ç”¨ **`mmap`** æˆ– **å¤šè¿›ç¨‹åˆ†å—**ï¼ˆä¸Šé¢çš„ `parallel_copy`ï¼‰<br>â‘¢ è‹¥æ˜¯ç½‘ç»œç£ç›˜ï¼ˆNASã€SMBï¼‰ï¼Œè€ƒè™‘ **å…ˆæŠŠæ–‡ä»¶å…ˆæ‹‰åˆ°æœ¬åœ°** å†å¤åˆ¶ | | **â€œå¤åˆ¶è¿‡ç¨‹è¢«æ„å¤–ä¸­æ–­ï¼Œç•™ä¸‹æ®‹ç¼ºæ–‡ä»¶â€** | å¤åˆ¶å‰å…ˆåˆ›å»º **ä¸´æ—¶æ–‡ä»¶**ï¼ˆå¦‚ `dst_path.with_suffix('.part')`ï¼‰ï¼Œå¤åˆ¶æˆåŠŸå `os.replace(tmp, dst_path)`ï¼Œè¿™æ ·å³ä½¿ä¸­é€”å¼‚å¸¸ä¹Ÿä¸ä¼šç•™ä¸‹ä¸å®Œæ•´çš„ç›®æ ‡æ–‡ä»¶ | | **â€œè·¨ç›˜ç§»åŠ¨ï¼ˆåŒä¸€å°æœºå™¨ä¸åŒåˆ†åŒºï¼‰æƒ³ä¿ç•™å…ƒæ•°æ®â€** | `shutil.move`ï¼ˆä¼šè‡ªåŠ¨è°ƒç”¨ç³»ç»Ÿçš„ `rename`/`move`ï¼‰ï¼Œä½†è·¨åˆ†åŒºä¼šé€€åŒ–ä¸ºå¤åˆ¶+åˆ é™¤ï¼Œå»ºè®®ä»ä½¿ç”¨ `shutil.copy2` å† `os.remove(src)`ï¼Œä¿è¯å±æ€§å®Œæ•´ | | **â€œéœ€è¦å¤åˆ¶ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼ˆé€’å½’ï¼‰â€** | `shutil.copytree(src_dir, dst_dir, dirs_exist_ok=True)`ï¼ˆPythonâ€¯3.8+ï¼‰<br>æˆ–æ‰‹åŠ¨éå† `Path.rglob("*")` å¹¶é€ä¸ª `copy2` | --- ## ğŸš€ å¿«é€Ÿä¸Šæ‰‹ ```bash # 1ï¸âƒ£ åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆå¯é€‰ï¼‰ python -m venv venv source venv/bin/activate # Windows: venv\Scripts\activate # 2ï¸âƒ£ å®‰è£… tqdmï¼ˆè¿›åº¦æ¡åº“ï¼‰å’Œ pydubï¼ˆå¦‚æœéœ€è¦éŸ³é¢‘åˆ‡ç‰‡ï¼‰ pip install tqdm pydub # 3ï¸âƒ£ è¿è¡Œä½ é€‰ä¸­çš„è„šæœ¬ python copy_file_with_progress.py # æˆ–è€… python video_to_text.py ï¼ˆå‰é¢ç»™çš„ MP4 â†’ txt ç¤ºä¾‹ï¼‰ ``` > **ä¸€å¥è¯æ€»ç»“**ï¼š > - **å°æ–‡ä»¶** â†’ `shutil.copy2`ï¼ˆä¿ç•™å±æ€§ï¼‰ > - **æƒ³è¦è¿›åº¦** â†’ åˆ†å—è¯»å– + `tqdm` > - **å¤§æ–‡ä»¶/é«˜åå** â†’ `mmap` æˆ– **å¤šè¿›ç¨‹åˆ†å—**ï¼ˆ`parallel_copy`ï¼‰ è¿™æ ·ï¼Œä½ å°±å¯ä»¥ç”¨ Python è½»æ¾ã€å¯é åœ°æŠŠä»»æ„ MP4ï¼ˆæˆ–å…¶ä»–ä»»æ„æ–‡ä»¶ï¼‰å¤åˆ¶åˆ°ç›®æ ‡ä½ç½®äº†ã€‚ç¥ä½ ç©å¾—å¼€å¿ƒ ğŸ‰!
--------------------------------------------------------------------------- FileNotFoundError Traceback (most recent call last) Cell In[5], line 21 18 shutil.copy(src_path, dst_path) # åªæ‹·è´å†…å®¹ 19 print(f"âœ… å·²å¤åˆ¶ {src_path} â†’ {dst_path}") ---> 21 copy_simple("./files/video1.mp4", "backup/example_copy.mp4") Cell In[5], line 18, in copy_simple**(src, dst)** 15 if dst_path.is_dir(): 16 dst_path = dst_path / src_path.name ---> 18 shutil.copy(src_path, dst_path) # åªæ‹·è´å†…å®¹ 19 print(f"âœ… å·²å¤åˆ¶ {src_path} â†’ {dst_path}") File E:\tools\Anaconda3\lib\shutil.py:417, in copy**(src, dst, follow_symlinks)** 415 if os.path.isdir(dst): 416 dst = os.path.join(dst, os.path.basename(src)) --> 417 copyfile(src, dst, follow_symlinks=follow_symlinks) 418 copymode(src, dst, follow_symlinks=follow_symlinks) 419 return dst File E:\tools\Anaconda3\lib\shutil.py:256, in copyfile**(src, dst, follow_symlinks)** 254 with open(src, 'rb') as fsrc: 255 try: --> 256 with open(dst, 'wb') as fdst: 257 # macOS 258 if _HAS_FCOPYFILE: 259 try: FileNotFoundError: [Errno 2] No such file or directory: 'backup\example_copy.mp4'

profile
gpt-oss:120b
æ€è€ƒç”¨æ—¶ 1 ç§’
ğŸ” å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ
FileNotFoundError: No such file or directory: 'backup\\example_copy.mp4'
è¯´æ˜ ç›®æ ‡è·¯å¾„çš„çˆ¶ç›®å½• backup/ å¹¶ä¸å­˜åœ¨ï¼Œäºæ˜¯ shutil.copy() åœ¨å°è¯•æ‰“å¼€ç›®æ ‡æ–‡ä»¶è¿›è¡Œå†™å…¥æ—¶å¤±è´¥äº†ã€‚

shutil.copy(src, dst) åªä¼šåˆ›å»ºç›®æ ‡æ–‡ä»¶æœ¬èº«ï¼Œä¸ä¼šè‡ªåŠ¨åˆ›å»ºç¼ºå¤±çš„ç›®å½•ã€‚
å¦‚æœ dst æ˜¯ä¸€ä¸ªç›®å½•ï¼Œshutil.copy ä¼šæŠŠæ–‡ä»¶æ”¾è¿›å»ï¼›å¦‚æœ dst æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ–‡ä»¶è·¯å¾„ï¼Œè€Œå®ƒçš„ä¸Šå±‚ç›®å½•ä¸å­˜åœ¨ï¼Œå°±ä¼šæŠ›å‡ºä¸Šé¢çš„å¼‚å¸¸ã€‚ 

âœ… è§£å†³æ€è·¯
åœ¨å¤åˆ¶å‰ç¡®ä¿ç›®æ ‡ç›®å½•å·²åˆ›å»ºï¼ˆPath.mkdir(parents=True, exist_ok=True)ï¼‰ã€‚
ï¼ˆå¯é€‰ï¼‰æŠŠå¤åˆ¶ä»£ç åŒ…è£…æˆ å¼‚å¸¸å®‰å…¨ çš„å‡½æ•°ï¼Œæ–¹ä¾¿åœ¨é¡¹ç›®ä¸­å¤ç”¨ã€‚
å¦‚æœä½ æƒ³ä¸€æ¬¡æ€§å¤åˆ¶åˆ°åŒä¸€ç›®å½•ä¸‹çš„å¤šä¸ªæ–‡ä»¶ï¼Œå»ºè®®æŠŠç›®å½•è·¯å¾„å•ç‹¬ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚
ä¸‹é¢ç»™å‡ºå‡ ç§å¸¸ç”¨çš„ã€æ›´å¥å£®çš„å®ç°æ–¹å¼ã€‚

ğŸ› ï¸ å®Œæ•´ç¤ºä¾‹ 1ï¼šæœ€ç®€ç‰ˆï¼ˆåªä¿è¯ç›®å½•å­˜åœ¨ï¼‰
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
import shutil
from pathlib import Path

def copy_simple(src: str, dst_dir: str, dst_name: str | None = None):
    """
    å°† src æ–‡ä»¶å¤åˆ¶åˆ° dst_dir ç›®å½•ä¸‹ã€‚
    - å¦‚æœ dst_name ä¸º Noneï¼Œåˆ™ä¿æŒåŸæ–‡ä»¶åã€‚
    - è‡ªåŠ¨åˆ›å»º dst_dirï¼ˆåŒ…æ‹¬å¤šå±‚çˆ¶ç›®å½•ï¼‰ã€‚
    """
    src_path = Path(src).expanduser().resolve()
    dst_dir_path = Path(dst_dir).expanduser().resolve()

    # â‘  ç¡®ä¿æºæ–‡ä»¶çœŸçš„å­˜åœ¨
    if not src_path.is_file():
        raise FileNotFoundError(f"æºæ–‡ä»¶ä¸å­˜åœ¨ï¼š{src_path}")

    # â‘¡ è‡ªåŠ¨åˆ›å»ºç›®æ ‡ç›®å½•ï¼ˆåŒ…æ‹¬æ‰€æœ‰ç¼ºå¤±çš„çˆ¶ç›®å½•ï¼‰
    dst_dir_path.mkdir(parents=True, exist_ok=True)

    # â‘¢ ç›®æ ‡æ–‡ä»¶å®Œæ•´è·¯å¾„
    if dst_name is None:
        dst_path = dst_dir_path / src_path.name
    else:
        dst_path = dst_dir_path / dst_name

    # â‘£ å¤åˆ¶ï¼ˆåªæ‹·è´å†…å®¹ï¼Œä¸ä¿ç•™å…ƒæ•°æ®ï¼‰
    shutil.copy(src_path, dst_path)

    print(f"âœ… å·²å¤åˆ¶ {src_path} â†’ {dst_path}")

# ------------------- è°ƒç”¨ç¤ºä¾‹ -------------------
if __name__ == "__main__":
    # å‡è®¾å½“å‰å·¥ä½œç›®å½•ä¸‹æœ‰ ./files/video1.mp4
    copy_simple("./files/video1.mp4", "backup")                 # å¤åˆ¶ä¸º backup/video1.mp4
    # å¦‚æœæƒ³æ”¹åï¼š
    copy_simple("./files/video1.mp4", "backup", "example.mp4")   # å¤åˆ¶ä¸º backup/example.mp4
å…³é”®ç‚¹ï¼šdst_dir_path.mkdir(parents=True, exist_ok=True) ä¼šä¸€æ¬¡æ€§åˆ›å»º backup/ï¼Œå³ä½¿å®ƒçš„çˆ¶ç›®å½•ä¹Ÿä¸å­˜åœ¨ä¹Ÿæ²¡é—®é¢˜ã€‚ 

ğŸ› ï¸ å®Œæ•´ç¤ºä¾‹ 2ï¼šä¿ç•™å…ƒæ•°æ®ï¼ˆæ—¶é—´æˆ³ã€æƒé™ï¼‰å¹¶å¸¦è¿›åº¦æ¡
å¦‚æœä½ å¸Œæœ›å¤åˆ¶åä¿ç•™ åˆ›å»ºæ—¶é—´ / ä¿®æ”¹æ—¶é—´ / æƒé™ï¼Œä»¥åŠåœ¨å¤åˆ¶å¤§æ–‡ä»¶æ—¶çœ‹åˆ°è¿›åº¦æ¡ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å®ç°ï¼š

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
import shutil
from pathlib import Path
from tqdm import tqdm

def copy_with_progress(src: str, dst_dir: str, bufsize: int = 4 * 1024 * 1024):
    """
    - è‡ªåŠ¨åˆ›å»ºç›®æ ‡ç›®å½•
    - åˆ†å—è¯»å– + tqdm è¿›åº¦æ¡
    - å¤åˆ¶å®Œåä¿ç•™å…ƒæ•°æ®ï¼ˆç›¸å½“äº shutil.copy2ï¼‰
    """
    src_path = Path(src).expanduser().resolve()
    dst_dir_path = Path(dst_dir).expanduser().resolve()

    if not src_path.is_file():
        raise FileNotFoundError(f"æºæ–‡ä»¶ä¸å­˜åœ¨ï¼š{src_path}")

    dst_dir_path.mkdir(parents=True, exist_ok=True)
    dst_path = dst_dir_path / src_path.name

    total = src_path.stat().st_size
    with src_path.open('rb') as fsrc, dst_path.open('wb') as fdst, tqdm(
        total=total, unit='B', unit_scale=True,
        desc=f'å¤åˆ¶ {src_path.name}'
    ) as pbar:
        while True:
            chunk = fsrc.read(bufsize)
            if not chunk:
                break
            fdst.write(chunk)
            pbar.update(len(chunk))

    # ---- ä¿ç•™å…ƒæ•°æ®ï¼ˆæ—¶é—´æˆ³ã€æƒé™ï¼‰----
    shutil.copystat(src_path, dst_path)   # å¤åˆ¶è®¿é—®/ä¿®æ”¹æ—¶é—´ã€æƒé™ç­‰
    print(f"\nâœ… å·²å®Œæ•´å¤åˆ¶ï¼ˆä¿ç•™å…ƒæ•°æ®ï¼‰{src_path} â†’ {dst_path}")

# ------------------- è°ƒç”¨ç¤ºä¾‹ -------------------
if __name__ == "__main__":
    copy_with_progress("./files/video1.mp4", "backup")
ğŸ§© å°æŠ€å·§ä¸å¸¸è§å‘
åœºæ™¯
å¸¸è§é”™è¯¯
æ­£ç¡®åšæ³•
ç›¸å¯¹è·¯å¾„å†™é”™	
./files/video1.mp4 å®é™…åœ¨ä¸åŒå·¥ä½œç›®å½•ä¸‹æ‰¾ä¸åˆ°	
ä½¿ç”¨ Path(__file__).parent / "files/video1.mp4" æˆ– os.chdir() æ˜ç¡®å·¥ä½œç›®å½•
ç›®æ ‡æ˜¯æ–‡ä»¶è€Œä¸æ˜¯ç›®å½•	
shutil.copy(src, "backup/example.mp4") ä¸” backup/ ä¸å­˜åœ¨	
å…ˆåˆ›å»ºçˆ¶ç›®å½•ï¼šPath("backup").mkdir(parents=True, exist_ok=True)
è·¨ç›˜ç§»åŠ¨	
shutil.move è·¨åˆ†åŒºæ—¶ä¼šå…ˆå¤åˆ¶å†åˆ é™¤ï¼Œå¯èƒ½ä¸¢å¤±å±æ€§	
ä½¿ç”¨ shutil.copy2 + os.remove(src)ï¼Œæˆ– Path.renameï¼ˆåŒç›˜ï¼‰
éœ€è¦åŸå­æ€§ï¼ˆå¤åˆ¶è¿‡ç¨‹ä¸­ä¸æƒ³å‡ºç°åŠæˆå“ï¼‰	
ç›´æ¥å†™å…¥ç›®æ ‡æ–‡ä»¶ï¼Œè‹¥ä¸­é€”å¼‚å¸¸ä¼šç•™ä¸‹ä¸å®Œæ•´æ–‡ä»¶	
å…ˆå¤åˆ¶åˆ° dst_path.with_suffix('.part')ï¼Œå¤åˆ¶æˆåŠŸå os.replace(tmp, dst_path)
å¤§æ–‡ä»¶ï¼ˆ>â€¯10â€¯GBï¼‰å¤åˆ¶æ…¢	
ç”¨ shutil.copyï¼ˆå•çº¿ç¨‹ï¼‰	
ä½¿ç”¨ mmap æˆ– å¤šè¿›ç¨‹åˆ†å—ï¼ˆå‰æ–‡ parallel_copy ç¤ºä¾‹ï¼‰
ğŸ“¦ ç»„åˆè¿›ä½ è‡ªå·±çš„å·¥å…·åº“
ä¸‹é¢æ˜¯ä¸€æ®µ é€šç”¨çš„å¤åˆ¶å‡½æ•°ï¼ŒæŠŠå‰é¢çš„åŠŸèƒ½éƒ½å°è£…è¿›ä¸€ä¸ª APIï¼Œæ–¹ä¾¿åœ¨é¡¹ç›®é‡Œéšå¤„è°ƒç”¨ï¼š

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
import shutil
from pathlib import Path
from tqdm import tqdm
import os

def robust_copy(
    src: str,
    dst: str,
    *,
    keep_meta: bool = True,
    show_progress: bool = True,
    bufsize: int = 4 * 1024 * 1024,
    atomic: bool = True,
) -> Path:
    """
    å‚æ•°è¯´æ˜
    ----------
    src : str
        æºæ–‡ä»¶è·¯å¾„ï¼ˆå¿…é¡»æ˜¯æ–‡ä»¶ï¼‰ã€‚
    dst : str
        ç›®æ ‡è·¯å¾„ï¼Œå¯ä»¥æ˜¯ç›®å½•ä¹Ÿå¯ä»¥æ˜¯å®Œæ•´æ–‡ä»¶åã€‚
    keep_meta : bool
        æ˜¯å¦ä¿ç•™æ—¶é—´æˆ³ã€æƒé™ç­‰å…ƒæ•°æ®ï¼ˆç­‰ä»·äº shutil.copy2ï¼‰ã€‚
    show_progress : bool
        æ˜¯å¦åœ¨ç»ˆç«¯æ˜¾ç¤º tqdm è¿›åº¦æ¡ï¼ˆé€‚åˆå¤§æ–‡ä»¶ï¼‰ã€‚
    bufsize : int
        åˆ†å—å¤§å°ï¼Œé»˜è®¤ 4MiBã€‚
    atomic : bool
        è‹¥ä¸º Trueï¼Œåˆ™å…ˆå†™å…¥ *.part* ä¸´æ—¶æ–‡ä»¶ï¼Œå¤åˆ¶æˆåŠŸåå†æ”¹åï¼Œé˜²æ­¢ä¸­é€”å¼‚å¸¸ç•™ä¸‹åŠæˆå“ã€‚

    è¿”å›å€¼
    ------
    pathlib.Path
        å®é™…å†™å…¥çš„ç›®æ ‡æ–‡ä»¶è·¯å¾„ï¼ˆå·²æ ‡å‡†åŒ–ä¸ºç»å¯¹è·¯å¾„ï¼‰ã€‚
    """
    src_path = Path(src).expanduser().resolve()
    if not src_path.is_file():
        raise FileNotFoundError(f"æºæ–‡ä»¶ä¸å­˜åœ¨ï¼š{src_path}")

    dst_path = Path(dst).expanduser().resolve()
    # å¦‚æœ dst æ˜¯ç›®å½•ï¼Œåˆ™åœ¨è¯¥ç›®å½•ä¸‹ä¿æŒåŸæ–‡ä»¶å
    if dst_path.is_dir() or dst_path.suffix == "":
        dst_path = dst_path / src_path.name

    # ç¡®ä¿çˆ¶ç›®å½•å­˜åœ¨
    dst_path.parent.mkdir(parents=True, exist_ok=True)

    # è‹¥è¦æ±‚åŸå­æ“ä½œï¼Œå…ˆå†™å…¥ .part ä¸´æ—¶æ–‡ä»¶
    final_path = dst_path
    if atomic:
        tmp_path = dst_path.with_suffix(dst_path.suffix + ".part")
    else:
        tmp_path = dst_path

    # ----------------- å¤åˆ¶è¿‡ç¨‹ -----------------
    total = src_path.stat().st_size
    if show_progress:
        iterator = tqdm(
            total=total,
            unit='B',
            unit_scale=True,
            desc=f'å¤åˆ¶ {src_path.name}'
        )
    else:
        iterator = None

    with src_path.open('rb') as fsrc, tmp_path.open('wb') as fdst:
        while True:
            chunk = fsrc.read(bufsize)
            if not chunk:
                break
            fdst.write(chunk)
            if iterator:
                iterator.update(len(chunk))

    if iterator:
        iterator.close()

    # ----------------- å…ƒæ•°æ® -----------------
    if keep_meta:
        shutil.copystat(src_path, tmp_path)

    # ----------------- åŸå­ rename -----------------
    if atomic:
        os.replace(tmp_path, final_path)   # Windowsã€Linux å‡å¯

    print(f"âœ… å¤åˆ¶å®Œæˆ â†’ {final_path}")
    return final_path

# ------------------- ä½¿ç”¨ç¤ºä¾‹ -------------------
if __name__ == "__main__":
    robust_copy("./files/video1.mp4", "backup")                     # è‡ªåŠ¨åˆ›å»ºç›®å½•ã€è¿›åº¦æ¡ã€ä¿ç•™å…ƒæ•°æ®
    robust_copy("./files/video1.mp4", "backup/example2.mp4", atomic=False)  # ä¸èµ° .part ä¸´æ—¶æ–‡ä»¶
ä¼˜ç‚¹ï¼š

ä¸€æ¬¡æ€§è§£å†³ï¼šç›®å½•åˆ›å»ºã€è¿›åº¦æ¡ã€å…ƒæ•°æ®ã€åŸå­æ€§å‡å¯è‡ªç”±å¼€å…³ã€‚
è¿”å› Pathï¼Œæ–¹ä¾¿åç»­ç»§ç»­é“¾å¼è°ƒç”¨ï¼ˆå¦‚ path.with_suffix('.txt')ï¼‰ã€‚
å¼‚å¸¸é€æ˜ï¼šå¦‚æœå¤åˆ¶è¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œä¸´æ—¶ .part æ–‡ä»¶ä¼šä¿ç•™ä¸‹æ¥ï¼Œä¾¿äºè°ƒè¯•æˆ–æ‰‹åŠ¨æ¸…ç†ã€‚
ğŸ“š å°ç»“
FileNotFoundError é€šå¸¸æ˜¯ç›®æ ‡ç›®å½•ä¸å­˜åœ¨å¯¼è‡´çš„ã€‚
ä½¿ç”¨ Path.mkdir(parents=True, exist_ok=True) å…ˆåˆ›å»ºç›®å½•ï¼Œå†è°ƒç”¨ shutil.copy æˆ–è‡ªå®šä¹‰çš„å—å¤åˆ¶ã€‚
è‹¥è¦ ä¿ç•™å…ƒæ•°æ® ç”¨ shutil.copy2 æˆ– shutil.copystatã€‚
å¤§æ–‡ä»¶å»ºè®® åˆ†å—å¤åˆ¶ + tqdmï¼Œç”šè‡³ä½¿ç”¨ mmap / å¤šè¿›ç¨‹ ä»¥æå‡ååã€‚
ä¸ºäº†å®‰å…¨èµ·è§ï¼ŒåŸå­å†™å…¥ï¼ˆå…ˆå†™ .part å† os.replaceï¼‰æ˜¯æœ€ä½³å®è·µã€‚
è¿™æ ·ï¼Œä½ çš„å¤åˆ¶è„šæœ¬å°±èƒ½åœ¨å„ç§ç¯å¢ƒï¼ˆWindows / macOS / Linuxï¼‰ä¸‹ç¨³ç¨³è¿è¡Œäº†ã€‚ç¥ä½ ç¼–ç é¡ºåˆ© ğŸš€!

<details type="reasoning" done="true" duration="1"> <summary>Thought for 1 seconds</summary> > The user posted an error traceback indicating FileNotFoundError when trying to copy a file to a destination directory that doesn't exist. They need guidance on fixing that: ensure destination directory exists, maybe create it. Also discuss using pathlib and shutil functions. Provide corrected code, explain error, and possibly show alternative methods with progress. Also maybe mention relative paths. Provide robust function that ensures directory. Provide suggestions for handling errors. > > Now craft answer in Chinese, with explanation, code snippets, and suggestions. </details> ## ğŸ” å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ `FileNotFoundError: No such file or directory: 'backup\\example_copy.mp4'` è¯´æ˜ **ç›®æ ‡è·¯å¾„çš„çˆ¶ç›®å½• `backup/` å¹¶ä¸å­˜åœ¨**ï¼Œäºæ˜¯ `shutil.copy()` åœ¨å°è¯•æ‰“å¼€ç›®æ ‡æ–‡ä»¶è¿›è¡Œå†™å…¥æ—¶å¤±è´¥äº†ã€‚ > `shutil.copy(src, dst)` **åªä¼šåˆ›å»ºç›®æ ‡æ–‡ä»¶æœ¬èº«**ï¼Œ**ä¸ä¼šè‡ªåŠ¨åˆ›å»ºç¼ºå¤±çš„ç›®å½•**ã€‚ > å¦‚æœ `dst` æ˜¯ä¸€ä¸ªç›®å½•ï¼Œ`shutil.copy` ä¼šæŠŠæ–‡ä»¶æ”¾è¿›å»ï¼›å¦‚æœ `dst` æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ–‡ä»¶è·¯å¾„ï¼Œè€Œå®ƒçš„ä¸Šå±‚ç›®å½•ä¸å­˜åœ¨ï¼Œå°±ä¼šæŠ›å‡ºä¸Šé¢çš„å¼‚å¸¸ã€‚ --- ## âœ… è§£å†³æ€è·¯ 1. **åœ¨å¤åˆ¶å‰ç¡®ä¿ç›®æ ‡ç›®å½•å·²åˆ›å»º**ï¼ˆ`Path.mkdir(parents=True, exist_ok=True)`ï¼‰ã€‚ 2. ï¼ˆå¯é€‰ï¼‰æŠŠå¤åˆ¶ä»£ç åŒ…è£…æˆ **å¼‚å¸¸å®‰å…¨** çš„å‡½æ•°ï¼Œæ–¹ä¾¿åœ¨é¡¹ç›®ä¸­å¤ç”¨ã€‚ 3. å¦‚æœä½ æƒ³ä¸€æ¬¡æ€§å¤åˆ¶åˆ°åŒä¸€ç›®å½•ä¸‹çš„å¤šä¸ªæ–‡ä»¶ï¼Œå»ºè®®æŠŠç›®å½•è·¯å¾„å•ç‹¬ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚ ä¸‹é¢ç»™å‡ºå‡ ç§å¸¸ç”¨çš„ã€**æ›´å¥å£®**çš„å®ç°æ–¹å¼ã€‚ --- ## ğŸ› ï¸ å®Œæ•´ç¤ºä¾‹ 1ï¼šæœ€ç®€ç‰ˆï¼ˆåªä¿è¯ç›®å½•å­˜åœ¨ï¼‰ ```python import shutil from pathlib import Path def copy_simple(src: str, dst_dir: str, dst_name: str | None = None): """ å°† src æ–‡ä»¶å¤åˆ¶åˆ° dst_dir ç›®å½•ä¸‹ã€‚ - å¦‚æœ dst_name ä¸º Noneï¼Œåˆ™ä¿æŒåŸæ–‡ä»¶åã€‚ - è‡ªåŠ¨åˆ›å»º dst_dirï¼ˆåŒ…æ‹¬å¤šå±‚çˆ¶ç›®å½•ï¼‰ã€‚ """ src_path = Path(src).expanduser().resolve() dst_dir_path = Path(dst_dir).expanduser().resolve() # â‘  ç¡®ä¿æºæ–‡ä»¶çœŸçš„å­˜åœ¨ if not src_path.is_file(): raise FileNotFoundError(f"æºæ–‡ä»¶ä¸å­˜åœ¨ï¼š{src_path}") # â‘¡ è‡ªåŠ¨åˆ›å»ºç›®æ ‡ç›®å½•ï¼ˆåŒ…æ‹¬æ‰€æœ‰ç¼ºå¤±çš„çˆ¶ç›®å½•ï¼‰ dst_dir_path.mkdir(parents=True, exist_ok=True) # â‘¢ ç›®æ ‡æ–‡ä»¶å®Œæ•´è·¯å¾„ if dst_name is None: dst_path = dst_dir_path / src_path.name else: dst_path = dst_dir_path / dst_name # â‘£ å¤åˆ¶ï¼ˆåªæ‹·è´å†…å®¹ï¼Œä¸ä¿ç•™å…ƒæ•°æ®ï¼‰ shutil.copy(src_path, dst_path) print(f"âœ… å·²å¤åˆ¶ {src_path} â†’ {dst_path}") # ------------------- è°ƒç”¨ç¤ºä¾‹ ------------------- if __name__ == "__main__": # å‡è®¾å½“å‰å·¥ä½œç›®å½•ä¸‹æœ‰ ./files/video1.mp4 copy_simple("./files/video1.mp4", "backup") # å¤åˆ¶ä¸º backup/video1.mp4 # å¦‚æœæƒ³æ”¹åï¼š copy_simple("./files/video1.mp4", "backup", "example.mp4") # å¤åˆ¶ä¸º backup/example.mp4 ``` > **å…³é”®ç‚¹**ï¼š`dst_dir_path.mkdir(parents=True, exist_ok=True)` ä¼šä¸€æ¬¡æ€§åˆ›å»º `backup/`ï¼Œå³ä½¿å®ƒçš„çˆ¶ç›®å½•ä¹Ÿä¸å­˜åœ¨ä¹Ÿæ²¡é—®é¢˜ã€‚ --- ## ğŸ› ï¸ å®Œæ•´ç¤ºä¾‹ 2ï¼šä¿ç•™å…ƒæ•°æ®ï¼ˆæ—¶é—´æˆ³ã€æƒé™ï¼‰å¹¶å¸¦è¿›åº¦æ¡ å¦‚æœä½ å¸Œæœ›å¤åˆ¶åä¿ç•™ **åˆ›å»ºæ—¶é—´ / ä¿®æ”¹æ—¶é—´ / æƒé™**ï¼Œä»¥åŠåœ¨å¤åˆ¶å¤§æ–‡ä»¶æ—¶çœ‹åˆ°è¿›åº¦æ¡ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å®ç°ï¼š ```python import shutil from pathlib import Path from tqdm import tqdm def copy_with_progress(src: str, dst_dir: str, bufsize: int = 4 * 1024 * 1024): """ - è‡ªåŠ¨åˆ›å»ºç›®æ ‡ç›®å½• - åˆ†å—è¯»å– + tqdm è¿›åº¦æ¡ - å¤åˆ¶å®Œåä¿ç•™å…ƒæ•°æ®ï¼ˆç›¸å½“äº shutil.copy2ï¼‰ """ src_path = Path(src).expanduser().resolve() dst_dir_path = Path(dst_dir).expanduser().resolve() if not src_path.is_file(): raise FileNotFoundError(f"æºæ–‡ä»¶ä¸å­˜åœ¨ï¼š{src_path}") dst_dir_path.mkdir(parents=True, exist_ok=True) dst_path = dst_dir_path / src_path.name total = src_path.stat().st_size with src_path.open('rb') as fsrc, dst_path.open('wb') as fdst, tqdm( total=total, unit='B', unit_scale=True, desc=f'å¤åˆ¶ {src_path.name}' ) as pbar: while True: chunk = fsrc.read(bufsize) if not chunk: break fdst.write(chunk) pbar.update(len(chunk)) # ---- ä¿ç•™å…ƒæ•°æ®ï¼ˆæ—¶é—´æˆ³ã€æƒé™ï¼‰---- shutil.copystat(src_path, dst_path) # å¤åˆ¶è®¿é—®/ä¿®æ”¹æ—¶é—´ã€æƒé™ç­‰ print(f"\nâœ… å·²å®Œæ•´å¤åˆ¶ï¼ˆä¿ç•™å…ƒæ•°æ®ï¼‰{src_path} â†’ {dst_path}") # ------------------- è°ƒç”¨ç¤ºä¾‹ ------------------- if __name__ == "__main__": copy_with_progress("./files/video1.mp4", "backup") ``` --- ## ğŸ§© å°æŠ€å·§ä¸å¸¸è§å‘ | åœºæ™¯ | å¸¸è§é”™è¯¯ | æ­£ç¡®åšæ³• | |------|----------|----------| | **ç›¸å¯¹è·¯å¾„å†™é”™** | `./files/video1.mp4` å®é™…åœ¨ä¸åŒå·¥ä½œç›®å½•ä¸‹æ‰¾ä¸åˆ° | ä½¿ç”¨ `Path(__file__).parent / "files/video1.mp4"` æˆ– `os.chdir()` æ˜ç¡®å·¥ä½œç›®å½• | | **ç›®æ ‡æ˜¯æ–‡ä»¶è€Œä¸æ˜¯ç›®å½•** | `shutil.copy(src, "backup/example.mp4")` ä¸” `backup/` ä¸å­˜åœ¨ | **å…ˆåˆ›å»ºçˆ¶ç›®å½•**ï¼š`Path("backup").mkdir(parents=True, exist_ok=True)` | | **è·¨ç›˜ç§»åŠ¨** | `shutil.move` è·¨åˆ†åŒºæ—¶ä¼šå…ˆå¤åˆ¶å†åˆ é™¤ï¼Œå¯èƒ½ä¸¢å¤±å±æ€§ | ä½¿ç”¨ `shutil.copy2` + `os.remove(src)`ï¼Œæˆ– `Path.rename`ï¼ˆåŒç›˜ï¼‰ | | **éœ€è¦åŸå­æ€§**ï¼ˆå¤åˆ¶è¿‡ç¨‹ä¸­ä¸æƒ³å‡ºç°åŠæˆå“ï¼‰ | ç›´æ¥å†™å…¥ç›®æ ‡æ–‡ä»¶ï¼Œè‹¥ä¸­é€”å¼‚å¸¸ä¼šç•™ä¸‹ä¸å®Œæ•´æ–‡ä»¶ | å…ˆå¤åˆ¶åˆ° `dst_path.with_suffix('.part')`ï¼Œå¤åˆ¶æˆåŠŸå `os.replace(tmp, dst_path)` | | **å¤§æ–‡ä»¶ï¼ˆ>â€¯10â€¯GBï¼‰å¤åˆ¶æ…¢** | ç”¨ `shutil.copy`ï¼ˆå•çº¿ç¨‹ï¼‰ | ä½¿ç”¨ **`mmap`** æˆ– **å¤šè¿›ç¨‹åˆ†å—**ï¼ˆå‰æ–‡ `parallel_copy` ç¤ºä¾‹ï¼‰ | --- ## ğŸ“¦ ç»„åˆè¿›ä½ è‡ªå·±çš„å·¥å…·åº“ ä¸‹é¢æ˜¯ä¸€æ®µ **é€šç”¨çš„å¤åˆ¶å‡½æ•°**ï¼ŒæŠŠå‰é¢çš„åŠŸèƒ½éƒ½å°è£…è¿›ä¸€ä¸ª APIï¼Œæ–¹ä¾¿åœ¨é¡¹ç›®é‡Œéšå¤„è°ƒç”¨ï¼š ```python import shutil from pathlib import Path from tqdm import tqdm import os def robust_copy( src: str, dst: str, *, keep_meta: bool = True, show_progress: bool = True, bufsize: int = 4 * 1024 * 1024, atomic: bool = True, ) -> Path: """ å‚æ•°è¯´æ˜ ---------- src : str æºæ–‡ä»¶è·¯å¾„ï¼ˆå¿…é¡»æ˜¯æ–‡ä»¶ï¼‰ã€‚ dst : str ç›®æ ‡è·¯å¾„ï¼Œå¯ä»¥æ˜¯ç›®å½•ä¹Ÿå¯ä»¥æ˜¯å®Œæ•´æ–‡ä»¶åã€‚ keep_meta : bool æ˜¯å¦ä¿ç•™æ—¶é—´æˆ³ã€æƒé™ç­‰å…ƒæ•°æ®ï¼ˆç­‰ä»·äº shutil.copy2ï¼‰ã€‚ show_progress : bool æ˜¯å¦åœ¨ç»ˆç«¯æ˜¾ç¤º tqdm è¿›åº¦æ¡ï¼ˆé€‚åˆå¤§æ–‡ä»¶ï¼‰ã€‚ bufsize : int åˆ†å—å¤§å°ï¼Œé»˜è®¤ 4MiBã€‚ atomic : bool è‹¥ä¸º Trueï¼Œåˆ™å…ˆå†™å…¥ *.part* ä¸´æ—¶æ–‡ä»¶ï¼Œå¤åˆ¶æˆåŠŸåå†æ”¹åï¼Œé˜²æ­¢ä¸­é€”å¼‚å¸¸ç•™ä¸‹åŠæˆå“ã€‚ è¿”å›å€¼ ------ pathlib.Path å®é™…å†™å…¥çš„ç›®æ ‡æ–‡ä»¶è·¯å¾„ï¼ˆå·²æ ‡å‡†åŒ–ä¸ºç»å¯¹è·¯å¾„ï¼‰ã€‚ """ src_path = Path(src).expanduser().resolve() if not src_path.is_file(): raise FileNotFoundError(f"æºæ–‡ä»¶ä¸å­˜åœ¨ï¼š{src_path}") dst_path = Path(dst).expanduser().resolve() # å¦‚æœ dst æ˜¯ç›®å½•ï¼Œåˆ™åœ¨è¯¥ç›®å½•ä¸‹ä¿æŒåŸæ–‡ä»¶å if dst_path.is_dir() or dst_path.suffix == "": dst_path = dst_path / src_path.name # ç¡®ä¿çˆ¶ç›®å½•å­˜åœ¨ dst_path.parent.mkdir(parents=True, exist_ok=True) # è‹¥è¦æ±‚åŸå­æ“ä½œï¼Œå…ˆå†™å…¥ .part ä¸´æ—¶æ–‡ä»¶ final_path = dst_path if atomic: tmp_path = dst_path.with_suffix(dst_path.suffix + ".part") else: tmp_path = dst_path # ----------------- å¤åˆ¶è¿‡ç¨‹ ----------------- total = src_path.stat().st_size if show_progress: iterator = tqdm( total=total, unit='B', unit_scale=True, desc=f'å¤åˆ¶ {src_path.name}' ) else: iterator = None with src_path.open('rb') as fsrc, tmp_path.open('wb') as fdst: while True: chunk = fsrc.read(bufsize) if not chunk: break fdst.write(chunk) if iterator: iterator.update(len(chunk)) if iterator: iterator.close() # ----------------- å…ƒæ•°æ® ----------------- if keep_meta: shutil.copystat(src_path, tmp_path) # ----------------- åŸå­ rename ----------------- if atomic: os.replace(tmp_path, final_path) # Windowsã€Linux å‡å¯ print(f"âœ… å¤åˆ¶å®Œæˆ â†’ {final_path}") return final_path # ------------------- ä½¿ç”¨ç¤ºä¾‹ ------------------- if __name__ == "__main__": robust_copy("./files/video1.mp4", "backup") # è‡ªåŠ¨åˆ›å»ºç›®å½•ã€è¿›åº¦æ¡ã€ä¿ç•™å…ƒæ•°æ® robust_copy("./files/video1.mp4", "backup/example2.mp4", atomic=False) # ä¸èµ° .part ä¸´æ—¶æ–‡ä»¶ ``` **ä¼˜ç‚¹**ï¼š - **ä¸€æ¬¡æ€§è§£å†³**ï¼šç›®å½•åˆ›å»ºã€è¿›åº¦æ¡ã€å…ƒæ•°æ®ã€åŸå­æ€§å‡å¯è‡ªç”±å¼€å…³ã€‚ - **è¿”å› `Path`**ï¼Œæ–¹ä¾¿åç»­ç»§ç»­é“¾å¼è°ƒç”¨ï¼ˆå¦‚ `path.with_suffix('.txt')`ï¼‰ã€‚ - **å¼‚å¸¸é€æ˜**ï¼šå¦‚æœå¤åˆ¶è¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œä¸´æ—¶ `.part` æ–‡ä»¶ä¼šä¿ç•™ä¸‹æ¥ï¼Œä¾¿äºè°ƒè¯•æˆ–æ‰‹åŠ¨æ¸…ç†ã€‚ --- ## ğŸ“š å°ç»“ 1. **`FileNotFoundError`** é€šå¸¸æ˜¯ç›®æ ‡ç›®å½•ä¸å­˜åœ¨å¯¼è‡´çš„ã€‚ 2. ä½¿ç”¨ `Path.mkdir(parents=True, exist_ok=True)` **å…ˆåˆ›å»ºç›®å½•**ï¼Œå†è°ƒç”¨ `shutil.copy` æˆ–è‡ªå®šä¹‰çš„å—å¤åˆ¶ã€‚ 3. è‹¥è¦ **ä¿ç•™å…ƒæ•°æ®** ç”¨ `shutil.copy2` æˆ– `shutil.copystat`ã€‚ 4. å¤§æ–‡ä»¶å»ºè®® **åˆ†å—å¤åˆ¶ + tqdm**ï¼Œç”šè‡³ä½¿ç”¨ **`mmap` / å¤šè¿›ç¨‹** ä»¥æå‡ååã€‚ 5. ä¸ºäº†å®‰å…¨èµ·è§ï¼Œ**åŸå­å†™å…¥**ï¼ˆå…ˆå†™ `.part` å† `os.replace`ï¼‰æ˜¯æœ€ä½³å®è·µã€‚ è¿™æ ·ï¼Œä½ çš„å¤åˆ¶è„šæœ¬å°±èƒ½åœ¨å„ç§ç¯å¢ƒï¼ˆWindows / macOS / Linuxï¼‰ä¸‹ç¨³ç¨³è¿è¡Œäº†ã€‚ç¥ä½ ç¼–ç é¡ºåˆ© ğŸš€!
python

æŠ˜å 

è¿è¡Œ
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
âŒ„
âŒ„
import time 
import shutil
from pathlib import Path
def copy_simple(src: str, dst: str):
    """
    ç›´æ¥å¤åˆ¶æ–‡ä»¶ï¼ˆä¸ä¿ç•™å…ƒæ•°æ®ï¼‰ã€‚
    å¦‚æœ dst æ˜¯ç›®å½•ï¼Œåˆ™æ–‡ä»¶ä¼šæ”¾è¿›è¯¥ç›®å½•å¹¶ä¿æŒåŸæ–‡ä»¶åã€‚
    """
    src_path = Path(src)
    dst_path = Path(dst)
    # ç›®æ ‡æ˜¯ç›®å½• â†’ è‡ªåŠ¨æ‹¼æ¥æ–‡ä»¶å
    if dst_path.is_dir():
        dst_path = dst_path / src_path.name
    shutil.copy(src_path, dst_path)          # åªæ‹·è´å†…å®¹
    print(f"âœ… å·²å¤åˆ¶ {src_path} â†’ {dst_path}")
copy_simple("./files/video1.mp4", "./backup/example_copy.mp4")
profile
gpt-oss:120b
æ€è€ƒç”¨æ—¶ 0 ç§’
ä¸‹é¢çš„ä»£ç æŠŠ â€œç›®æ ‡ç›®å½•ä¸å­˜åœ¨â€ çš„é—®é¢˜å½»åº•è§£å†³äº†ï¼ŒåŒæ—¶åŠ å…¥äº†ä¸€äº›å¸¸ç”¨çš„å¥å£®æ€§æ”¹è¿›ï¼š

âœ… å…ˆåˆ›å»ºç›®æ ‡çˆ¶ç›®å½•ï¼ˆmkdir(parents=True, exist_ok=True)ï¼‰
âœ… ä½¿ç”¨ Path.resolve() æŠŠç›¸å¯¹è·¯å¾„è½¬æˆç»å¯¹è·¯å¾„ï¼Œé¿å…å› ä¸ºå·¥ä½œç›®å½•å˜åŒ–å¯¼è‡´æ‰¾ä¸åˆ°æ–‡ä»¶
âœ… åŠ å…¥ å¼‚å¸¸æ•è·ï¼ŒæŠŠé”™è¯¯ä¿¡æ¯æ‰“å°å‡ºæ¥ï¼Œæ–¹ä¾¿è°ƒè¯•
âœ… æä¾› å¯é€‰çš„ä¿ç•™å…ƒæ•°æ®ï¼ˆshutil.copy2ï¼‰å’Œ è¿›åº¦æ¡ï¼ˆtqdmï¼‰ä¸¤ç§å®ç°ï¼Œä»»é€‰å…¶ä¸€
ğŸ“¦ å®Œæ•´ã€å¯ç›´æ¥è¿è¡Œçš„ç¤ºä¾‹
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
import shutil
from pathlib import Path
from tqdm import tqdm   # åªåœ¨éœ€è¦è¿›åº¦æ¡æ—¶ importï¼Œæ²¡è£…çš„è¯ pip install tqdm

def copy_simple(
    src: str,
    dst: str,
    *,
    keep_meta: bool = False,   # True â†’ shutil.copy2ï¼ˆä¿ç•™æ—¶é—´æˆ³ã€æƒé™ç­‰ï¼‰
    show_progress: bool = False,  # True â†’ åˆ†å—å¤åˆ¶å¹¶æ˜¾ç¤º tqdm è¿›åº¦æ¡
    bufsize: int = 4 * 1024 * 1024  # 4â€¯MiBï¼Œè¿›åº¦æ¡æ¨¡å¼ä¸‹çš„å—å¤§å°
) -> None:
    """
    æŠŠ src æ–‡ä»¶å¤åˆ¶åˆ° dstï¼ˆå¯ä»¥æ˜¯ç›®å½•æˆ–å®Œæ•´æ–‡ä»¶è·¯å¾„ï¼‰ã€‚
    - è‡ªåŠ¨åˆ›å»ºç¼ºå¤±çš„çˆ¶ç›®å½•
    - é»˜è®¤åªæ‹·è´å†…å®¹ï¼›å¦‚æœ keep_meta ä¸º Trueï¼Œåˆ™ä½¿ç”¨ copy2
    - å¦‚æœ show_progress ä¸º Trueï¼Œåˆ™ä½¿ç”¨ tqdm æ˜¾ç¤ºè¿›åº¦æ¡ï¼ˆé€‚åˆå¤§æ–‡ä»¶ï¼‰
    """
    # ----------------- 1ï¸âƒ£ å‚æ•°æ ‡å‡†åŒ– -----------------
    src_path = Path(src).expanduser().resolve()
    dst_path = Path(dst).expanduser().resolve()

    # æºæ–‡ä»¶å¿…é¡»å­˜åœ¨ä¸”æ˜¯æ™®é€šæ–‡ä»¶
    if not src_path.is_file():
        raise FileNotFoundError(f"æºæ–‡ä»¶ä¸å­˜åœ¨ï¼š{src_path}")

    # å¦‚æœ dst æœ¬èº«æ˜¯ç›®å½•ï¼Œæˆ–è€…åªç»™äº†ç›®å½•è·¯å¾„è€Œæ²¡æœ‰æ–‡ä»¶åï¼Œåˆ™ä¿æŒåŸæ–‡ä»¶å
    if dst_path.is_dir() or dst_path.suffix == "":
        dst_path = dst_path / src_path.name

    # ----------------- 2ï¸âƒ£ ç¡®ä¿ç›®æ ‡ç›®å½•å·²ç»åˆ›å»º -----------------
    dst_path.parent.mkdir(parents=True, exist_ok=True)

    # ----------------- 3ï¸âƒ£ å¤åˆ¶è¿‡ç¨‹ -----------------
    try:
        if show_progress:
            # ----- å¸¦è¿›åº¦æ¡çš„åˆ†å—å¤åˆ¶ -----
            total = src_path.stat().st_size
            with src_path.open('rb') as fsrc, dst_path.open('wb') as fdst, tqdm(
                total=total,
                unit='B',
                unit_scale=True,
                desc=f'å¤åˆ¶ {src_path.name}'
            ) as pbar:
                while True:
                    chunk = fsrc.read(bufsize)
                    if not chunk:
                        break
                    fdst.write(chunk)
                    pbar.update(len(chunk))
        else:
            # ----- æœ€ç®€ç‰ˆï¼šä¸€æ¬¡æ€§å¤åˆ¶ -----
            if keep_meta:
                shutil.copy2(src_path, dst_path)   # ä¿ç•™æ—¶é—´æˆ³ã€æƒé™ç­‰
            else:
                shutil.copy(src_path, dst_path)    # åªæ‹·è´å†…å®¹

        # å¦‚æœéœ€è¦ä¿ç•™å…ƒæ•°æ®è€Œç”¨äº† shutil.copyï¼ˆä¸ä¿ç•™ï¼‰ï¼Œæ‰‹åŠ¨è¡¥ä¸Š
        if keep_meta and not show_progress:
            shutil.copystat(src_path, dst_path)

        print(f"âœ… å·²å¤åˆ¶ {src_path} â†’ {dst_path}")

    except Exception as e:   # æ•è·æ‰€æœ‰å¼‚å¸¸å¹¶ç»™å‡ºå‹å¥½çš„æç¤º
        print(f"âŒ å¤åˆ¶å¤±è´¥ï¼{type(e).__name__}: {e}")
        # è¿™é‡Œå¯ä»¥æ ¹æ®éœ€æ±‚æŠŠå¼‚å¸¸å†æŠ›å‡ºæˆ–è®°å½•æ—¥å¿—
        raise


# ------------------- è°ƒç”¨ç¤ºä¾‹ -------------------
if __name__ == "__main__":
    # ç¤ºä¾‹ 1ï¼šæœ€ç®€ç‰ˆï¼ˆä¸ä¿ç•™å…ƒæ•°æ®ï¼Œä¸æ˜¾ç¤ºè¿›åº¦æ¡ï¼‰
    copy_simple("./files/video1.mp4", "./backup/example_copy.mp4")

    # ç¤ºä¾‹ 2ï¼šä¿ç•™å…ƒæ•°æ®ï¼ˆç›¸å½“äº shutil.copy2ï¼‰
    copy_simple("./files/video1.mp4", "./backup/example_copy_meta.mp4")
    # åªè¦æŠŠ `shutil.copy` æ”¹æˆ `shutil.copy2` å³å¯ï¼ˆä¸‹é¢çš„å®ç°å·²ç»æŠŠå¼€å…³å°è£…è¿›å‡½æ•°ï¼‰

    # ç¤ºä¾‹ 3ï¼šå¸¦è¿›åº¦æ¡çš„å¤§æ–‡ä»¶å¤åˆ¶
    copy_simple("./files/video1.mp4", "./backup/example_copy_progress.mp4")
å…³é”®ç‚¹è§£é‡Š
æ­¥éª¤
ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå†™
src_path = Path(src).expanduser().resolve()	
æŠŠ ./files/video1.mp4 è§£ææˆå®Œæ•´çš„ç»å¯¹è·¯å¾„ï¼Œé˜²æ­¢åœ¨ Jupyterã€IDE æˆ– os.chdir() ä¹‹åæ‰¾ä¸åˆ°æ–‡ä»¶ã€‚
dst_path.parent.mkdir(parents=True, exist_ok=True)	
shutil.copy åªä¼šåˆ›å»ºç›®æ ‡æ–‡ä»¶æœ¬èº«ï¼Œä¸ä¼šè‡ªåŠ¨åˆ›å»ºç¼ºå¤±çš„ç›®å½•ã€‚parents=True èƒ½ä¸€æ¬¡æ€§åˆ›å»ºå¤šå±‚ç›®å½•ï¼Œexist_ok=True åœ¨ç›®å½•å·²å­˜åœ¨æ—¶ä¸ä¼šæŠ¥é”™ã€‚
if dst_path.is_dir(): dst_path = dst_path / src_path.name	
å½“ç”¨æˆ·æŠŠ dst å½“æˆç›®å½•ä¼ å…¥æ—¶ï¼ˆå¦‚ ./backup/ï¼‰ï¼Œè‡ªåŠ¨æ‹¼æ¥ä¸Šæºæ–‡ä»¶åï¼Œä½¿ API æ›´ç›´è§‚ã€‚
shutil.copy vs shutil.copy2	
copy åªæ‹·è´æ–‡ä»¶å†…å®¹ï¼›copy2 åœ¨æ‹·è´å†…å®¹çš„åŒæ—¶ ä¿ç•™æ—¶é—´æˆ³ã€æƒé™ç­‰å…ƒæ•°æ®ã€‚ä½ å¯ä»¥æŠŠ keep_meta å‚æ•°è®¾ä¸º True æ¥åˆ‡æ¢ã€‚
tqdm è¿›åº¦æ¡	
å¯¹äºå‡ ç™¾ MBã€å‡  GB ç”šè‡³æ›´å¤§çš„æ–‡ä»¶ï¼Œåˆ†å—è¯»å–å¹¶å®æ—¶æ˜¾ç¤ºè¿›åº¦å¯ä»¥æ˜æ˜¾æå‡ç”¨æˆ·ä½“éªŒã€‚
try/except æ•è·	
å½“è·¯å¾„é”™è¯¯ã€ç£ç›˜ç©ºé—´ä¸è¶³ã€æ–‡ä»¶è¢«å ç”¨ç­‰å¼‚å¸¸å‡ºç°æ—¶ï¼Œèƒ½å¤Ÿç»™å‡ºæ˜ç¡®çš„é”™è¯¯ä¿¡æ¯è€Œä¸æ˜¯ç›´æ¥ä¸­æ–­æ•´ä¸ªè„šæœ¬ã€‚
ğŸš€ å¦‚ä½•æŠŠè¿™æ®µä»£ç ç›´æ¥æ¬è¿›ä½ çš„é¡¹ç›®
å¤åˆ¶ä¸Šé¢çš„ copy_simpleï¼ˆæˆ– robust_copyï¼‰å‡½æ•°åˆ°ä½ è‡ªå·±çš„æ¨¡å—ä¸­ã€‚
ç¡®ä¿é¡¹ç›®æ ¹ç›®å½•ä¸‹æœ‰ files/video1.mp4ï¼Œæˆ–è€…æŠŠè·¯å¾„æ”¹æˆå®é™…æ‰€åœ¨ä½ç½®ã€‚
è¿è¡Œï¼š
bash

æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
python your_script.py
å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼çš„è¾“å‡ºï¼š


æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
âœ… å·²å¤åˆ¶ /absolute/path/to/files/video1.mp4 â†’ /absolute/path/to/backup/example_copy.mp4
â“ ä½ å¯èƒ½è¿˜æœ‰çš„ç–‘é—®
| é—®é¢˜ | è§£ç­” |

<details type="reasoning" done="true" duration="0"> <summary>Thought for 0 seconds</summary> > User posted a Python code snippet that still errors due to missing directory. Need to respond with fix, explain issue, suggest improvements. Possibly show creating directory, handling errors, using pathlib, etc. Provide updated code. Also maybe ask for environment details. Provide final answer. </details> ä¸‹é¢çš„ä»£ç æŠŠ **â€œç›®æ ‡ç›®å½•ä¸å­˜åœ¨â€** çš„é—®é¢˜å½»åº•è§£å†³äº†ï¼ŒåŒæ—¶åŠ å…¥äº†ä¸€äº›å¸¸ç”¨çš„å¥å£®æ€§æ”¹è¿›ï¼š * âœ… **å…ˆåˆ›å»ºç›®æ ‡çˆ¶ç›®å½•**ï¼ˆ`mkdir(parents=True, exist_ok=True)`ï¼‰ * âœ… ä½¿ç”¨ **`Path.resolve()`** æŠŠç›¸å¯¹è·¯å¾„è½¬æˆç»å¯¹è·¯å¾„ï¼Œé¿å…å› ä¸ºå·¥ä½œç›®å½•å˜åŒ–å¯¼è‡´æ‰¾ä¸åˆ°æ–‡ä»¶ * âœ… åŠ å…¥ **å¼‚å¸¸æ•è·**ï¼ŒæŠŠé”™è¯¯ä¿¡æ¯æ‰“å°å‡ºæ¥ï¼Œæ–¹ä¾¿è°ƒè¯• * âœ… æä¾› **å¯é€‰çš„ä¿ç•™å…ƒæ•°æ®**ï¼ˆ`shutil.copy2`ï¼‰å’Œ **è¿›åº¦æ¡**ï¼ˆ`tqdm`ï¼‰ä¸¤ç§å®ç°ï¼Œä»»é€‰å…¶ä¸€ --- ## ğŸ“¦ å®Œæ•´ã€å¯ç›´æ¥è¿è¡Œçš„ç¤ºä¾‹ ```python import shutil from pathlib import Path from tqdm import tqdm # åªåœ¨éœ€è¦è¿›åº¦æ¡æ—¶ importï¼Œæ²¡è£…çš„è¯ pip install tqdm def copy_simple( src: str, dst: str, *, keep_meta: bool = False, # True â†’ shutil.copy2ï¼ˆä¿ç•™æ—¶é—´æˆ³ã€æƒé™ç­‰ï¼‰ show_progress: bool = False, # True â†’ åˆ†å—å¤åˆ¶å¹¶æ˜¾ç¤º tqdm è¿›åº¦æ¡ bufsize: int = 4 * 1024 * 1024 # 4â€¯MiBï¼Œè¿›åº¦æ¡æ¨¡å¼ä¸‹çš„å—å¤§å° ) -> None: """ æŠŠ src æ–‡ä»¶å¤åˆ¶åˆ° dstï¼ˆå¯ä»¥æ˜¯ç›®å½•æˆ–å®Œæ•´æ–‡ä»¶è·¯å¾„ï¼‰ã€‚ - è‡ªåŠ¨åˆ›å»ºç¼ºå¤±çš„çˆ¶ç›®å½• - é»˜è®¤åªæ‹·è´å†…å®¹ï¼›å¦‚æœ keep_meta ä¸º Trueï¼Œåˆ™ä½¿ç”¨ copy2 - å¦‚æœ show_progress ä¸º Trueï¼Œåˆ™ä½¿ç”¨ tqdm æ˜¾ç¤ºè¿›åº¦æ¡ï¼ˆé€‚åˆå¤§æ–‡ä»¶ï¼‰ """ # ----------------- 1ï¸âƒ£ å‚æ•°æ ‡å‡†åŒ– ----------------- src_path = Path(src).expanduser().resolve() dst_path = Path(dst).expanduser().resolve() # æºæ–‡ä»¶å¿…é¡»å­˜åœ¨ä¸”æ˜¯æ™®é€šæ–‡ä»¶ if not src_path.is_file(): raise FileNotFoundError(f"æºæ–‡ä»¶ä¸å­˜åœ¨ï¼š{src_path}") # å¦‚æœ dst æœ¬èº«æ˜¯ç›®å½•ï¼Œæˆ–è€…åªç»™äº†ç›®å½•è·¯å¾„è€Œæ²¡æœ‰æ–‡ä»¶åï¼Œåˆ™ä¿æŒåŸæ–‡ä»¶å if dst_path.is_dir() or dst_path.suffix == "": dst_path = dst_path / src_path.name # ----------------- 2ï¸âƒ£ ç¡®ä¿ç›®æ ‡ç›®å½•å·²ç»åˆ›å»º ----------------- dst_path.parent.mkdir(parents=True, exist_ok=True) # ----------------- 3ï¸âƒ£ å¤åˆ¶è¿‡ç¨‹ ----------------- try: if show_progress: # ----- å¸¦è¿›åº¦æ¡çš„åˆ†å—å¤åˆ¶ ----- total = src_path.stat().st_size with src_path.open('rb') as fsrc, dst_path.open('wb') as fdst, tqdm( total=total, unit='B', unit_scale=True, desc=f'å¤åˆ¶ {src_path.name}' ) as pbar: while True: chunk = fsrc.read(bufsize) if not chunk: break fdst.write(chunk) pbar.update(len(chunk)) else: # ----- æœ€ç®€ç‰ˆï¼šä¸€æ¬¡æ€§å¤åˆ¶ ----- if keep_meta: shutil.copy2(src_path, dst_path) # ä¿ç•™æ—¶é—´æˆ³ã€æƒé™ç­‰ else: shutil.copy(src_path, dst_path) # åªæ‹·è´å†…å®¹ # å¦‚æœéœ€è¦ä¿ç•™å…ƒæ•°æ®è€Œç”¨äº† shutil.copyï¼ˆä¸ä¿ç•™ï¼‰ï¼Œæ‰‹åŠ¨è¡¥ä¸Š if keep_meta and not show_progress: shutil.copystat(src_path, dst_path) print(f"âœ… å·²å¤åˆ¶ {src_path} â†’ {dst_path}") except Exception as e: # æ•è·æ‰€æœ‰å¼‚å¸¸å¹¶ç»™å‡ºå‹å¥½çš„æç¤º print(f"âŒ å¤åˆ¶å¤±è´¥ï¼{type(e).__name__}: {e}") # è¿™é‡Œå¯ä»¥æ ¹æ®éœ€æ±‚æŠŠå¼‚å¸¸å†æŠ›å‡ºæˆ–è®°å½•æ—¥å¿— raise # ------------------- è°ƒç”¨ç¤ºä¾‹ ------------------- if __name__ == "__main__": # ç¤ºä¾‹ 1ï¼šæœ€ç®€ç‰ˆï¼ˆä¸ä¿ç•™å…ƒæ•°æ®ï¼Œä¸æ˜¾ç¤ºè¿›åº¦æ¡ï¼‰ copy_simple("./files/video1.mp4", "./backup/example_copy.mp4") # ç¤ºä¾‹ 2ï¼šä¿ç•™å…ƒæ•°æ®ï¼ˆç›¸å½“äº shutil.copy2ï¼‰ copy_simple("./files/video1.mp4", "./backup/example_copy_meta.mp4") # åªè¦æŠŠ `shutil.copy` æ”¹æˆ `shutil.copy2` å³å¯ï¼ˆä¸‹é¢çš„å®ç°å·²ç»æŠŠå¼€å…³å°è£…è¿›å‡½æ•°ï¼‰ # ç¤ºä¾‹ 3ï¼šå¸¦è¿›åº¦æ¡çš„å¤§æ–‡ä»¶å¤åˆ¶ copy_simple("./files/video1.mp4", "./backup/example_copy_progress.mp4") ``` ### å…³é”®ç‚¹è§£é‡Š | æ­¥éª¤ | ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå†™ | |------|-----------------| | `src_path = Path(src).expanduser().resolve()` | æŠŠ `./files/video1.mp4` è§£ææˆå®Œæ•´çš„ç»å¯¹è·¯å¾„ï¼Œé˜²æ­¢åœ¨ Jupyterã€IDE æˆ– `os.chdir()` ä¹‹åæ‰¾ä¸åˆ°æ–‡ä»¶ã€‚ | | `dst_path.parent.mkdir(parents=True, exist_ok=True)` | `shutil.copy` åªä¼šåˆ›å»ºç›®æ ‡æ–‡ä»¶æœ¬èº«ï¼Œ**ä¸ä¼š**è‡ªåŠ¨åˆ›å»ºç¼ºå¤±çš„ç›®å½•ã€‚`parents=True` èƒ½ä¸€æ¬¡æ€§åˆ›å»ºå¤šå±‚ç›®å½•ï¼Œ`exist_ok=True` åœ¨ç›®å½•å·²å­˜åœ¨æ—¶ä¸ä¼šæŠ¥é”™ã€‚ | | `if dst_path.is_dir(): dst_path = dst_path / src_path.name` | å½“ç”¨æˆ·æŠŠ `dst` å½“æˆç›®å½•ä¼ å…¥æ—¶ï¼ˆå¦‚ `./backup/`ï¼‰ï¼Œè‡ªåŠ¨æ‹¼æ¥ä¸Šæºæ–‡ä»¶åï¼Œä½¿ API æ›´ç›´è§‚ã€‚ | | `shutil.copy` vs `shutil.copy2` | `copy` åªæ‹·è´æ–‡ä»¶å†…å®¹ï¼›`copy2` åœ¨æ‹·è´å†…å®¹çš„åŒæ—¶ **ä¿ç•™æ—¶é—´æˆ³ã€æƒé™ç­‰å…ƒæ•°æ®**ã€‚ä½ å¯ä»¥æŠŠ `keep_meta` å‚æ•°è®¾ä¸º `True` æ¥åˆ‡æ¢ã€‚ | | `tqdm` è¿›åº¦æ¡ | å¯¹äºå‡ ç™¾ MBã€å‡  GB ç”šè‡³æ›´å¤§çš„æ–‡ä»¶ï¼Œåˆ†å—è¯»å–å¹¶å®æ—¶æ˜¾ç¤ºè¿›åº¦å¯ä»¥æ˜æ˜¾æå‡ç”¨æˆ·ä½“éªŒã€‚ | | `try/except` æ•è· | å½“è·¯å¾„é”™è¯¯ã€ç£ç›˜ç©ºé—´ä¸è¶³ã€æ–‡ä»¶è¢«å ç”¨ç­‰å¼‚å¸¸å‡ºç°æ—¶ï¼Œèƒ½å¤Ÿç»™å‡ºæ˜ç¡®çš„é”™è¯¯ä¿¡æ¯è€Œä¸æ˜¯ç›´æ¥ä¸­æ–­æ•´ä¸ªè„šæœ¬ã€‚ | --- ## ğŸš€ å¦‚ä½•æŠŠè¿™æ®µä»£ç ç›´æ¥æ¬è¿›ä½ çš„é¡¹ç›® 1. **å¤åˆ¶**ä¸Šé¢çš„ `copy_simple`ï¼ˆæˆ– `robust_copy`ï¼‰å‡½æ•°åˆ°ä½ è‡ªå·±çš„æ¨¡å—ä¸­ã€‚ 2. **ç¡®ä¿**é¡¹ç›®æ ¹ç›®å½•ä¸‹æœ‰ `files/video1.mp4`ï¼Œæˆ–è€…æŠŠè·¯å¾„æ”¹æˆå®é™…æ‰€åœ¨ä½ç½®ã€‚ 3. è¿è¡Œï¼š ```bash python your_script.py ``` å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼çš„è¾“å‡ºï¼š ``` âœ… å·²å¤åˆ¶ /absolute/path/to/files/video1.mp4 â†’ /absolute/path/to/backup/example_copy.mp4 ``` --- ## â“ ä½ å¯èƒ½è¿˜æœ‰çš„ç–‘é—® | é—®é¢˜ | è§£ç­” |
ç°åœ¨æ˜¯ä½¿ç”¨å¤šçº¿ç¨‹å¤„ç†æ–‡ä»¶ï¼Œ éšä¾¿æŒ‘é€‰ä¸€ä¸ªç®€å•çš„ä»»åŠ¡ä»£ç 

profile
gpt-oss:120b
æ€è€ƒç”¨æ—¶ 1 ç§’
ä¸‹é¢ç»™å‡ºä¸€ä¸ª â€œå¤šçº¿ç¨‹æ‰¹é‡å¤„ç†æ–‡ä»¶â€ çš„å®Œæ•´ã€å¯ç›´æ¥è¿è¡Œçš„ç¤ºä¾‹ã€‚
ç¤ºä¾‹ä»»åŠ¡éå¸¸è½»é‡â€”â€”éå†ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œè®¡ç®—æ¯ä¸ªæ–‡ä»¶çš„ SHAâ€‘256 å“ˆå¸Œå€¼å¹¶æŠŠç»“æœå†™å…¥ CSVã€‚
è¿™ç±» I/Oâ€‘boundï¼ˆç£ç›˜è¯»å†™ï¼‰ä»»åŠ¡éå¸¸é€‚åˆç”¨ çº¿ç¨‹ æ¥å¹¶è¡Œï¼ŒåŠ é€Ÿæ•´ä½“è€—æ—¶ã€‚

ğŸ“ ç¤ºä¾‹ç›®å½•ç»“æ„ï¼ˆä½ å¯ä»¥è‡ªè¡Œåˆ›å»ºï¼‰

æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
project/
â”œâ”€ data/                 # å¾…å¤„ç†çš„æ–‡ä»¶ï¼ˆéšæ„æ”¾å‡ ä¸ª txtã€jpgã€mp4 â€¦ï¼‰
â”‚   â”œâ”€ a.txt
â”‚   â”œâ”€ b.jpg
â”‚   â””â”€ c.mp4
â””â”€ multithread_hash.py   # ä¸‹é¢çš„ä»£ç ä¿å­˜ä¸ºè¿™ä¸ªæ–‡ä»¶
è¯´æ˜ï¼šå¦‚æœ data/ é‡Œåªæœ‰å‡ ç™¾ MB çš„æ–‡ä»¶ï¼Œå•çº¿ç¨‹å¤§çº¦ 1â€‘2â€¯ç§’/GBï¼›ä½¿ç”¨ 8â€¯çº¿ç¨‹æ—¶é€šå¸¸å¯ä»¥æŠŠè€—æ—¶ç¼©çŸ­åˆ° 30â€‘40%ã€‚ 

ğŸ§© ä»£ç  â€”â€” multithread_hash.py
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
å¤šçº¿ç¨‹æ‰¹é‡è®¡ç®—æ–‡ä»¶ SHAâ€‘256 å“ˆå¸Œå¹¶å†™å…¥ CSVã€‚

- ä½¿ç”¨ ThreadPoolExecutorï¼ˆæ ‡å‡†åº“ concurrent.futuresï¼‰å®ç°çº¿ç¨‹æ± ã€‚
- åªåš I/Oâ€‘bound å·¥ä½œï¼ˆè¯»å–ç£ç›˜ï¼‰ï¼Œå› æ­¤å¤šçº¿ç¨‹èƒ½å¤Ÿæ˜¾è‘—æå‡é€Ÿåº¦ã€‚
- æ”¯æŒé€’å½’éå†å­ç›®å½•ã€è‡ªåŠ¨åˆ›å»ºè¾“å‡ºç›®å½•ã€å¼‚å¸¸æ•è·ä¸æ—¥å¿—ã€‚
"""

import csv
import hashlib
import os
from pathlib import Path
from concurrent.futures import ThreadPoolExecutor, as_completed
from typing import List, Tuple
import time


# --------------------------------------------------------------
# é…ç½®åŒºï¼ˆå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚è‡ªè¡Œä¿®æ”¹ï¼‰
# --------------------------------------------------------------
ROOT_DIR   = Path("./data")               # å¾…å¤„ç†çš„æ ¹ç›®å½•
OUT_DIR    = Path("./output")             # ç»“æœæ–‡ä»¶å­˜æ”¾ç›®å½•
CSV_NAME   = "hashes.csv"                 # CSV æ–‡ä»¶å
MAX_WORKERS = os.cpu_count() or 4         # çº¿ç¨‹æ± å¤§å°ï¼ˆé»˜è®¤ CPU æ ¸æ•°ï¼ŒI/O ä»»åŠ¡å¯é€‚å½“è°ƒå¤§ï¼‰
CHUNK_SIZE = 4 * 1024 * 1024              # è¯»å–æ–‡ä»¶æ—¶çš„å—å¤§å°ï¼ˆ4â€¯MiBï¼‰  
# --------------------------------------------------------------


def compute_sha256(file_path: Path) -> Tuple[Path, str]:
    """
    è¯»å– *file_path* å¹¶è¿”å› (file_path, hex_digest)ã€‚
    è‹¥è¯»å–è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ï¼Œè¿”å› (file_path, "ERROR:<msg>")ã€‚
    """
    try:
        h = hashlib.sha256()
        with file_path.open("rb") as f:
            while chunk := f.read(CHUNK_SIZE):
                h.update(chunk)
        return file_path, h.hexdigest()
    except Exception as exc:                 # æ•è·æ‰€æœ‰å¼‚å¸¸ï¼Œé˜²æ­¢çº¿ç¨‹å´©æºƒ
        return file_path, f"ERROR:{exc}"


def gather_file_list(root: Path) -> List[Path]:
    """é€’å½’æ”¶é›†æ‰€æœ‰æ™®é€šæ–‡ä»¶ï¼ˆæ’é™¤ç¬¦å·é“¾æ¥ã€ç›®å½•ç­‰ï¼‰ã€‚"""
    return [p for p in root.rglob("*") if p.is_file() and not p.is_symlink()]


def write_csv(results: List[Tuple[Path, str]], out_csv: Path) -> None:
    """æŠŠ [(Path, hash), â€¦] å†™å…¥ CSVï¼Œä½¿ç”¨ utfâ€‘8â€‘sig é˜²æ­¢ Windows æ‰“å¼€ä¹±ç ã€‚"""
    out_csv.parent.mkdir(parents=True, exist_ok=True)
    with out_csv.open("w", newline="", encoding="utf-8-sig") as fp:
        writer = csv.writer(fp)
        writer.writerow(["relative_path", "sha256"])
        for path, digest in results:
            # ä¸ºäº† CSV å¯è¯»ï¼Œå†™å…¥ç›¸å¯¹äº ROOT_DIR çš„ç›¸å¯¹è·¯å¾„
            writer.writerow([path.relative_to(ROOT_DIR).as_posix(), digest])


def main() -> None:
    start = time.time()
    print(f"ğŸ” æ­£åœ¨æ”¶é›† {ROOT_DIR} ä¸‹çš„æ‰€æœ‰æ–‡ä»¶â€¦")
    all_files = gather_file_list(ROOT_DIR)
    print(f"âœ… æ‰¾åˆ° {len(all_files)} ä¸ªæ–‡ä»¶ï¼Œå‡†å¤‡ä½¿ç”¨ {MAX_WORKERS} çº¿ç¨‹å¹¶è¡Œè®¡ç®—å“ˆå¸Œâ€¦")

    # ----------------------------------------------------------
    # â‘  åˆ›å»ºçº¿ç¨‹æ± å¹¶æäº¤ä»»åŠ¡
    # ----------------------------------------------------------
    results: List[Tuple[Path, str]] = []
    with ThreadPoolExecutor(max_workers=MAX_WORKERS) as executor:
        # submit() è¿”å› Future å¯¹è±¡ï¼Œä½¿ç”¨ as_completed() æŒ‰å®Œæˆé¡ºåºè¿­ä»£
        future_to_path = {executor.submit(compute_sha256, p): p for p in all_files}
        for future in as_completed(future_to_path):
            path, digest = future.result()
            results.append((path, digest))

    # ----------------------------------------------------------
    # â‘¡ å†™å…¥ CSV
    # ----------------------------------------------------------
    out_csv = OUT_DIR / CSV_NAME
    write_csv(results, out_csv)

    elapsed = time.time() - start
    print(f"\nğŸ‰ å®Œæˆï¼å…±å¤„ç† {len(all_files)} æ–‡ä»¶ï¼Œç”¨æ—¶ {elapsed:.2f} ç§’")
    print(f"ğŸ”— ç»“æœå·²å†™å…¥ï¼š{out_csv.resolve()}")


if __name__ == "__main__":
    main()
ğŸš€ å¦‚ä½•è¿è¡Œ
bash

æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
2
# 1ï¸âƒ£ ç¡®ä¿ä½ å·²ç»åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼ˆå³åŒçº§æœ‰ data/ ç›®å½•ï¼‰
python multithread_hash.py
è¿è¡Œåä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¾“å‡º

æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
ğŸ” æ­£åœ¨æ”¶é›† ./data ä¸‹çš„æ‰€æœ‰æ–‡ä»¶â€¦
âœ… æ‰¾åˆ° 37 ä¸ªæ–‡ä»¶ï¼Œå‡†å¤‡ä½¿ç”¨ 8 çº¿ç¨‹å¹¶è¡Œè®¡ç®—å“ˆå¸Œâ€¦
âœ… å·²å¤åˆ¶ /abs/path/to/data/a.txt â†’ /abs/path/to/output/example_copy.mp4
...
ğŸ‰ å®Œæˆï¼å…±å¤„ç† 37 æ–‡ä»¶ï¼Œç”¨æ—¶ 3.87 ç§’
ğŸ”— ç»“æœå·²å†™å…¥ï¼š/abs/path/to/output/hashes.csv
æ‰“å¼€ output/hashes.csvï¼Œå†…å®¹ç±»ä¼¼ï¼š


æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
2
3
4
relative_path,sha256
a.txt,3a7bd3e2360a5b...
subdir/b.jpg,4b825dc642cb...
c.mp4,8f14e45fceeaâ€¦
ğŸ§© ä»£ç è¦ç‚¹è§£é‡Š
ä»£ç å—
å…³é”®ç‚¹
ä¸ºä»€ä¹ˆé‡è¦
ThreadPoolExecutor(max_workers=MAX_WORKERS)	
ä½¿ç”¨æ ‡å‡†åº“çš„çº¿ç¨‹æ± ï¼Œè‡ªåŠ¨ç®¡ç†çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ	
ç®€æ´ã€è·¨å¹³å°ã€æ— éœ€æ‰‹åŠ¨ threading.Thread ç®¡ç†
CHUNK_SIZE = 4â€¯MiB	
åˆ†å—è¯»å–æ–‡ä»¶	
è¯»å–å¤§æ–‡ä»¶æ—¶é¿å…ä¸€æ¬¡æ€§æŠŠå…¨éƒ¨å†…å®¹è£…è¿›å†…å­˜
as_completed	
æŒ‰å®Œæˆé¡ºåºè·å–ç»“æœ	
èƒ½å³æ—¶æŠŠå·²ç»ç®—å¥½çš„å“ˆå¸Œå†™è¿›åˆ—è¡¨ï¼Œé˜²æ­¢å› å•ä¸ªæ…¢æ–‡ä»¶æ‹–æ…¢æ•´ä½“
å¼‚å¸¸æ•è· (except Exception as exc)	
ä»»ä½•è¯»å–é”™è¯¯éƒ½è¿”å› "ERROR:â€¦" è€Œä¸æ˜¯è®©çº¿ç¨‹å´©æºƒ	
ä¿è¯æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šå¾—åˆ°ä¸€æ¡è®°å½•ï¼Œè°ƒè¯•æ›´å®¹æ˜“
Path.rglob("*") + is_file()	
é€’å½’éå†æ‰€æœ‰å­ç›®å½•	
åªå¤„ç†çœŸå®æ–‡ä»¶ï¼Œè‡ªåŠ¨è·³è¿‡ç›®å½•å’Œè½¯é“¾æ¥
out_csv.parent.mkdir(parents=True, exist_ok=True)	
è‡ªåŠ¨åˆ›å»º output/ ç›®å½•	
é˜²æ­¢ FileNotFoundError
utf-8-sig	
CSV é‡‡ç”¨ UTFâ€‘8 å¸¦ BOM ç¼–ç 	
åœ¨ Windows è®°äº‹æœ¬é‡Œæ‰“å¼€ä¸ä¼šå‡ºç°ä¹±ç 
ğŸ“ˆ æ€§èƒ½å°å®éªŒï¼ˆå¯é€‰ï¼‰
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
import time, os, random, string
from pathlib import Path

def gen_dummy_files(root: Path, n: int, size_mb: int = 5):
    """å¿«é€Ÿç”Ÿæˆ n ä¸ªå¤§å°ä¸º size_mb çš„éšæœºæ–‡ä»¶ï¼Œä¾¿äºæ€§èƒ½å¯¹æ¯”ã€‚"""
    root.mkdir(parents=True, exist_ok=True)
    for i in range(n):
        p = root / f"dummy_{i}.bin"
        with p.open("wb") as f:
            for _ in range(size_mb):
                f.write(os.urandom(1024 * 1024))   # å†™ 1â€¯MiB éšæœºæ•°æ®

# ç”Ÿæˆ 20 ä¸ª 10â€¯MiB çš„æ–‡ä»¶ï¼ˆçº¦ 200â€¯MiBï¼‰
gen_dummy_files(Path("./data"), n=20, size_mb=10)

# è¿è¡Œä¸€æ¬¡åŸºå‡†ï¼ˆå•çº¿ç¨‹ï¼‰ï¼š
start = time.time()
_ = [compute_sha256(p) for p in gather_file_list(Path("./data"))]
print("å•çº¿ç¨‹è€—æ—¶:", time.time() - start)

# å†è·‘ä¸€æ¬¡å¤šçº¿ç¨‹ï¼ˆé»˜è®¤ CPU æ ¸æ•°ï¼‰ï¼š
start = time.time()
with ThreadPoolExecutor(max_workers=os.cpu_count() or 4) as ex:
    list(ex.map(compute_sha256, gather_file_list(Path("./data"))))
print("å¤šçº¿ç¨‹è€—æ—¶:", time.time() - start)
åœ¨å¤§å¤šæ•° SSD / HDD ç¯å¢ƒä¸‹ï¼Œä½ ä¼šçœ‹åˆ° å¤šçº¿ç¨‹è€—æ—¶çº¦ä¸ºå•çº¿ç¨‹çš„ 30â€‘60%ï¼ˆå–å†³äºç£ç›˜å¹¶å‘è¯»å†™èƒ½åŠ›ï¼‰ã€‚

ğŸ¯ é€‚ç”¨åœºæ™¯æ‰©å±•
æ–‡ä»¶å‹ç¼©ï¼šæŠŠ compute_sha256 æ¢æˆ gzip.compress æˆ– shutil.make_archiveï¼ŒåŒæ ·å¯ä»¥å¹¶è¡Œã€‚
å›¾ç‰‡/éŸ³è§†é¢‘è½¬ç ï¼šåªè¦å†…éƒ¨å®ç°æ˜¯ I/Oâ€‘boundï¼ˆè°ƒç”¨å¤–éƒ¨ CLI å·¥å…·ï¼‰ï¼Œä¹Ÿå¯ä»¥ç”¨åŒæ ·çš„çº¿ç¨‹æ± åŒ…è£…ã€‚
æ‰¹é‡ä¸Šä¼ /ä¸‹è½½ï¼šæŠŠ compute_sha256 æ›¿æ¢ä¸º requests.put æˆ– boto3.upload_fileobjï¼Œå³å¯å®ç°å¹¶å‘ç½‘ç»œ I/Oã€‚
æ³¨æ„ï¼šå¦‚æœä½ çš„ä»»åŠ¡æ˜¯ CPUâ€‘boundï¼ˆä¾‹å¦‚å¤§é‡å›¾ç‰‡è§£ç ã€åŠ å¯†ã€å¤æ‚è®¡ç®—ï¼‰ï¼Œè¯·æ”¹ç”¨ ProcessPoolExecutor æˆ– multiprocessingï¼Œå› ä¸º CPython çš„ GIL ä¼šé™åˆ¶çº¿ç¨‹çš„å¹¶è¡Œåº¦ã€‚ 

âœ… å°ç»“
ä½¿ç”¨ ThreadPoolExecutor å¯ä»¥éå¸¸ç®€æ´åœ°å®ç°å¤šçº¿ç¨‹æ–‡ä»¶å¤„ç†ã€‚
åªè¦æ˜¯ I/Oâ€‘boundï¼ˆç£ç›˜è¯»å†™ã€ç½‘ç»œè¯·æ±‚ï¼‰ï¼Œçº¿ç¨‹æ•°è®¾ç½®ä¸º CPU æ ¸æ•°çš„ 2â€‘4 å€ å¾€å¾€èƒ½å¾—åˆ°æœ€ä½³ååã€‚
ä»£ç é‡Œå·²ç»è€ƒè™‘äº† å¼‚å¸¸å®‰å…¨ã€ç›®å½•è‡ªåŠ¨åˆ›å»ºã€è¿›åº¦æ—¥å¿—ï¼Œç›´æ¥æ‹·è´åˆ°é¡¹ç›®ä¸­å³å¯ä½¿ç”¨ã€‚
ç¥ä½ ç©å¾—å¼€å¿ƒ ğŸš€ï¼Œå¦‚æœè¿˜æœ‰åˆ«çš„éœ€æ±‚ï¼ˆæ¯”å¦‚æ”¹æˆè¿›åº¦æ¡ç‰ˆã€æ”¹æˆå¤šè¿›ç¨‹ç‰ˆã€æˆ–è€…æƒ³æŠŠç»“æœå†™å…¥æ•°æ®åº“ï¼‰ï¼Œéšæ—¶å‘Šè¯‰æˆ‘ï¼

<details type="reasoning" done="true" duration="1"> <summary>Thought for 1 seconds</summary> > User asks: "ç°åœ¨æ˜¯ä½¿ç”¨å¤šçº¿ç¨‹å¤„ç†æ–‡ä»¶ï¼Œ éšä¾¿æŒ‘é€‰ä¸€ä¸ªç®€å•çš„ä»»åŠ¡ä»£ç ". They want a simple multi-threaded file processing example. Should provide Python code using threading or concurrent.futures ThreadPoolExecutor, maybe processing a list of files (e.g., compute hash, copy, compress). Provide explanation. Also ensure thread safety. Provide complete example. </details> ä¸‹é¢ç»™å‡ºä¸€ä¸ª **â€œå¤šçº¿ç¨‹æ‰¹é‡å¤„ç†æ–‡ä»¶â€** çš„å®Œæ•´ã€å¯ç›´æ¥è¿è¡Œçš„ç¤ºä¾‹ã€‚ ç¤ºä¾‹ä»»åŠ¡éå¸¸è½»é‡â€”â€”**éå†ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œè®¡ç®—æ¯ä¸ªæ–‡ä»¶çš„ SHAâ€‘256 å“ˆå¸Œå€¼å¹¶æŠŠç»“æœå†™å…¥ CSV**ã€‚ è¿™ç±» I/Oâ€‘boundï¼ˆç£ç›˜è¯»å†™ï¼‰ä»»åŠ¡éå¸¸é€‚åˆç”¨ **çº¿ç¨‹** æ¥å¹¶è¡Œï¼ŒåŠ é€Ÿæ•´ä½“è€—æ—¶ã€‚ --- ## ğŸ“ ç¤ºä¾‹ç›®å½•ç»“æ„ï¼ˆä½ å¯ä»¥è‡ªè¡Œåˆ›å»ºï¼‰ ``` project/ â”œâ”€ data/ # å¾…å¤„ç†çš„æ–‡ä»¶ï¼ˆéšæ„æ”¾å‡ ä¸ª txtã€jpgã€mp4 â€¦ï¼‰ â”‚ â”œâ”€ a.txt â”‚ â”œâ”€ b.jpg â”‚ â””â”€ c.mp4 â””â”€ multithread_hash.py # ä¸‹é¢çš„ä»£ç ä¿å­˜ä¸ºè¿™ä¸ªæ–‡ä»¶ ``` > **è¯´æ˜**ï¼šå¦‚æœ `data/` é‡Œåªæœ‰å‡ ç™¾ MB çš„æ–‡ä»¶ï¼Œå•çº¿ç¨‹å¤§çº¦ 1â€‘2â€¯ç§’/GBï¼›ä½¿ç”¨ 8â€¯çº¿ç¨‹æ—¶é€šå¸¸å¯ä»¥æŠŠè€—æ—¶ç¼©çŸ­åˆ° 30â€‘40%ã€‚ --- ## ğŸ§© ä»£ç  â€”â€” `multithread_hash.py` ```python #!/usr/bin/env python # -*- coding: utf-8 -*- """ å¤šçº¿ç¨‹æ‰¹é‡è®¡ç®—æ–‡ä»¶ SHAâ€‘256 å“ˆå¸Œå¹¶å†™å…¥ CSVã€‚ - ä½¿ç”¨ ThreadPoolExecutorï¼ˆæ ‡å‡†åº“ concurrent.futuresï¼‰å®ç°çº¿ç¨‹æ± ã€‚ - åªåš I/Oâ€‘bound å·¥ä½œï¼ˆè¯»å–ç£ç›˜ï¼‰ï¼Œå› æ­¤å¤šçº¿ç¨‹èƒ½å¤Ÿæ˜¾è‘—æå‡é€Ÿåº¦ã€‚ - æ”¯æŒé€’å½’éå†å­ç›®å½•ã€è‡ªåŠ¨åˆ›å»ºè¾“å‡ºç›®å½•ã€å¼‚å¸¸æ•è·ä¸æ—¥å¿—ã€‚ """ import csv import hashlib import os from pathlib import Path from concurrent.futures import ThreadPoolExecutor, as_completed from typing import List, Tuple import time # -------------------------------------------------------------- # é…ç½®åŒºï¼ˆå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚è‡ªè¡Œä¿®æ”¹ï¼‰ # -------------------------------------------------------------- ROOT_DIR = Path("./data") # å¾…å¤„ç†çš„æ ¹ç›®å½• OUT_DIR = Path("./output") # ç»“æœæ–‡ä»¶å­˜æ”¾ç›®å½• CSV_NAME = "hashes.csv" # CSV æ–‡ä»¶å MAX_WORKERS = os.cpu_count() or 4 # çº¿ç¨‹æ± å¤§å°ï¼ˆé»˜è®¤ CPU æ ¸æ•°ï¼ŒI/O ä»»åŠ¡å¯é€‚å½“è°ƒå¤§ï¼‰ CHUNK_SIZE = 4 * 1024 * 1024 # è¯»å–æ–‡ä»¶æ—¶çš„å—å¤§å°ï¼ˆ4â€¯MiBï¼‰ # -------------------------------------------------------------- def compute_sha256(file_path: Path) -> Tuple[Path, str]: """ è¯»å– *file_path* å¹¶è¿”å› (file_path, hex_digest)ã€‚ è‹¥è¯»å–è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ï¼Œè¿”å› (file_path, "ERROR:<msg>")ã€‚ """ try: h = hashlib.sha256() with file_path.open("rb") as f: while chunk := f.read(CHUNK_SIZE): h.update(chunk) return file_path, h.hexdigest() except Exception as exc: # æ•è·æ‰€æœ‰å¼‚å¸¸ï¼Œé˜²æ­¢çº¿ç¨‹å´©æºƒ return file_path, f"ERROR:{exc}" def gather_file_list(root: Path) -> List[Path]: """é€’å½’æ”¶é›†æ‰€æœ‰æ™®é€šæ–‡ä»¶ï¼ˆæ’é™¤ç¬¦å·é“¾æ¥ã€ç›®å½•ç­‰ï¼‰ã€‚""" return [p for p in root.rglob("*") if p.is_file() and not p.is_symlink()] def write_csv(results: List[Tuple[Path, str]], out_csv: Path) -> None: """æŠŠ [(Path, hash), â€¦] å†™å…¥ CSVï¼Œä½¿ç”¨ utfâ€‘8â€‘sig é˜²æ­¢ Windows æ‰“å¼€ä¹±ç ã€‚""" out_csv.parent.mkdir(parents=True, exist_ok=True) with out_csv.open("w", newline="", encoding="utf-8-sig") as fp: writer = csv.writer(fp) writer.writerow(["relative_path", "sha256"]) for path, digest in results: # ä¸ºäº† CSV å¯è¯»ï¼Œå†™å…¥ç›¸å¯¹äº ROOT_DIR çš„ç›¸å¯¹è·¯å¾„ writer.writerow([path.relative_to(ROOT_DIR).as_posix(), digest]) def main() -> None: start = time.time() print(f"ğŸ” æ­£åœ¨æ”¶é›† {ROOT_DIR} ä¸‹çš„æ‰€æœ‰æ–‡ä»¶â€¦") all_files = gather_file_list(ROOT_DIR) print(f"âœ… æ‰¾åˆ° {len(all_files)} ä¸ªæ–‡ä»¶ï¼Œå‡†å¤‡ä½¿ç”¨ {MAX_WORKERS} çº¿ç¨‹å¹¶è¡Œè®¡ç®—å“ˆå¸Œâ€¦") # ---------------------------------------------------------- # â‘  åˆ›å»ºçº¿ç¨‹æ± å¹¶æäº¤ä»»åŠ¡ # ---------------------------------------------------------- results: List[Tuple[Path, str]] = [] with ThreadPoolExecutor(max_workers=MAX_WORKERS) as executor: # submit() è¿”å› Future å¯¹è±¡ï¼Œä½¿ç”¨ as_completed() æŒ‰å®Œæˆé¡ºåºè¿­ä»£ future_to_path = {executor.submit(compute_sha256, p): p for p in all_files} for future in as_completed(future_to_path): path, digest = future.result() results.append((path, digest)) # ---------------------------------------------------------- # â‘¡ å†™å…¥ CSV # ---------------------------------------------------------- out_csv = OUT_DIR / CSV_NAME write_csv(results, out_csv) elapsed = time.time() - start print(f"\nğŸ‰ å®Œæˆï¼å…±å¤„ç† {len(all_files)} æ–‡ä»¶ï¼Œç”¨æ—¶ {elapsed:.2f} ç§’") print(f"ğŸ”— ç»“æœå·²å†™å…¥ï¼š{out_csv.resolve()}") if __name__ == "__main__": main() ``` --- ## ğŸš€ å¦‚ä½•è¿è¡Œ ```bash # 1ï¸âƒ£ ç¡®ä¿ä½ å·²ç»åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼ˆå³åŒçº§æœ‰ data/ ç›®å½•ï¼‰ python multithread_hash.py ``` ### è¿è¡Œåä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¾“å‡º ``` ğŸ” æ­£åœ¨æ”¶é›† ./data ä¸‹çš„æ‰€æœ‰æ–‡ä»¶â€¦ âœ… æ‰¾åˆ° 37 ä¸ªæ–‡ä»¶ï¼Œå‡†å¤‡ä½¿ç”¨ 8 çº¿ç¨‹å¹¶è¡Œè®¡ç®—å“ˆå¸Œâ€¦ âœ… å·²å¤åˆ¶ /abs/path/to/data/a.txt â†’ /abs/path/to/output/example_copy.mp4 ... ğŸ‰ å®Œæˆï¼å…±å¤„ç† 37 æ–‡ä»¶ï¼Œç”¨æ—¶ 3.87 ç§’ ğŸ”— ç»“æœå·²å†™å…¥ï¼š/abs/path/to/output/hashes.csv ``` æ‰“å¼€ `output/hashes.csv`ï¼Œå†…å®¹ç±»ä¼¼ï¼š ``` relative_path,sha256 a.txt,3a7bd3e2360a5b... subdir/b.jpg,4b825dc642cb... c.mp4,8f14e45fceeaâ€¦ ``` --- ## ğŸ§© ä»£ç è¦ç‚¹è§£é‡Š | ä»£ç å— | å…³é”®ç‚¹ | ä¸ºä»€ä¹ˆé‡è¦ | |--------|--------|------------| | **`ThreadPoolExecutor(max_workers=MAX_WORKERS)`** | ä½¿ç”¨æ ‡å‡†åº“çš„çº¿ç¨‹æ± ï¼Œè‡ªåŠ¨ç®¡ç†çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ | ç®€æ´ã€è·¨å¹³å°ã€æ— éœ€æ‰‹åŠ¨ `threading.Thread` ç®¡ç† | | **`CHUNK_SIZE = 4â€¯MiB`** | åˆ†å—è¯»å–æ–‡ä»¶ | è¯»å–å¤§æ–‡ä»¶æ—¶é¿å…ä¸€æ¬¡æ€§æŠŠå…¨éƒ¨å†…å®¹è£…è¿›å†…å­˜ | | **`as_completed`** | æŒ‰å®Œæˆé¡ºåºè·å–ç»“æœ | èƒ½å³æ—¶æŠŠå·²ç»ç®—å¥½çš„å“ˆå¸Œå†™è¿›åˆ—è¡¨ï¼Œé˜²æ­¢å› å•ä¸ªæ…¢æ–‡ä»¶æ‹–æ…¢æ•´ä½“ | | **å¼‚å¸¸æ•è· (`except Exception as exc`)** | ä»»ä½•è¯»å–é”™è¯¯éƒ½è¿”å› `"ERROR:â€¦"` è€Œä¸æ˜¯è®©çº¿ç¨‹å´©æºƒ | ä¿è¯æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šå¾—åˆ°ä¸€æ¡è®°å½•ï¼Œè°ƒè¯•æ›´å®¹æ˜“ | | **`Path.rglob("*")`** + `is_file()` | é€’å½’éå†æ‰€æœ‰å­ç›®å½• | åªå¤„ç†çœŸå®æ–‡ä»¶ï¼Œè‡ªåŠ¨è·³è¿‡ç›®å½•å’Œè½¯é“¾æ¥ | | **`out_csv.parent.mkdir(parents=True, exist_ok=True)`** | è‡ªåŠ¨åˆ›å»º `output/` ç›®å½• | é˜²æ­¢ `FileNotFoundError` | | **`utf-8-sig`** | CSV é‡‡ç”¨ UTFâ€‘8 å¸¦ BOM ç¼–ç  | åœ¨ Windows è®°äº‹æœ¬é‡Œæ‰“å¼€ä¸ä¼šå‡ºç°ä¹±ç  | --- ## ğŸ“ˆ æ€§èƒ½å°å®éªŒï¼ˆå¯é€‰ï¼‰ ```python import time, os, random, string from pathlib import Path def gen_dummy_files(root: Path, n: int, size_mb: int = 5): """å¿«é€Ÿç”Ÿæˆ n ä¸ªå¤§å°ä¸º size_mb çš„éšæœºæ–‡ä»¶ï¼Œä¾¿äºæ€§èƒ½å¯¹æ¯”ã€‚""" root.mkdir(parents=True, exist_ok=True) for i in range(n): p = root / f"dummy_{i}.bin" with p.open("wb") as f: for _ in range(size_mb): f.write(os.urandom(1024 * 1024)) # å†™ 1â€¯MiB éšæœºæ•°æ® # ç”Ÿæˆ 20 ä¸ª 10â€¯MiB çš„æ–‡ä»¶ï¼ˆçº¦ 200â€¯MiBï¼‰ gen_dummy_files(Path("./data"), n=20, size_mb=10) # è¿è¡Œä¸€æ¬¡åŸºå‡†ï¼ˆå•çº¿ç¨‹ï¼‰ï¼š start = time.time() _ = [compute_sha256(p) for p in gather_file_list(Path("./data"))] print("å•çº¿ç¨‹è€—æ—¶:", time.time() - start) # å†è·‘ä¸€æ¬¡å¤šçº¿ç¨‹ï¼ˆé»˜è®¤ CPU æ ¸æ•°ï¼‰ï¼š start = time.time() with ThreadPoolExecutor(max_workers=os.cpu_count() or 4) as ex: list(ex.map(compute_sha256, gather_file_list(Path("./data")))) print("å¤šçº¿ç¨‹è€—æ—¶:", time.time() - start) ``` åœ¨å¤§å¤šæ•° SSD / HDD ç¯å¢ƒä¸‹ï¼Œä½ ä¼šçœ‹åˆ° **å¤šçº¿ç¨‹è€—æ—¶çº¦ä¸ºå•çº¿ç¨‹çš„ 30â€‘60%**ï¼ˆå–å†³äºç£ç›˜å¹¶å‘è¯»å†™èƒ½åŠ›ï¼‰ã€‚ --- ## ğŸ¯ é€‚ç”¨åœºæ™¯æ‰©å±• - **æ–‡ä»¶å‹ç¼©**ï¼šæŠŠ `compute_sha256` æ¢æˆ `gzip.compress` æˆ– `shutil.make_archive`ï¼ŒåŒæ ·å¯ä»¥å¹¶è¡Œã€‚ - **å›¾ç‰‡/éŸ³è§†é¢‘è½¬ç **ï¼šåªè¦å†…éƒ¨å®ç°æ˜¯ I/Oâ€‘boundï¼ˆè°ƒç”¨å¤–éƒ¨ CLI å·¥å…·ï¼‰ï¼Œä¹Ÿå¯ä»¥ç”¨åŒæ ·çš„çº¿ç¨‹æ± åŒ…è£…ã€‚ - **æ‰¹é‡ä¸Šä¼ /ä¸‹è½½**ï¼šæŠŠ `compute_sha256` æ›¿æ¢ä¸º `requests.put` æˆ– `boto3.upload_fileobj`ï¼Œå³å¯å®ç°å¹¶å‘ç½‘ç»œ I/Oã€‚ > **æ³¨æ„**ï¼šå¦‚æœä½ çš„ä»»åŠ¡æ˜¯ **CPUâ€‘bound**ï¼ˆä¾‹å¦‚å¤§é‡å›¾ç‰‡è§£ç ã€åŠ å¯†ã€å¤æ‚è®¡ç®—ï¼‰ï¼Œè¯·æ”¹ç”¨ `ProcessPoolExecutor` æˆ– `multiprocessing`ï¼Œå› ä¸º CPython çš„ GIL ä¼šé™åˆ¶çº¿ç¨‹çš„å¹¶è¡Œåº¦ã€‚ --- ## âœ… å°ç»“ - ä½¿ç”¨ **`ThreadPoolExecutor`** å¯ä»¥éå¸¸ç®€æ´åœ°å®ç°å¤šçº¿ç¨‹æ–‡ä»¶å¤„ç†ã€‚ - åªè¦æ˜¯ **I/Oâ€‘bound**ï¼ˆç£ç›˜è¯»å†™ã€ç½‘ç»œè¯·æ±‚ï¼‰ï¼Œçº¿ç¨‹æ•°è®¾ç½®ä¸º **CPU æ ¸æ•°çš„ 2â€‘4 å€** å¾€å¾€èƒ½å¾—åˆ°æœ€ä½³ååã€‚ - ä»£ç é‡Œå·²ç»è€ƒè™‘äº† **å¼‚å¸¸å®‰å…¨ã€ç›®å½•è‡ªåŠ¨åˆ›å»ºã€è¿›åº¦æ—¥å¿—**ï¼Œç›´æ¥æ‹·è´åˆ°é¡¹ç›®ä¸­å³å¯ä½¿ç”¨ã€‚ ç¥ä½ ç©å¾—å¼€å¿ƒ ğŸš€ï¼Œå¦‚æœè¿˜æœ‰åˆ«çš„éœ€æ±‚ï¼ˆæ¯”å¦‚æ”¹æˆè¿›åº¦æ¡ç‰ˆã€æ”¹æˆå¤šè¿›ç¨‹ç‰ˆã€æˆ–è€…æƒ³æŠŠç»“æœå†™å…¥æ•°æ®åº“ï¼‰ï¼Œéšæ—¶å‘Šè¯‰æˆ‘ï¼
æ›´ç®€æ´çš„ä»»åŠ¡

profile
gpt-oss:120b
æ€è€ƒç”¨æ—¶ 0 ç§’
ä¸‹é¢ç»™å‡º æœ€ç®€ç‰ˆ çš„å¤šçº¿ç¨‹æ–‡ä»¶ä»»åŠ¡â€”â€”ç»Ÿè®¡æŒ‡å®šç›®å½•ï¼ˆå«å­ç›®å½•ï¼‰ä¸‹æ‰€æœ‰æ™®é€šæ–‡ä»¶çš„å¤§å°ï¼Œå¹¶æŠŠã€Œæ–‡ä»¶ç›¸å¯¹è·¯å¾„ + å¤§å°ï¼ˆå­—èŠ‚ï¼‰ã€å†™å…¥ä¸€è¡Œ CSVã€‚
ä»£ç åªç”¨äº†å‡ è¡Œæ ‡å‡†åº“ï¼Œå‡ ä¹æ²¡æœ‰ä»»ä½•é¢å¤–ä¾èµ–ï¼Œé€‚åˆä½œä¸ºã€Œå¤šçº¿ç¨‹ç¤ºä¾‹ã€ç›´æ¥å¤åˆ¶ç²˜è´´è¿è¡Œã€‚

ğŸ“„ ä»£ç ï¼ˆä¿å­˜ä¸º simple_threaded_size.pyï¼‰
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
#!/usr/bin/env python
# -*- coding: utf-8 -*-

import csv
from pathlib import Path
from concurrent.futures import ThreadPoolExecutor, as_completed

# ------------------- é…ç½® -------------------
ROOT_DIR   = Path("./data")          # å¾…éå†çš„æ ¹ç›®å½•
OUT_CSV    = Path("./output/size.csv")
MAX_WORKERS = 8                     # çº¿ç¨‹æ•°ï¼ˆå¯æ”¹æˆ os.cpu_count()ï¼‰
# -------------------------------------------

def file_size(p: Path) -> tuple[Path, int]:
    """è¿”å› (æ–‡ä»¶Path, å¤§å°ï¼ˆå­—èŠ‚ï¼‰)ã€‚å¼‚å¸¸è¿”å› (Path, -1)ã€‚"""
    try:
        return p, p.stat().st_size
    except Exception:
        return p, -1                     # -1 ä»£è¡¨è¯»å–å¤±è´¥

def all_files(root: Path) -> list[Path]:
    """é€’å½’æ”¶é›†æ‰€æœ‰æ™®é€šæ–‡ä»¶ï¼ˆä¸åŒ…æ‹¬ç›®å½•ã€è½¯é“¾æ¥ï¼‰ã€‚"""
    return [p for p in root.rglob("*") if p.is_file() and not p.is_symlink()]

def write_csv(results: list[tuple[Path, int]], csv_path: Path) -> None:
    csv_path.parent.mkdir(parents=True, exist_ok=True)
    with csv_path.open("w", newline="", encoding="utf-8-sig") as f:
        writer = csv.writer(f)
        writer.writerow(["relative_path", "size_bytes"])
        for p, size in results:
            writer.writerow([p.relative_to(ROOT_DIR).as_posix(), size])

def main() -> None:
    files = all_files(ROOT_DIR)
    print(f"ğŸ” æ‰¾åˆ° {len(files)} ä¸ªæ–‡ä»¶ï¼Œä½¿ç”¨ {MAX_WORKERS} çº¿ç¨‹è®¡ç®—å¤§å°â€¦")

    results = []
    with ThreadPoolExecutor(max_workers=MAX_WORKERS) as pool:
        # æŠŠæ¯ä¸ªæ–‡ä»¶äº¤ç»™çº¿ç¨‹æ± å¤„ç†ï¼Œas_completed èƒ½å³æ—¶æ‹¿åˆ°å·²å®Œæˆçš„ä»»åŠ¡
        future_to_path = {pool.submit(file_size, p): p for p in files}
        for fut in as_completed(future_to_path):
            results.append(fut.result())

    write_csv(results, OUT_CSV)
    print(f"âœ… å®Œæˆï¼ç»“æœå†™å…¥ {OUT_CSV.resolve()}")

if __name__ == "__main__":
    main()
ğŸ“¦ å¦‚ä½•ä½¿ç”¨
bash

æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
2
3
# 1ï¸âƒ£ æŠŠå¾…å¤„ç†æ–‡ä»¶æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ data/ï¼ˆå¯ä»¥æ˜¯ä»»æ„å­ç›®å½•ç»“æ„ï¼‰
# 2ï¸âƒ£ è¿è¡Œè„šæœ¬
python simple_threaded_size.py
è¿è¡Œç»“æŸåï¼Œä¼šåœ¨ output/size.csv ä¸­å¾—åˆ°ç±»ä¼¼å†…å®¹ï¼š


æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
relative_path,size_bytes
a.txt,1245
subdir/b.jpg,587231
c.mp4,10485760
...
ğŸ” ä¸ºä»€ä¹ˆè¿™æ®µä»£ç ç®—ã€Œæ›´ç®€æ´ã€ï¼Ÿ
æ­¥éª¤
ä»£ç è¡Œæ•°
è¯´æ˜
æ”¶é›†æ–‡ä»¶	
all_files()ï¼ˆ2 è¡Œï¼‰	
Path.rglob("*") è‡ªåŠ¨é€’å½’
å¹¶è¡Œè®¡ç®—	
ThreadPoolExecutor + as_completedï¼ˆ5 è¡Œï¼‰	
åªæäº¤ä¸€æ¬¡å‡½æ•° file_sizeï¼Œçº¿ç¨‹æ± è´Ÿè´£è°ƒåº¦
å†™ CSV	
write_csv()ï¼ˆ5 è¡Œï¼‰	
è‡ªåŠ¨åˆ›å»ºçˆ¶ç›®å½•ï¼Œä½¿ç”¨ UTFâ€‘8â€‘sig é˜²æ­¢ Windows ä¹±ç 
ä¸»æµç¨‹	
main()ï¼ˆçº¦ 10 è¡Œï¼‰	
è¯»å–ã€å¹¶è¡Œã€å†™å‡ºï¼Œä¸€ç›®äº†ç„¶
æ•´æ®µè„šæœ¬ â‰ˆ 30 è¡Œï¼ˆå«æ³¨é‡Šï¼‰ï¼Œä¸éœ€è¦é¢å¤–åº“ã€ä¹Ÿä¸æ¶‰åŠå¤æ‚å¼‚å¸¸å¤„ç†ï¼Œè¶³ä»¥æ¼”ç¤ºã€Œå¤šçº¿ç¨‹ + æ–‡ä»¶ I/Oã€çš„æ ¸å¿ƒæ¦‚å¿µã€‚

ğŸ“ˆ å°å®éªŒï¼ˆå¯é€‰ï¼‰
å¦‚æœæƒ³æ„Ÿå—å¤šçº¿ç¨‹å¸¦æ¥çš„é€Ÿåº¦æå‡ï¼Œåªéœ€è¦æŠŠ MAX_WORKERS æ”¹æˆ 1ï¼ˆå•çº¿ç¨‹ï¼‰å†è·‘ä¸€æ¬¡ï¼Œå¯¹æ¯”è€—æ—¶å³å¯ã€‚
åœ¨ SSD ä¸Šå¯¹å‡ åƒä¸ªå°æ–‡ä»¶æˆ–å‡ ä¸ª GB çš„å¤§æ–‡ä»¶ï¼Œé€šå¸¸èƒ½çœ‹åˆ° 30â€‘50% çš„åŠ é€Ÿã€‚

ç¥ä½ ç©å¾—å¼€å¿ƒ ğŸš€ï¼å¦‚æœè¿˜æœ‰å…¶ä»–æƒ³è¦å®ç°çš„ç®€æ˜“ä»»åŠ¡ï¼ˆæ¯”å¦‚è¡Œæ•°ç»Ÿè®¡ã€MD5ã€å›¾ç‰‡ç¼©æ”¾ç­‰ï¼‰ï¼Œéšæ—¶å‘Šè¯‰æˆ‘ï¼

<details type="reasoning" done="true" duration="0"> <summary>Thought for 0 seconds</summary> > The user wants a simpler task for multithreading file processing. Provide minimal code: maybe count lines in text files, or compute file size, using ThreadPoolExecutor. Provide explanation. Keep concise. </details> ä¸‹é¢ç»™å‡º **æœ€ç®€ç‰ˆ** çš„å¤šçº¿ç¨‹æ–‡ä»¶ä»»åŠ¡â€”â€”**ç»Ÿè®¡æŒ‡å®šç›®å½•ï¼ˆå«å­ç›®å½•ï¼‰ä¸‹æ‰€æœ‰æ™®é€šæ–‡ä»¶çš„å¤§å°**ï¼Œå¹¶æŠŠã€Œæ–‡ä»¶ç›¸å¯¹è·¯å¾„ + å¤§å°ï¼ˆå­—èŠ‚ï¼‰ã€å†™å…¥ä¸€è¡Œ CSVã€‚ ä»£ç åªç”¨äº†å‡ è¡Œæ ‡å‡†åº“ï¼Œå‡ ä¹æ²¡æœ‰ä»»ä½•é¢å¤–ä¾èµ–ï¼Œé€‚åˆä½œä¸ºã€Œå¤šçº¿ç¨‹ç¤ºä¾‹ã€ç›´æ¥å¤åˆ¶ç²˜è´´è¿è¡Œã€‚ --- ## ğŸ“„ ä»£ç ï¼ˆä¿å­˜ä¸º `simple_threaded_size.py`ï¼‰ ```python #!/usr/bin/env python # -*- coding: utf-8 -*- import csv from pathlib import Path from concurrent.futures import ThreadPoolExecutor, as_completed # ------------------- é…ç½® ------------------- ROOT_DIR = Path("./data") # å¾…éå†çš„æ ¹ç›®å½• OUT_CSV = Path("./output/size.csv") MAX_WORKERS = 8 # çº¿ç¨‹æ•°ï¼ˆå¯æ”¹æˆ os.cpu_count()ï¼‰ # ------------------------------------------- def file_size(p: Path) -> tuple[Path, int]: """è¿”å› (æ–‡ä»¶Path, å¤§å°ï¼ˆå­—èŠ‚ï¼‰)ã€‚å¼‚å¸¸è¿”å› (Path, -1)ã€‚""" try: return p, p.stat().st_size except Exception: return p, -1 # -1 ä»£è¡¨è¯»å–å¤±è´¥ def all_files(root: Path) -> list[Path]: """é€’å½’æ”¶é›†æ‰€æœ‰æ™®é€šæ–‡ä»¶ï¼ˆä¸åŒ…æ‹¬ç›®å½•ã€è½¯é“¾æ¥ï¼‰ã€‚""" return [p for p in root.rglob("*") if p.is_file() and not p.is_symlink()] def write_csv(results: list[tuple[Path, int]], csv_path: Path) -> None: csv_path.parent.mkdir(parents=True, exist_ok=True) with csv_path.open("w", newline="", encoding="utf-8-sig") as f: writer = csv.writer(f) writer.writerow(["relative_path", "size_bytes"]) for p, size in results: writer.writerow([p.relative_to(ROOT_DIR).as_posix(), size]) def main() -> None: files = all_files(ROOT_DIR) print(f"ğŸ” æ‰¾åˆ° {len(files)} ä¸ªæ–‡ä»¶ï¼Œä½¿ç”¨ {MAX_WORKERS} çº¿ç¨‹è®¡ç®—å¤§å°â€¦") results = [] with ThreadPoolExecutor(max_workers=MAX_WORKERS) as pool: # æŠŠæ¯ä¸ªæ–‡ä»¶äº¤ç»™çº¿ç¨‹æ± å¤„ç†ï¼Œas_completed èƒ½å³æ—¶æ‹¿åˆ°å·²å®Œæˆçš„ä»»åŠ¡ future_to_path = {pool.submit(file_size, p): p for p in files} for fut in as_completed(future_to_path): results.append(fut.result()) write_csv(results, OUT_CSV) print(f"âœ… å®Œæˆï¼ç»“æœå†™å…¥ {OUT_CSV.resolve()}") if __name__ == "__main__": main() ``` --- ## ğŸ“¦ å¦‚ä½•ä½¿ç”¨ ```bash # 1ï¸âƒ£ æŠŠå¾…å¤„ç†æ–‡ä»¶æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ data/ï¼ˆå¯ä»¥æ˜¯ä»»æ„å­ç›®å½•ç»“æ„ï¼‰ # 2ï¸âƒ£ è¿è¡Œè„šæœ¬ python simple_threaded_size.py ``` è¿è¡Œç»“æŸåï¼Œä¼šåœ¨ `output/size.csv` ä¸­å¾—åˆ°ç±»ä¼¼å†…å®¹ï¼š ``` relative_path,size_bytes a.txt,1245 subdir/b.jpg,587231 c.mp4,10485760 ... ``` --- ## ğŸ” ä¸ºä»€ä¹ˆè¿™æ®µä»£ç ç®—ã€Œæ›´ç®€æ´ã€ï¼Ÿ | æ­¥éª¤ | ä»£ç è¡Œæ•° | è¯´æ˜ | |------|----------|------| | æ”¶é›†æ–‡ä»¶ | `all_files()`ï¼ˆ2 è¡Œï¼‰ | `Path.rglob("*")` è‡ªåŠ¨é€’å½’ | | å¹¶è¡Œè®¡ç®— | `ThreadPoolExecutor` + `as_completed`ï¼ˆ5 è¡Œï¼‰ | åªæäº¤ä¸€æ¬¡å‡½æ•° `file_size`ï¼Œçº¿ç¨‹æ± è´Ÿè´£è°ƒåº¦ | | å†™ CSV | `write_csv()`ï¼ˆ5 è¡Œï¼‰ | è‡ªåŠ¨åˆ›å»ºçˆ¶ç›®å½•ï¼Œä½¿ç”¨ UTFâ€‘8â€‘sig é˜²æ­¢ Windows ä¹±ç  | | ä¸»æµç¨‹ | `main()`ï¼ˆçº¦ 10 è¡Œï¼‰ | è¯»å–ã€å¹¶è¡Œã€å†™å‡ºï¼Œä¸€ç›®äº†ç„¶ | æ•´æ®µè„šæœ¬ **â‰ˆ 30 è¡Œ**ï¼ˆå«æ³¨é‡Šï¼‰ï¼Œä¸éœ€è¦é¢å¤–åº“ã€ä¹Ÿä¸æ¶‰åŠå¤æ‚å¼‚å¸¸å¤„ç†ï¼Œè¶³ä»¥æ¼”ç¤ºã€Œå¤šçº¿ç¨‹ + æ–‡ä»¶ I/Oã€çš„æ ¸å¿ƒæ¦‚å¿µã€‚ --- ## ğŸ“ˆ å°å®éªŒï¼ˆå¯é€‰ï¼‰ å¦‚æœæƒ³æ„Ÿå—å¤šçº¿ç¨‹å¸¦æ¥çš„é€Ÿåº¦æå‡ï¼Œåªéœ€è¦æŠŠ `MAX_WORKERS` æ”¹æˆ `1`ï¼ˆå•çº¿ç¨‹ï¼‰å†è·‘ä¸€æ¬¡ï¼Œå¯¹æ¯”è€—æ—¶å³å¯ã€‚ åœ¨ SSD ä¸Šå¯¹å‡ åƒä¸ªå°æ–‡ä»¶æˆ–å‡ ä¸ª GB çš„å¤§æ–‡ä»¶ï¼Œé€šå¸¸èƒ½çœ‹åˆ° **30â€‘50%** çš„åŠ é€Ÿã€‚ ç¥ä½ ç©å¾—å¼€å¿ƒ ğŸš€ï¼å¦‚æœè¿˜æœ‰å…¶ä»–æƒ³è¦å®ç°çš„ç®€æ˜“ä»»åŠ¡ï¼ˆæ¯”å¦‚è¡Œæ•°ç»Ÿè®¡ã€MD5ã€å›¾ç‰‡ç¼©æ”¾ç­‰ï¼‰ï¼Œéšæ—¶å‘Šè¯‰æˆ‘ï¼
ä¸ç”¨çº¿ç¨‹å¤„ç†çš„ä»»åŠ¡

profile
gpt-oss:120b
æ€è€ƒç”¨æ—¶ 0 ç§’
ä¸‹é¢ç»™å‡º æœ€ç®€æ´ã€å•çº¿ç¨‹ çš„æ–‡ä»¶æ‰¹å¤„ç†ç¤ºä¾‹â€”â€”
ç»Ÿè®¡æŒ‡å®šç›®å½•ï¼ˆåŒ…æ‹¬å­ç›®å½•ï¼‰ä¸‹æ‰€æœ‰æ™®é€šæ–‡ä»¶çš„è¡Œæ•°ï¼Œå¹¶æŠŠã€Œç›¸å¯¹è·¯å¾„ + è¡Œæ•°ã€å†™å…¥ CSVã€‚
ä»£ç åªä½¿ç”¨ Python æ ‡å‡†åº“ï¼Œä¸æ¶‰åŠä»»ä½•å¹¶å‘/çº¿ç¨‹ï¼Œä¸€æ­¥ä¸€æ­¥å°±èƒ½è·‘é€šã€‚

ğŸ“‚ ç›®å½•ç»“æ„ï¼ˆè‡ªè¡Œåˆ›å»ºæˆ–è‡ªè¡Œæ›¿æ¢è·¯å¾„ï¼‰

æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
project/
â”œâ”€ data/                # å¾…å¤„ç†çš„æ–‡æœ¬æ–‡ä»¶ï¼ˆå¯ä»¥æ··åˆå­ç›®å½•ï¼‰
â”‚   â”œâ”€ a.txt
â”‚   â”œâ”€ sub/
â”‚   â”‚   â””â”€ b.log
â”‚   â””â”€ c.md
â””â”€ count_lines.py       # ä¸‹é¢çš„ä»£ç ä¿å­˜ä¸ºæ­¤æ–‡ä»¶
ğŸ ä»£ç  â€“ count_lines.py
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
å•çº¿ç¨‹æ‰¹é‡ç»Ÿè®¡æ–‡ä»¶è¡Œæ•°å¹¶å†™å…¥ CSVã€‚

åŠŸèƒ½ï¼š
  1. é€’å½’éå† data/ ç›®å½•ï¼Œæ”¶é›†æ‰€æœ‰æ™®é€šæ–‡ä»¶ï¼ˆæ’é™¤ç›®å½•ã€è½¯é“¾æ¥ï¼‰ã€‚
  2. é€ä¸ªæ‰“å¼€æ–‡ä»¶ï¼Œé€è¡Œè®¡æ•°ï¼ˆä½¿ç”¨æœ€çœå†…å­˜çš„æ–¹å¼ï¼‰ã€‚
  3. æŠŠ â€œç›¸å¯¹è·¯å¾„, è¡Œæ•°â€ å†™å…¥ output/lines.csvï¼ˆè‡ªåŠ¨åˆ›å»º output/ ç›®å½•ï¼‰ã€‚
"""

import csv
from pathlib import Path

# -------------------------------------------------
# â˜… é…ç½®ï¼ˆæ ¹æ®å®é™…éœ€æ±‚è‡ªè¡Œä¿®æ”¹ï¼‰ â˜…
# -------------------------------------------------
ROOT_DIR   = Path("./data")          # å¾…éå†çš„æ ¹ç›®å½•
OUT_CSV    = Path("./output/lines.csv")
# -------------------------------------------------


def count_file_lines(p: Path) -> tuple[Path, int]:
    """
    è¿”å› (æ–‡ä»¶Path, è¡Œæ•°)ã€‚
    å¦‚æœæ‰“å¼€æˆ–è¯»å–è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ï¼Œè¿”å› (Path, -1) è¡¨ç¤ºâ€œå‡ºé”™â€ã€‚
    """
    try:
        with p.open("r", encoding="utf-8", errors="ignore") as f:
            # é€è¡Œéå†æ¯”ä¸€æ¬¡æ€§ read().splitlines() æ›´çœå†…å­˜
            return p, sum(1 for _ in f)
    except Exception:
        return p, -1                     # -1 ä»£è¡¨è¯»å–å¤±è´¥


def gather_files(root: Path) -> list[Path]:
    """é€’å½’æ”¶é›†æ‰€æœ‰æ™®é€šæ–‡ä»¶ï¼ˆä¸åŒ…æ‹¬ç›®å½•ã€è½¯é“¾æ¥ï¼‰ã€‚"""
    return [p for p in root.rglob("*") if p.is_file() and not p.is_symlink()]


def write_csv(results: list[tuple[Path, int]], csv_path: Path) -> None:
    """æŠŠ [(Path, è¡Œæ•°), â€¦] å†™å…¥ CSVï¼Œä½¿ç”¨ UTFâ€‘8â€‘sig é˜²æ­¢ Windows æ‰“å¼€ä¹±ç ã€‚"""
    csv_path.parent.mkdir(parents=True, exist_ok=True)
    with csv_path.open("w", newline="", encoding="utf-8-sig") as fp:
        writer = csv.writer(fp)
        writer.writerow(["relative_path", "line_count"])
        for p, cnt in results:
            writer.writerow([p.relative_to(ROOT_DIR).as_posix(), cnt])


def main() -> None:
    files = gather_files(ROOT_DIR)
    print(f"ğŸ” æ‰¾åˆ° {len(files)} ä¸ªæ–‡ä»¶ï¼Œå¼€å§‹é€ä¸ªè®¡æ•°â€¦")

    results = []
    for p in files:                     # ğŸ‘‰ **å•çº¿ç¨‹é¡ºåºå¤„ç†**
        results.append(count_file_lines(p))

    write_csv(results, OUT_CSV)
    print(f"âœ… å®Œæˆï¼ç»“æœå·²å†™å…¥ {OUT_CSV.resolve()}")


if __name__ == "__main__":
    main()
è¿è¡Œæ–¹å¼
bash

æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
2
# ç¡®ä¿ data/ ç›®å½•å·²ç»å­˜åœ¨å¹¶æ”¾å…¥ä¸€äº›æ–‡æœ¬æ–‡ä»¶
python count_lines.py
è¿è¡Œåä¼šåœ¨ output/lines.csv ä¸­å¾—åˆ°ç±»ä¼¼å†…å®¹ï¼š


æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
2
3
4
relative_path,line_count
a.txt,42
sub/b.log,118
c.md,7
âœ¨ ä¸ºä»€ä¹ˆè¿™æ®µä»£ç ç®—ã€Œä¸ç”¨çº¿ç¨‹ã€ï¼Ÿ
æ­¥éª¤
ä»£ç è¡Œæ•°
è¯´æ˜
æ”¶é›†æ–‡ä»¶	
gather_files()ï¼ˆ2 è¡Œï¼‰	
Path.rglob("*") è‡ªåŠ¨é€’å½’ï¼Œæ— éœ€å¹¶å‘
è®¡æ•°	
for p in files: å¾ªç¯ + count_file_lines()ï¼ˆ3 è¡Œï¼‰	
é€ä¸ªé¡ºåºæ‰“å¼€ã€é€è¡Œè®¡æ•°ï¼Œæœ€ç›´æ¥çš„ I/O æ–¹å¼
å†™ CSV	
write_csv()ï¼ˆ5 è¡Œï¼‰	
è‡ªåŠ¨åˆ›å»ºçˆ¶ç›®å½•ï¼Œä½¿ç”¨ UTFâ€‘8â€‘sig é˜²æ­¢ Windows ä¹±ç 
ä¸»æµç¨‹	
main()ï¼ˆçº¦ 10 è¡Œï¼‰	
è¯»å– â†’ è®¡æ•° â†’ å†™å‡ºï¼Œä¸€ç›®äº†ç„¶
æ•´æ®µè„šæœ¬ â‰ˆ 30 è¡Œï¼ˆå«æ³¨é‡Šï¼‰ï¼Œä¸ä¾èµ– concurrent.futuresã€threadingã€multiprocessingï¼Œå®Œå…¨æ˜¯ é¡ºåºæ‰§è¡Œã€‚

ğŸ“ˆ å°å®éªŒï¼ˆéªŒè¯å•çº¿ç¨‹çš„è€—æ—¶ï¼‰
å¦‚æœä½ æƒ³æ„Ÿå—å•çº¿ç¨‹çš„æ‰§è¡Œæ—¶é—´ï¼Œåªéœ€è¦ç›´æ¥è¿è¡Œè„šæœ¬å³å¯ã€‚
åœ¨æ™®é€šæœºæ¢°ç¡¬ç›˜ä¸Šç»Ÿè®¡å‡ åƒä¸ªå°æ–‡ä»¶çš„è¡Œæ•°ï¼Œå¤§çº¦ 0.1â€‘0.3â€¯ç§’/åƒæ–‡ä»¶ï¼›
åœ¨ SSD ä¸Šåˆ™æ›´å¿«ï¼Œé€šå¸¸ 1â€¯ç§’ä»¥å†… å®Œæˆå‡ ä¸‡è¡Œæ–‡æœ¬çš„ç»Ÿè®¡ã€‚

ğŸ¯ é€‚ç”¨åœºæ™¯æ‰©å±•ï¼ˆä»ä¿æŒå•çº¿ç¨‹ï¼‰
æ–‡ä»¶å¤§å°ç»Ÿè®¡ â†’ æŠŠ count_file_lines æ”¹æˆ p.stat().st_sizeã€‚
æ–‡ä»¶ MD5 / SHAâ€‘256 â†’ æ›¿æ¢å‡½æ•°ä½“ä¸ºç›¸åº”çš„ hashlib è®¡ç®—ã€‚
ç®€å•å¤åˆ¶/ç§»åŠ¨ â†’ ç”¨ shutil.copy2(p, dest) ä»£æ›¿è®¡æ•°ã€‚
æç¤ºï¼šå¦‚æœä½ çš„ä»»åŠ¡æ˜¯ CPUâ€‘boundï¼ˆæ¯”å¦‚å¤æ‚æ–‡æœ¬è§£æã€å›¾ç‰‡å¤„ç†ç­‰ï¼‰ï¼Œå•çº¿ç¨‹ä¼šå—é™äº CPUã€‚æ­¤æ—¶å¯ä»¥è€ƒè™‘æ”¹ä¸ºå¤šè¿›ç¨‹æˆ–çº¿ç¨‹ï¼Œä½†å¦‚æœåªæ˜¯ I/Oâ€‘boundï¼ˆè¯»å–ç£ç›˜ã€å†™ CSVï¼‰â€”â€”å•çº¿ç¨‹å·²ç»è¶³å¤Ÿå¿«ä¸”ä»£ç æœ€ç®€æ´ã€‚ 

ç¥ä½ ç©å¾—å¼€å¿ƒ ğŸš€ï¼Œæœ‰å…¶ä»–æƒ³è¦çš„ç®€æ˜“å•çº¿ç¨‹ä»»åŠ¡ï¼ˆæ¯”å¦‚è¯é¢‘ç»Ÿè®¡ã€JSON åˆå¹¶ã€å›¾ç‰‡è½¬ç°åº¦ç­‰ï¼‰ï¼Œéšæ—¶å‘Šè¯‰æˆ‘ï¼









è¿½é—®
èƒ½å¦ç»™ä¸€ä¸ªåªåˆ—å‡ºæ–‡ä»¶è·¯å¾„è€Œä¸åšä»»ä½•ç»Ÿè®¡çš„æœ€ç®€è„šæœ¬ï¼Ÿ
æˆ‘æƒ³åœ¨å•çº¿ç¨‹å¤„ç†æ—¶åŠ å…¥è¿›åº¦æ¡æ˜¾ç¤ºï¼Œåº”è¯¥æ€ä¹ˆå®ç°ï¼Ÿ
å¦‚æœåªæƒ³ç»Ÿè®¡ç‰¹å®šåç¼€ï¼ˆæ¯”å¦‚ .txtï¼‰çš„æ–‡ä»¶è¡Œæ•°ï¼Œè¯¥æ€ä¹ˆè¿‡æ»¤ï¼Ÿ
èƒ½å¦æŠŠè„šæœ¬æ”¹æˆæ¥å—å‘½ä»¤è¡Œå‚æ•°ï¼Œä¾‹å¦‚ç›®å½•å’Œè¾“å‡ºæ–‡ä»¶åï¼Ÿ
å¯¹äºè¶…å¤§æ–‡ä»¶ï¼Œæœ‰æ²¡æœ‰æ›´çœå†…å­˜çš„è¯»å–æ–¹å¼å¯ä»¥æ¨èï¼Ÿ
<details type="reasoning" done="true" duration="0"> <summary>Thought for 0 seconds</summary> > We need to provide a simple task without threading. Possibly a script that processes files sequentially. Should be simple. Provide example: count lines, compute hash, copy files, etc. Provide code and explanation. Ensure no threading. Provide concise. </details> ä¸‹é¢ç»™å‡º **æœ€ç®€æ´ã€å•çº¿ç¨‹** çš„æ–‡ä»¶æ‰¹å¤„ç†ç¤ºä¾‹â€”â€” **ç»Ÿè®¡æŒ‡å®šç›®å½•ï¼ˆåŒ…æ‹¬å­ç›®å½•ï¼‰ä¸‹æ‰€æœ‰æ™®é€šæ–‡ä»¶çš„è¡Œæ•°**ï¼Œå¹¶æŠŠã€Œç›¸å¯¹è·¯å¾„ + è¡Œæ•°ã€å†™å…¥ CSVã€‚ ä»£ç åªä½¿ç”¨ Python æ ‡å‡†åº“ï¼Œ**ä¸æ¶‰åŠä»»ä½•å¹¶å‘/çº¿ç¨‹**ï¼Œä¸€æ­¥ä¸€æ­¥å°±èƒ½è·‘é€šã€‚ --- ## ğŸ“‚ ç›®å½•ç»“æ„ï¼ˆè‡ªè¡Œåˆ›å»ºæˆ–è‡ªè¡Œæ›¿æ¢è·¯å¾„ï¼‰ ``` project/ â”œâ”€ data/ # å¾…å¤„ç†çš„æ–‡æœ¬æ–‡ä»¶ï¼ˆå¯ä»¥æ··åˆå­ç›®å½•ï¼‰ â”‚ â”œâ”€ a.txt â”‚ â”œâ”€ sub/ â”‚ â”‚ â””â”€ b.log â”‚ â””â”€ c.md â””â”€ count_lines.py # ä¸‹é¢çš„ä»£ç ä¿å­˜ä¸ºæ­¤æ–‡ä»¶ ``` --- ## ğŸ ä»£ç  â€“ `count_lines.py` ```python #!/usr/bin/env python # -*- coding: utf-8 -*- """ å•çº¿ç¨‹æ‰¹é‡ç»Ÿè®¡æ–‡ä»¶è¡Œæ•°å¹¶å†™å…¥ CSVã€‚ åŠŸèƒ½ï¼š 1. é€’å½’éå† data/ ç›®å½•ï¼Œæ”¶é›†æ‰€æœ‰æ™®é€šæ–‡ä»¶ï¼ˆæ’é™¤ç›®å½•ã€è½¯é“¾æ¥ï¼‰ã€‚ 2. é€ä¸ªæ‰“å¼€æ–‡ä»¶ï¼Œé€è¡Œè®¡æ•°ï¼ˆä½¿ç”¨æœ€çœå†…å­˜çš„æ–¹å¼ï¼‰ã€‚ 3. æŠŠ â€œç›¸å¯¹è·¯å¾„, è¡Œæ•°â€ å†™å…¥ output/lines.csvï¼ˆè‡ªåŠ¨åˆ›å»º output/ ç›®å½•ï¼‰ã€‚ """ import csv from pathlib import Path # ------------------------------------------------- # â˜… é…ç½®ï¼ˆæ ¹æ®å®é™…éœ€æ±‚è‡ªè¡Œä¿®æ”¹ï¼‰ â˜… # ------------------------------------------------- ROOT_DIR = Path("./data") # å¾…éå†çš„æ ¹ç›®å½• OUT_CSV = Path("./output/lines.csv") # ------------------------------------------------- def count_file_lines(p: Path) -> tuple[Path, int]: """ è¿”å› (æ–‡ä»¶Path, è¡Œæ•°)ã€‚ å¦‚æœæ‰“å¼€æˆ–è¯»å–è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ï¼Œè¿”å› (Path, -1) è¡¨ç¤ºâ€œå‡ºé”™â€ã€‚ """ try: with p.open("r", encoding="utf-8", errors="ignore") as f: # é€è¡Œéå†æ¯”ä¸€æ¬¡æ€§ read().splitlines() æ›´çœå†…å­˜ return p, sum(1 for _ in f) except Exception: return p, -1 # -1 ä»£è¡¨è¯»å–å¤±è´¥ def gather_files(root: Path) -> list[Path]: """é€’å½’æ”¶é›†æ‰€æœ‰æ™®é€šæ–‡ä»¶ï¼ˆä¸åŒ…æ‹¬ç›®å½•ã€è½¯é“¾æ¥ï¼‰ã€‚""" return [p for p in root.rglob("*") if p.is_file() and not p.is_symlink()] def write_csv(results: list[tuple[Path, int]], csv_path: Path) -> None: """æŠŠ [(Path, è¡Œæ•°), â€¦] å†™å…¥ CSVï¼Œä½¿ç”¨ UTFâ€‘8â€‘sig é˜²æ­¢ Windows æ‰“å¼€ä¹±ç ã€‚""" csv_path.parent.mkdir(parents=True, exist_ok=True) with csv_path.open("w", newline="", encoding="utf-8-sig") as fp: writer = csv.writer(fp) writer.writerow(["relative_path", "line_count"]) for p, cnt in results: writer.writerow([p.relative_to(ROOT_DIR).as_posix(), cnt]) def main() -> None: files = gather_files(ROOT_DIR) print(f"ğŸ” æ‰¾åˆ° {len(files)} ä¸ªæ–‡ä»¶ï¼Œå¼€å§‹é€ä¸ªè®¡æ•°â€¦") results = [] for p in files: # ğŸ‘‰ **å•çº¿ç¨‹é¡ºåºå¤„ç†** results.append(count_file_lines(p)) write_csv(results, OUT_CSV) print(f"âœ… å®Œæˆï¼ç»“æœå·²å†™å…¥ {OUT_CSV.resolve()}") if __name__ == "__main__": main() ``` ### è¿è¡Œæ–¹å¼ ```bash # ç¡®ä¿ data/ ç›®å½•å·²ç»å­˜åœ¨å¹¶æ”¾å…¥ä¸€äº›æ–‡æœ¬æ–‡ä»¶ python count_lines.py ``` è¿è¡Œåä¼šåœ¨ `output/lines.csv` ä¸­å¾—åˆ°ç±»ä¼¼å†…å®¹ï¼š ``` relative_path,line_count a.txt,42 sub/b.log,118 c.md,7 ``` --- ## âœ¨ ä¸ºä»€ä¹ˆè¿™æ®µä»£ç ç®—ã€Œä¸ç”¨çº¿ç¨‹ã€ï¼Ÿ | æ­¥éª¤ | ä»£ç è¡Œæ•° | è¯´æ˜ | |------|----------|------| | æ”¶é›†æ–‡ä»¶ | `gather_files()`ï¼ˆ2 è¡Œï¼‰ | `Path.rglob("*")` è‡ªåŠ¨é€’å½’ï¼Œæ— éœ€å¹¶å‘ | | è®¡æ•° | `for p in files:` å¾ªç¯ + `count_file_lines()`ï¼ˆ3 è¡Œï¼‰ | é€ä¸ªé¡ºåºæ‰“å¼€ã€é€è¡Œè®¡æ•°ï¼Œæœ€ç›´æ¥çš„ I/O æ–¹å¼ | | å†™ CSV | `write_csv()`ï¼ˆ5 è¡Œï¼‰ | è‡ªåŠ¨åˆ›å»ºçˆ¶ç›®å½•ï¼Œä½¿ç”¨ UTFâ€‘8â€‘sig é˜²æ­¢ Windows ä¹±ç  | | ä¸»æµç¨‹ | `main()`ï¼ˆçº¦ 10 è¡Œï¼‰ | è¯»å– â†’ è®¡æ•° â†’ å†™å‡ºï¼Œä¸€ç›®äº†ç„¶ | æ•´æ®µè„šæœ¬ **â‰ˆ 30 è¡Œ**ï¼ˆå«æ³¨é‡Šï¼‰ï¼Œä¸ä¾èµ– `concurrent.futures`ã€`threading`ã€`multiprocessing`ï¼Œå®Œå…¨æ˜¯ **é¡ºåºæ‰§è¡Œ**ã€‚ --- ## ğŸ“ˆ å°å®éªŒï¼ˆéªŒè¯å•çº¿ç¨‹çš„è€—æ—¶ï¼‰ å¦‚æœä½ æƒ³æ„Ÿå—å•çº¿ç¨‹çš„æ‰§è¡Œæ—¶é—´ï¼Œåªéœ€è¦ç›´æ¥è¿è¡Œè„šæœ¬å³å¯ã€‚ åœ¨æ™®é€šæœºæ¢°ç¡¬ç›˜ä¸Šç»Ÿè®¡å‡ åƒä¸ªå°æ–‡ä»¶çš„è¡Œæ•°ï¼Œå¤§çº¦ **0.1â€‘0.3â€¯ç§’/åƒæ–‡ä»¶**ï¼› åœ¨ SSD ä¸Šåˆ™æ›´å¿«ï¼Œé€šå¸¸ **1â€¯ç§’ä»¥å†…** å®Œæˆå‡ ä¸‡è¡Œæ–‡æœ¬çš„ç»Ÿè®¡ã€‚ --- ## ğŸ¯ é€‚ç”¨åœºæ™¯æ‰©å±•ï¼ˆä»ä¿æŒå•çº¿ç¨‹ï¼‰ - **æ–‡ä»¶å¤§å°ç»Ÿè®¡** â†’ æŠŠ `count_file_lines` æ”¹æˆ `p.stat().st_size`ã€‚ - **æ–‡ä»¶ MD5 / SHAâ€‘256** â†’ æ›¿æ¢å‡½æ•°ä½“ä¸ºç›¸åº”çš„ `hashlib` è®¡ç®—ã€‚ - **ç®€å•å¤åˆ¶/ç§»åŠ¨** â†’ ç”¨ `shutil.copy2(p, dest)` ä»£æ›¿è®¡æ•°ã€‚ > **æç¤º**ï¼šå¦‚æœä½ çš„ä»»åŠ¡æ˜¯ **CPUâ€‘bound**ï¼ˆæ¯”å¦‚å¤æ‚æ–‡æœ¬è§£æã€å›¾ç‰‡å¤„ç†ç­‰ï¼‰ï¼Œå•çº¿ç¨‹ä¼šå—é™äº CPUã€‚æ­¤æ—¶å¯ä»¥è€ƒè™‘æ”¹ä¸ºå¤šè¿›ç¨‹æˆ–çº¿ç¨‹ï¼Œä½†å¦‚æœåªæ˜¯ **I/Oâ€‘bound**ï¼ˆè¯»å–ç£ç›˜ã€å†™ CSVï¼‰â€”â€”å•çº¿ç¨‹å·²ç»è¶³å¤Ÿå¿«ä¸”ä»£ç æœ€ç®€æ´ã€‚ ç¥ä½ ç©å¾—å¼€å¿ƒ ğŸš€ï¼Œæœ‰å…¶ä»–æƒ³è¦çš„ç®€æ˜“å•çº¿ç¨‹ä»»åŠ¡ï¼ˆæ¯”å¦‚è¯é¢‘ç»Ÿè®¡ã€JSON åˆå¹¶ã€å›¾ç‰‡è½¬ç°åº¦ç­‰ï¼‰ï¼Œéšæ—¶å‘Šè¯‰æˆ‘ï¼





è”ç½‘æœç´¢

ä»£ç è§£é‡Šå™¨


Open WebUI



gpt-oss:120b




Loading...
profile
gpt-oss:120b
æ€è€ƒç”¨æ—¶ 0 ç§’
ğŸ“‹ Python list å¸¸ç”¨æ–¹æ³•é€ŸæŸ¥è¡¨
ä¸‹é¢åˆ—å‡º å†…ç½®åˆ—è¡¨ (list) æ‰€æä¾›çš„å…¨éƒ¨å…¬å¼€æ–¹æ³•ï¼ŒåŒ…å«åŠŸèƒ½è¯´æ˜ã€å¸¸è§ç”¨æ³•ç¤ºä¾‹ä»¥åŠå¸¸è§çš„å‘/æ³¨æ„ç‚¹ã€‚
ä»£ç å‡å¯åœ¨äº¤äº’å¼è§£é‡Šå™¨æˆ– Jupyter Notebook ä¸­ç›´æ¥è¿è¡Œã€‚ 

æ–¹æ³•
åŠŸèƒ½
å¸¸ç”¨è¯­æ³•
ç¤ºä¾‹
å¤‡æ³¨ / å¸¸è§å‘
append(x)	
åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å•ä¸ªå…ƒç´  x	
lst.append(item)	
lst=[1,2]; lst.append(3) # [1,2,3]	
O(1) æ—¶é—´å¤æ‚åº¦
extend(iterable)	
ç”¨å¯è¿­ä»£å¯¹è±¡çš„æ¯ä¸ªå…ƒç´ æ‰©å±•åˆ—è¡¨	
lst.extend(other)	
lst=[1]; lst.extend([2,3]) # [1,2,3]	
ç­‰ä»·äº lst += otherï¼Œä¸è¦å†™æˆ lst.append(other)ï¼ˆä¼šæŠŠæ•´ä¸ªå¯¹è±¡å½“æˆä¸€ä¸ªå…ƒç´ ï¼‰
insert(i, x)	
åœ¨ç´¢å¼• i ä½ç½®æ’å…¥å…ƒç´  xï¼Œåé¢çš„å…ƒç´ å³ç§»	
lst.insert(idx, item)	
lst=[1,3]; lst.insert(1,2) # [1,2,3]	
è´Ÿç´¢å¼•åŒæ ·æœ‰æ•ˆï¼›O(n) å¤æ‚åº¦
remove(x)	
åˆ é™¤åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªå€¼ç­‰äº x çš„å…ƒç´ 	
lst.remove(item)	
lst=[1,2,2,3]; lst.remove(2) # [1,2,3]	
è‹¥ä¸å­˜åœ¨æŠ› ValueError
pop([i])	
åˆ é™¤å¹¶è¿”å›ç´¢å¼• i å¤„çš„å…ƒç´ ï¼Œé»˜è®¤ i=-1ï¼ˆå¼¹å‡ºæœ«å°¾ï¼‰	
item = lst.pop(idx)	
lst=[1,2,3]; lst.pop() # è¿”å› 3ï¼Œåˆ—è¡¨å˜ä¸º [1,2]	
ç©ºåˆ—è¡¨è°ƒç”¨ä¼šæŠ› IndexError
clear()	
åˆ é™¤åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ ï¼Œå¾—åˆ°ç©ºåˆ—è¡¨	
lst.clear()	
lst=[1,2]; lst.clear() # []	
ç­‰ä»·äº del lst[:]
index(x, start=0, end=len(lst))	
è¿”å›å€¼ç­‰äº x çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ï¼Œå¯é€‰æœç´¢åŒºé—´	
pos = lst.index(item, start, end)	
lst=[1,2,3]; lst.index(2) # 1	
è‹¥ä¸å­˜åœ¨æŠ› ValueError
count(x)	
ç»Ÿè®¡åˆ—è¡¨ä¸­å€¼ç­‰äº x çš„å…ƒç´ ä¸ªæ•°	
n = lst.count(item)	
lst=[1,2,2,3]; lst.count(2) # 2	
O(n)
sort(key=None, reverse=False)	
åŸåœ°æ’åºï¼Œè¿”å› None	
lst.sort(key=func, reverse=True)	
lst=[3,1,2]; lst.sort() # [1,2,3]	
æ³¨æ„ï¼šlist.sort() ä¼šä¿®æ”¹åŸåˆ—è¡¨ï¼Œè‹¥éœ€è¦ä¿ç•™åŸåˆ—è¡¨è¯·ä½¿ç”¨ sorted(lst)
reverse()	
åŸåœ°ç¿»è½¬åˆ—è¡¨é¡ºåº	
lst.reverse()	
lst=[1,2,3]; lst.reverse() # [3,2,1]	
åŒæ ·è¿”å› Noneï¼Œä¸ç”Ÿæˆæ–°åˆ—è¡¨
copy()	
è¿”å›åˆ—è¡¨çš„æµ…æ‹·è´ï¼ˆç­‰ä»·äº lst[:]ï¼‰	
new_lst = lst.copy()	
a=[1,2]; b=a.copy(); b.append(3) # a=[1,2], b=[1,2,3]	
è‹¥åˆ—è¡¨å†…éƒ¨è¿˜æœ‰å¯å˜å¯¹è±¡ï¼Œéœ€è¦ copy.deepcopy
__len__() / len(lst)	
è¿”å›åˆ—è¡¨é•¿åº¦	
n = len(lst)	
len([1,2,3]) # 3	
ä¸æ˜¯æ–¹æ³•ï¼Œä½†å¸¸ç”¨
__getitem__(i) / lst[i]	
å–å…ƒç´ æˆ–åˆ‡ç‰‡	
item = lst[i]	
lst=[1,2,3]; lst[0] # 1	
æ”¯æŒè´Ÿç´¢å¼•ã€æ­¥é•¿åˆ‡ç‰‡
__setitem__(i, x) / lst[i] = x	
æ›¿æ¢æŒ‡å®šä½ç½®çš„å…ƒç´ 	
lst[i] = val	
lst[1]=9 # [1,9,3]	
åŒæ ·æ”¯æŒåˆ‡ç‰‡èµ‹å€¼ lst[1:3]=[8,8]
__delitem__(i) / del lst[i]	
åˆ é™¤æŒ‡å®šä½ç½®æˆ–åˆ‡ç‰‡	
del lst[i]	
del lst[0] # åˆ é™¤é¦–å…ƒç´ 	
__contains__(x) / x in lst	
åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨åˆ—è¡¨ä¸­	
x in lst	
2 in [1,2,3] # True	
O(n) çº¿æ€§æœç´¢
__iter__() / for x in lst:	
è¿­ä»£åˆ—è¡¨	
for v in lst: ...	
for v in [1,2]: print(v)	
ğŸ›  å¸¸è§å®ç”¨æŠ€å·§
1ï¸âƒ£ åˆ—è¡¨æ¨å¯¼å¼ï¼ˆList Comprehensionï¼‰
è¯­æ³•ï¼š[expr for item in iterable if condition]

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
# 1~10 çš„å¹³æ–¹ï¼Œåªä¿ç•™å¶æ•°
evens_sq = [x**2 for x in range(1, 11) if x % 2 == 0]
# è¾“å‡º: [4, 16, 36, 64, 100]
2ï¸âƒ£ åˆ—è¡¨åˆ‡ç‰‡ï¼ˆSliceï¼‰
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
lst = list(range(10))   # [0,1,2,3,4,5,6,7,8,9]

# å‰ 5 é¡¹
first5 = lst[:5]        # [0,1,2,3,4]

# ä»ç¬¬ 3 é¡¹å¼€å§‹åˆ°å€’æ•°ç¬¬ 2 é¡¹
mid = lst[2:-1]         # [2,3,4,5,6,7,8]

# æ­¥é•¿ 2ï¼ˆå–å¶æ•°ç´¢å¼•ï¼‰
step2 = lst[::2]        # [0,2,4,6,8]

# é€†åº
rev = lst[::-1]         # [9,8,7,6,5,4,3,2,1,0]
3ï¸âƒ£ â€œå»é‡ + ä¿æŒé¡ºåºâ€
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
âŒ„
def uniq_keep_order(seq):
    seen = set()
    return [x for x in seq if not (x in seen or seen.add(x))]

print(uniq_keep_order([1,2,2,3,1,4]))  # [1,2,3,4]
4ï¸âƒ£ ç”¨ list.extend æ›¿ä»£ +=ï¼ˆå¯è¯»æ€§æ›´å¥½ï¼‰
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
a = [1, 2]
b = [3, 4]
a.extend(b)   # a -> [1,2,3,4]
# a += b  ä¹Ÿè¡Œï¼Œä½†åœ¨é˜…è¯»æ—¶ä¸æ˜“ç«‹å³çœ‹å‡ºæ˜¯â€œæ‰©å±•â€è€Œéâ€œé‡æ–°èµ‹å€¼â€
5ï¸âƒ£ å¿«é€Ÿç”Ÿæˆå›ºå®šå€¼åˆ—è¡¨
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
zeros = [0] * 10          # [0,0,0,0,0,0,0,0,0,0]
ones  = [1] * 5           # [1,1,1,1,1]
âš ï¸ æ³¨æ„ï¼šå¦‚æœåˆ—è¡¨å†…éƒ¨çš„å…ƒç´ æ˜¯ å¯å˜å¯¹è±¡ï¼Œ[obj] * n ä¼šåˆ›å»º n ä¸ªå¯¹åŒä¸€å¯¹è±¡çš„å¼•ç”¨ï¼Œä¿®æ”¹å…¶ä¸­ä¸€ä¸ªä¼šå½±å“å…¨éƒ¨ã€‚ä¾‹å¦‚ï¼š 

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
inner = [0]
lst = [inner] * 3   # ä¸‰ä¸ªå…ƒç´ æŒ‡å‘åŒä¸€ä¸ªåˆ—è¡¨
lst[0].append(1)    # æ‰€æœ‰å­åˆ—è¡¨éƒ½ä¼šå˜æˆ [0,1]
6ï¸âƒ£ â€œç¿»è½¬ + è¿‡æ»¤â€ å¸¸ç”¨ç»„åˆ
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
# å–å€’æ•°ç¬¬ 2 åˆ°ç¬¬ 5ï¼ˆå€’åºï¼‰ä¸”å¤§äº 10 çš„å…ƒç´ 
result = [x for x in lst[-5:-1][::-1] if x > 10]
ğŸ“¦ ä¸å…¶ä»–å®¹å™¨çš„å¯¹æ¯”
å®¹å™¨
æ˜¯å¦æœ‰åº
æ˜¯å¦å¯å˜
å…³é”®ç‰¹æ€§
é€‚ç”¨åœºæ™¯
list	
âœ…	
âœ…	
æ”¯æŒéšæœºè®¿é—®ã€åˆ‡ç‰‡ã€å¿«é€Ÿè¿½åŠ 	
éœ€è¦é¡ºåºå­˜å‚¨ã€é¢‘ç¹éå†ã€å¶å°”æ’å…¥/åˆ é™¤
tuple	
âœ…	
âŒ	
ä¸å¯å˜ï¼Œå“ˆå¸Œå¯ç”¨ä½œå­—å…¸é”®	
å¸¸é‡åºåˆ—ã€å‡½æ•°è¿”å›å¤šå€¼
set	
âŒ	
âœ…	
å»é‡ã€é›†åˆè¿ç®— O(1) æŸ¥æ‰¾	
å»é‡ã€æˆå‘˜æ£€æµ‹ã€æ•°å­¦é›†åˆæ“ä½œ
dict	
âœ… (Pythonâ€¯3.7+)	
âœ…	
é”®å€¼æ˜ å°„ï¼Œé”®å”¯ä¸€	
å¿«é€ŸæŸ¥æ‰¾ã€å…³è”æ•°æ®
ğŸ§© å°ç»ƒä¹ ï¼ˆè‡ªæµ‹ï¼‰
ç”¨ä¸‹é¢çš„åˆ—è¡¨å®Œæˆ æ‰€æœ‰ æ³¨é‡Šä¸­çš„ä»»åŠ¡ï¼Œå°½é‡åªä½¿ç”¨åˆ—è¡¨è‡ªå¸¦çš„æ–¹æ³•ï¼ˆä¸è¦å¯¼å…¥é¢å¤–æ¨¡å—ï¼‰ã€‚ 

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
data = [5, 2, 9, 2, 7, 5, 1, 3]

# 1. åˆ é™¤ç¬¬ä¸€ä¸ªå‡ºç°çš„ 2
# 2. åœ¨æœ«å°¾è¿½åŠ  10
# 3. æŠŠ 7 æ›¿æ¢æˆ 8
# 4. æŠŠåˆ—è¡¨å€’åº
# 5. ç»Ÿè®¡ 5 å‡ºç°äº†å‡ æ¬¡
# 6. ç”Ÿæˆä¸€ä¸ªæ–°åˆ—è¡¨ï¼Œåªä¿ç•™å¥‡æ•°ä¸”å»é‡ï¼Œä¿æŒåŸé¡ºåº
å‚è€ƒç­”æ¡ˆï¼ˆä»…ä¾›æ£€éªŒï¼‰

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
âŒ„
# 1
data.remove(2)

# 2
data.append(10)

# 3
idx = data.index(7)
data[idx] = 8

# 4
data.reverse()

# 5
cnt_five = data.count(5)

# 6
def uniq_keep_order(seq):
    seen = set()
    return [x for x in seq if not (x in seen or seen.add(x))]

odd_unique = uniq_keep_order([x for x in data if x % 2 == 1])
print(odd_unique)   # ç¤ºä¾‹è¾“å‡º: [5, 9, 1, 3]
ğŸ“š æ¨èé˜…è¯» & è¿›é˜¶
å®˜æ–¹æ–‡æ¡£ â€“ list ç« èŠ‚ï¼šhttps://docs.python.org/3/tutorial/datastructures.html#more-on-lists
PEP 8 â€“ ä»£ç é£æ ¼æŒ‡å—ï¼Œä¿æŒåˆ—è¡¨æ“ä½œçš„å¯è¯»æ€§ã€‚
ã€ŠEffective Pythonã€‹ï¼ˆç¬¬äºŒç‰ˆï¼‰â€“ ç¬¬ 12 æ¡ â€œPrefer list comprehensions over map and filterâ€ã€‚
itertools â€“ å½“åˆ—è¡¨æ“ä½œå˜å¾—æ›´å¤æ‚ï¼ˆå¦‚æ— é™è¿­ä»£ã€ç¬›å¡å°”ç§¯ï¼‰æ—¶ï¼Œç”¨å®ƒå¯ä»¥å†™å‡ºæ›´é«˜æ•ˆã€æ›´ç®€æ´çš„ä»£ç ã€‚
åªè¦ç†Ÿç»ƒæŒæ¡ä¸Šè¡¨çš„è¿™äº›æ–¹æ³•ï¼Œä½ å°±èƒ½åœ¨æ—¥å¸¸å¼€å‘ã€æ•°æ®æ¸…æ´—ã€ç®—æ³•å®ç°ç­‰åœºæ™¯ä¸­è‡ªå¦‚åœ°ä½¿ç”¨ Python åˆ—è¡¨äº†ã€‚ç¥ç¼–ç æ„‰å¿« ğŸš€ 

<details type="reasoning" done="true" duration="0"> <summary>Thought for 0 seconds</summary> > The user says "listæ–¹æ³•". Likely they want methods of Python list. Provide description of list methods with examples. Probably Chinese. Provide table of methods, usage, examples. Also include tips and common patterns. </details> ## ğŸ“‹ Python `list` å¸¸ç”¨æ–¹æ³•é€ŸæŸ¥è¡¨ > ä¸‹é¢åˆ—å‡º **å†…ç½®åˆ—è¡¨ (`list`)** æ‰€æä¾›çš„å…¨éƒ¨å…¬å¼€æ–¹æ³•ï¼ŒåŒ…å«åŠŸèƒ½è¯´æ˜ã€å¸¸è§ç”¨æ³•ç¤ºä¾‹ä»¥åŠå¸¸è§çš„å‘/æ³¨æ„ç‚¹ã€‚ > ä»£ç å‡å¯åœ¨äº¤äº’å¼è§£é‡Šå™¨æˆ– Jupyter Notebook ä¸­ç›´æ¥è¿è¡Œã€‚ | æ–¹æ³• | åŠŸèƒ½ | å¸¸ç”¨è¯­æ³• | ç¤ºä¾‹ | å¤‡æ³¨ / å¸¸è§å‘ | |------|------|----------|------|--------------| | `append(x)` | åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å•ä¸ªå…ƒç´  `x` | `lst.append(item)` | `lst=[1,2]; lst.append(3) # [1,2,3]` | O(1) æ—¶é—´å¤æ‚åº¦ | | `extend(iterable)` | ç”¨å¯è¿­ä»£å¯¹è±¡çš„æ¯ä¸ªå…ƒç´ æ‰©å±•åˆ—è¡¨ | `lst.extend(other)` | `lst=[1]; lst.extend([2,3]) # [1,2,3]` | ç­‰ä»·äº `lst += other`ï¼Œ**ä¸è¦**å†™æˆ `lst.append(other)`ï¼ˆä¼šæŠŠæ•´ä¸ªå¯¹è±¡å½“æˆä¸€ä¸ªå…ƒç´ ï¼‰ | | `insert(i, x)` | åœ¨ç´¢å¼• `i` ä½ç½®æ’å…¥å…ƒç´  `x`ï¼Œåé¢çš„å…ƒç´ å³ç§» | `lst.insert(idx, item)` | `lst=[1,3]; lst.insert(1,2) # [1,2,3]` | è´Ÿç´¢å¼•åŒæ ·æœ‰æ•ˆï¼›O(n) å¤æ‚åº¦ | | `remove(x)` | åˆ é™¤åˆ—è¡¨ä¸­**ç¬¬ä¸€ä¸ª**å€¼ç­‰äº `x` çš„å…ƒç´  | `lst.remove(item)` | `lst=[1,2,2,3]; lst.remove(2) # [1,2,3]` | è‹¥ä¸å­˜åœ¨æŠ› `ValueError` | | `pop([i])` | åˆ é™¤å¹¶è¿”å›ç´¢å¼• `i` å¤„çš„å…ƒç´ ï¼Œé»˜è®¤ `i=-1`ï¼ˆå¼¹å‡ºæœ«å°¾ï¼‰ | `item = lst.pop(idx)` | `lst=[1,2,3]; lst.pop() # è¿”å› 3ï¼Œåˆ—è¡¨å˜ä¸º [1,2]` | ç©ºåˆ—è¡¨è°ƒç”¨ä¼šæŠ› `IndexError` | | `clear()` | åˆ é™¤åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ ï¼Œå¾—åˆ°ç©ºåˆ—è¡¨ | `lst.clear()` | `lst=[1,2]; lst.clear() # []` | ç­‰ä»·äº `del lst[:]` | | `index(x, start=0, end=len(lst))` | è¿”å›å€¼ç­‰äº `x` çš„**ç¬¬ä¸€ä¸ª**å…ƒç´ çš„ç´¢å¼•ï¼Œå¯é€‰æœç´¢åŒºé—´ | `pos = lst.index(item, start, end)` | `lst=[1,2,3]; lst.index(2) # 1` | è‹¥ä¸å­˜åœ¨æŠ› `ValueError` | | `count(x)` | ç»Ÿè®¡åˆ—è¡¨ä¸­å€¼ç­‰äº `x` çš„å…ƒç´ ä¸ªæ•° | `n = lst.count(item)` | `lst=[1,2,2,3]; lst.count(2) # 2` | O(n) | | `sort(key=None, reverse=False)` | åŸåœ°æ’åºï¼Œè¿”å› `None` | `lst.sort(key=func, reverse=True)` | `lst=[3,1,2]; lst.sort() # [1,2,3]` | **æ³¨æ„**ï¼š`list.sort()` **ä¼šä¿®æ”¹åŸåˆ—è¡¨**ï¼Œè‹¥éœ€è¦ä¿ç•™åŸåˆ—è¡¨è¯·ä½¿ç”¨ `sorted(lst)` | | `reverse()` | åŸåœ°ç¿»è½¬åˆ—è¡¨é¡ºåº | `lst.reverse()` | `lst=[1,2,3]; lst.reverse() # [3,2,1]` | åŒæ ·è¿”å› `None`ï¼Œä¸ç”Ÿæˆæ–°åˆ—è¡¨ | | `copy()` | è¿”å›åˆ—è¡¨çš„**æµ…æ‹·è´**ï¼ˆç­‰ä»·äº `lst[:]`ï¼‰ | `new_lst = lst.copy()` | `a=[1,2]; b=a.copy(); b.append(3) # a=[1,2], b=[1,2,3]` | è‹¥åˆ—è¡¨å†…éƒ¨è¿˜æœ‰å¯å˜å¯¹è±¡ï¼Œéœ€è¦ `copy.deepcopy` | | `__len__()` / `len(lst)` | è¿”å›åˆ—è¡¨é•¿åº¦ | `n = len(lst)` | `len([1,2,3]) # 3` | ä¸æ˜¯æ–¹æ³•ï¼Œä½†å¸¸ç”¨ | | `__getitem__(i)` / `lst[i]` | å–å…ƒç´ æˆ–åˆ‡ç‰‡ | `item = lst[i]` | `lst=[1,2,3]; lst[0] # 1` | æ”¯æŒè´Ÿç´¢å¼•ã€æ­¥é•¿åˆ‡ç‰‡ | | `__setitem__(i, x)` / `lst[i] = x` | æ›¿æ¢æŒ‡å®šä½ç½®çš„å…ƒç´  | `lst[i] = val` | `lst[1]=9 # [1,9,3]` | åŒæ ·æ”¯æŒåˆ‡ç‰‡èµ‹å€¼ `lst[1:3]=[8,8]` | | `__delitem__(i)` / `del lst[i]` | åˆ é™¤æŒ‡å®šä½ç½®æˆ–åˆ‡ç‰‡ | `del lst[i]` | `del lst[0] # åˆ é™¤é¦–å…ƒç´ ` | | | `__contains__(x)` / `x in lst` | åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨åˆ—è¡¨ä¸­ | `x in lst` | `2 in [1,2,3] # True` | O(n) çº¿æ€§æœç´¢ | | `__iter__()` / `for x in lst:` | è¿­ä»£åˆ—è¡¨ | `for v in lst: ...` | `for v in [1,2]: print(v)` | | --- ## ğŸ›  å¸¸è§å®ç”¨æŠ€å·§ ### 1ï¸âƒ£ åˆ—è¡¨æ¨å¯¼å¼ï¼ˆList Comprehensionï¼‰ **è¯­æ³•**ï¼š`[expr for item in iterable if condition]` ```python # 1~10 çš„å¹³æ–¹ï¼Œåªä¿ç•™å¶æ•° evens_sq = [x**2 for x in range(1, 11) if x % 2 == 0] # è¾“å‡º: [4, 16, 36, 64, 100] ``` ### 2ï¸âƒ£ åˆ—è¡¨åˆ‡ç‰‡ï¼ˆSliceï¼‰ ```python lst = list(range(10)) # [0,1,2,3,4,5,6,7,8,9] # å‰ 5 é¡¹ first5 = lst[:5] # [0,1,2,3,4] # ä»ç¬¬ 3 é¡¹å¼€å§‹åˆ°å€’æ•°ç¬¬ 2 é¡¹ mid = lst[2:-1] # [2,3,4,5,6,7,8] # æ­¥é•¿ 2ï¼ˆå–å¶æ•°ç´¢å¼•ï¼‰ step2 = lst[::2] # [0,2,4,6,8] # é€†åº rev = lst[::-1] # [9,8,7,6,5,4,3,2,1,0] ``` ### 3ï¸âƒ£ â€œå»é‡ + ä¿æŒé¡ºåºâ€ ```python def uniq_keep_order(seq): seen = set() return [x for x in seq if not (x in seen or seen.add(x))] print(uniq_keep_order([1,2,2,3,1,4])) # [1,2,3,4] ``` ### 4ï¸âƒ£ ç”¨ `list.extend` æ›¿ä»£ `+=`ï¼ˆå¯è¯»æ€§æ›´å¥½ï¼‰ ```python a = [1, 2] b = [3, 4] a.extend(b) # a -> [1,2,3,4] # a += b ä¹Ÿè¡Œï¼Œä½†åœ¨é˜…è¯»æ—¶ä¸æ˜“ç«‹å³çœ‹å‡ºæ˜¯â€œæ‰©å±•â€è€Œéâ€œé‡æ–°èµ‹å€¼â€ ``` ### 5ï¸âƒ£ å¿«é€Ÿç”Ÿæˆå›ºå®šå€¼åˆ—è¡¨ ```python zeros = [0] * 10 # [0,0,0,0,0,0,0,0,0,0] ones = [1] * 5 # [1,1,1,1,1] ``` > âš ï¸ **æ³¨æ„**ï¼šå¦‚æœåˆ—è¡¨å†…éƒ¨çš„å…ƒç´ æ˜¯ **å¯å˜å¯¹è±¡**ï¼Œ`[obj] * n` ä¼šåˆ›å»º *n* ä¸ªå¯¹åŒä¸€å¯¹è±¡çš„å¼•ç”¨ï¼Œä¿®æ”¹å…¶ä¸­ä¸€ä¸ªä¼šå½±å“å…¨éƒ¨ã€‚ä¾‹å¦‚ï¼š ```python inner = [0] lst = [inner] * 3 # ä¸‰ä¸ªå…ƒç´ æŒ‡å‘åŒä¸€ä¸ªåˆ—è¡¨ lst[0].append(1) # æ‰€æœ‰å­åˆ—è¡¨éƒ½ä¼šå˜æˆ [0,1] ``` ### 6ï¸âƒ£ â€œç¿»è½¬ + è¿‡æ»¤â€ å¸¸ç”¨ç»„åˆ ```python # å–å€’æ•°ç¬¬ 2 åˆ°ç¬¬ 5ï¼ˆå€’åºï¼‰ä¸”å¤§äº 10 çš„å…ƒç´  result = [x for x in lst[-5:-1][::-1] if x > 10] ``` --- ## ğŸ“¦ ä¸å…¶ä»–å®¹å™¨çš„å¯¹æ¯” | å®¹å™¨ | æ˜¯å¦æœ‰åº | æ˜¯å¦å¯å˜ | å…³é”®ç‰¹æ€§ | é€‚ç”¨åœºæ™¯ | |------|----------|----------|----------|----------| | `list` | âœ… | âœ… | æ”¯æŒéšæœºè®¿é—®ã€åˆ‡ç‰‡ã€å¿«é€Ÿè¿½åŠ  | éœ€è¦é¡ºåºå­˜å‚¨ã€é¢‘ç¹éå†ã€å¶å°”æ’å…¥/åˆ é™¤ | | `tuple` | âœ… | âŒ | ä¸å¯å˜ï¼Œå“ˆå¸Œå¯ç”¨ä½œå­—å…¸é”® | å¸¸é‡åºåˆ—ã€å‡½æ•°è¿”å›å¤šå€¼ | | `set` | âŒ | âœ… | å»é‡ã€é›†åˆè¿ç®— O(1) æŸ¥æ‰¾ | å»é‡ã€æˆå‘˜æ£€æµ‹ã€æ•°å­¦é›†åˆæ“ä½œ | | `dict` | âœ… (Pythonâ€¯3.7+) | âœ… | é”®å€¼æ˜ å°„ï¼Œé”®å”¯ä¸€ | å¿«é€ŸæŸ¥æ‰¾ã€å…³è”æ•°æ® | --- ## ğŸ§© å°ç»ƒä¹ ï¼ˆè‡ªæµ‹ï¼‰ > ç”¨ä¸‹é¢çš„åˆ—è¡¨å®Œæˆ **æ‰€æœ‰** æ³¨é‡Šä¸­çš„ä»»åŠ¡ï¼Œå°½é‡åªä½¿ç”¨åˆ—è¡¨è‡ªå¸¦çš„æ–¹æ³•ï¼ˆä¸è¦å¯¼å…¥é¢å¤–æ¨¡å—ï¼‰ã€‚ ```python data = [5, 2, 9, 2, 7, 5, 1, 3] # 1. åˆ é™¤ç¬¬ä¸€ä¸ªå‡ºç°çš„ 2 # 2. åœ¨æœ«å°¾è¿½åŠ  10 # 3. æŠŠ 7 æ›¿æ¢æˆ 8 # 4. æŠŠåˆ—è¡¨å€’åº # 5. ç»Ÿè®¡ 5 å‡ºç°äº†å‡ æ¬¡ # 6. ç”Ÿæˆä¸€ä¸ªæ–°åˆ—è¡¨ï¼Œåªä¿ç•™å¥‡æ•°ä¸”å»é‡ï¼Œä¿æŒåŸé¡ºåº ``` **å‚è€ƒç­”æ¡ˆï¼ˆä»…ä¾›æ£€éªŒï¼‰** ```python # 1 data.remove(2) # 2 data.append(10) # 3 idx = data.index(7) data[idx] = 8 # 4 data.reverse() # 5 cnt_five = data.count(5) # 6 def uniq_keep_order(seq): seen = set() return [x for x in seq if not (x in seen or seen.add(x))] odd_unique = uniq_keep_order([x for x in data if x % 2 == 1]) print(odd_unique) # ç¤ºä¾‹è¾“å‡º: [5, 9, 1, 3] ``` --- ## ğŸ“š æ¨èé˜…è¯» & è¿›é˜¶ 1. **å®˜æ–¹æ–‡æ¡£** â€“ `list` ç« èŠ‚ï¼šhttps://docs.python.org/3/tutorial/datastructures.html#more-on-lists 2. **PEP 8** â€“ ä»£ç é£æ ¼æŒ‡å—ï¼Œä¿æŒåˆ—è¡¨æ“ä½œçš„å¯è¯»æ€§ã€‚ 3. **ã€ŠEffective Pythonã€‹**ï¼ˆç¬¬äºŒç‰ˆï¼‰â€“ ç¬¬ 12 æ¡ â€œPrefer list comprehensions over map and filterâ€ã€‚ 4. **`itertools`** â€“ å½“åˆ—è¡¨æ“ä½œå˜å¾—æ›´å¤æ‚ï¼ˆå¦‚æ— é™è¿­ä»£ã€ç¬›å¡å°”ç§¯ï¼‰æ—¶ï¼Œç”¨å®ƒå¯ä»¥å†™å‡ºæ›´é«˜æ•ˆã€æ›´ç®€æ´çš„ä»£ç ã€‚ > åªè¦ç†Ÿç»ƒæŒæ¡ä¸Šè¡¨çš„è¿™äº›æ–¹æ³•ï¼Œä½ å°±èƒ½åœ¨æ—¥å¸¸å¼€å‘ã€æ•°æ®æ¸…æ´—ã€ç®—æ³•å®ç°ç­‰åœºæ™¯ä¸­è‡ªå¦‚åœ°ä½¿ç”¨ Python åˆ—è¡¨äº†ã€‚ç¥ç¼–ç æ„‰å¿« ğŸš€
è¡¨æ ¼è½¬æ¢ä¸ºå¯ä»¥notionç›´æ¥å¤åˆ¶çš„

profile
gpt-oss:120b
æ€è€ƒç”¨æ—¶ 2 ç§’
ä¸‹é¢çš„æ‰€æœ‰è¡¨æ ¼å‡é‡‡ç”¨ Markdown è¡¨æ ¼è¯­æ³•ï¼ˆ| åˆ†å‰²ã€--- åˆ†éš”æ ‡é¢˜ï¼‰ï¼Œç›´æ¥ å¤åˆ¶ç²˜è´´ åˆ° Notion é¡µé¢åï¼ŒNotion ä¼šè‡ªåŠ¨æ¸²æŸ“ä¸ºå¯ç¼–è¾‘çš„è¡¨æ ¼ã€‚

1ï¸âƒ£ list å¸¸ç”¨æ–¹æ³•é€ŸæŸ¥è¡¨
æ–¹æ³•
åŠŸèƒ½
å¸¸ç”¨è¯­æ³•
ç¤ºä¾‹
å¤‡æ³¨ / å¸¸è§å‘
append(x)	
åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å•ä¸ªå…ƒç´  x	
lst.append(item)	
lst=[1,2]; lst.append(3) # [1,2,3]	
O(1) æ—¶é—´å¤æ‚åº¦
extend(iterable)	
ç”¨å¯è¿­ä»£å¯¹è±¡çš„æ¯ä¸ªå…ƒç´ æ‰©å±•åˆ—è¡¨	
lst.extend(other)	
lst=[1]; lst.extend([2,3]) # [1,2,3]	
ç­‰ä»·äº lst += otherï¼Œä¸è¦å†™æˆ lst.append(other)ï¼ˆä¼šæŠŠæ•´ä¸ªå¯¹è±¡å½“æˆä¸€ä¸ªå…ƒç´ ï¼‰
insert(i, x)	
åœ¨ç´¢å¼• i ä½ç½®æ’å…¥å…ƒç´  xï¼Œåé¢çš„å…ƒç´ å³ç§»	
lst.insert(idx, item)	
lst=[1,3]; lst.insert(1,2) # [1,2,3]	
è´Ÿç´¢å¼•åŒæ ·æœ‰æ•ˆï¼›O(n) å¤æ‚åº¦
remove(x)	
åˆ é™¤åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªå€¼ç­‰äº x çš„å…ƒç´ 	
lst.remove(item)	
lst=[1,2,2,3]; lst.remove(2) # [1,2,3]	
è‹¥ä¸å­˜åœ¨æŠ› ValueError
pop([i])	
åˆ é™¤å¹¶è¿”å›ç´¢å¼• i å¤„çš„å…ƒç´ ï¼Œé»˜è®¤ i=-1ï¼ˆå¼¹å‡ºæœ«å°¾ï¼‰	
item = lst.pop(idx)	
lst=[1,2,3]; lst.pop() # è¿”å› 3ï¼Œåˆ—è¡¨å˜ä¸º [1,2]	
ç©ºåˆ—è¡¨è°ƒç”¨ä¼šæŠ› IndexError
clear()	
åˆ é™¤åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ ï¼Œå¾—åˆ°ç©ºåˆ—è¡¨	
lst.clear()	
lst=[1,2]; lst.clear() # []	
ç­‰ä»·äº del lst[:]
index(x, start=0, end=len(lst))	
è¿”å›å€¼ç­‰äº x çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ï¼Œå¯é€‰æœç´¢åŒºé—´	
pos = lst.index(item, start, end)	
lst=[1,2,3]; lst.index(2) # 1	
è‹¥ä¸å­˜åœ¨æŠ› ValueError
count(x)	
ç»Ÿè®¡åˆ—è¡¨ä¸­å€¼ç­‰äº x çš„å…ƒç´ ä¸ªæ•°	
n = lst.count(item)	
lst=[1,2,2,3]; lst.count(2) # 2	
O(n)
sort(key=None, reverse=False)	
åŸåœ°æ’åºï¼Œè¿”å› None	
lst.sort(key=func, reverse=True)	
lst=[3,1,2]; lst.sort() # [1,2,3]	
æ³¨æ„ï¼šlist.sort() ä¼šä¿®æ”¹åŸåˆ—è¡¨ï¼Œè‹¥éœ€è¦ä¿ç•™åŸåˆ—è¡¨è¯·ä½¿ç”¨ sorted(lst)
reverse()	
åŸåœ°ç¿»è½¬åˆ—è¡¨é¡ºåº	
lst.reverse()	
lst=[1,2,3]; lst.reverse() # [3,2,1]	
åŒæ ·è¿”å› Noneï¼Œä¸ç”Ÿæˆæ–°åˆ—è¡¨
copy()	
è¿”å›åˆ—è¡¨çš„æµ…æ‹·è´ï¼ˆç­‰ä»·äº lst[:]ï¼‰	
new_lst = lst.copy()	
a=[1,2]; b=a.copy(); b.append(3) # a=[1,2], b=[1,2,3]	
è‹¥åˆ—è¡¨å†…éƒ¨è¿˜æœ‰å¯å˜å¯¹è±¡ï¼Œéœ€è¦ copy.deepcopy
len(lst)	
è¿”å›åˆ—è¡¨é•¿åº¦ï¼ˆä¸æ˜¯æ–¹æ³•ï¼‰	
n = len(lst)	
len([1,2,3]) # 3	
lst[i] / lst[i:j:k]	
å–å…ƒç´ æˆ–åˆ‡ç‰‡	
item = lst[i]	
lst=[1,2,3]; lst[0] # 1	
æ”¯æŒè´Ÿç´¢å¼•ã€æ­¥é•¿åˆ‡ç‰‡
lst[i] = x	
æ›¿æ¢æŒ‡å®šä½ç½®çš„å…ƒç´ 	
lst[i] = val	
lst[1]=9 # [1,9,3]	
åŒæ ·æ”¯æŒåˆ‡ç‰‡èµ‹å€¼ lst[1:3]=[8,8]
del lst[i]	
åˆ é™¤æŒ‡å®šä½ç½®æˆ–åˆ‡ç‰‡	
del lst[i]	
del lst[0] # åˆ é™¤é¦–å…ƒç´ 	
x in lst	
åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨åˆ—è¡¨ä¸­	
x in lst	
2 in [1,2,3] # True	
O(n) çº¿æ€§æœç´¢
for x in lst:	
è¿­ä»£åˆ—è¡¨	
for v in lst: ...	
for v in [1,2]: print(v)	
list(iterable)	
å°†å¯è¿­ä»£å¯¹è±¡è½¬æ¢ä¸ºåˆ—è¡¨	
lst = list(some_iterable)	
list('abc') # ['a','b','c']	
2ï¸âƒ£ å¸¸ç”¨å®ç”¨æŠ€å·§ï¼ˆä»£ç å—ä¿æŒåŸæ ·ï¼‰
åˆ—è¡¨æ¨å¯¼å¼
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
# 1~10 çš„å¹³æ–¹ï¼Œåªä¿ç•™å¶æ•°
evens_sq = [x**2 for x in range(1, 11) if x % 2 == 0]
# -> [4, 16, 36, 64, 100]
åˆ—è¡¨åˆ‡ç‰‡
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
lst = list(range(10))   # [0,1,2,3,4,5,6,7,8,9]

first5 = lst[:5]        # [0,1,2,3,4]
mid    = lst[2:-1]      # [2,3,4,5,6,7,8]
step2  = lst[::2]       # [0,2,4,6,8]
rev    = lst[::-1]      # [9,8,7,6,5,4,3,2,1,0]
å»é‡å¹¶ä¿æŒé¡ºåº
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
âŒ„
def uniq_keep_order(seq):
    seen = set()
    return [x for x in seq if not (x in seen or seen.add(x))]

print(uniq_keep_order([1,2,2,3,1,4]))  # [1,2,3,4]
ç”¨ extend æ›¿ä»£ +=
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
a = [1, 2]
b = [3, 4]
a.extend(b)   # a -> [1,2,3,4]
# a += b  ä¹Ÿè¡Œï¼Œä½†é˜…è¯»æ—¶ä¸æ˜“ç«‹å³çœ‹å‡ºæ˜¯â€œæ‰©å±•â€
å¿«é€Ÿç”Ÿæˆå›ºå®šå€¼åˆ—è¡¨
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
zeros = [0] * 10          # [0,0,0,0,0,0,0,0,0,0]
ones  = [1] * 5           # [1,1,1,1,1]
âš ï¸ æ³¨æ„ï¼šå¦‚æœåˆ—è¡¨å†…éƒ¨çš„å…ƒç´ æ˜¯å¯å˜å¯¹è±¡ï¼Œ[obj] * n ä¼šåˆ›å»º n ä¸ªå¯¹åŒä¸€å¯¹è±¡çš„å¼•ç”¨ï¼Œä¿®æ”¹å…¶ä¸­ä¸€ä¸ªä¼šå½±å“å…¨éƒ¨ã€‚ä¾‹å¦‚ï¼š 

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
inner = [0]
lst   = [inner] * 3   # ä¸‰ä¸ªå…ƒç´ æŒ‡å‘åŒä¸€ä¸ªåˆ—è¡¨
lst[0].append(1)      # æ‰€æœ‰å­åˆ—è¡¨éƒ½ä¼šå˜æˆ [0,1]
â€œç¿»è½¬ + è¿‡æ»¤â€ ç»„åˆ
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
# å–å€’æ•°ç¬¬ 2~ç¬¬ 5ï¼ˆå€’åºï¼‰ä¸”å¤§äº 10 çš„å…ƒç´ 
result = [x for x in lst[-5:-1][::-1] if x > 10]
3ï¸âƒ£ ä¸å…¶ä»–å®¹å™¨çš„å¯¹æ¯”è¡¨
å®¹å™¨
æ˜¯å¦æœ‰åº
æ˜¯å¦å¯å˜
å…³é”®ç‰¹æ€§
é€‚ç”¨åœºæ™¯
list	
âœ…	
âœ…	
æ”¯æŒéšæœºè®¿é—®ã€åˆ‡ç‰‡ã€å¿«é€Ÿè¿½åŠ 	
éœ€è¦é¡ºåºå­˜å‚¨ã€é¢‘ç¹éå†ã€å¶å°”æ’å…¥/åˆ é™¤
tuple	
âœ…	
âŒ	
ä¸å¯å˜ï¼Œå“ˆå¸Œå¯ç”¨ä½œå­—å…¸é”®	
å¸¸é‡åºåˆ—ã€å‡½æ•°è¿”å›å¤šå€¼
set	
âŒ	
âœ…	
å»é‡ã€é›†åˆè¿ç®— O(1) æŸ¥æ‰¾	
å»é‡ã€æˆå‘˜æ£€æµ‹ã€æ•°å­¦é›†åˆæ“ä½œ
dict	
âœ… (Pythonâ€¯3.7+)	
âœ…	
é”®å€¼æ˜ å°„ï¼Œé”®å”¯ä¸€	
å¿«é€ŸæŸ¥æ‰¾ã€å…³è”æ•°æ®
4ï¸âƒ£ å°ç»ƒä¹ ï¼ˆè‡ªæµ‹ï¼‰
ç”¨ä¸‹é¢çš„åˆ—è¡¨å®Œæˆ æ‰€æœ‰ æ³¨é‡Šä¸­çš„ä»»åŠ¡ï¼Œå°½é‡åªä½¿ç”¨åˆ—è¡¨è‡ªå¸¦çš„æ–¹æ³•ï¼ˆä¸è¦å¯¼å…¥é¢å¤–æ¨¡å—ï¼‰ã€‚ 

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
data = [5, 2, 9, 2, 7, 5, 1, 3]

# 1. åˆ é™¤ç¬¬ä¸€ä¸ªå‡ºç°çš„ 2
# 2. åœ¨æœ«å°¾è¿½åŠ  10
# 3. æŠŠ 7 æ›¿æ¢æˆ 8
# 4. æŠŠåˆ—è¡¨å€’åº
# 5. ç»Ÿè®¡ 5 å‡ºç°äº†å‡ æ¬¡
# 6. ç”Ÿæˆä¸€ä¸ªæ–°åˆ—è¡¨ï¼Œåªä¿ç•™å¥‡æ•°ä¸”å»é‡ï¼Œä¿æŒåŸé¡ºåº
å‚è€ƒç­”æ¡ˆï¼ˆä»…ä¾›æ£€éªŒï¼‰

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
âŒ„
# 1
data.remove(2)

# 2
data.append(10)

# 3
idx = data.index(7)
data[idx] = 8

# 4
data.reverse()

# 5
cnt_five = data.count(5)

# 6
def uniq_keep_order(seq):
    seen = set()
    return [x for x in seq if not (x in seen or seen.add(x))]

odd_unique = uniq_keep_order([x for x in data if x % 2 == 1])
print(odd_unique)   # ç¤ºä¾‹è¾“å‡º: [5, 9, 1, 3]
5ï¸âƒ£ ä¸å…¶ä»–å®¹å™¨çš„å¯¹æ¯”ï¼ˆMarkdown è¡¨æ ¼ï¼‰
å®¹å™¨
æ˜¯å¦æœ‰åº
æ˜¯å¦å¯å˜
å…³é”®ç‰¹æ€§
é€‚ç”¨åœºæ™¯
list	
âœ…	
âœ…	
æ”¯æŒéšæœºè®¿é—®ã€åˆ‡ç‰‡ã€å¿«é€Ÿè¿½åŠ 	
éœ€è¦é¡ºåºå­˜å‚¨ã€é¢‘ç¹éå†ã€å¶å°”æ’å…¥/åˆ é™¤
tuple	
âœ…	
âŒ	
ä¸å¯å˜ï¼Œå“ˆå¸Œå¯ç”¨ä½œå­—å…¸é”®	
å¸¸é‡åºåˆ—ã€å‡½æ•°è¿”å›å¤šå€¼
set	
âŒ	
âœ…	
å»é‡ã€é›†åˆè¿ç®— O(1) æŸ¥æ‰¾	
å»é‡ã€æˆå‘˜æ£€æµ‹ã€æ•°å­¦é›†åˆæ“ä½œ
dict	
âœ… (Pythonâ€¯3.7+)	
âœ…	
é”®å€¼æ˜ å°„ï¼Œé”®å”¯ä¸€	
å¿«é€ŸæŸ¥æ‰¾ã€å…³è”æ•°æ®
6ï¸âƒ£ æ¨èé˜…è¯» & è¿›é˜¶ï¼ˆå¯ç›´æ¥å¤åˆ¶åˆ° Notionï¼‰
ç¼–å·
èµ„æº
é“¾æ¥
1	
å®˜æ–¹æ–‡æ¡£ â€“ list ç« èŠ‚	
https://docs.python.org/3/tutorial/datastructures.html#more-on-lists
2	
PEP 8 â€“ ä»£ç é£æ ¼æŒ‡å—	
https://peps.python.org/pep-0008/
3	
ã€ŠEffective Pythonã€‹â€‘ ç¬¬ 12 æ¡ â€œPrefer list comprehensions over map and filterâ€	
https://effectivepython.com/
4	
itertools â€“ é«˜çº§è¿­ä»£å·¥å…·	
https://docs.python.org/3/library/itertools.html
ä½¿ç”¨æ–¹æ³•

é€‰ä¸­éœ€è¦çš„è¡¨æ ¼ï¼ˆåŒ…æ‹¬æ ‡é¢˜è¡Œå’Œåˆ†éš”è¡Œ ---ï¼‰ï¼ŒCtrlâ€¯+C å¤åˆ¶ã€‚
åœ¨ Notion é¡µé¢ç©ºç™½å¤„ Ctrlâ€¯+â€¯V ç²˜è´´ã€‚
Notion ä¼šè‡ªåŠ¨æŠŠ Markdown è¡¨æ ¼è½¬ä¸º Notion åŸç”Ÿçš„è¡¨æ ¼å—ï¼Œä½ å¯ä»¥ç›´æ¥ç¼–è¾‘ã€æ·»åŠ æˆ–åˆ é™¤è¡Œ/åˆ—ã€‚
ç¥ä½ åœ¨ Notion ä¸­ä½¿ç”¨è¿™äº›è¡¨æ ¼é¡ºæ‰‹é«˜æ•ˆ ğŸš€ï¼

<details type="reasoning" done="true" duration="2"> <summary>Thought for 2 seconds</summary> > User wants the table (the previous answer) converted into a format that can be directly copied into Notion. Notion supports markdown tables, but with pipe syntax. Notion can paste markdown tables and will convert. So need to output tables in markdown format. The previous answer contains several tables. Need to ensure they are plain markdown (with headers). Provide the tables separately. Also need to maybe keep code blocks. So produce markdown tables that can be copied-pasted into Notion. Provide all tables: list methods, comparison table, etc. Ensure no extra formatting that breaks Notion. Probably just plain markdown. > > Let's produce final answer with markdown tables. </details> ä¸‹é¢çš„æ‰€æœ‰è¡¨æ ¼å‡é‡‡ç”¨ **Markdown è¡¨æ ¼è¯­æ³•**ï¼ˆ`|` åˆ†å‰²ã€`---` åˆ†éš”æ ‡é¢˜ï¼‰ï¼Œç›´æ¥ **å¤åˆ¶ç²˜è´´** åˆ° Notion é¡µé¢åï¼ŒNotion ä¼šè‡ªåŠ¨æ¸²æŸ“ä¸ºå¯ç¼–è¾‘çš„è¡¨æ ¼ã€‚ --- ## 1ï¸âƒ£ `list` å¸¸ç”¨æ–¹æ³•é€ŸæŸ¥è¡¨ | æ–¹æ³• | åŠŸèƒ½ | å¸¸ç”¨è¯­æ³• | ç¤ºä¾‹ | å¤‡æ³¨ / å¸¸è§å‘ | |------|------|----------|------|--------------| | `append(x)` | åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å•ä¸ªå…ƒç´  `x` | `lst.append(item)` | `lst=[1,2]; lst.append(3) # [1,2,3]` | O(1) æ—¶é—´å¤æ‚åº¦ | | `extend(iterable)` | ç”¨å¯è¿­ä»£å¯¹è±¡çš„æ¯ä¸ªå…ƒç´ æ‰©å±•åˆ—è¡¨ | `lst.extend(other)` | `lst=[1]; lst.extend([2,3]) # [1,2,3]` | ç­‰ä»·äº `lst += other`ï¼Œ**ä¸è¦**å†™æˆ `lst.append(other)`ï¼ˆä¼šæŠŠæ•´ä¸ªå¯¹è±¡å½“æˆä¸€ä¸ªå…ƒç´ ï¼‰ | | `insert(i, x)` | åœ¨ç´¢å¼• `i` ä½ç½®æ’å…¥å…ƒç´  `x`ï¼Œåé¢çš„å…ƒç´ å³ç§» | `lst.insert(idx, item)` | `lst=[1,3]; lst.insert(1,2) # [1,2,3]` | è´Ÿç´¢å¼•åŒæ ·æœ‰æ•ˆï¼›O(n) å¤æ‚åº¦ | | `remove(x)` | åˆ é™¤åˆ—è¡¨ä¸­**ç¬¬ä¸€ä¸ª**å€¼ç­‰äº `x` çš„å…ƒç´  | `lst.remove(item)` | `lst=[1,2,2,3]; lst.remove(2) # [1,2,3]` | è‹¥ä¸å­˜åœ¨æŠ› `ValueError` | | `pop([i])` | åˆ é™¤å¹¶è¿”å›ç´¢å¼• `i` å¤„çš„å…ƒç´ ï¼Œé»˜è®¤ `i=-1`ï¼ˆå¼¹å‡ºæœ«å°¾ï¼‰ | `item = lst.pop(idx)` | `lst=[1,2,3]; lst.pop() # è¿”å› 3ï¼Œåˆ—è¡¨å˜ä¸º [1,2]` | ç©ºåˆ—è¡¨è°ƒç”¨ä¼šæŠ› `IndexError` | | `clear()` | åˆ é™¤åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ ï¼Œå¾—åˆ°ç©ºåˆ—è¡¨ | `lst.clear()` | `lst=[1,2]; lst.clear() # []` | ç­‰ä»·äº `del lst[:]` | | `index(x, start=0, end=len(lst))` | è¿”å›å€¼ç­‰äº `x` çš„**ç¬¬ä¸€ä¸ª**å…ƒç´ çš„ç´¢å¼•ï¼Œå¯é€‰æœç´¢åŒºé—´ | `pos = lst.index(item, start, end)` | `lst=[1,2,3]; lst.index(2) # 1` | è‹¥ä¸å­˜åœ¨æŠ› `ValueError` | | `count(x)` | ç»Ÿè®¡åˆ—è¡¨ä¸­å€¼ç­‰äº `x` çš„å…ƒç´ ä¸ªæ•° | `n = lst.count(item)` | `lst=[1,2,2,3]; lst.count(2) # 2` | O(n) | | `sort(key=None, reverse=False)` | åŸåœ°æ’åºï¼Œè¿”å› `None` | `lst.sort(key=func, reverse=True)` | `lst=[3,1,2]; lst.sort() # [1,2,3]` | **æ³¨æ„**ï¼š`list.sort()` **ä¼šä¿®æ”¹åŸåˆ—è¡¨**ï¼Œè‹¥éœ€è¦ä¿ç•™åŸåˆ—è¡¨è¯·ä½¿ç”¨ `sorted(lst)` | | `reverse()` | åŸåœ°ç¿»è½¬åˆ—è¡¨é¡ºåº | `lst.reverse()` | `lst=[1,2,3]; lst.reverse() # [3,2,1]` | åŒæ ·è¿”å› `None`ï¼Œä¸ç”Ÿæˆæ–°åˆ—è¡¨ | | `copy()` | è¿”å›åˆ—è¡¨çš„**æµ…æ‹·è´**ï¼ˆç­‰ä»·äº `lst[:]`ï¼‰ | `new_lst = lst.copy()` | `a=[1,2]; b=a.copy(); b.append(3) # a=[1,2], b=[1,2,3]` | è‹¥åˆ—è¡¨å†…éƒ¨è¿˜æœ‰å¯å˜å¯¹è±¡ï¼Œéœ€è¦ `copy.deepcopy` | | `len(lst)` | è¿”å›åˆ—è¡¨é•¿åº¦ï¼ˆä¸æ˜¯æ–¹æ³•ï¼‰ | `n = len(lst)` | `len([1,2,3]) # 3` | | | `lst[i]` / `lst[i:j:k]` | å–å…ƒç´ æˆ–åˆ‡ç‰‡ | `item = lst[i]` | `lst=[1,2,3]; lst[0] # 1` | æ”¯æŒè´Ÿç´¢å¼•ã€æ­¥é•¿åˆ‡ç‰‡ | | `lst[i] = x` | æ›¿æ¢æŒ‡å®šä½ç½®çš„å…ƒç´  | `lst[i] = val` | `lst[1]=9 # [1,9,3]` | åŒæ ·æ”¯æŒåˆ‡ç‰‡èµ‹å€¼ `lst[1:3]=[8,8]` | | `del lst[i]` | åˆ é™¤æŒ‡å®šä½ç½®æˆ–åˆ‡ç‰‡ | `del lst[i]` | `del lst[0] # åˆ é™¤é¦–å…ƒç´ ` | | | `x in lst` | åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨åˆ—è¡¨ä¸­ | `x in lst` | `2 in [1,2,3] # True` | O(n) çº¿æ€§æœç´¢ | | `for x in lst:` | è¿­ä»£åˆ—è¡¨ | `for v in lst: ...` | `for v in [1,2]: print(v)` | | | `list(iterable)` | å°†å¯è¿­ä»£å¯¹è±¡è½¬æ¢ä¸ºåˆ—è¡¨ | `lst = list(some_iterable)` | `list('abc') # ['a','b','c']` | | --- ## 2ï¸âƒ£ å¸¸ç”¨å®ç”¨æŠ€å·§ï¼ˆä»£ç å—ä¿æŒåŸæ ·ï¼‰ ### åˆ—è¡¨æ¨å¯¼å¼ ```python # 1~10 çš„å¹³æ–¹ï¼Œåªä¿ç•™å¶æ•° evens_sq = [x**2 for x in range(1, 11) if x % 2 == 0] # -> [4, 16, 36, 64, 100] ``` ### åˆ—è¡¨åˆ‡ç‰‡ ```python lst = list(range(10)) # [0,1,2,3,4,5,6,7,8,9] first5 = lst[:5] # [0,1,2,3,4] mid = lst[2:-1] # [2,3,4,5,6,7,8] step2 = lst[::2] # [0,2,4,6,8] rev = lst[::-1] # [9,8,7,6,5,4,3,2,1,0] ``` ### å»é‡å¹¶ä¿æŒé¡ºåº ```python def uniq_keep_order(seq): seen = set() return [x for x in seq if not (x in seen or seen.add(x))] print(uniq_keep_order([1,2,2,3,1,4])) # [1,2,3,4] ``` ### ç”¨ `extend` æ›¿ä»£ `+=` ```python a = [1, 2] b = [3, 4] a.extend(b) # a -> [1,2,3,4] # a += b ä¹Ÿè¡Œï¼Œä½†é˜…è¯»æ—¶ä¸æ˜“ç«‹å³çœ‹å‡ºæ˜¯â€œæ‰©å±•â€ ``` ### å¿«é€Ÿç”Ÿæˆå›ºå®šå€¼åˆ—è¡¨ ```python zeros = [0] * 10 # [0,0,0,0,0,0,0,0,0,0] ones = [1] * 5 # [1,1,1,1,1] ``` > âš ï¸ **æ³¨æ„**ï¼šå¦‚æœåˆ—è¡¨å†…éƒ¨çš„å…ƒç´ æ˜¯å¯å˜å¯¹è±¡ï¼Œ`[obj] * n` ä¼šåˆ›å»º *n* ä¸ªå¯¹åŒä¸€å¯¹è±¡çš„å¼•ç”¨ï¼Œä¿®æ”¹å…¶ä¸­ä¸€ä¸ªä¼šå½±å“å…¨éƒ¨ã€‚ä¾‹å¦‚ï¼š ```python inner = [0] lst = [inner] * 3 # ä¸‰ä¸ªå…ƒç´ æŒ‡å‘åŒä¸€ä¸ªåˆ—è¡¨ lst[0].append(1) # æ‰€æœ‰å­åˆ—è¡¨éƒ½ä¼šå˜æˆ [0,1] ``` ### â€œç¿»è½¬ + è¿‡æ»¤â€ ç»„åˆ ```python # å–å€’æ•°ç¬¬ 2~ç¬¬ 5ï¼ˆå€’åºï¼‰ä¸”å¤§äº 10 çš„å…ƒç´  result = [x for x in lst[-5:-1][::-1] if x > 10] ``` --- ## 3ï¸âƒ£ ä¸å…¶ä»–å®¹å™¨çš„å¯¹æ¯”è¡¨ | å®¹å™¨ | æ˜¯å¦æœ‰åº | æ˜¯å¦å¯å˜ | å…³é”®ç‰¹æ€§ | é€‚ç”¨åœºæ™¯ | |------|----------|----------|----------|----------| | `list` | âœ… | âœ… | æ”¯æŒéšæœºè®¿é—®ã€åˆ‡ç‰‡ã€å¿«é€Ÿè¿½åŠ  | éœ€è¦é¡ºåºå­˜å‚¨ã€é¢‘ç¹éå†ã€å¶å°”æ’å…¥/åˆ é™¤ | | `tuple` | âœ… | âŒ | ä¸å¯å˜ï¼Œå“ˆå¸Œå¯ç”¨ä½œå­—å…¸é”® | å¸¸é‡åºåˆ—ã€å‡½æ•°è¿”å›å¤šå€¼ | | `set` | âŒ | âœ… | å»é‡ã€é›†åˆè¿ç®— O(1) æŸ¥æ‰¾ | å»é‡ã€æˆå‘˜æ£€æµ‹ã€æ•°å­¦é›†åˆæ“ä½œ | | `dict` | âœ… (Pythonâ€¯3.7+) | âœ… | é”®å€¼æ˜ å°„ï¼Œé”®å”¯ä¸€ | å¿«é€ŸæŸ¥æ‰¾ã€å…³è”æ•°æ® | --- ## 4ï¸âƒ£ å°ç»ƒä¹ ï¼ˆè‡ªæµ‹ï¼‰ > ç”¨ä¸‹é¢çš„åˆ—è¡¨å®Œæˆ **æ‰€æœ‰** æ³¨é‡Šä¸­çš„ä»»åŠ¡ï¼Œå°½é‡åªä½¿ç”¨åˆ—è¡¨è‡ªå¸¦çš„æ–¹æ³•ï¼ˆä¸è¦å¯¼å…¥é¢å¤–æ¨¡å—ï¼‰ã€‚ ```python data = [5, 2, 9, 2, 7, 5, 1, 3] # 1. åˆ é™¤ç¬¬ä¸€ä¸ªå‡ºç°çš„ 2 # 2. åœ¨æœ«å°¾è¿½åŠ  10 # 3. æŠŠ 7 æ›¿æ¢æˆ 8 # 4. æŠŠåˆ—è¡¨å€’åº # 5. ç»Ÿè®¡ 5 å‡ºç°äº†å‡ æ¬¡ # 6. ç”Ÿæˆä¸€ä¸ªæ–°åˆ—è¡¨ï¼Œåªä¿ç•™å¥‡æ•°ä¸”å»é‡ï¼Œä¿æŒåŸé¡ºåº ``` **å‚è€ƒç­”æ¡ˆï¼ˆä»…ä¾›æ£€éªŒï¼‰** ```python # 1 data.remove(2) # 2 data.append(10) # 3 idx = data.index(7) data[idx] = 8 # 4 data.reverse() # 5 cnt_five = data.count(5) # 6 def uniq_keep_order(seq): seen = set() return [x for x in seq if not (x in seen or seen.add(x))] odd_unique = uniq_keep_order([x for x in data if x % 2 == 1]) print(odd_unique) # ç¤ºä¾‹è¾“å‡º: [5, 9, 1, 3] ``` --- ## 5ï¸âƒ£ ä¸å…¶ä»–å®¹å™¨çš„å¯¹æ¯”ï¼ˆMarkdown è¡¨æ ¼ï¼‰ | å®¹å™¨ | æ˜¯å¦æœ‰åº | æ˜¯å¦å¯å˜ | å…³é”®ç‰¹æ€§ | é€‚ç”¨åœºæ™¯ | |------|----------|----------|----------|----------| | `list` | âœ… | âœ… | æ”¯æŒéšæœºè®¿é—®ã€åˆ‡ç‰‡ã€å¿«é€Ÿè¿½åŠ  | éœ€è¦é¡ºåºå­˜å‚¨ã€é¢‘ç¹éå†ã€å¶å°”æ’å…¥/åˆ é™¤ | | `tuple` | âœ… | âŒ | ä¸å¯å˜ï¼Œå“ˆå¸Œå¯ç”¨ä½œå­—å…¸é”® | å¸¸é‡åºåˆ—ã€å‡½æ•°è¿”å›å¤šå€¼ | | `set` | âŒ | âœ… | å»é‡ã€é›†åˆè¿ç®— O(1) æŸ¥æ‰¾ | å»é‡ã€æˆå‘˜æ£€æµ‹ã€æ•°å­¦é›†åˆæ“ä½œ | | `dict` | âœ… (Pythonâ€¯3.7+) | âœ… | é”®å€¼æ˜ å°„ï¼Œé”®å”¯ä¸€ | å¿«é€ŸæŸ¥æ‰¾ã€å…³è”æ•°æ® | --- ## 6ï¸âƒ£ æ¨èé˜…è¯» & è¿›é˜¶ï¼ˆå¯ç›´æ¥å¤åˆ¶åˆ° Notionï¼‰ | ç¼–å· | èµ„æº | é“¾æ¥ | |------|------|------| | 1 | å®˜æ–¹æ–‡æ¡£ â€“ `list` ç« èŠ‚ | <https://docs.python.org/3/tutorial/datastructures.html#more-on-lists> | | 2 | PEP 8 â€“ ä»£ç é£æ ¼æŒ‡å— | <https://peps.python.org/pep-0008/> | | 3 | ã€ŠEffective Pythonã€‹â€‘ ç¬¬ 12 æ¡ â€œPrefer list comprehensions over map and filterâ€ | <https://effectivepython.com/> | | 4 | `itertools` â€“ é«˜çº§è¿­ä»£å·¥å…· | <https://docs.python.org/3/library/itertools.html> | --- **ä½¿ç”¨æ–¹æ³•** 1. é€‰ä¸­éœ€è¦çš„è¡¨æ ¼ï¼ˆåŒ…æ‹¬æ ‡é¢˜è¡Œå’Œåˆ†éš”è¡Œ `---`ï¼‰ï¼Œ**Ctrlâ€¯+C** å¤åˆ¶ã€‚ 2. åœ¨ Notion é¡µé¢ç©ºç™½å¤„ **Ctrlâ€¯+â€¯V** ç²˜è´´ã€‚ 3. Notion ä¼šè‡ªåŠ¨æŠŠ Markdown è¡¨æ ¼è½¬ä¸º Notion åŸç”Ÿçš„è¡¨æ ¼å—ï¼Œä½ å¯ä»¥ç›´æ¥ç¼–è¾‘ã€æ·»åŠ æˆ–åˆ é™¤è¡Œ/åˆ—ã€‚ ç¥ä½ åœ¨ Notion ä¸­ä½¿ç”¨è¿™äº›è¡¨æ ¼é¡ºæ‰‹é«˜æ•ˆ ğŸš€ï¼
ç›´æ¥è¾“å‡ºMarkdown è¯­æ³•

profile
gpt-oss:120b
æ€è€ƒç”¨æ—¶ 1 ç§’
ä¸‹é¢æ˜¯å…¨éƒ¨ Markdown è¯­æ³•çš„è¡¨æ ¼å’Œä»£ç å—ï¼Œç›´æ¥å¤åˆ¶ç²˜è´´åˆ° Notionï¼ˆæˆ–ä»»ä½•æ”¯æŒ Markdown çš„ç¼–è¾‘å™¨ï¼‰å³å¯å¾—åˆ°æ¸²æŸ“åçš„è¡¨æ ¼ã€‚

1ï¸âƒ£ list å¸¸ç”¨æ–¹æ³•é€ŸæŸ¥è¡¨
markdown

æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
âŒ„
| æ–¹æ³• | åŠŸèƒ½ | å¸¸ç”¨è¯­æ³• | ç¤ºä¾‹ | å¤‡æ³¨ / å¸¸è§å‘ |
|------|------|----------|------|--------------|
| `append(x)` | åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å•ä¸ªå…ƒç´  `x` | `lst.append(item)` | `lst=[1,2]; lst.append(3)  # [1,2,3]` | O(1) æ—¶é—´å¤æ‚åº¦ |
| `extend(iterable)` | ç”¨å¯è¿­ä»£å¯¹è±¡çš„æ¯ä¸ªå…ƒç´ æ‰©å±•åˆ—è¡¨ | `lst.extend(other)` | `lst=[1]; lst.extend([2,3])  # [1,2,3]` | ç­‰ä»·äº `lst += other`ï¼Œ**ä¸è¦**å†™æˆ `lst.append(other)`ï¼ˆä¼šæŠŠæ•´ä¸ªå¯¹è±¡å½“æˆä¸€ä¸ªå…ƒç´ ï¼‰ |
| `insert(i, x)` | åœ¨ç´¢å¼• `i` ä½ç½®æ’å…¥å…ƒç´  `x`ï¼Œåé¢çš„å…ƒç´ å³ç§» | `lst.insert(idx, item)` | `lst=[1,3]; lst.insert(1,2)  # [1,2,3]` | è´Ÿç´¢å¼•åŒæ ·æœ‰æ•ˆï¼›O(n) å¤æ‚åº¦ |
| `remove(x)` | åˆ é™¤åˆ—è¡¨ä¸­**ç¬¬ä¸€ä¸ª**å€¼ç­‰äº `x` çš„å…ƒç´  | `lst.remove(item)` | `lst=[1,2,2,3]; lst.remove(2)  # [1,2,3]` | è‹¥ä¸å­˜åœ¨æŠ› `ValueError` |
| `pop([i])` | åˆ é™¤å¹¶è¿”å›ç´¢å¼• `i` å¤„çš„å…ƒç´ ï¼Œé»˜è®¤ `i=-1`ï¼ˆå¼¹å‡ºæœ«å°¾ï¼‰ | `item = lst.pop(idx)` | `lst=[1,2,3]; lst.pop()  # è¿”å› 3ï¼Œåˆ—è¡¨å˜ä¸º [1,2]` | ç©ºåˆ—è¡¨è°ƒç”¨ä¼šæŠ› `IndexError` |
| `clear()` | åˆ é™¤åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ ï¼Œå¾—åˆ°ç©ºåˆ—è¡¨ | `lst.clear()` | `lst=[1,2]; lst.clear()  # []` | ç­‰ä»·äº `del lst[:]` |
| `index(x, start=0, end=len(lst))` | è¿”å›å€¼ç­‰äº `x` çš„**ç¬¬ä¸€ä¸ª**å…ƒç´ çš„ç´¢å¼•ï¼Œå¯é€‰æœç´¢åŒºé—´ | `pos = lst.index(item, start, end)` | `lst=[1,2,3]; lst.index(2)  # 1` | è‹¥ä¸å­˜åœ¨æŠ› `ValueError` |
| `count(x)` | ç»Ÿè®¡åˆ—è¡¨ä¸­å€¼ç­‰äº `x` çš„å…ƒç´ ä¸ªæ•° | `n = lst.count(item)` | `lst=[1,2,2,3]; lst.count(2)  # 2` | O(n) |
| `sort(key=None, reverse=False)` | åŸåœ°æ’åºï¼Œè¿”å› `None` | `lst.sort(key=func, reverse=True)` | `lst=[3,1,2]; lst.sort()  # [1,2,3]` | **æ³¨æ„**ï¼š`list.sort()` **ä¼šä¿®æ”¹åŸåˆ—è¡¨**ï¼Œè‹¥éœ€è¦ä¿ç•™åŸåˆ—è¡¨è¯·ä½¿ç”¨ `sorted(lst)` |
| `reverse()` | åŸåœ°ç¿»è½¬åˆ—è¡¨é¡ºåº | `lst.reverse()` | `lst=[1,2,3]; lst.reverse()  # [3,2,1]` | åŒæ ·è¿”å› `None`ï¼Œä¸ç”Ÿæˆæ–°åˆ—è¡¨ |
| `copy()` | è¿”å›åˆ—è¡¨çš„**æµ…æ‹·è´**ï¼ˆç­‰ä»·äº `lst[:]`ï¼‰ | `new_lst = lst.copy()` | `a=[1,2]; b=a.copy(); b.append(3)  # a=[1,2], b=[1,2,3]` | è‹¥åˆ—è¡¨å†…éƒ¨è¿˜æœ‰å¯å˜å¯¹è±¡ï¼Œéœ€è¦ `copy.deepcopy` |
| `len(lst)` | è¿”å›åˆ—è¡¨é•¿åº¦ï¼ˆä¸æ˜¯æ–¹æ³•ï¼‰ | `n = len(lst)` | `len([1,2,3])  # 3` |  |
| `lst[i]` / `lst[i:j:k]` | å–å…ƒç´ æˆ–åˆ‡ç‰‡ | `item = lst[i]` | `lst=[1,2,3]; lst[0]  # 1` | æ”¯æŒè´Ÿç´¢å¼•ã€æ­¥é•¿åˆ‡ç‰‡ |
| `lst[i] = x` | æ›¿æ¢æŒ‡å®šä½ç½®çš„å…ƒç´  | `lst[i] = val` | `lst[1]=9  # [1,9,3]` | åŒæ ·æ”¯æŒåˆ‡ç‰‡èµ‹å€¼ `lst[1:3]=[8,8]` |
| `del lst[i]` | åˆ é™¤æŒ‡å®šä½ç½®æˆ–åˆ‡ç‰‡ | `del lst[i]` | `del lst[0]  # åˆ é™¤é¦–å…ƒç´ ` |  |
| `x in lst` | åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨åˆ—è¡¨ä¸­ | `x in lst` | `2 in [1,2,3]  # True` | O(n) çº¿æ€§æœç´¢ |
| `for x in lst:` | è¿­ä»£åˆ—è¡¨ | `for v in lst: ...` | `for v in [1,2]: print(v)` |  |
| `list(iterable)` | å°†å¯è¿­ä»£å¯¹è±¡è½¬æ¢ä¸ºåˆ—è¡¨ | `lst = list(some_iterable)` | `list('abc')  # ['a','b','c']` |  |
2ï¸âƒ£ å¸¸ç”¨å®ç”¨æŠ€å·§ï¼ˆä»£ç å—ï¼‰
markdown

æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
âŒ„
âŒ„
#### åˆ—è¡¨æ¨å¯¼å¼
```python
# 1~10 çš„å¹³æ–¹ï¼Œåªä¿ç•™å¶æ•°
evens_sq = [x**2 for x in range(1, 11) if x % 2 == 0]
# -> [4, 16, 36, 64, 100]
åˆ—è¡¨åˆ‡ç‰‡
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
lst = list(range(10))   # [0,1,2,3,4,5,6,7,8,9]

first5 = lst[:5]        # [0,1,2,3,4]
mid    = lst[2:-1]      # [2,3,4,5,6,7,8]
step2  = lst[::2]       # [0,2,4,6,8]
rev    = lst[::-1]      # [9,8,7,6,5,4,3,2,1,0]
å»é‡å¹¶ä¿æŒé¡ºåº
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
âŒ„
def uniq_keep_order(seq):
    seen = set()
    return [x for x in seq if not (x in seen or seen.add(x))]

print(uniq_keep_order([1,2,2,3,1,4]))  # [1,2,3,4]
ç”¨ extend æ›¿ä»£
<details type="reasoning" done="true" duration="1"> <summary>Thought for 1 seconds</summary> > The user wants "ç›´æ¥è¾“å‡ºMarkdown è¯­æ³•". Likely they want the markdown tables directly, no extra explanation. Provide the markdown code for the list methods table, tips maybe, but likely just the tables. Provide markdown code blocks with tables. Let's output the markdown for the list methods, and maybe other tables. Provide as raw markdown. </details> ä¸‹é¢æ˜¯å…¨éƒ¨ **Markdown** è¯­æ³•çš„è¡¨æ ¼å’Œä»£ç å—ï¼Œç›´æ¥å¤åˆ¶ç²˜è´´åˆ° Notionï¼ˆæˆ–ä»»ä½•æ”¯æŒ Markdown çš„ç¼–è¾‘å™¨ï¼‰å³å¯å¾—åˆ°æ¸²æŸ“åçš„è¡¨æ ¼ã€‚ --- ### 1ï¸âƒ£ `list` å¸¸ç”¨æ–¹æ³•é€ŸæŸ¥è¡¨ ```markdown | æ–¹æ³• | åŠŸèƒ½ | å¸¸ç”¨è¯­æ³• | ç¤ºä¾‹ | å¤‡æ³¨ / å¸¸è§å‘ | |------|------|----------|------|--------------| | `append(x)` | åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å•ä¸ªå…ƒç´  `x` | `lst.append(item)` | `lst=[1,2]; lst.append(3) # [1,2,3]` | O(1) æ—¶é—´å¤æ‚åº¦ | | `extend(iterable)` | ç”¨å¯è¿­ä»£å¯¹è±¡çš„æ¯ä¸ªå…ƒç´ æ‰©å±•åˆ—è¡¨ | `lst.extend(other)` | `lst=[1]; lst.extend([2,3]) # [1,2,3]` | ç­‰ä»·äº `lst += other`ï¼Œ**ä¸è¦**å†™æˆ `lst.append(other)`ï¼ˆä¼šæŠŠæ•´ä¸ªå¯¹è±¡å½“æˆä¸€ä¸ªå…ƒç´ ï¼‰ | | `insert(i, x)` | åœ¨ç´¢å¼• `i` ä½ç½®æ’å…¥å…ƒç´  `x`ï¼Œåé¢çš„å…ƒç´ å³ç§» | `lst.insert(idx, item)` | `lst=[1,3]; lst.insert(1,2) # [1,2,3]` | è´Ÿç´¢å¼•åŒæ ·æœ‰æ•ˆï¼›O(n) å¤æ‚åº¦ | | `remove(x)` | åˆ é™¤åˆ—è¡¨ä¸­**ç¬¬ä¸€ä¸ª**å€¼ç­‰äº `x` çš„å…ƒç´  | `lst.remove(item)` | `lst=[1,2,2,3]; lst.remove(2) # [1,2,3]` | è‹¥ä¸å­˜åœ¨æŠ› `ValueError` | | `pop([i])` | åˆ é™¤å¹¶è¿”å›ç´¢å¼• `i` å¤„çš„å…ƒç´ ï¼Œé»˜è®¤ `i=-1`ï¼ˆå¼¹å‡ºæœ«å°¾ï¼‰ | `item = lst.pop(idx)` | `lst=[1,2,3]; lst.pop() # è¿”å› 3ï¼Œåˆ—è¡¨å˜ä¸º [1,2]` | ç©ºåˆ—è¡¨è°ƒç”¨ä¼šæŠ› `IndexError` | | `clear()` | åˆ é™¤åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ ï¼Œå¾—åˆ°ç©ºåˆ—è¡¨ | `lst.clear()` | `lst=[1,2]; lst.clear() # []` | ç­‰ä»·äº `del lst[:]` | | `index(x, start=0, end=len(lst))` | è¿”å›å€¼ç­‰äº `x` çš„**ç¬¬ä¸€ä¸ª**å…ƒç´ çš„ç´¢å¼•ï¼Œå¯é€‰æœç´¢åŒºé—´ | `pos = lst.index(item, start, end)` | `lst=[1,2,3]; lst.index(2) # 1` | è‹¥ä¸å­˜åœ¨æŠ› `ValueError` | | `count(x)` | ç»Ÿè®¡åˆ—è¡¨ä¸­å€¼ç­‰äº `x` çš„å…ƒç´ ä¸ªæ•° | `n = lst.count(item)` | `lst=[1,2,2,3]; lst.count(2) # 2` | O(n) | | `sort(key=None, reverse=False)` | åŸåœ°æ’åºï¼Œè¿”å› `None` | `lst.sort(key=func, reverse=True)` | `lst=[3,1,2]; lst.sort() # [1,2,3]` | **æ³¨æ„**ï¼š`list.sort()` **ä¼šä¿®æ”¹åŸåˆ—è¡¨**ï¼Œè‹¥éœ€è¦ä¿ç•™åŸåˆ—è¡¨è¯·ä½¿ç”¨ `sorted(lst)` | | `reverse()` | åŸåœ°ç¿»è½¬åˆ—è¡¨é¡ºåº | `lst.reverse()` | `lst=[1,2,3]; lst.reverse() # [3,2,1]` | åŒæ ·è¿”å› `None`ï¼Œä¸ç”Ÿæˆæ–°åˆ—è¡¨ | | `copy()` | è¿”å›åˆ—è¡¨çš„**æµ…æ‹·è´**ï¼ˆç­‰ä»·äº `lst[:]`ï¼‰ | `new_lst = lst.copy()` | `a=[1,2]; b=a.copy(); b.append(3) # a=[1,2], b=[1,2,3]` | è‹¥åˆ—è¡¨å†…éƒ¨è¿˜æœ‰å¯å˜å¯¹è±¡ï¼Œéœ€è¦ `copy.deepcopy` | | `len(lst)` | è¿”å›åˆ—è¡¨é•¿åº¦ï¼ˆä¸æ˜¯æ–¹æ³•ï¼‰ | `n = len(lst)` | `len([1,2,3]) # 3` | | | `lst[i]` / `lst[i:j:k]` | å–å…ƒç´ æˆ–åˆ‡ç‰‡ | `item = lst[i]` | `lst=[1,2,3]; lst[0] # 1` | æ”¯æŒè´Ÿç´¢å¼•ã€æ­¥é•¿åˆ‡ç‰‡ | | `lst[i] = x` | æ›¿æ¢æŒ‡å®šä½ç½®çš„å…ƒç´  | `lst[i] = val` | `lst[1]=9 # [1,9,3]` | åŒæ ·æ”¯æŒåˆ‡ç‰‡èµ‹å€¼ `lst[1:3]=[8,8]` | | `del lst[i]` | åˆ é™¤æŒ‡å®šä½ç½®æˆ–åˆ‡ç‰‡ | `del lst[i]` | `del lst[0] # åˆ é™¤é¦–å…ƒç´ ` | | | `x in lst` | åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨åˆ—è¡¨ä¸­ | `x in lst` | `2 in [1,2,3] # True` | O(n) çº¿æ€§æœç´¢ | | `for x in lst:` | è¿­ä»£åˆ—è¡¨ | `for v in lst: ...` | `for v in [1,2]: print(v)` | | | `list(iterable)` | å°†å¯è¿­ä»£å¯¹è±¡è½¬æ¢ä¸ºåˆ—è¡¨ | `lst = list(some_iterable)` | `list('abc') # ['a','b','c']` | | ``` --- ### 2ï¸âƒ£ å¸¸ç”¨å®ç”¨æŠ€å·§ï¼ˆä»£ç å—ï¼‰ ```markdown #### åˆ—è¡¨æ¨å¯¼å¼ ```python # 1~10 çš„å¹³æ–¹ï¼Œåªä¿ç•™å¶æ•° evens_sq = [x**2 for x in range(1, 11) if x % 2 == 0] # -> [4, 16, 36, 64, 100] ``` #### åˆ—è¡¨åˆ‡ç‰‡ ```python lst = list(range(10)) # [0,1,2,3,4,5,6,7,8,9] first5 = lst[:5] # [0,1,2,3,4] mid = lst[2:-1] # [2,3,4,5,6,7,8] step2 = lst[::2] # [0,2,4,6,8] rev = lst[::-1] # [9,8,7,6,5,4,3,2,1,0] ``` #### å»é‡å¹¶ä¿æŒé¡ºåº ```python def uniq_keep_order(seq): seen = set() return [x for x in seq if not (x in seen or seen.add(x))] print(uniq_keep_order([1,2,2,3,1,4])) # [1,2,3,4] ``` #### ç”¨ `extend` æ›¿ä»£
pythonè¿›ç¨‹é€šä¿¡

profile
gpt-oss:120b
æ€è€ƒç”¨æ—¶ 2 ç§’
ğŸ Python è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰å…¨æ”»ç•¥
ç›®æ ‡ï¼šå¿«é€Ÿäº†è§£åœ¨ Python ä¸­ä¸åŒè¿›ç¨‹ä¹‹é—´å¦‚ä½•ä¼ é€’æ•°æ®ã€åŒæ­¥çŠ¶æ€ã€å…±äº«èµ„æºï¼Œå¹¶æä¾›å¯ç›´æ¥è¿è¡Œçš„ç¤ºä¾‹ä»£ç ã€‚
é€‚ç”¨èŒƒå›´ï¼šmultiprocessingï¼ˆè·¨å¹³å°çš„å¤šè¿›ç¨‹åº“ï¼‰+ æ ‡å‡†åº“ socketã€queueã€multiprocessing.shared_memoryï¼ˆPythonâ€¯3.8+ï¼‰+ ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ ZeroMQã€Redisï¼‰çš„å¸¸è§ä½¿ç”¨åœºæ™¯ã€‚ 

1ï¸âƒ£ ä¸ºä»€ä¹ˆéœ€è¦è¿›ç¨‹é—´é€šä¿¡ï¼Ÿ
åœºæ™¯
è¿›ç¨‹ VS çº¿ç¨‹
éœ€è¦çš„ IPC æ‰‹æ®µ
CPUâ€‘å¯†é›†å‹è®¡ç®—ï¼ˆåˆ©ç”¨å¤šæ ¸ï¼‰	
å¤šè¿›ç¨‹ï¼ˆæ¯ä¸ªè¿›ç¨‹ç‹¬ç«‹çš„ GILï¼‰	
Pipeã€Queueã€å…±äº«å†…å­˜ã€Manager
å¤§é‡æ•°æ®å…±äº«ï¼ˆå›¾ç‰‡ã€çŸ©é˜µï¼‰	
å¤šè¿›ç¨‹	
å…±äº«å†…å­˜ (shared_memoryã€Value/Array)
è·¨æœºå™¨/è·¨è¯­è¨€åä½œ	
å¤šè¿›ç¨‹æˆ–å¤šä¸»æœº	
å¥—æ¥å­—ã€HTTPã€ZeroMQã€Redisã€RabbitMQ ç­‰
éœ€è¦åŒæ­¥/äº’æ–¥	
å¤šè¿›ç¨‹	
Lockã€Eventã€Conditionã€Barrier
åŠ¨æ€ä»»åŠ¡è°ƒåº¦ï¼ˆç”Ÿäº§è€…â€‘æ¶ˆè´¹è€…ï¼‰	
å¤šè¿›ç¨‹	
Queueã€JoinableQueueã€Pool.apply_async
æ ¸å¿ƒåŸåˆ™ï¼šæ•°æ®çš„å¯åºåˆ—åŒ–ï¼ˆpickleï¼‰æ˜¯å¤§å¤šæ•° IPC æ‰‹æ®µçš„å‰æï¼Œé™¤éä½¿ç”¨å…±äº«å†…å­˜æˆ–ä¸“é—¨çš„äºŒè¿›åˆ¶åè®®ã€‚ 

2ï¸âƒ£ multiprocessing æ¨¡å—çš„å‡ å¤§é€šä¿¡å·¥å…·
multiprocessing æ˜¯ Python æ ‡å‡†åº“ï¼Œè·¨å¹³å°ï¼ˆWindowsã€Linuxã€macOSï¼‰å®ç°äº†è¿›ç¨‹åˆ›å»ºã€åŒæ­¥ã€å…±äº«ç­‰åŠŸèƒ½ã€‚ 

2.1 Pipe â€”â€” åŒå‘ç®¡é“
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
from multiprocessing import Process, Pipe

def worker(conn):
    # æ”¶åˆ°ä¸»è¿›ç¨‹å‘é€çš„æ•°å­—ï¼Œè®¡ç®—å¹³æ–¹åè¿”å›
    while True:
        msg = conn.recv()                # é˜»å¡ç­‰å¾…
        if msg == "STOP":
            break
        conn.send(msg ** 2)

if __name__ == "__main__":
    parent_conn, child_conn = Pipe()      # åˆ›å»ºä¸€å¯¹è¿æ¥å¯¹è±¡
    p = Process(target=worker, args=(child_conn,))
    p.start()

    for i in range(5):
        parent_conn.send(i)              # å‘é€æ•°æ®åˆ°å­è¿›ç¨‹
        print(f"{i}^2 = {parent_conn.recv()}")  # æ¥æ”¶å­è¿›ç¨‹è¿”å›

    parent_conn.send("STOP")             # ç»“æŸä¿¡å·
    p.join()
ç‰¹ç‚¹ï¼š
åŒå‘ï¼ˆé»˜è®¤ duplex=Trueï¼‰ï¼Œä¹Ÿå¯ä»¥è®¾ duplex=False å˜æˆå•å‘ã€‚
é€‚åˆç‚¹å¯¹ç‚¹çš„å°‘é‡æ•°æ®äº¤æ¢ï¼Œå¼€é”€å°ã€‚
åªèƒ½åœ¨çˆ¶å­è¿›ç¨‹ä¹‹é—´ä½¿ç”¨ï¼ˆä¸é€‚ç”¨äºå¤šè¿›ç¨‹ç½‘ç»œæ‹“æ‰‘ï¼‰ã€‚
2.2 Queue â€”â€” ç”Ÿäº§è€…â€‘æ¶ˆè´¹è€…å®‰å…¨é˜Ÿåˆ—
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
from multiprocessing import Process, Queue
import time, random

def producer(q, n):
    for i in range(n):
        item = random.randint(1, 100)
        q.put(item)                     # æ”¾å…¥é˜Ÿåˆ—ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰
        print(f"Producer put {item}")
        time.sleep(0.1)

def consumer(q):
    while True:
        item = q.get()                  # é˜»å¡å–å‡º
        if item is None:                # çº¦å®šçš„ç»“æŸæ ‡è®°
            break
        print(f"Consumer got {item}")

if __name__ == "__main__":
    q = Queue()
    p = Process(target=producer, args=(q, 10))
    c = Process(target=consumer, args=(q,))
    p.start(); c.start()
    p.join()
    q.put(None)      # ç»™æ¶ˆè´¹è€…å‘é€ç»ˆæ­¢ä¿¡å·
    c.join()
ç‰¹ç‚¹ï¼š
åŸºäºåº•å±‚ Pipe + Lock å®ç°ï¼Œæ”¯æŒ å¤šç”Ÿäº§è€…â€‘å¤šæ¶ˆè´¹è€…ã€‚
è‡ªåŠ¨åºåˆ—åŒ–ï¼ˆpickleï¼‰ï¼Œä¸é€‚åˆæ”¾å…¥ ä¸å¯ pickle çš„å¯¹è±¡ï¼ˆå¦‚æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„ã€socketï¼‰ã€‚
JoinableQueue è¿˜èƒ½åœ¨ task_done() / join() ä¹‹é—´å®ç°ä»»åŠ¡å®Œæˆçš„åŒæ­¥ã€‚
2.3 Manager â€”â€” å…±äº«å¯¹è±¡ï¼ˆåˆ—è¡¨ã€å­—å…¸ã€Namespaceï¼‰
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
âŒ„
âŒ„
âŒ„
from multiprocessing import Process, Manager

def worker(d, lst, i):
    d[i] = i * i
    lst.append(i)

if __name__ == "__main__":
    with Manager() as mgr:
        shared_dict = mgr.dict()
        shared_list = mgr.list()
        procs = [Process(target=worker, args=(shared_dict, shared_list, i))
                 for i in range(5)]
        for p in procs: p.start()
        for p in procs: p.join()

        print("dict:", dict(shared_dict))
        print("list:", list(shared_list))
ç‰¹ç‚¹ï¼š
é€šè¿‡ æœåŠ¡å™¨è¿›ç¨‹ï¼ˆManagerï¼‰åœ¨è¿›ç¨‹é—´ä»£ç†å¯¹è±¡ï¼Œå®ç°å‡ ä¹æ‰€æœ‰å¯å˜å®¹å™¨çš„å…±äº«ã€‚
é€‚ç”¨äº å¤æ‚ç»“æ„ï¼ˆåµŒå¥— dict/listï¼‰ä½†æ€§èƒ½ä¸å¦‚ Queue/Pipeï¼ˆæ¯ä¸€æ¬¡è®¿é—®éƒ½ä¼šç»è¿‡ç½‘ç»œ RPCï¼‰ã€‚
2.4 Value / Array â€”â€” åŸå­å…±äº«å†…å­˜
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
âŒ„
âŒ„
âŒ„
âŒ„
from multiprocessing import Process, Value, Array

def inc(counter):
    for _ in range(1000):
        with counter.get_lock():        # åŸå­åŠ é”
            counter.value += 1

if __name__ == "__main__":
    cnt = Value('i', 0)   # 'i' = signed int, åˆå§‹å€¼ 0
    procs = [Process(target=inc, args=(cnt,)) for _ in range(4)]
    for p in procs: p.start()
    for p in procs: p.join()
    print("final count =", cnt.value)   # 4000
ç‰¹ç‚¹ï¼š
åªé€‚åˆ å•ä¸ªæ ‡é‡ æˆ– ä¸€ç»´æ•°ç»„ï¼ˆArray('d', [0.0]*10)ï¼‰ã€‚
å¿…é¡»ä½¿ç”¨åŒæ­¥åŸè¯­ï¼ˆget_lock()ï¼‰æ¥ä¿è¯åŸå­æ€§ã€‚
åºåˆ—åŒ–æˆæœ¬ä¸º 0ï¼Œå› ä¸ºæ•°æ®ç›´æ¥å­˜æ”¾åœ¨å…±äº«å†…å­˜ä¸­ã€‚
2.4 shared_memoryï¼ˆPythonâ€¯3.8+ï¼‰â€”â€” çœŸæ­£çš„é›¶æ‹·è´å…±äº«
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
âŒ„
âŒ„
âŒ„
# è¿›ç¨‹ Aï¼šåˆ›å»ºå…±äº«å†…å­˜å—å¹¶å†™å…¥ NumPy æ•°ç»„
import numpy as np
from multiprocessing import Process
from multiprocessing import shared_memory

def writer():
    a = np.arange(10, dtype=np.int64)
    shm = shared_memory.SharedMemory(create=True, size=a.nbytes, name='my_shm')
    buf = np.ndarray(a.shape, dtype=a.dtype, buffer=shm.buf)
    buf[:] = a[:]                        # ç›´æ¥å†™å…¥å…±äº«å†…å­˜
    print("writer: data written")
    # å­è¿›ç¨‹è¯»å–åè‡ªè¡Œ unlinkï¼Œçˆ¶è¿›ç¨‹è¿™é‡Œä¸ close/unlinkï¼Œç•™ç»™å­è¿›ç¨‹
    # shm.close()  # è‹¥åœ¨æ­¤å…³é—­ï¼Œå­è¿›ç¨‹ä»èƒ½é€šè¿‡ name è®¿é—®

def reader():
    # é€šè¿‡åå­—æ‰“å¼€å·²æœ‰å…±äº«å†…å­˜
    existing = shared_memory.SharedMemory(name='my_shm')
    b = np.ndarray((10,), dtype=np.int64, buffer=existing.buf)
    print("reader sees:", b)
    existing.close()
    existing.unlink()                    # æœ€åä¸€ä¸ªä½¿ç”¨è€…è´Ÿè´£é‡Šæ”¾

if __name__ == '__main__':
    p1 = Process(target=writer)
    p2 = Process(target=reader)
    p1.start(); p1.join()
    p2.start(); p2.join()
ç‰¹ç‚¹ï¼š
é›¶æ‹·è´ï¼šæ•°æ®åœ¨å¤šä¸ªè¿›ç¨‹é—´å…±äº«åŒä¸€å—ç‰©ç†å†…å­˜ï¼Œé€‚åˆå¤§çŸ©é˜µã€å›¾åƒã€éŸ³è§†é¢‘å¸§ã€‚
åªèƒ½å…±äº« äºŒè¿›åˆ¶/NumPy ä¹‹ç±»çš„ è¿ç»­å†…å­˜ å¯¹è±¡ã€‚
éœ€è¦è‡ªè¡Œç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼ˆunlinkï¼‰ï¼Œå¦åˆ™ä¼šç•™ä¸‹ç³»ç»Ÿæ®‹ç•™çš„å…±äº«å—ã€‚
3ï¸âƒ£ åŸºäºå¥—æ¥å­—ï¼ˆSocketï¼‰çš„è·¨æœºå™¨/è·¨è¯­è¨€é€šä¿¡
å¥—æ¥å­—æ˜¯æœ€é€šç”¨çš„ IPC æ‰‹æ®µï¼Œé€‚ç”¨äº åŒæœºå¤šè¿›ç¨‹ã€è·¨ä¸»æœºï¼Œä»¥åŠ ä¸åŒè¯­è¨€ï¼ˆC/C++ã€Javaã€Goã€Node.jsï¼‰ä¹‹é—´çš„äº¤äº’ã€‚

3.1 ç®€å• TCP ç¤ºä¾‹ï¼ˆPython3ï¼‰
æœåŠ¡å™¨ï¼ˆçˆ¶è¿›ç¨‹ï¼‰

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
âŒ„
âŒ„
âŒ„
âŒ„
# server.py
import socket
import struct

def start_server(host='127.0.0.1', port=6000):
    srv = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    srv.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
    srv.bind((host, port))
    srv.listen()
    print(f"Listening on {host}:{port}")

    conn, addr = srv.accept()
    print("Connected by", addr)

    while True:
        # è¯»å– 4 å­—èŠ‚æ•´æ•°ï¼ˆç½‘ç»œå­—èŠ‚åºï¼‰
        data = conn.recv(4)
        if not data:
            break
        n = struct.unpack('!i', data)[0]   # '!i' = bigâ€‘endian signed int
        print("recv:", n)
        conn.sendall(struct.pack('!i', n * n))

    conn.close()
    srv.close()

if __name__ == '__main__':
    start_server()
å®¢æˆ·ç«¯ï¼ˆå­è¿›ç¨‹ï¼‰

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
âŒ„
âŒ„
âŒ„
# client.py
import socket, struct, time

def client(host='127.0.0.1', port=6000):
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((host, port))
    for i in range(5):
        s.sendall(struct.pack('!i', i))
        res = s.recv(4)
        print(f"{i}^2 = {struct.unpack('!i', res)[0]}")
        time.sleep(0.2)
    s.close()

if __name__ == '__main__':
    client()
ä¼˜ç‚¹ï¼š
å®Œå…¨è·¨å¹³å°ã€è·¨è¯­è¨€ã€‚
å¯é…åˆ select/poll/asyncio å®ç° éé˜»å¡ã€äº‹ä»¶é©±åŠ¨ã€‚
ç¼ºç‚¹ï¼š
éœ€è¦è‡ªè¡Œå¤„ç† åºåˆ—åŒ–åè®®ï¼ˆå¦‚ structã€jsonã€msgpackï¼‰ï¼Œæ¯” Queue æ›´åº•å±‚ã€‚
3.2 multiprocessing.connectionï¼ˆæ›´é«˜å±‚çš„ socket/pipeï¼‰
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
from multiprocessing.connection import Listener, Client

def server():
    address = ('localhost', 6001)          # åªåœ¨æœ¬æœºå¯è¾¾
    listener = Listener(address, authkey=b'secret')
    conn = listener.accept()
    print('Connection accepted')
    while True:
        try:
            msg = conn.recv()
            if msg == 'STOP':
                break
            conn.send(msg * 2)
        except EOFError:
            break
    conn.close()
    listener.close()

def client():
    address = ('localhost', 6001)
    conn = Client(address, authkey=b'secret')
    for i in range(5):
        conn.send(i)
        print('reply:', conn.recv())
    conn.send('STOP')
    conn.close()

if __name__ == '__main__':
    from multiprocessing import Process
    p = Process(target=server); p.start()
    client()
    p.join()
ç‰¹ç‚¹ï¼š
åŸºäº socket å®ç°ï¼Œä½†æä¾›äº† pickle è‡ªåŠ¨åºåˆ—åŒ– ä¸ å¯é€‰è®¤è¯ (authkey)ã€‚
é€‚åˆ æœ¬æœº æˆ– å±€åŸŸç½‘ çš„è½»é‡çº§ RPC åœºæ™¯ã€‚
4ï¸âƒ£ è¿›ç¨‹åŒæ­¥/äº’æ–¥ï¼ˆé…åˆé€šä¿¡ï¼‰
åŒæ­¥åŸè¯­
ç”¨é€”
ç¤ºä¾‹
Lock / RLock	
äº’æ–¥è®¿é—®å…±äº«èµ„æº	
with lock:
Event	
å•å‘ä¿¡å·ï¼ˆå¦‚â€œä»»åŠ¡å·²å‡†å¤‡å¥½â€ï¼‰	
event.set()/event.wait()
Condition	
å¤æ‚çš„ç”Ÿäº§è€…â€‘æ¶ˆè´¹è€…ï¼ˆå¯æŒ‡å®šæ¡ä»¶ï¼‰	
cond.wait()/cond.notify_all()
Barrier	
å¤šè¿›ç¨‹åœ¨åŒä¸€ç‚¹â€œé›†åˆâ€åç»§ç»­	
barrier.wait()
Semaphore / BoundedSemaphore	
é™åˆ¶å¹¶å‘æ•°ï¼ˆå¦‚åŒæ—¶åªèƒ½æœ‰ N ä¸ªå­è¿›ç¨‹è®¿é—®å¤–éƒ¨ APIï¼‰	
sem.acquire()/sem.release()
å°æŠ€å·§ï¼šåœ¨ä½¿ç”¨ Queue/Pipe æ—¶ï¼Œä¸å¿…é¢å¤–åŠ é”â€”â€”å®ƒä»¬å†…éƒ¨å·²ç»å®ç°äº†å®‰å…¨çš„ Lockï¼Œé™¤éä½ åœ¨åŒä¸€è¿æ¥å¯¹è±¡ä¸Šè¿›è¡Œæ··åˆè¯»å†™ï¼ˆè¿™ä¼šå¯¼è‡´æ­»é”ï¼‰ï¼Œæ­¤æ—¶å»ºè®®ä½¿ç”¨ å•ç‹¬çš„è¯»å†™ç«¯ï¼ˆå¦‚ Pipe(duplex=False)ï¼‰æˆ– ä¸¤æ¡é€šé“ã€‚ 

5ï¸âƒ£ å¸¸è§å‘ & æ€§èƒ½è°ƒä¼˜
ç—‡çŠ¶
å¯èƒ½çš„æ ¹æœ¬åŸå› 
è§£å†³åŠæ³•
pickle æŠ¥é”™ â€œCan't pickle local object â€¦â€	
ä¼ é€’çš„å¯¹è±¡æ˜¯ å±€éƒ¨å‡½æ•°/ç±» æˆ– lambda	
å°†å¯¹è±¡æå‡åˆ°æ¨¡å—é¡¶å±‚ï¼Œæˆ–æ‰‹åŠ¨å®ç° __reduce__ï¼›æˆ–è€…æ”¹ç”¨ å…±äº«å†…å­˜ï¼ˆä¸éœ€è¦åºåˆ—åŒ–ï¼‰ã€‚
ç¨‹åºåœ¨ Windows ä¸Š fork å¤±è´¥	
Windows åªèƒ½ spawnï¼Œå­è¿›ç¨‹ä¸ä¼šç»§æ‰¿çˆ¶è¿›ç¨‹çš„å…¨å±€å˜é‡	
æŠŠæ‰€æœ‰èµ„æºåˆ›å»ºæ”¾åœ¨ if __name__ == '__main__': é‡Œï¼›ä½¿ç”¨ multiprocessing.set_start_method('spawn')ï¼ˆé»˜è®¤ï¼‰ã€‚
Queue é˜Ÿåˆ—å¡ä½ä¸åŠ¨	
æ¶ˆè´¹è€…è¿›ç¨‹æ„å¤–é€€å‡ºæˆ– æœªå‘é€ç»“æŸæ ‡è®°	
ä½¿ç”¨ JoinableQueue + task_done()/join()ï¼Œæˆ–æ˜¾å¼å‘é€ None/ç‰¹æ®Šå¯¹è±¡ä½œä¸ºç»ˆæ­¢ä¿¡å·ã€‚
å¤§é‡æ•°æ®ä¼ é€’æ…¢ï¼ˆæ¯æ¬¡ put/send éƒ½å¾ˆæ…¢ï¼‰	
æ•°æ®è¢« pickle å† copyï¼Œç½‘ç»œ/ç®¡é“å¸¦å®½å—é™	
æ”¹ç”¨ å…±äº«å†…å­˜ (shared_memoryã€Value/Array) æˆ– å†…å­˜æ˜ å°„æ–‡ä»¶ (mmap).
è¿›ç¨‹æ³„æ¼ï¼ˆæ®‹ç•™çš„å­è¿›ç¨‹ï¼‰	
çˆ¶è¿›ç¨‹å¼‚å¸¸é€€å‡ºã€å­è¿›ç¨‹æœª join()	
ç”¨ try/finally åŒ…è£… Process å¯åŠ¨ï¼Œæˆ–ä½¿ç”¨ daemon=Trueï¼ˆä»…åœ¨ä¸éœ€è¦å­è¿›ç¨‹æ¸…ç†èµ„æºæ—¶ï¼‰ã€‚
æ­»é”ï¼ˆä¸¤ä¸ªè¿›ç¨‹äº’ç›¸ç­‰å¾…ï¼‰	
åŒæ—¶è·å–å¤šä¸ª Lockï¼Œé¡ºåºä¸ç»Ÿä¸€	
ç»Ÿä¸€é”é¡ºåºï¼ˆå¦‚æ€»æ˜¯å…ˆæ‹¿ lock_a å† lock_bï¼‰ï¼Œæˆ–ä½¿ç”¨ RLockã€‚
å…±äº«å†…å­˜ç¢ç‰‡åŒ–/æ³„æ¼	
shared_memory.SharedMemory æ²¡æœ‰ unlink()	
æœ€åä½¿ç”¨ shm.close(); shm.unlink()ï¼Œæˆ–ç”¨ with è¯­å¥ç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼ˆPythonâ€¯3.9+ï¼‰ã€‚
6ï¸âƒ£ è¿›é˜¶ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆå¯è·¨æœºå™¨/è·¨è¯­è¨€ï¼‰
ä¸­é—´ä»¶
é€‚ç”¨åœºæ™¯
ç®€å• PYTHON ç¤ºä¾‹
ZeroMQ (pyzmq)	
é«˜ååã€ä½å»¶è¿Ÿã€ç‚¹å¯¹ç‚¹/å‘å¸ƒâ€‘è®¢é˜…/è¯·æ±‚â€‘å“åº”	
python\nimport zmq\nctx = zmq.Context()\n# æœåŠ¡å™¨\nsock = ctx.socket(zmq.REP)\nsock.bind('tcp://*:5555')\nwhile True:\n msg = sock.recv()\n sock.send(b'ACK:' + msg)\n
Redis (redis-py)	
æŒä¹…åŒ–ã€å¹¿æ’­ã€ä»»åŠ¡é˜Ÿåˆ—ã€åˆ†å¸ƒå¼é”	
python\nimport redis, json\nr = redis.Redis()\nr.lpush('task_queue', json.dumps({'id':1}))\nmsg = json.loads(r.rpop('task_queue'))\n
RabbitMQ (pika)	
å¯é çš„æ¶ˆæ¯æŠ•é€’ã€äº‹åŠ¡ã€è·¯ç”±	
python\nimport pika\nconn = pika.BlockingConnection(pika.ConnectionParameters('localhost'))\nch = conn.channel()\nch.queue_declare('hello')\nch.basic_publish(exchange='', routing_key='hello', body='world')\n
gRPC (grpcio)	
å¼ºç±»å‹ã€è·¨è¯­è¨€ã€æ”¯æŒæµå¼ RPC	
éœ€è¦å…ˆå®šä¹‰ .protoï¼Œç”Ÿæˆ Python stubï¼Œå†è°ƒç”¨ã€‚
é€‰å‹å»ºè®®ï¼š 

åŒæœºå¤šè¿›ç¨‹ â†’ multiprocessingï¼ˆPipe/Queue/å…±äº«å†…å­˜ï¼‰
è·¨æœºã€è·¨è¯­è¨€ â†’ ZeroMQï¼ˆè½»é‡ï¼‰æˆ– Redis/RabbitMQï¼ˆå¯é ã€æŒä¹…ï¼‰
éœ€è¦é«˜ååã€äºŒè¿›åˆ¶åè®® â†’ gRPCï¼ˆGoogle Protocol Buffersï¼‰
7ï¸âƒ£ å®Œæ•´ç¤ºä¾‹ï¼šå¤šè¿›ç¨‹å›¾åƒå¤„ç†ç®¡çº¿ï¼ˆPipeâ€¯+â€¯shared_memoryï¼‰
ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº† çˆ¶è¿›ç¨‹ è¯»å–å›¾ç‰‡æ–‡ä»¶ï¼ˆç”¨ Pillowï¼‰ï¼ŒæŠŠåŸå§‹ numpy æ•°ç»„æ”¾è¿›å…±äº«å†…å­˜ï¼Œå­è¿›ç¨‹ è¯»å–å…±äº«å†…å­˜è¿›è¡Œç°åº¦åŒ–å¹¶æŠŠç»“æœå†™å›çˆ¶è¿›ç¨‹çš„ Queueã€‚æ•´ä¸ªé“¾è·¯ä¸è¿›è¡Œä»»ä½• pickleï¼Œåªæœ‰ä¸€æ¬¡å†…å­˜æ‹·è´ï¼ˆå…±äº«å†…å­˜ï¼‰ã€‚ 

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
# pip install pillow numpy
import numpy as np
from PIL import Image
from multiprocessing import Process, Queue, shared_memory
import os, time

def producer(img_path, shm_name, shape, dtype, q):
    """è¯»å–å›¾ç‰‡ â†’ å¤åˆ¶åˆ°å…±äº«å†…å­˜ â†’ æŠŠ shm åå­—å‘ç»™å­è¿›ç¨‹"""
    img = Image.open(img_path).convert('RGB')
    arr = np.asarray(img, dtype=dtype)
    shm = shared_memory.SharedMemory(name=shm_name, create=True, size=arr.nbytes)
    buf = np.ndarray(shape, dtype=dtype, buffer=shm.buf)
    buf[:] = arr[:]                     # ç›´æ¥å†™å…¥å…±äº«å†…å­˜
    q.put(shm_name)                     # æŠŠå…±äº«å—çš„åå­—äº¤ç»™æ¶ˆè´¹è€…
    shm.close()                         # è¿™é‡Œä¸ unlinkï¼Œå­è¿›ç¨‹è´Ÿè´£

def consumer(q, out_dir):
    """ä»é˜Ÿåˆ—æ‹¿åˆ° shm åå­— â†’ è¯»å– â†’ ç°åº¦åŒ– â†’ ä¿å­˜"""
    while True:
        name = q.get()
        if name is None:                # ç»“æŸæ ‡è®°
            break
        # æ‰“å¼€å·²æœ‰å…±äº«å†…å­˜å—
        existing = shared_memory.SharedMemory(name=name)
        # å‡è®¾æˆ‘ä»¬äº‹å…ˆçŸ¥é“ shape/dtypeï¼ˆè¿™é‡Œç¡¬ç¼–ç æ¼”ç¤ºï¼‰
        shape = (256, 256, 3)            # éœ€è¦å’Œ producer ä¿æŒä¸€è‡´
        dtype = np.uint8
        img = np.ndarray(shape, dtype=dtype, buffer=existing.buf)

        # ------- ä¸šåŠ¡å¤„ç†ï¼ˆç°åº¦åŒ–ï¼‰ -------
        gray = np.dot(img[..., :3], [0.2989, 0.5870, 0.1140]).astype(np.uint8)

        # ä¿å­˜ä¸ºæ–‡ä»¶
        out_path = os.path.join(out_dir, f'gray_{name}.png')
        Image.fromarray(gray).save(out_path)
        print('saved', out_path)

        existing.close()
        existing.unlink()                # é‡Šæ”¾å…±äº«å—

if __name__ == '__main__':
    IMG_PATH = 'test.jpg'               # <-- æ¢æˆä½ è‡ªå·±çš„å›¾ç‰‡è·¯å¾„
    OUT_DIR = './output'
    os.makedirs(OUT_DIR, exist_ok=True)

    # å‡è®¾å›¾ç‰‡å·²è¢« resize ä¸º 256x256ï¼ˆæ¼”ç¤ºç”¨ï¼‰ï¼Œå®é™…ç”Ÿäº§ä¸­å¯åŠ¨æ€è·å– shape
    SHM_NAME = 'img_shm'
    SHAPE = (256, 256, 3)
    DTYPE = np.uint8

    q = Queue()
    p_prod = Process(target=producer, args=(IMG_PATH, SHM_NAME, SHAPE, DTYPE, q))
    p_cons = Process(target=consumer, args=(q, OUT_DIR))

    p_prod.start()
    p_cons.start()
    p_prod.join()

    q.put(None)          # å‘é€ç»ˆæ­¢ä¿¡å·
    p_cons.join()
è¦ç‚¹å›é¡¾ï¼š

å…±äº«å†…å­˜ï¼šshared_memory.SharedMemory åªéœ€è¦ä¸€æ¬¡åˆ›å»º/æ‰“å¼€ï¼Œæ‰€æœ‰è¿›ç¨‹çœ‹åˆ°åŒä¸€å—ç‰©ç†å†…å­˜ï¼Œé›¶æ‹·è´ã€‚
åŒæ­¥ï¼šä½¿ç”¨ Queue åªè´Ÿè´£ â€œè°å…ˆå¤„ç†â€ çš„è°ƒåº¦ï¼ŒçœŸæ­£çš„æ•°æ®åœ¨å…±äº«å†…å­˜é‡Œã€‚
èµ„æºå›æ”¶ï¼šæœ€åä¸€å®šè¦ unlink() å…±äº«å—ï¼Œå¦åˆ™ç³»ç»Ÿä¼šç•™ä¸‹å­¤å„¿å…±äº«å†…å­˜å¯¹è±¡ã€‚
8ï¸âƒ£ å°ç»“ & æ¨èå®è·µ
ä»»åŠ¡
æ¨èå·¥å…·
ä¸ºä»€ä¹ˆ
ç‚¹å¯¹ç‚¹å°‘é‡æ•°æ®	
Pipeï¼ˆæˆ– socketpairï¼‰	
å¼€é”€æœ€å°ã€å®ç°æœ€ç®€å•
ç”Ÿäº§è€…â€‘æ¶ˆè´¹è€…ã€ä»»åŠ¡é˜Ÿåˆ—	
multiprocessing.Queue / JoinableQueue	
è‡ªåŠ¨åºåˆ—åŒ–ã€çº¿ç¨‹å®‰å…¨ã€æ”¯æŒå¤šè¿›ç¨‹
å¤æ‚/åµŒå¥—ç»“æ„å…±äº«	
Manager().dict()/list()/Namespace	
é€šè¿‡æœåŠ¡å™¨è¿›ç¨‹ä»£ç†ï¼Œä½¿ç”¨æ–¹ä¾¿
å¤§å—æ•°ç»„/çŸ©é˜µå…±äº«	
shared_memory / Value / Array	
é›¶æ‹·è´ã€æä½å»¶è¿Ÿ
è·¨æœºå™¨/è·¨è¯­è¨€	
socket / ZeroMQ / Redis / gRPC	
ç½‘ç»œåè®®ã€æŒä¹…åŒ–ã€è¯­è¨€æ— å…³
éœ€è¦é”/ä¿¡å·	
Lockã€Eventã€Conditionã€Barrier	
é˜²æ­¢ç«äº‰ã€å®ç°åŒæ­¥ç‚¹
å¸¸ç”¨ä»£ç æ¨¡æ¿ï¼ˆå¯ç›´æ¥ç²˜è´´ï¼‰
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
# ---------- è¿›ç¨‹åˆ›å»º ----------
from multiprocessing import Process, Queue, Pipe, Lock, Event, Manager, Value, Array
# ---------- è¿›ç¨‹é€šä¿¡ ----------
#   Pipe   -> parent_conn, child_conn = Pipe()
#   Queue  -> q = Queue()
#   Manager-> mgr = Manager(); shared_dict = mgr.dict()
#   Value/Array -> v = Value('i', 0); a = Array('d', [0.0]*10)
#   shared_memory (py3.8+) -> from multiprocessing import shared_memory
# ---------- åŒæ­¥åŸè¯­ ----------
#   lock = Lock(); event = Event(); cond = Condition()
åªè¦æŠŠä¸Šé¢çš„ æ¨¡æ¿ ä¸å®é™…ä¸šåŠ¡é€»è¾‘ï¼ˆè¯»å–ã€è®¡ç®—ã€å†™å›ï¼‰ç»„åˆèµ·æ¥ï¼Œå°±èƒ½è½»æ¾æ­å»ºå‡ºå¯é ã€å¯ç»´æŠ¤çš„å¤šè¿›ç¨‹ç³»ç»Ÿã€‚ç¥ä½ ç©è½¬ Python è¿›ç¨‹é€šä¿¡ ğŸš€ï¼

<details type="reasoning" done="true" duration="2"> <summary>Thought for 2 seconds</summary> > The user asks "pythonè¿›ç¨‹é€šä¿¡". They likely want information about inter-process communication (IPC) in Python. Need to provide details on multiprocessing module, Pipe, Queue, shared memory, Manager, sockets, multiprocessing.shared_memory (Python 3.8+), and maybe third-party like multiprocessing.connection, multiprocessing.managers, and also using threading or async. Provide code examples. Should be in Chinese. Probably they want a guide. > > Will output structured answer with sections: basics, Pipe, Queue, Manager, Value/Array, shared_memory, sockets, example codes, best practices, pitfalls. Also mention using multiprocessing vs threading. Provide some reference. > > Will produce final answer in Chinese. </details> # ğŸ Python è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰å…¨æ”»ç•¥ > **ç›®æ ‡**ï¼šå¿«é€Ÿäº†è§£åœ¨ Python ä¸­ä¸åŒè¿›ç¨‹ä¹‹é—´å¦‚ä½•ä¼ é€’æ•°æ®ã€åŒæ­¥çŠ¶æ€ã€å…±äº«èµ„æºï¼Œå¹¶æä¾›å¯ç›´æ¥è¿è¡Œçš„ç¤ºä¾‹ä»£ç ã€‚ > **é€‚ç”¨èŒƒå›´**ï¼š`multiprocessing`ï¼ˆè·¨å¹³å°çš„å¤šè¿›ç¨‹åº“ï¼‰+ æ ‡å‡†åº“ `socket`ã€`queue`ã€`multiprocessing.shared_memory`ï¼ˆPythonâ€¯3.8+ï¼‰+ ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ `ZeroMQ`ã€`Redis`ï¼‰çš„å¸¸è§ä½¿ç”¨åœºæ™¯ã€‚ --- ## 1ï¸âƒ£ ä¸ºä»€ä¹ˆéœ€è¦è¿›ç¨‹é—´é€šä¿¡ï¼Ÿ | åœºæ™¯ | è¿›ç¨‹ vs çº¿ç¨‹ | éœ€è¦çš„ IPC æ‰‹æ®µ | |------|--------------|----------------| | CPUâ€‘å¯†é›†å‹è®¡ç®—ï¼ˆåˆ©ç”¨å¤šæ ¸ï¼‰ | å¤šè¿›ç¨‹ï¼ˆæ¯ä¸ªè¿›ç¨‹ç‹¬ç«‹çš„ GILï¼‰ | `Pipe`ã€`Queue`ã€å…±äº«å†…å­˜ã€`Manager` | | å¤§é‡æ•°æ®å…±äº«ï¼ˆå›¾ç‰‡ã€çŸ©é˜µï¼‰ | å¤šè¿›ç¨‹ | å…±äº«å†…å­˜ (`shared_memory`ã€`Value/Array`) | | è·¨æœºå™¨/è·¨è¯­è¨€åä½œ | å¤šè¿›ç¨‹æˆ–å¤šä¸»æœº | å¥—æ¥å­—ã€HTTPã€ZeroMQã€Redisã€RabbitMQ ç­‰ | | éœ€è¦åŒæ­¥/äº’æ–¥ | å¤šè¿›ç¨‹ | `Lock`ã€`Event`ã€`Condition`ã€`Barrier` | | åŠ¨æ€ä»»åŠ¡è°ƒåº¦ï¼ˆç”Ÿäº§è€…â€‘æ¶ˆè´¹è€…ï¼‰ | å¤šè¿›ç¨‹ | `Queue`ã€`JoinableQueue`ã€`Pool.apply_async` | > **æ ¸å¿ƒåŸåˆ™**ï¼š**æ•°æ®çš„å¯åºåˆ—åŒ–**ï¼ˆpickleï¼‰æ˜¯å¤§å¤šæ•° IPC æ‰‹æ®µçš„å‰æï¼Œé™¤éä½¿ç”¨å…±äº«å†…å­˜æˆ–ä¸“é—¨çš„äºŒè¿›åˆ¶åè®®ã€‚ --- ## 2ï¸âƒ£ `multiprocessing` æ¨¡å—çš„å‡ å¤§é€šä¿¡å·¥å…· > `multiprocessing` æ˜¯ Python æ ‡å‡†åº“ï¼Œè·¨å¹³å°ï¼ˆWindowsã€Linuxã€macOSï¼‰å®ç°äº†è¿›ç¨‹åˆ›å»ºã€åŒæ­¥ã€å…±äº«ç­‰åŠŸèƒ½ã€‚ ### 2.1 `Pipe` â€”â€” åŒå‘ç®¡é“ ```python from multiprocessing import Process, Pipe def worker(conn): # æ”¶åˆ°ä¸»è¿›ç¨‹å‘é€çš„æ•°å­—ï¼Œè®¡ç®—å¹³æ–¹åè¿”å› while True: msg = conn.recv() # é˜»å¡ç­‰å¾… if msg == "STOP": break conn.send(msg ** 2) if __name__ == "__main__": parent_conn, child_conn = Pipe() # åˆ›å»ºä¸€å¯¹è¿æ¥å¯¹è±¡ p = Process(target=worker, args=(child_conn,)) p.start() for i in range(5): parent_conn.send(i) # å‘é€æ•°æ®åˆ°å­è¿›ç¨‹ print(f"{i}^2 = {parent_conn.recv()}") # æ¥æ”¶å­è¿›ç¨‹è¿”å› parent_conn.send("STOP") # ç»“æŸä¿¡å· p.join() ``` - **ç‰¹ç‚¹**ï¼š - åŒå‘ï¼ˆé»˜è®¤ `duplex=True`ï¼‰ï¼Œä¹Ÿå¯ä»¥è®¾ `duplex=False` å˜æˆå•å‘ã€‚ - é€‚åˆç‚¹å¯¹ç‚¹çš„å°‘é‡æ•°æ®äº¤æ¢ï¼Œå¼€é”€å°ã€‚ - åªèƒ½åœ¨çˆ¶å­è¿›ç¨‹ä¹‹é—´ä½¿ç”¨ï¼ˆä¸é€‚ç”¨äºå¤šè¿›ç¨‹ç½‘ç»œæ‹“æ‰‘ï¼‰ã€‚ ### 2.2 `Queue` â€”â€” ç”Ÿäº§è€…â€‘æ¶ˆè´¹è€…å®‰å…¨é˜Ÿåˆ— ```python from multiprocessing import Process, Queue import time, random def producer(q, n): for i in range(n): item = random.randint(1, 100) q.put(item) # æ”¾å…¥é˜Ÿåˆ—ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ print(f"Producer put {item}") time.sleep(0.1) def consumer(q): while True: item = q.get() # é˜»å¡å–å‡º if item is None: # çº¦å®šçš„ç»“æŸæ ‡è®° break print(f"Consumer got {item}") if __name__ == "__main__": q = Queue() p = Process(target=producer, args=(q, 10)) c = Process(target=consumer, args=(q,)) p.start(); c.start() p.join() q.put(None) # ç»™æ¶ˆè´¹è€…å‘é€ç»ˆæ­¢ä¿¡å· c.join() ``` - **ç‰¹ç‚¹**ï¼š - åŸºäºåº•å±‚ `Pipe` + `Lock` å®ç°ï¼Œæ”¯æŒ **å¤šç”Ÿäº§è€…â€‘å¤šæ¶ˆè´¹è€…**ã€‚ - è‡ªåŠ¨åºåˆ—åŒ–ï¼ˆpickleï¼‰ï¼Œä¸é€‚åˆæ”¾å…¥ **ä¸å¯ pickle** çš„å¯¹è±¡ï¼ˆå¦‚æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„ã€socketï¼‰ã€‚ - `JoinableQueue` è¿˜èƒ½åœ¨ `task_done()` / `join()` ä¹‹é—´å®ç°ä»»åŠ¡å®Œæˆçš„åŒæ­¥ã€‚ ### 2.3 `Manager` â€”â€” å…±äº«å¯¹è±¡ï¼ˆåˆ—è¡¨ã€å­—å…¸ã€Namespaceï¼‰ ```python from multiprocessing import Process, Manager def worker(d, lst, i): d[i] = i * i lst.append(i) if __name__ == "__main__": with Manager() as mgr: shared_dict = mgr.dict() shared_list = mgr.list() procs = [Process(target=worker, args=(shared_dict, shared_list, i)) for i in range(5)] for p in procs: p.start() for p in procs: p.join() print("dict:", dict(shared_dict)) print("list:", list(shared_list)) ``` - **ç‰¹ç‚¹**ï¼š - é€šè¿‡ **æœåŠ¡å™¨è¿›ç¨‹**ï¼ˆManagerï¼‰åœ¨è¿›ç¨‹é—´ä»£ç†å¯¹è±¡ï¼Œå®ç°å‡ ä¹æ‰€æœ‰å¯å˜å®¹å™¨çš„å…±äº«ã€‚ - é€‚ç”¨äº **å¤æ‚ç»“æ„**ï¼ˆåµŒå¥— dict/listï¼‰ä½†æ€§èƒ½ä¸å¦‚ `Queue`/`Pipe`ï¼ˆæ¯ä¸€æ¬¡è®¿é—®éƒ½ä¼šç»è¿‡ç½‘ç»œ RPCï¼‰ã€‚ ### 2.4 `Value` / `Array` â€”â€” åŸå­å…±äº«å†…å­˜ ```python from multiprocessing import Process, Value, Array def inc(counter): for _ in range(1000): with counter.get_lock(): # åŸå­åŠ é” counter.value += 1 if __name__ == "__main__": cnt = Value('i', 0) # 'i' = signed int, åˆå§‹å€¼ 0 procs = [Process(target=inc, args=(cnt,)) for _ in range(4)] for p in procs: p.start() for p in procs: p.join() print("final count =", cnt.value) # 4000 ``` - **ç‰¹ç‚¹**ï¼š - åªé€‚åˆ **å•ä¸ªæ ‡é‡** æˆ– **ä¸€ç»´æ•°ç»„**ï¼ˆ`Array('d', [0.0]*10)`ï¼‰ã€‚ - å¿…é¡»ä½¿ç”¨åŒæ­¥åŸè¯­ï¼ˆ`get_lock()`ï¼‰æ¥ä¿è¯åŸå­æ€§ã€‚ - åºåˆ—åŒ–æˆæœ¬ä¸º **0**ï¼Œå› ä¸ºæ•°æ®ç›´æ¥å­˜æ”¾åœ¨å…±äº«å†…å­˜ä¸­ã€‚ ### 2.4 `shared_memory`ï¼ˆPythonâ€¯3.8+ï¼‰â€”â€” çœŸæ­£çš„é›¶æ‹·è´å…±äº« ```python # è¿›ç¨‹ Aï¼šåˆ›å»ºå…±äº«å†…å­˜å—å¹¶å†™å…¥ NumPy æ•°ç»„ import numpy as np from multiprocessing import Process from multiprocessing import shared_memory def writer(): a = np.arange(10, dtype=np.int64) shm = shared_memory.SharedMemory(create=True, size=a.nbytes, name='my_shm') buf = np.ndarray(a.shape, dtype=a.dtype, buffer=shm.buf) buf[:] = a[:] # ç›´æ¥å†™å…¥å…±äº«å†…å­˜ print("writer: data written") # å­è¿›ç¨‹è¯»å–åè‡ªè¡Œ unlinkï¼Œçˆ¶è¿›ç¨‹è¿™é‡Œä¸ close/unlinkï¼Œç•™ç»™å­è¿›ç¨‹ # shm.close() # è‹¥åœ¨æ­¤å…³é—­ï¼Œå­è¿›ç¨‹ä»èƒ½é€šè¿‡ name è®¿é—® def reader(): # é€šè¿‡åå­—æ‰“å¼€å·²æœ‰å…±äº«å†…å­˜ existing = shared_memory.SharedMemory(name='my_shm') b = np.ndarray((10,), dtype=np.int64, buffer=existing.buf) print("reader sees:", b) existing.close() existing.unlink() # æœ€åä¸€ä¸ªä½¿ç”¨è€…è´Ÿè´£é‡Šæ”¾ if __name__ == '__main__': p1 = Process(target=writer) p2 = Process(target=reader) p1.start(); p1.join() p2.start(); p2.join() ``` - **ç‰¹ç‚¹**ï¼š - **é›¶æ‹·è´**ï¼šæ•°æ®åœ¨å¤šä¸ªè¿›ç¨‹é—´å…±äº«åŒä¸€å—ç‰©ç†å†…å­˜ï¼Œé€‚åˆå¤§çŸ©é˜µã€å›¾åƒã€éŸ³è§†é¢‘å¸§ã€‚ - åªèƒ½å…±äº« **äºŒè¿›åˆ¶/NumPy** ä¹‹ç±»çš„ **è¿ç»­å†…å­˜** å¯¹è±¡ã€‚ - éœ€è¦è‡ªè¡Œç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼ˆ`unlink`ï¼‰ï¼Œå¦åˆ™ä¼šç•™ä¸‹ç³»ç»Ÿæ®‹ç•™çš„å…±äº«å—ã€‚ --- ## 3ï¸âƒ£ åŸºäºå¥—æ¥å­—ï¼ˆSocketï¼‰çš„è·¨æœºå™¨/è·¨è¯­è¨€é€šä¿¡ å¥—æ¥å­—æ˜¯æœ€é€šç”¨çš„ IPC æ‰‹æ®µï¼Œé€‚ç”¨äº **åŒæœºå¤šè¿›ç¨‹**ã€**è·¨ä¸»æœº**ï¼Œä»¥åŠ **ä¸åŒè¯­è¨€**ï¼ˆC/C++ã€Javaã€Goã€Node.jsï¼‰ä¹‹é—´çš„äº¤äº’ã€‚ ### 3.1 ç®€å• TCP ç¤ºä¾‹ï¼ˆPython3ï¼‰ **æœåŠ¡å™¨ï¼ˆçˆ¶è¿›ç¨‹ï¼‰** ```python # server.py import socket import struct def start_server(host='127.0.0.1', port=6000): srv = socket.socket(socket.AF_INET, socket.SOCK_STREAM) srv.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1) srv.bind((host, port)) srv.listen() print(f"Listening on {host}:{port}") conn, addr = srv.accept() print("Connected by", addr) while True: # è¯»å– 4 å­—èŠ‚æ•´æ•°ï¼ˆç½‘ç»œå­—èŠ‚åºï¼‰ data = conn.recv(4) if not data: break n = struct.unpack('!i', data)[0] # '!i' = bigâ€‘endian signed int print("recv:", n) conn.sendall(struct.pack('!i', n * n)) conn.close() srv.close() if __name__ == '__main__': start_server() ``` **å®¢æˆ·ç«¯ï¼ˆå­è¿›ç¨‹ï¼‰** ```python # client.py import socket, struct, time def client(host='127.0.0.1', port=6000): s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((host, port)) for i in range(5): s.sendall(struct.pack('!i', i)) res = s.recv(4) print(f"{i}^2 = {struct.unpack('!i', res)[0]}") time.sleep(0.2) s.close() if __name__ == '__main__': client() ``` - **ä¼˜ç‚¹**ï¼š - å®Œå…¨è·¨å¹³å°ã€è·¨è¯­è¨€ã€‚ - å¯é…åˆ `select`/`poll`/`asyncio` å®ç° **éé˜»å¡**ã€**äº‹ä»¶é©±åŠ¨**ã€‚ - **ç¼ºç‚¹**ï¼š - éœ€è¦è‡ªè¡Œå¤„ç† **åºåˆ—åŒ–åè®®**ï¼ˆå¦‚ `struct`ã€`json`ã€`msgpack`ï¼‰ï¼Œæ¯” `Queue` æ›´åº•å±‚ã€‚ ### 3.2 `multiprocessing.connection`ï¼ˆæ›´é«˜å±‚çš„ socket/pipeï¼‰ ```python from multiprocessing.connection import Listener, Client def server(): address = ('localhost', 6001) # åªåœ¨æœ¬æœºå¯è¾¾ listener = Listener(address, authkey=b'secret') conn = listener.accept() print('Connection accepted') while True: try: msg = conn.recv() if msg == 'STOP': break conn.send(msg * 2) except EOFError: break conn.close() listener.close() def client(): address = ('localhost', 6001) conn = Client(address, authkey=b'secret') for i in range(5): conn.send(i) print('reply:', conn.recv()) conn.send('STOP') conn.close() if __name__ == '__main__': from multiprocessing import Process p = Process(target=server); p.start() client() p.join() ``` - **ç‰¹ç‚¹**ï¼š - åŸºäº `socket` å®ç°ï¼Œä½†æä¾›äº† **pickle è‡ªåŠ¨åºåˆ—åŒ–** ä¸ **å¯é€‰è®¤è¯** (`authkey`)ã€‚ - é€‚åˆ **æœ¬æœº** æˆ– **å±€åŸŸç½‘** çš„è½»é‡çº§ RPC åœºæ™¯ã€‚ --- ## 4ï¸âƒ£ è¿›ç¨‹åŒæ­¥/äº’æ–¥ï¼ˆé…åˆé€šä¿¡ï¼‰ | åŒæ­¥åŸè¯­ | ç”¨é€” | ç¤ºä¾‹ | |----------|------|------| | `Lock` / `RLock` | äº’æ–¥è®¿é—®å…±äº«èµ„æº | `with lock:` | | `Event` | å•å‘ä¿¡å·ï¼ˆå¦‚â€œä»»åŠ¡å·²å‡†å¤‡å¥½â€ï¼‰ | `event.set()/event.wait()` | | `Condition` | å¤æ‚çš„ç”Ÿäº§è€…â€‘æ¶ˆè´¹è€…ï¼ˆå¯æŒ‡å®šæ¡ä»¶ï¼‰ | `cond.wait()/cond.notify_all()` | | `Barrier` | å¤šè¿›ç¨‹åœ¨åŒä¸€ç‚¹â€œé›†åˆâ€åç»§ç»­ | `barrier.wait()` | | `Semaphore` / `BoundedSemaphore` | é™åˆ¶å¹¶å‘æ•°ï¼ˆå¦‚åŒæ—¶åªèƒ½æœ‰ N ä¸ªå­è¿›ç¨‹è®¿é—®å¤–éƒ¨ APIï¼‰ | `sem.acquire()/sem.release()` | > **å°æŠ€å·§**ï¼šåœ¨ä½¿ç”¨ `Queue`/`Pipe` æ—¶ï¼Œ**ä¸å¿…é¢å¤–åŠ é”**â€”â€”å®ƒä»¬å†…éƒ¨å·²ç»å®ç°äº†å®‰å…¨çš„ `Lock`ï¼Œé™¤éä½ åœ¨åŒä¸€è¿æ¥å¯¹è±¡ä¸Šè¿›è¡Œ**æ··åˆè¯»å†™**ï¼ˆè¿™ä¼šå¯¼è‡´æ­»é”ï¼‰ï¼Œæ­¤æ—¶å»ºè®®ä½¿ç”¨ **å•ç‹¬çš„è¯»å†™ç«¯**ï¼ˆå¦‚ `Pipe(duplex=False)`ï¼‰æˆ– **ä¸¤æ¡é€šé“**ã€‚ --- ## 5ï¸âƒ£ å¸¸è§å‘ & æ€§èƒ½è°ƒä¼˜ | ç—‡çŠ¶ | å¯èƒ½çš„æ ¹æœ¬åŸå›  | è§£å†³åŠæ³• | |------|----------------|----------| | `pickle` æŠ¥é”™ **â€œCan't pickle local object â€¦â€** | ä¼ é€’çš„å¯¹è±¡æ˜¯ **å±€éƒ¨å‡½æ•°/ç±»** æˆ– **lambda** | å°†å¯¹è±¡æå‡åˆ°æ¨¡å—é¡¶å±‚ï¼Œæˆ–æ‰‹åŠ¨å®ç° `__reduce__`ï¼›æˆ–è€…æ”¹ç”¨ **å…±äº«å†…å­˜**ï¼ˆä¸éœ€è¦åºåˆ—åŒ–ï¼‰ã€‚ | | ç¨‹åºåœ¨ **Windows** ä¸Š `fork` å¤±è´¥ | Windows åªèƒ½ `spawn`ï¼Œå­è¿›ç¨‹ä¸ä¼šç»§æ‰¿çˆ¶è¿›ç¨‹çš„å…¨å±€å˜é‡ | æŠŠæ‰€æœ‰èµ„æºåˆ›å»ºæ”¾åœ¨ `if __name__ == '__main__':` é‡Œï¼›ä½¿ç”¨ `multiprocessing.set_start_method('spawn')`ï¼ˆé»˜è®¤ï¼‰ã€‚ | | `Queue` é˜Ÿåˆ—å¡ä½ä¸åŠ¨ | æ¶ˆè´¹è€…è¿›ç¨‹æ„å¤–é€€å‡ºæˆ– **æœªå‘é€ç»“æŸæ ‡è®°** | ä½¿ç”¨ `JoinableQueue` + `task_done()/join()`ï¼Œæˆ–æ˜¾å¼å‘é€ `None`/ç‰¹æ®Šå¯¹è±¡ä½œä¸ºç»ˆæ­¢ä¿¡å·ã€‚ | | å¤§é‡æ•°æ®ä¼ é€’æ…¢ï¼ˆæ¯æ¬¡ `put`/`send` éƒ½å¾ˆæ…¢ï¼‰ | æ•°æ®è¢« **pickle** å† **copy**ï¼Œç½‘ç»œ/ç®¡é“å¸¦å®½å—é™ | æ”¹ç”¨ **å…±äº«å†…å­˜** (`shared_memory`ã€`Value/Array`) æˆ– **å†…å­˜æ˜ å°„æ–‡ä»¶** (`mmap`). | | è¿›ç¨‹æ³„æ¼ï¼ˆæ®‹ç•™çš„å­è¿›ç¨‹ï¼‰ | çˆ¶è¿›ç¨‹å¼‚å¸¸é€€å‡ºã€å­è¿›ç¨‹æœª `join()` | ç”¨ `try/finally` åŒ…è£… `Process` å¯åŠ¨ï¼Œæˆ–ä½¿ç”¨ `daemon=True`ï¼ˆä»…åœ¨**ä¸éœ€è¦**å­è¿›ç¨‹æ¸…ç†èµ„æºæ—¶ï¼‰ã€‚ | | æ­»é”ï¼ˆä¸¤ä¸ªè¿›ç¨‹äº’ç›¸ç­‰å¾…ï¼‰ | åŒæ—¶è·å–å¤šä¸ª `Lock`ï¼Œé¡ºåºä¸ç»Ÿä¸€ | **ç»Ÿä¸€é”é¡ºåº**ï¼ˆå¦‚æ€»æ˜¯å…ˆæ‹¿ `lock_a` å† `lock_b`ï¼‰ï¼Œæˆ–ä½¿ç”¨ **`RLock`**ã€‚ | | å…±äº«å†…å­˜ç¢ç‰‡åŒ–/æ³„æ¼ | `shared_memory.SharedMemory` æ²¡æœ‰ `unlink()` | æœ€åä½¿ç”¨ `shm.close(); shm.unlink()`ï¼Œæˆ–ç”¨ `with` è¯­å¥ç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼ˆPythonâ€¯3.9+ï¼‰ã€‚ | --- ## 6ï¸âƒ£ è¿›é˜¶ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆå¯è·¨æœºå™¨/è·¨è¯­è¨€ï¼‰ | ä¸­é—´ä»¶ | é€‚ç”¨åœºæ™¯ | ç®€å• Python ç¤ºä¾‹ | |--------|----------|-----------------| | **ZeroMQ** (`pyzmq`) | é«˜ååã€ä½å»¶è¿Ÿã€ç‚¹å¯¹ç‚¹/å‘å¸ƒâ€‘è®¢é˜…/è¯·æ±‚â€‘å“åº” | ```python\nimport zmq\nctx = zmq.Context()\n# æœåŠ¡å™¨\nsock = ctx.socket(zmq.REP)\nsock.bind('tcp://*:5555')\nwhile True:\n msg = sock.recv()\n sock.send(b'ACK:' + msg)\n``` | | **Redis** (`redis-py`) | æŒä¹…åŒ–ã€å¹¿æ’­ã€ä»»åŠ¡é˜Ÿåˆ—ã€åˆ†å¸ƒå¼é” | ```python\nimport redis, json\nr = redis.Redis()\nr.lpush('task_queue', json.dumps({'id':1}))\nmsg = json.loads(r.rpop('task_queue'))\n``` | | **RabbitMQ** (`pika`) | å¯é çš„æ¶ˆæ¯æŠ•é€’ã€äº‹åŠ¡ã€è·¯ç”± | ```python\nimport pika\nconn = pika.BlockingConnection(pika.ConnectionParameters('localhost'))\nch = conn.channel()\nch.queue_declare('hello')\nch.basic_publish(exchange='', routing_key='hello', body='world')\n``` | | **gRPC** (`grpcio`) | å¼ºç±»å‹ã€è·¨è¯­è¨€ã€æ”¯æŒæµå¼ RPC | éœ€è¦å…ˆå®šä¹‰ `.proto`ï¼Œç”Ÿæˆ Python stubï¼Œå†è°ƒç”¨ã€‚| > **é€‰å‹å»ºè®®**ï¼š - **åŒæœºå¤šè¿›ç¨‹** â†’ `multiprocessing`ï¼ˆPipe/Queue/å…±äº«å†…å­˜ï¼‰ - **è·¨æœºã€è·¨è¯­è¨€** â†’ `ZeroMQ`ï¼ˆè½»é‡ï¼‰æˆ– `Redis/RabbitMQ`ï¼ˆå¯é ã€æŒä¹…ï¼‰ - **éœ€è¦é«˜ååã€äºŒè¿›åˆ¶åè®®** â†’ `gRPC`ï¼ˆGoogle Protocol Buffersï¼‰ --- ## 7ï¸âƒ£ å®Œæ•´ç¤ºä¾‹ï¼šå¤šè¿›ç¨‹å›¾åƒå¤„ç†ç®¡çº¿ï¼ˆPipeâ€¯+â€¯shared_memoryï¼‰ > ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº† **çˆ¶è¿›ç¨‹** è¯»å–å›¾ç‰‡æ–‡ä»¶ï¼ˆç”¨ `Pillow`ï¼‰ï¼ŒæŠŠåŸå§‹ `numpy` æ•°ç»„æ”¾è¿›å…±äº«å†…å­˜ï¼Œ**å­è¿›ç¨‹** è¯»å–å…±äº«å†…å­˜è¿›è¡Œç°åº¦åŒ–å¹¶æŠŠç»“æœå†™å›çˆ¶è¿›ç¨‹çš„ `Queue`ã€‚æ•´ä¸ªé“¾è·¯ä¸è¿›è¡Œä»»ä½• pickleï¼Œåªæœ‰ä¸€æ¬¡å†…å­˜æ‹·è´ï¼ˆå…±äº«å†…å­˜ï¼‰ã€‚ ```python # pip install pillow numpy import numpy as np from PIL import Image from multiprocessing import Process, Queue, shared_memory import os, time def producer(img_path, shm_name, shape, dtype, q): """è¯»å–å›¾ç‰‡ â†’ å¤åˆ¶åˆ°å…±äº«å†…å­˜ â†’ æŠŠ shm åå­—å‘ç»™å­è¿›ç¨‹""" img = Image.open(img_path).convert('RGB') arr = np.asarray(img, dtype=dtype) shm = shared_memory.SharedMemory(name=shm_name, create=True, size=arr.nbytes) buf = np.ndarray(shape, dtype=dtype, buffer=shm.buf) buf[:] = arr[:] # ç›´æ¥å†™å…¥å…±äº«å†…å­˜ q.put(shm_name) # æŠŠå…±äº«å—çš„åå­—äº¤ç»™æ¶ˆè´¹è€… shm.close() # è¿™é‡Œä¸ unlinkï¼Œå­è¿›ç¨‹è´Ÿè´£ def consumer(q, out_dir): """ä»é˜Ÿåˆ—æ‹¿åˆ° shm åå­— â†’ è¯»å– â†’ ç°åº¦åŒ– â†’ ä¿å­˜""" while True: name = q.get() if name is None: # ç»“æŸæ ‡è®° break # æ‰“å¼€å·²æœ‰å…±äº«å†…å­˜å— existing = shared_memory.SharedMemory(name=name) # å‡è®¾æˆ‘ä»¬äº‹å…ˆçŸ¥é“ shape/dtypeï¼ˆè¿™é‡Œç¡¬ç¼–ç æ¼”ç¤ºï¼‰ shape = (256, 256, 3) # éœ€è¦å’Œ producer ä¿æŒä¸€è‡´ dtype = np.uint8 img = np.ndarray(shape, dtype=dtype, buffer=existing.buf) # ------- ä¸šåŠ¡å¤„ç†ï¼ˆç°åº¦åŒ–ï¼‰ ------- gray = np.dot(img[..., :3], [0.2989, 0.5870, 0.1140]).astype(np.uint8) # ä¿å­˜ä¸ºæ–‡ä»¶ out_path = os.path.join(out_dir, f'gray_{name}.png') Image.fromarray(gray).save(out_path) print('saved', out_path) existing.close() existing.unlink() # é‡Šæ”¾å…±äº«å— if __name__ == '__main__': IMG_PATH = 'test.jpg' # <-- æ¢æˆä½ è‡ªå·±çš„å›¾ç‰‡è·¯å¾„ OUT_DIR = './output' os.makedirs(OUT_DIR, exist_ok=True) # å‡è®¾å›¾ç‰‡å·²è¢« resize ä¸º 256x256ï¼ˆæ¼”ç¤ºç”¨ï¼‰ï¼Œå®é™…ç”Ÿäº§ä¸­å¯åŠ¨æ€è·å– shape SHM_NAME = 'img_shm' SHAPE = (256, 256, 3) DTYPE = np.uint8 q = Queue() p_prod = Process(target=producer, args=(IMG_PATH, SHM_NAME, SHAPE, DTYPE, q)) p_cons = Process(target=consumer, args=(q, OUT_DIR)) p_prod.start() p_cons.start() p_prod.join() q.put(None) # å‘é€ç»ˆæ­¢ä¿¡å· p_cons.join() ``` **è¦ç‚¹å›é¡¾**ï¼š 1. **å…±äº«å†…å­˜**ï¼š`shared_memory.SharedMemory` åªéœ€è¦ä¸€æ¬¡åˆ›å»º/æ‰“å¼€ï¼Œæ‰€æœ‰è¿›ç¨‹çœ‹åˆ°åŒä¸€å—ç‰©ç†å†…å­˜ï¼Œé›¶æ‹·è´ã€‚ 2. **åŒæ­¥**ï¼šä½¿ç”¨ `Queue` åªè´Ÿè´£ **â€œè°å…ˆå¤„ç†â€** çš„è°ƒåº¦ï¼ŒçœŸæ­£çš„æ•°æ®åœ¨å…±äº«å†…å­˜é‡Œã€‚ 3. **èµ„æºå›æ”¶**ï¼šæœ€åä¸€å®šè¦ `unlink()` å…±äº«å—ï¼Œå¦åˆ™ç³»ç»Ÿä¼šç•™ä¸‹å­¤å„¿å…±äº«å†…å­˜å¯¹è±¡ã€‚ --- ## 8ï¸âƒ£ å°ç»“ & æ¨èå®è·µ | ä»»åŠ¡ | æ¨èå·¥å…· | ä¸ºä»€ä¹ˆ | |------|----------|--------| | **ç‚¹å¯¹ç‚¹å°‘é‡æ•°æ®** | `Pipe`ï¼ˆæˆ– `socketpair`ï¼‰ | å¼€é”€æœ€å°ã€å®ç°æœ€ç®€å• | | **ç”Ÿäº§è€…â€‘æ¶ˆè´¹è€…ã€ä»»åŠ¡é˜Ÿåˆ—** | `multiprocessing.Queue` / `JoinableQueue` | è‡ªåŠ¨åºåˆ—åŒ–ã€çº¿ç¨‹å®‰å…¨ã€æ”¯æŒå¤šè¿›ç¨‹ | | **å¤æ‚/åµŒå¥—ç»“æ„å…±äº«** | `Manager().dict()/list()/Namespace` | é€šè¿‡æœåŠ¡å™¨è¿›ç¨‹ä»£ç†ï¼Œä½¿ç”¨æ–¹ä¾¿ | | **å¤§å—æ•°ç»„/çŸ©é˜µå…±äº«** | `shared_memory` / `Value` / `Array` | é›¶æ‹·è´ã€æä½å»¶è¿Ÿ | | **è·¨æœºå™¨/è·¨è¯­è¨€** | `socket` / `ZeroMQ` / `Redis` / `gRPC` | ç½‘ç»œåè®®ã€æŒä¹…åŒ–ã€è¯­è¨€æ— å…³ | | **éœ€è¦é”/ä¿¡å·** | `Lock`ã€`Event`ã€`Condition`ã€`Barrier` | é˜²æ­¢ç«äº‰ã€å®ç°åŒæ­¥ç‚¹ | ### å¸¸ç”¨ä»£ç æ¨¡æ¿ï¼ˆå¯ç›´æ¥ç²˜è´´ï¼‰ ```python # ---------- è¿›ç¨‹åˆ›å»º ---------- from multiprocessing import Process, Queue, Pipe, Lock, Event, Manager, Value, Array # ---------- è¿›ç¨‹é€šä¿¡ ---------- # Pipe -> parent_conn, child_conn = Pipe() # Queue -> q = Queue() # Manager-> mgr = Manager(); shared_dict = mgr.dict() # Value/Array -> v = Value('i', 0); a = Array('d', [0.0]*10) # shared_memory (py3.8+) -> from multiprocessing import shared_memory # ---------- åŒæ­¥åŸè¯­ ---------- # lock = Lock(); event = Event(); cond = Condition() ``` åªè¦æŠŠä¸Šé¢çš„ **æ¨¡æ¿** ä¸å®é™…ä¸šåŠ¡é€»è¾‘ï¼ˆè¯»å–ã€è®¡ç®—ã€å†™å›ï¼‰ç»„åˆèµ·æ¥ï¼Œå°±èƒ½è½»æ¾æ­å»ºå‡ºå¯é ã€å¯ç»´æŠ¤çš„å¤šè¿›ç¨‹ç³»ç»Ÿã€‚ç¥ä½ ç©è½¬ Python è¿›ç¨‹é€šä¿¡ ğŸš€ï¼
æˆ‘ç°åœ¨æœ‰ä¸€ä¸ªmp4æ–‡ä»¶ï¼Œæˆ‘éœ€è¦ç”¨pythonæŠŠé‡Œé¢çš„ä¸œè¥¿è½¬æ¢ä¸ºtxt

profile
gpt-oss:120b
æ€è€ƒç”¨æ—¶ 1 ç§’
ä¸‹é¢ç»™å‡º å®Œæ•´ã€å¯ç›´æ¥è¿è¡Œ çš„ Python ç¤ºä¾‹ï¼Œå¸®åŠ©ä½ æŠŠä¸€ä¸ª MP4 è§†é¢‘æ–‡ä»¶ é‡Œçš„ è¯­éŸ³å†…å®¹ï¼ˆæˆ–å­—å¹•ã€å…ƒæ•°æ®ï¼‰å…¨éƒ¨è½¬æˆ çº¯æ–‡æœ¬ï¼ˆ.txtï¼‰ã€‚
ç¤ºä¾‹åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼š

æ­¥éª¤
ä½œç”¨
å…³é”®å·¥å…·
1ï¸âƒ£ æŠŠ MP4 æ‹†æˆ éŸ³é¢‘ï¼ˆWAV/MP3ï¼‰	
è§†é¢‘æœ¬èº«æ˜¯äºŒè¿›åˆ¶å›¾åƒæµï¼Œå¿…é¡»å…ˆæŠŠå£°éŸ³æå–å‡ºæ¥	
ffmpegï¼ˆå‘½ä»¤è¡Œï¼‰
2ï¸âƒ£ åˆ‡åˆ† é•¿éŸ³é¢‘ä¸ºè‹¥å¹² çŸ­ç‰‡æ®µï¼ˆé¿å…ä¸€æ¬¡æ€§å–‚ç»™æ¨¡å‹å¤ªå¤§ï¼‰	
å¤§æ–‡ä»¶ä¸€æ¬¡æ€§è¯†åˆ«ä¼šå ç”¨å¤§é‡æ˜¾å­˜/å†…å­˜	
pydub
3ï¸âƒ£ è°ƒç”¨ è¯­éŸ³â€‘è½¬â€‘æ–‡å­—æ¨¡å‹ è¿›è¡Œè¯†åˆ«	
æ¨èä½¿ç”¨ OpenAI Whisperï¼ˆæœ¬åœ°ç¦»çº¿ï¼‰æˆ– speech_recognition + Google APIï¼ˆåœ¨çº¿ï¼‰	
whisperã€torchã€speech_recognition
4ï¸âƒ£ æŠŠè¯†åˆ«ç»“æœå†™å…¥ .txt æ–‡ä»¶	
å®Œæ•´çš„æ–‡å­—è¾“å‡º	
æ ‡å‡† I/O
å¦‚æœä½ åªæƒ³æŠ½å–è§†é¢‘çš„å…ƒæ•°æ®ï¼ˆæ—¶é•¿ã€åˆ†è¾¨ç‡ã€ç ç‡ç­‰ï¼‰ï¼Œè¯·ç›´æ¥è·³åˆ° â€œå…ƒæ•°æ®æå–â€ é‚£ä¸€èŠ‚ï¼›
å¦‚æœä½ å·²æœ‰å¤–éƒ¨å­—å¹•æ–‡ä»¶ï¼ˆ.srt/.assï¼‰ï¼Œåªéœ€è¦æŠŠå®ƒè½¬æˆ txtï¼Œè¿™é‡Œä¹Ÿæä¾›äº†å¿«æ·è„šæœ¬ã€‚ 

ğŸ“¦ ç¯å¢ƒå‡†å¤‡
ç³»ç»Ÿè¦æ±‚ï¼š 

Windows / macOS / Linuxï¼ˆå‡å¯ï¼‰
å·²å®‰è£… FFmpegï¼ˆç¡®ä¿ ffmpeg å’Œ ffprobe èƒ½åœ¨ç»ˆç«¯/å‘½ä»¤æç¤ºç¬¦ç›´æ¥è°ƒç”¨ï¼‰
Python 3.9+ï¼ˆå»ºè®® 3.10/3.11ï¼‰
GPUï¼ˆå¯é€‰ï¼‰â€”â€”å¦‚æœæœ‰ NVIDIA GPUï¼ŒWhisper ä¼šå¿«å¾ˆå¤šï¼›æ²¡æœ‰ä¹Ÿå¯ä»¥åœ¨ CPU ä¸Šè·‘ï¼Œåªæ˜¯æ…¢ä¸€ç‚¹ã€‚
1ï¸âƒ£ å®‰è£… FFmpeg
å¹³å°
å®‰è£…æ–¹å¼
Windows	
ä¸‹è½½ https://ffmpeg.org/download.html#build-windows æä¾›çš„ zipï¼Œè§£å‹åæŠŠ bin ç›®å½•åŠ å…¥ç³»ç»Ÿ PATHã€‚
macOS	
brew install ffmpeg
Linux (Debian/Ubuntu)	
sudo apt-get install ffmpeg
éªŒè¯ï¼šæ‰“å¼€ç»ˆç«¯ï¼Œæ‰§è¡Œ ffmpeg -versionï¼Œèƒ½çœ‹åˆ°ç‰ˆæœ¬ä¿¡æ¯å³è¡¨ç¤ºæˆåŠŸã€‚ 

2ï¸âƒ£ å®‰è£… Python åŒ…
bash

æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
python -m venv venv
source venv/bin/activate   # Windows: venv\Scripts\activate

# å¿…è¦ä¾èµ–
pip install -U pip setuptools wheel

# æ ¸å¿ƒåº“
pip install pydub tqdm

# è¯­éŸ³è¯†åˆ«ï¼ˆä¸¤ç§æ–¹æ¡ˆä»»é€‰å…¶ä¸€ï¼‰
# æ–¹æ¡ˆ Aï¼šOpenAI Whisperï¼ˆç¦»çº¿ï¼Œæ•ˆæœå¥½ï¼‰
pip install -U "openai-whisper[torch]"   # è‡ªåŠ¨å®‰è£… torchï¼ˆCPU or GPUï¼‰

# æ–¹æ¡ˆ Bï¼šGoogle Speechâ€‘Recognitionï¼ˆåœ¨çº¿ï¼Œéœ€è¦ç½‘ç»œï¼‰
pip install speechrecognition
# æ–¹æ¡ˆ B éœ€è¦é¢å¤–çš„ audio backendï¼ˆå¦‚ PyAudioï¼‰ï¼š
pip install pyaudio   # Windows ç”¨æˆ·å¯ç›´æ¥ pipï¼ŒLinux éœ€å…ˆ apt-get install portaudio19-dev
æç¤ºï¼šå¦‚æœä½ çš„æœºå™¨ä¸Šå·²ç»è£…æœ‰ torchï¼Œç›´æ¥ pip install openai-whisper å³å¯ï¼›å¦åˆ™ä¸Šé¢ä¸€æ¡ä¼šè‡ªåŠ¨å¸®ä½ è£…å¯¹åº”çš„ CPU/GPU ç‰ˆæœ¬ã€‚ 

ğŸ› ï¸ å®Œæ•´è„šæœ¬ï¼ˆWhisper ç¦»çº¿ç‰ˆï¼‰
é€‚ç”¨äºï¼š 

éœ€è¦é«˜è´¨é‡è½¬å†™ï¼ˆä¸­æ–‡ã€è‹±æ–‡ã€æ—¥æ–‡ç­‰å¤šè¯­è¨€ï¼‰
æœ¬åœ°ç¦»çº¿ã€æ— éœ€ç½‘ç»œ
æ”¯æŒ GPU åŠ é€Ÿï¼ˆå¦‚æœæœ‰ï¼‰
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
âŒ„
âŒ„
âŒ„
âŒ„
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
video_to_text.py

æŠŠ MP4 è§†é¢‘ä¸­çš„è¯­éŸ³è½¬æˆçº¯æ–‡æœ¬ï¼ˆ.txtï¼‰ï¼Œ
ä½¿ç”¨ ffmpeg æŠ½å–éŸ³é¢‘ + OpenAI Whisper è¿›è¡Œè¯†åˆ«ã€‚
"""

import argparse
import os
import sys
import subprocess
import math
import shutil
from pathlib import Path
from tqdm import tqdm
from pydub import AudioSegment
import whisper
import torch

# -------------------------- è¾…åŠ©å‡½æ•° -------------------------- #

def check_ffmpeg():
    """ç¡®ä¿ç³»ç»Ÿèƒ½æ‰¾åˆ° ffmpeg/ffprobeï¼Œå¯ç›´æ¥è¿è¡Œçš„ç®€æ˜“æ£€æŸ¥ã€‚"""
    for exe in ("ffmpeg", "ffprobe"):
        if shutil.which(exe) is None:
            sys.exit(f"âŒ æœªæ‰¾åˆ° {exe}ï¼Œè¯·å…ˆå®‰è£…å¹¶æŠŠå…¶æ‰€åœ¨ç›®å½•åŠ å…¥ PATHã€‚")
    return True


def extract_audio(mp4_path: Path, out_wav: Path, codec: str = "pcm_s16le", sr: int = 16000):
    """
    ä½¿ç”¨ ffmpeg æŠŠ MP4 è½¬æˆå•å£°é“ 16k
<details type="reasoning" done="true" duration="1"> <summary>Thought for 1 seconds</summary> > User wants to convert mp4 file contents to txt using Python. Likely they want extract video frames as text? Or audio? "é‡Œé¢çš„ä¸œè¥¿è½¬æ¢ä¸ºtxt" could mean transcribe audio to text, or extract subtitles? Probably they want speech-to-text from video. Provide solution using speech recognition, ffmpeg to extract audio, then speech recognition (like Whisper). Provide code and steps. Also discuss extracting metadata (ffprobe). Provide script. Also handle large file, chunking. Provide requirements. </details> ä¸‹é¢ç»™å‡º **å®Œæ•´ã€å¯ç›´æ¥è¿è¡Œ** çš„ Python ç¤ºä¾‹ï¼Œå¸®åŠ©ä½ æŠŠä¸€ä¸ª **MP4 è§†é¢‘æ–‡ä»¶** é‡Œçš„ **è¯­éŸ³å†…å®¹**ï¼ˆæˆ–å­—å¹•ã€å…ƒæ•°æ®ï¼‰å…¨éƒ¨è½¬æˆ **çº¯æ–‡æœ¬ï¼ˆ.txtï¼‰**ã€‚ ç¤ºä¾‹åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼š | æ­¥éª¤ | ä½œç”¨ | å…³é”®å·¥å…· | |------|------|----------| | 1ï¸âƒ£ æŠŠ MP4 æ‹†æˆ **éŸ³é¢‘**ï¼ˆWAV/MP3ï¼‰ | è§†é¢‘æœ¬èº«æ˜¯äºŒè¿›åˆ¶å›¾åƒæµï¼Œå¿…é¡»å…ˆæŠŠå£°éŸ³æå–å‡ºæ¥ | `ffmpeg`ï¼ˆå‘½ä»¤è¡Œï¼‰ | | 2ï¸âƒ£ **åˆ‡åˆ†** é•¿éŸ³é¢‘ä¸ºè‹¥å¹² **çŸ­ç‰‡æ®µ**ï¼ˆé¿å…ä¸€æ¬¡æ€§å–‚ç»™æ¨¡å‹å¤ªå¤§ï¼‰ | å¤§æ–‡ä»¶ä¸€æ¬¡æ€§è¯†åˆ«ä¼šå ç”¨å¤§é‡æ˜¾å­˜/å†…å­˜ | `pydub` | | 3ï¸âƒ£ è°ƒç”¨ **è¯­éŸ³â€‘è½¬â€‘æ–‡å­—æ¨¡å‹** è¿›è¡Œè¯†åˆ« | æ¨èä½¿ç”¨ OpenAI **Whisper**ï¼ˆæœ¬åœ°ç¦»çº¿ï¼‰æˆ– `speech_recognition` + Google APIï¼ˆåœ¨çº¿ï¼‰ | `whisper`ã€`torch`ã€`speech_recognition` | | 4ï¸âƒ£ æŠŠè¯†åˆ«ç»“æœå†™å…¥ **.txt** æ–‡ä»¶ | å®Œæ•´çš„æ–‡å­—è¾“å‡º | æ ‡å‡† I/O | > **å¦‚æœä½ åªæƒ³æŠ½å–è§†é¢‘çš„å…ƒæ•°æ®ï¼ˆæ—¶é•¿ã€åˆ†è¾¨ç‡ã€ç ç‡ç­‰ï¼‰**ï¼Œè¯·ç›´æ¥è·³åˆ° **â€œå…ƒæ•°æ®æå–â€** é‚£ä¸€èŠ‚ï¼› > **å¦‚æœä½ å·²æœ‰å¤–éƒ¨å­—å¹•æ–‡ä»¶ï¼ˆ.srt/.assï¼‰**ï¼Œåªéœ€è¦æŠŠå®ƒè½¬æˆ txtï¼Œè¿™é‡Œä¹Ÿæä¾›äº†å¿«æ·è„šæœ¬ã€‚ --- ## ğŸ“¦ ç¯å¢ƒå‡†å¤‡ > **ç³»ç»Ÿè¦æ±‚**ï¼š > - Windows / macOS / Linuxï¼ˆå‡å¯ï¼‰ > - å·²å®‰è£… **FFmpeg**ï¼ˆç¡®ä¿ `ffmpeg` å’Œ `ffprobe` èƒ½åœ¨ç»ˆç«¯/å‘½ä»¤æç¤ºç¬¦ç›´æ¥è°ƒç”¨ï¼‰ > - Python **3.9+**ï¼ˆå»ºè®® 3.10/3.11ï¼‰ > - GPUï¼ˆå¯é€‰ï¼‰â€”â€”å¦‚æœæœ‰ NVIDIA GPUï¼ŒWhisper ä¼šå¿«å¾ˆå¤šï¼›æ²¡æœ‰ä¹Ÿå¯ä»¥åœ¨ CPU ä¸Šè·‘ï¼Œåªæ˜¯æ…¢ä¸€ç‚¹ã€‚ ### 1ï¸âƒ£ å®‰è£… FFmpeg | å¹³å° | å®‰è£…æ–¹å¼ | |------|----------| | **Windows** | ä¸‹è½½ https://ffmpeg.org/download.html#build-windows æä¾›çš„ zipï¼Œè§£å‹åæŠŠ `bin` ç›®å½•åŠ å…¥ç³»ç»Ÿ `PATH`ã€‚ | | **macOS** | `brew install ffmpeg` | | **Linux (Debian/Ubuntu)** | `sudo apt-get install ffmpeg` | > **éªŒè¯**ï¼šæ‰“å¼€ç»ˆç«¯ï¼Œæ‰§è¡Œ `ffmpeg -version`ï¼Œèƒ½çœ‹åˆ°ç‰ˆæœ¬ä¿¡æ¯å³è¡¨ç¤ºæˆåŠŸã€‚ ### 2ï¸âƒ£ å®‰è£… Python åŒ… ```bash # åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰ python -m venv venv source venv/bin/activate # Windows: venv\Scripts\activate # å¿…è¦ä¾èµ– pip install -U pip setuptools wheel # æ ¸å¿ƒåº“ pip install pydub tqdm # è¯­éŸ³è¯†åˆ«ï¼ˆä¸¤ç§æ–¹æ¡ˆä»»é€‰å…¶ä¸€ï¼‰ # æ–¹æ¡ˆ Aï¼šOpenAI Whisperï¼ˆç¦»çº¿ï¼Œæ•ˆæœå¥½ï¼‰ pip install -U "openai-whisper[torch]" # è‡ªåŠ¨å®‰è£… torchï¼ˆCPU or GPUï¼‰ # æ–¹æ¡ˆ Bï¼šGoogle Speechâ€‘Recognitionï¼ˆåœ¨çº¿ï¼Œéœ€è¦ç½‘ç»œï¼‰ pip install speechrecognition # æ–¹æ¡ˆ B éœ€è¦é¢å¤–çš„ audio backendï¼ˆå¦‚ PyAudioï¼‰ï¼š pip install pyaudio # Windows ç”¨æˆ·å¯ç›´æ¥ pipï¼ŒLinux éœ€å…ˆ apt-get install portaudio19-dev ``` > **æç¤º**ï¼šå¦‚æœä½ çš„æœºå™¨ä¸Šå·²ç»è£…æœ‰ `torch`ï¼Œç›´æ¥ `pip install openai-whisper` å³å¯ï¼›å¦åˆ™ä¸Šé¢ä¸€æ¡ä¼šè‡ªåŠ¨å¸®ä½ è£…å¯¹åº”çš„ CPU/GPU ç‰ˆæœ¬ã€‚ --- ## ğŸ› ï¸ å®Œæ•´è„šæœ¬ï¼ˆWhisper ç¦»çº¿ç‰ˆï¼‰ > **é€‚ç”¨äº**ï¼š > - éœ€è¦é«˜è´¨é‡è½¬å†™ï¼ˆä¸­æ–‡ã€è‹±æ–‡ã€æ—¥æ–‡ç­‰å¤šè¯­è¨€ï¼‰ > - æœ¬åœ°ç¦»çº¿ã€æ— éœ€ç½‘ç»œ > - æ”¯æŒ GPU åŠ é€Ÿï¼ˆå¦‚æœæœ‰ï¼‰ ```python #!/usr/bin/env python3 # -*- coding: utf-8 -*- """ video_to_text.py æŠŠ MP4 è§†é¢‘ä¸­çš„è¯­éŸ³è½¬æˆçº¯æ–‡æœ¬ï¼ˆ.txtï¼‰ï¼Œ ä½¿ç”¨ ffmpeg æŠ½å–éŸ³é¢‘ + OpenAI Whisper è¿›è¡Œè¯†åˆ«ã€‚ """ import argparse import os import sys import subprocess import math import shutil from pathlib import Path from tqdm import tqdm from pydub import AudioSegment import whisper import torch # -------------------------- è¾…åŠ©å‡½æ•° -------------------------- # def check_ffmpeg(): """ç¡®ä¿ç³»ç»Ÿèƒ½æ‰¾åˆ° ffmpeg/ffprobeï¼Œå¯ç›´æ¥è¿è¡Œçš„ç®€æ˜“æ£€æŸ¥ã€‚""" for exe in ("ffmpeg", "ffprobe"): if shutil.which(exe) is None: sys.exit(f"âŒ æœªæ‰¾åˆ° {exe}ï¼Œè¯·å…ˆå®‰è£…å¹¶æŠŠå…¶æ‰€åœ¨ç›®å½•åŠ å…¥ PATHã€‚") return True def extract_audio(mp4_path: Path, out_wav: Path, codec: str = "pcm_s16le", sr: int = 16000): """ ä½¿ç”¨ ffmpeg æŠŠ MP4 è½¬æˆå•å£°é“ 16k
ç”¨pythonè¿›è¡Œå¤åˆ¶è¿™ä¸ªæ–‡ä»¶

profile
gpt-oss:120b
æ€è€ƒç”¨æ—¶ 1 ç§’
ä¸‹é¢ç»™å‡º Python å¤åˆ¶æ–‡ä»¶çš„å‡ ç§å¸¸ç”¨å†™æ³•ï¼Œä»æœ€ç®€æ´çš„ shutil.copy åˆ°å¸¦è¿›åº¦æ¡ã€è·¨å¹³å°çš„å¤§æ–‡ä»¶é«˜é€Ÿæ‹·è´å®ç°ï¼Œå…¨éƒ¨é…æœ‰å¯ç›´æ¥è¿è¡Œçš„ç¤ºä¾‹ä»£ç ã€‚ä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚æŒ‘é€‰åˆé€‚çš„æ–¹å¼ã€‚

ğŸ¯ ç›®æ ‡
åœºæ™¯
æ¨èå®ç°
å…³é”®ç‚¹
ä¸€æ¬¡æ€§å¤åˆ¶å°æ–‡ä»¶	
shutil.copy / Path.renameï¼ˆåŒç›˜ç§»åŠ¨ï¼‰	
ä»£ç æœ€ç®€ã€è‡ªåŠ¨ä¿ç•™æƒé™
ä¿ç•™å®Œæ•´å…ƒæ•°æ®ï¼ˆæ—¶é—´æˆ³ã€æƒé™ã€ACLï¼‰	
shutil.copy2	
ä¸ç³»ç»Ÿ cp -p è¡Œä¸ºç›¸åŒ
æ˜¾ç¤ºå¤åˆ¶è¿›åº¦	
æ‰‹åŠ¨åˆ†å—è¯»å– + tqdm è¿›åº¦æ¡	
é€‚åˆ 100â€¯MBâ€‘å‡ â€¯GB çš„æ–‡ä»¶
è¶…å¤§æ–‡ä»¶ï¼ˆ>â€¯10â€¯GBï¼‰æˆ–é«˜å¹¶å‘æ‹·è´	
mmap / å¤šè¿›ç¨‹åˆ†å—æ‹·è´	
é›¶æ‹·è´æˆ–å¹¶è¡Œæå‡åå
è·¨å¹³å°ï¼ˆWindowsâ€¯/â€¯Linuxâ€¯/â€¯macOSï¼‰	
ç»Ÿä¸€ä½¿ç”¨ pathlib + shutil	
åªè¦ Python è§£é‡Šå™¨æœ¬èº«æ”¯æŒå³å¯
å¤åˆ¶åˆ°åŒä¸€ç›®å½•ä¸‹æ”¹å	
shutil.copy + ç›®æ ‡è·¯å¾„	
åªæ”¹æ–‡ä»¶åä¸æ”¹ç›®å½•
1ï¸âƒ£ æœ€ç®€æ´ï¼šshutil.copy / shutil.copy2
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
import shutil
from pathlib import Path

def copy_simple(src: str, dst: str):
    """
    ç›´æ¥å¤åˆ¶æ–‡ä»¶ï¼ˆä¸ä¿ç•™å…ƒæ•°æ®ï¼‰ã€‚
    å¦‚æœ dst æ˜¯ç›®å½•ï¼Œåˆ™æ–‡ä»¶ä¼šæ”¾è¿›è¯¥ç›®å½•å¹¶ä¿æŒåŸæ–‡ä»¶åã€‚
    """
    src_path = Path(src)
    dst_path = Path(dst)

    # ç›®æ ‡æ˜¯ç›®å½• â†’ è‡ªåŠ¨æ‹¼æ¥æ–‡ä»¶å
    if dst_path.is_dir():
        dst_path = dst_path / src_path.name

    shutil.copy(src_path, dst_path)          # åªæ‹·è´å†…å®¹
    print(f"âœ… å·²å¤åˆ¶ {src_path} â†’ {dst_path}")

def copy_with_meta(src: str, dst: str):
    """
    å¤åˆ¶æ–‡ä»¶å¹¶å®Œæ•´ä¿ç•™å…ƒæ•°æ®ï¼ˆåˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ã€æƒé™ï¼‰ã€‚
    ç›¸å½“äº Linux ä¸‹ `cp -p`ã€macOS/Windows ä¸‹çš„ â€œä¿ç•™å±æ€§â€ã€‚
    """
    src_path = Path(src)
    dst_path = Path(dst)

    if dst_path.is_dir():
        dst_path = dst_path / src_path.name

    shutil.copy2(src_path, dst_path)         # åŒæ—¶å¤åˆ¶æƒé™ã€æ—¶é—´æˆ³ç­‰
    print(f"âœ… å·²å®Œæ•´å¤åˆ¶ï¼ˆä¿ç•™å…ƒæ•°æ®ï¼‰{src_path} â†’ {dst_path}")

# ------------------- ç”¨æ³•ç¤ºä¾‹ ------------------- #
if __name__ == "__main__":
    copy_simple("example.mp4", "backup/example_copy.mp4")
    copy_with_meta("example.mp4", "backup/example_copy2.mp4")
æ³¨æ„ï¼š 

shutil.copy ä¼šåœ¨å¤åˆ¶å è‡ªåŠ¨åˆ›å»ºç›®æ ‡æ–‡ä»¶çš„å†™æƒé™ï¼Œä½†ä¸ä¼šä¿ç•™åŸæ–‡ä»¶çš„ ä¿®æ”¹æ—¶é—´ã€è®¿é—®æ—¶é—´ã€‚
shutil.copy2 ä¼šä¿ç•™ æƒé™ã€ä¿®æ”¹æ—¶é—´ã€è®¿é—®æ—¶é—´ï¼ˆåœ¨ Windows ä¸Šä¹Ÿä¼šä¿ç•™ æ–‡ä»¶å±æ€§ï¼‰ï¼Œä½†ä¸ä¿è¯å¤åˆ¶ ACLï¼ˆå¦‚ NTFS çš„ç‰¹æ®Šæƒé™ï¼‰ï¼Œå¦‚æœéœ€è¦æ›´ç»†ç²’åº¦çš„ ACLï¼Œè¯·ä½¿ç”¨ os.system("xcopy ...") æˆ–ç¬¬ä¸‰æ–¹åº“ pywin32ï¼ˆä»… Windowsï¼‰ã€‚
2ï¸âƒ£ å¸¦è¿›åº¦æ¡çš„åˆ†å—å¤åˆ¶ï¼ˆæ¨èç”¨äºå‡ ç™¾ MBâ€‘å‡  GB çš„æ–‡ä»¶ï¼‰
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
import os
from pathlib import Path
from tqdm import tqdm

def copy_with_progress(src: str, dst: str, buf_size: int = 4 * 1024 * 1024):
    """
    æŒ‰å—è¯»å–å¹¶å†™å…¥ï¼Œå®æ—¶æ˜¾ç¤º tqdm è¿›åº¦æ¡ã€‚
    - buf_sizeï¼šæ¯æ¬¡è¯»å†™çš„å­—èŠ‚æ•°ï¼Œé»˜è®¤ 4â€¯MiBï¼ˆå¯æ ¹æ®ç£ç›˜/ç½‘ç»œè°ƒä¼˜ï¼‰ã€‚
    """
    src_path = Path(src)
    dst_path = Path(dst)

    if dst_path.is_dir():
        dst_path = dst_path / src_path.name

    total_size = src_path.stat().st_size
    copied = 0

    with src_path.open("rb") as f_src, dst_path.open("wb") as f_dst, tqdm(
        total=total_size, unit="B", unit_scale=True, unit_divisor=1024,
        desc=f"å¤åˆ¶ {src_path.name}"
    ) as pbar:
        while True:
            chunk = f_src.read(buf_size)
            if not chunk:
                break
            f_dst.write(chunk)
            copied += len(chunk)
            pbar.update(len(chunk))

    # åŒæ­¥æ–‡ä»¶å±æ€§ï¼ˆæ—¶é—´æˆ³ã€æƒé™ï¼‰â€”â€”å¯é€‰
    shutil.copystat(src_path, dst_path)

    print(f"\nâœ… å¤åˆ¶å®Œæˆï¼Œå¤§å° {copied:,} å­—èŠ‚ â†’ {dst_path}")

# ------------------- ç”¨æ³•ç¤ºä¾‹ ------------------- #
if __name__ == "__main__":
    copy_with_progress("example.mp4", "backup/example_copy_progress.mp4")
ä¸ºä»€ä¹ˆè¦è‡ªå·±åˆ†å—ï¼Ÿ

shutil.copyfileobj ä¹Ÿå¯ä»¥åˆ†å—ï¼Œä½†ä¸è‡ªå¸¦è¿›åº¦æ¡ï¼›è‡ªå·±å†™å¾ªç¯å¯ä»¥éšæ—¶åŠ å…¥ æ—¥å¿—ã€æ ¡éªŒã€åŠ å¯† ç­‰é¢å¤–é€»è¾‘ã€‚
tqdm ä¼šè‡ªåŠ¨è®¡ç®— ä¼ è¾“é€Ÿç‡ã€å·²ç”¨æ—¶é—´ã€é¢„è®¡å‰©ä½™æ—¶é—´ï¼Œæå¤§æå‡ç”¨æˆ·ä½“éªŒã€‚
3ï¸âƒ£ è¶…å¤§æ–‡ä»¶çš„ é›¶æ‹·è´ï¼ˆmmapï¼‰
mmap åœ¨åº•å±‚åˆ©ç”¨æ“ä½œç³»ç»Ÿçš„ å†…å­˜æ˜ å°„ï¼ˆmemoryâ€‘mapped fileï¼‰æŠ€æœ¯ï¼Œè¯»å–å’Œå†™å…¥éƒ½ä¸éœ€è¦é¢å¤–çš„ç”¨æˆ·ç©ºé—´æ‹·è´ï¼Œé€‚åˆ å•è¿›ç¨‹ã€å•æ ¸ ç¯å¢ƒä¸‹çš„ GB çº§åˆ« æ–‡ä»¶æ‹·è´ã€‚
ï¼ˆåœ¨ Windows ä¸ŠåŒæ ·å¯ç”¨ï¼Œåªè¦æ–‡ä»¶ç³»ç»Ÿæ”¯æŒæ˜ å°„å³å¯ï¼‰ 

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
import mmap
from pathlib import Path

def copy_mmap(src: str, dst: str):
    src_path = Path(src)
    dst_path = Path(dst)

    if dst_path.is_dir():
        dst_path = dst_path / src_path.name

    # 1ï¸âƒ£ å…ˆåˆ›å»ºç›®æ ‡æ–‡ä»¶å¹¶é¢„åˆ†é…åŒæ ·å¤§å°
    with src_path.open("rb") as f_src, dst_path.open("wb") as f_dst:
        f_dst.truncate(src_path.stat().st_size)   # é¢„åˆ†é…ç£ç›˜ç©ºé—´

    # 2ï¸âƒ£ ä½¿ç”¨ mmap åŒæ—¶æ˜ å°„è¯»å†™
    with open(src_path, "rb") as f_src, open(dst_path, "r+b") as f_dst:
        # å‚æ•° 0 è¡¨ç¤ºæ˜ å°„æ•´ä¸ªæ–‡ä»¶
        with mmap.mmap(f_src.fileno(), 0, access=mmap.ACCESS_READ) as src_map, \
             mmap.mmap(f_dst.fileno(), 0, access=mmap.ACCESS_WRITE) as dst_map:
            dst_map[:] = src_map[:]   # ä¸€è¡Œä»£ç å®Œæˆæ‹·è´ï¼ˆåº•å±‚æ˜¯å†…æ ¸çº§æ‹·è´ï¼‰

    print(f"âœ… mmap é›¶æ‹·è´å®Œæˆ â†’ {dst_path}")

# ------------------- ç”¨æ³•ç¤ºä¾‹ ------------------- #
if __name__ == "__main__":
    copy_mmap("example.mp4", "backup/example_copy_mmap.mp4")
ä¼˜ç‚¹

é€Ÿåº¦å¿«ï¼ˆå‡ ä¹åªå—ç£ç›˜ååé™åˆ¶ï¼‰
å†…å­˜å ç”¨ä½ï¼ˆåªæ˜ å°„ä¸€æ¬¡ï¼Œä¸éœ€è¦åœ¨ Python é‡ŒæŒæœ‰æ•´ä¸ªæ–‡ä»¶ï¼‰
ç¼ºç‚¹

åªèƒ½åœ¨ åŒä¸€å°æœºå™¨å†…éƒ¨ä½¿ç”¨ï¼Œè·¨ç½‘ç»œéœ€è¦å…ˆæŠŠæ–‡ä»¶æ˜ å°„åˆ°ç½‘ç»œå…±äº«ç›˜ã€‚
å¯¹ æå°æ–‡ä»¶ æ²¡æœ‰ä¼˜åŠ¿ï¼Œåè€Œå¤šäº†æ‰“å¼€æ˜ å°„çš„å¼€é”€ã€‚
4ï¸âƒ£ å¤šè¿›ç¨‹å¹¶è¡Œåˆ†å—å¤åˆ¶ï¼ˆé€‚åˆ å¤šæ ¸æœåŠ¡å™¨ æˆ– ç½‘ç»œç£ç›˜ï¼‰
ä¸‹é¢çš„å®ç°æŠŠæ–‡ä»¶åˆ’åˆ†ä¸ºè‹¥å¹² ç­‰å¤§å°å—ï¼Œæ¯å—äº¤ç»™ç‹¬ç«‹çš„å­è¿›ç¨‹å¹¶è¡Œè¯»å–/å†™å…¥ã€‚é€‚åˆ 10â€¯GBâ€‘æ•°ç™¾â€¯GB çš„è§†é¢‘ã€å¤‡ä»½é•œåƒç­‰åœºæ™¯ã€‚

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
import os
import math
from pathlib import Path
from multiprocessing import Process, Queue, cpu_count
from tqdm import tqdm

def _worker_copy(src_path: Path, dst_path: Path, start: int, size: int, q: Queue):
    """å­è¿›ç¨‹å®é™…æ‰§è¡Œåˆ†å—å¤åˆ¶"""
    with src_path.open("rb") as f_src, dst_path.open("r+b") as f_dst:
        f_src.seek(start)
        f_dst.seek(start)
        remaining = size
        buf = 1024 * 1024  # 1â€¯MiB ç¼“å†²åŒº
        while remaining:
            read_len = min(buf, remaining)
            data = f_src.read(read_len)
            f_dst.write(data)
            remaining -= read_len
    q.put(start)   # æŠŠå·²ç»å®Œæˆçš„å—èµ·å§‹ä½ç½®å›æŠ¥ç»™ä¸»è¿›ç¨‹ï¼ˆç”¨äºè¿›åº¦æ˜¾ç¤ºï¼‰

def parallel_copy(src: str, dst: str, block_size: int = 64 * 1024 * 1024):
    """
    å¤šè¿›ç¨‹å¹¶è¡Œå¤åˆ¶å¤§æ–‡ä»¶ã€‚
    - block_sizeï¼šæ¯ä¸ªå­è¿›ç¨‹è´Ÿè´£çš„å—å¤§å°ï¼ˆé»˜è®¤ 64â€¯MiBï¼Œå¯è‡ªè¡Œè°ƒèŠ‚ï¼‰ã€‚
    - ä½¿ç”¨ cpu_count() è®¡ç®—å¹¶è¡Œåº¦ã€‚
    """
    src_path = Path(src)
    dst_path = Path(dst)

    if dst_path.is_dir():
        dst_path = dst_path / src_path.name

    total_size = src_path.stat().st_size

    # 1ï¸âƒ£ é¢„å…ˆåˆ›å»ºç›®æ ‡æ–‡ä»¶å¹¶åˆ†é…åŒæ ·å¤§å°
    with dst_path.open("wb") as f:
        f.truncate(total_size)

    # 2ï¸âƒ£ è®¡ç®—å—æ•°
    blocks = math.ceil(total_size / block_size)

    # 3ï¸âƒ£ å¯åŠ¨å­è¿›ç¨‹
    q = Queue()
    processes = []
    for i in range(blocks):
        start = i * block_size
        size = min(block_size, total_size - start)
        p = Process(target=_worker_copy,
                    args=(src_path, dst_path, start, size, q),
                    daemon=False)
        p.start()
        processes.append(p)

    # 4ï¸âƒ£ ä¸»è¿›ç¨‹æ˜¾ç¤ºè¿›åº¦æ¡
    with tqdm(total=total_size, unit="B", unit_scale=True,
              desc=f"å¹¶è¡Œå¤åˆ¶ {src_path.name}", ncols=80) as pbar:
        completed = 0
        while completed < total_size:
            finished_start = q.get()          # é˜Ÿåˆ—é‡Œæ˜¯å—çš„èµ·å§‹åç§»
            # è®¡ç®—æœ¬å—å¤§å°ï¼ˆæœ€åä¸€å—å¯èƒ½å°äº block_sizeï¼‰
            finished_size = min(block_size, total_size - finished_start)
            completed += finished_size
            pbar.update(finished_size)

    # 5ï¸âƒ£ ç­‰å¾…æ‰€æœ‰å­è¿›ç¨‹ç»“æŸ
    for p in processes:
        p.join()

    print(f"\nâœ… å¹¶è¡Œå¤åˆ¶å®Œæˆ â†’ {dst_path}")

# ------------------- ç”¨æ³•ç¤ºä¾‹ ------------------- #
if __name__ == "__main__":
    parallel_copy("example.mp4", "backup/example_parallel_copy.mp4")
è°ƒä¼˜å»ºè®®

å‚æ•°
è¯´æ˜
æ¨èå€¼
block_size	
æ¯ä¸ªå­è¿›ç¨‹ä¸€æ¬¡è¯»å–çš„å­—èŠ‚æ•°	
SSDâ€¯â†’â€¯64â€¯MiB128â€¯MiBï¼›æœºæ¢°ç¡¬ç›˜â€¯â†’â€¯32â€¯MiB64â€¯MiB
cpu_count()	
å¹¶å‘å­è¿›ç¨‹æ•°ï¼ˆé»˜è®¤ç­‰äº CPU æ ¸å¿ƒæ•°ï¼‰	
è‹¥ç£ç›˜æ˜¯ RAID/NVMeï¼Œå¯ä»¥æŠŠè¿›ç¨‹æ•°è°ƒåˆ° 2â€¯~â€¯4 å€ çš„ CPU æ ¸å¿ƒæ•°ä»¥æå‡ I/O å¹¶å‘
daemon	
å­è¿›ç¨‹æ˜¯å¦éšä¸»è¿›ç¨‹é€€å‡ºè€Œå¼ºåˆ¶ç»ˆæ­¢	
è‹¥å¤åˆ¶è¿‡ç¨‹å¿…é¡» å®Œæ•´ï¼ˆé¿å…åŠæˆå“ï¼‰ï¼Œè¯·ä¿æŒ daemon=False å¹¶æ‰‹åŠ¨ join()ï¼›è‹¥åªåšä¸´æ—¶æ‹·è´ï¼Œå¯è®¾ daemon=True åŠ é€Ÿé€€å‡º
ğŸ“‚ å®é™…ä½¿ç”¨æ¡ˆä¾‹ï¼ˆæŠŠ MP4 å¤åˆ¶åˆ°å¦ä¸€ä¸ªç›®å½•ï¼‰
å‡è®¾ä½ æœ‰ä¸€ä¸ªåŸå§‹è§†é¢‘ source/video.mp4ï¼Œæƒ³æŠŠå®ƒ å®Œæ•´å¤åˆ¶ åˆ° backup/ ç›®å½•å¹¶åœ¨æ§åˆ¶å°çœ‹åˆ°è¿›åº¦æ¡ï¼š

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
from pathlib import Path
import shutil
from tqdm import tqdm

def copy_file_with_progress(src: str, dst_dir: str, bufsize: int = 4 * 1024 * 1024):
    """
    ç®€å•ç‰ˆï¼šåˆ†å—è¯»å–+tqdm è¿›åº¦æ¡ + shutil.copymodeï¼ˆä¿ç•™æƒé™ï¼‰ã€‚
    é€‚åˆ 100â€¯MBâ€‘å‡ â€¯GB çš„å¸¸è§„æ–‡ä»¶ã€‚
    """
    src_path = Path(src)
    dst_dir = Path(dst_dir)
    dst_dir.mkdir(parents=True, exist_ok=True)
    dst_path = dst_dir / src_path.name

    total = src_path.stat().st_size
    with src_path.open('rb') as f_src, dst_path.open('wb') as f_dst, tqdm(
            total=total, unit='B', unit_scale=True, desc=f'å¤åˆ¶ {src_path.name}'
    ) as pbar:
        while True:
            data = f_src.read(bufsize)
            if not data:
                break
            f_dst.write(data)
            pbar.update(len(data))

    # å¤åˆ¶æ–‡ä»¶æƒé™ã€æ—¶é—´æˆ³ï¼ˆå¯é€‰ï¼‰
    shutil.copymode(src_path, dst_path)
    shutil.copystat(src_path, dst_path)   # åŒæ—¶ä¿ç•™è®¿é—®/ä¿®æ”¹æ—¶é—´

    print(f"âœ… å¤åˆ¶å®Œæˆ â†’ {dst_path}")

# ------------------- ç”¨æ³• ------------------- #
if __name__ == '__main__':
    copy_file_with_progress('source/video.mp4', 'backup')
ğŸ“Œ å°ç»“ & å¸¸è§é—®é¢˜
é—®é¢˜
è§£å†³æ–¹æ¡ˆ
â€œå¤åˆ¶åæ–‡ä»¶å¤§å°ä¸å¯¹â€	
1ï¸âƒ£ ç¡®è®¤æ˜¯å¦ä½¿ç”¨äº† äºŒè¿›åˆ¶æ¨¡å¼ï¼ˆ'rb' / 'wb'ï¼‰<br>2ï¸âƒ£ å¯¹ Windows ä¸Šçš„ æ–‡æœ¬æ–‡ä»¶ï¼ˆCRLFï¼‰è¯·ä¸€å®šä½¿ç”¨äºŒè¿›åˆ¶æ¨¡å¼ï¼Œå¦åˆ™ä¼šè‡ªåŠ¨è½¬æ¢å¯¼è‡´å¤§å°å˜åŒ–
â€œå¤åˆ¶åæƒé™ä¸¢å¤±â€	
ä½¿ç”¨ shutil.copy2 æˆ–åœ¨å¤åˆ¶åæ‰‹åŠ¨ shutil.copymode(src, dst)
â€œå¤åˆ¶å¤§æ–‡ä»¶éå¸¸æ…¢â€	
â‘  æ£€æŸ¥ç£ç›˜æ˜¯å¦ä¸º æœºæ¢° HDDï¼ˆç“¶é¢ˆåœ¨ I/Oï¼‰<br>â‘¡ ä½¿ç”¨ mmap æˆ– å¤šè¿›ç¨‹åˆ†å—ï¼ˆä¸Šé¢çš„ parallel_copyï¼‰<br>â‘¢ è‹¥æ˜¯ç½‘ç»œç£ç›˜ï¼ˆNASã€SMBï¼‰ï¼Œè€ƒè™‘ å…ˆæŠŠæ–‡ä»¶å…ˆæ‹‰åˆ°æœ¬åœ° å†å¤åˆ¶
â€œå¤åˆ¶è¿‡ç¨‹è¢«æ„å¤–ä¸­æ–­ï¼Œç•™ä¸‹æ®‹ç¼ºæ–‡ä»¶â€	
å¤åˆ¶å‰å…ˆåˆ›å»º ä¸´æ—¶æ–‡ä»¶ï¼ˆå¦‚ dst_path.with_suffix('.part')ï¼‰ï¼Œå¤åˆ¶æˆåŠŸå os.replace(tmp, dst_path)ï¼Œè¿™æ ·å³ä½¿ä¸­é€”å¼‚å¸¸ä¹Ÿä¸ä¼šç•™ä¸‹ä¸å®Œæ•´çš„ç›®æ ‡æ–‡ä»¶
â€œè·¨ç›˜ç§»åŠ¨ï¼ˆåŒä¸€å°æœºå™¨ä¸åŒåˆ†åŒºï¼‰æƒ³ä¿ç•™å…ƒæ•°æ®â€	
shutil.moveï¼ˆä¼šè‡ªåŠ¨è°ƒç”¨ç³»ç»Ÿçš„ rename/moveï¼‰ï¼Œä½†è·¨åˆ†åŒºä¼šé€€åŒ–ä¸ºå¤åˆ¶+åˆ é™¤ï¼Œå»ºè®®ä»ä½¿ç”¨ shutil.copy2 å† os.remove(src)ï¼Œä¿è¯å±æ€§å®Œæ•´
â€œéœ€è¦å¤åˆ¶ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼ˆé€’å½’ï¼‰â€	
shutil.copytree(src_dir, dst_dir, dirs_exist_ok=True)ï¼ˆPythonâ€¯3.8+ï¼‰<br>æˆ–æ‰‹åŠ¨éå† Path.rglob("*") å¹¶é€ä¸ª copy2
ğŸš€ å¿«é€Ÿä¸Šæ‰‹
bash

æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
# 1ï¸âƒ£ åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆå¯é€‰ï¼‰
python -m venv venv
source venv/bin/activate   # Windows: venv\Scripts\activate

# 2ï¸âƒ£ å®‰è£… tqdmï¼ˆè¿›åº¦æ¡åº“ï¼‰å’Œ pydubï¼ˆå¦‚æœéœ€è¦éŸ³é¢‘åˆ‡ç‰‡ï¼‰
pip install tqdm pydub

# 3ï¸âƒ£ è¿è¡Œä½ é€‰ä¸­çš„è„šæœ¬
python copy_file_with_progress.py   # æˆ–è€… python video_to_text.py ï¼ˆå‰é¢ç»™çš„ MP4 â†’ txt ç¤ºä¾‹ï¼‰
ä¸€å¥è¯æ€»ç»“ï¼š 

å°æ–‡ä»¶ â†’ shutil.copy2ï¼ˆä¿ç•™å±æ€§ï¼‰
æƒ³è¦è¿›åº¦ â†’ åˆ†å—è¯»å– + tqdm
å¤§æ–‡ä»¶/é«˜åå â†’ mmap æˆ– å¤šè¿›ç¨‹åˆ†å—ï¼ˆparallel_copyï¼‰
è¿™æ ·ï¼Œä½ å°±å¯ä»¥ç”¨ Python è½»æ¾ã€å¯é åœ°æŠŠä»»æ„ MP4ï¼ˆæˆ–å…¶ä»–ä»»æ„æ–‡ä»¶ï¼‰å¤åˆ¶åˆ°ç›®æ ‡ä½ç½®äº†ã€‚ç¥ä½ ç©å¾—å¼€å¿ƒ ğŸ‰!

<details type="reasoning" done="true" duration="1"> <summary>Thought for 1 seconds</summary> > User says "ç”¨pythonè¿›è¡Œå¤åˆ¶è¿™ä¸ªæ–‡ä»¶". They want to copy a file using Python. Probably they refer to the previous context about MP4 file? They might want to copy the file (the MP4) using Python. Provide code using shutil.copy, copy2, etc., handling large files, progress bar, possibly using pathlib. Also discuss binary copy with buffers, memory-mapped copy, multiprocessing for large files. Provide examples. > > Will answer in Chinese, include code snippets. </details> ä¸‹é¢ç»™å‡º **Python å¤åˆ¶æ–‡ä»¶çš„å‡ ç§å¸¸ç”¨å†™æ³•**ï¼Œä»æœ€ç®€æ´çš„ `shutil.copy` åˆ°å¸¦è¿›åº¦æ¡ã€è·¨å¹³å°çš„å¤§æ–‡ä»¶é«˜é€Ÿæ‹·è´å®ç°ï¼Œå…¨éƒ¨é…æœ‰å¯ç›´æ¥è¿è¡Œçš„ç¤ºä¾‹ä»£ç ã€‚ä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚æŒ‘é€‰åˆé€‚çš„æ–¹å¼ã€‚ --- ## ğŸ¯ ç›®æ ‡ | åœºæ™¯ | æ¨èå®ç° | å…³é”®ç‚¹ | |------|----------|--------| | **ä¸€æ¬¡æ€§å¤åˆ¶å°æ–‡ä»¶** | `shutil.copy` / `Path.rename`ï¼ˆåŒç›˜ç§»åŠ¨ï¼‰ | ä»£ç æœ€ç®€ã€è‡ªåŠ¨ä¿ç•™æƒé™ | | **ä¿ç•™å®Œæ•´å…ƒæ•°æ®ï¼ˆæ—¶é—´æˆ³ã€æƒé™ã€ACLï¼‰** | `shutil.copy2` | ä¸ç³»ç»Ÿ `cp -p` è¡Œä¸ºç›¸åŒ | | **æ˜¾ç¤ºå¤åˆ¶è¿›åº¦** | æ‰‹åŠ¨åˆ†å—è¯»å– + `tqdm` è¿›åº¦æ¡ | é€‚åˆ 100â€¯MBâ€‘å‡ â€¯GB çš„æ–‡ä»¶ | | **è¶…å¤§æ–‡ä»¶ï¼ˆ>â€¯10â€¯GBï¼‰æˆ–é«˜å¹¶å‘æ‹·è´** | `mmap` / å¤šè¿›ç¨‹åˆ†å—æ‹·è´ | é›¶æ‹·è´æˆ–å¹¶è¡Œæå‡åå | | **è·¨å¹³å°ï¼ˆWindowsâ€¯/â€¯Linuxâ€¯/â€¯macOSï¼‰** | ç»Ÿä¸€ä½¿ç”¨ `pathlib` + `shutil` | åªè¦ Python è§£é‡Šå™¨æœ¬èº«æ”¯æŒå³å¯ | | **å¤åˆ¶åˆ°åŒä¸€ç›®å½•ä¸‹æ”¹å** | `shutil.copy` + ç›®æ ‡è·¯å¾„ | åªæ”¹æ–‡ä»¶åä¸æ”¹ç›®å½• | --- ## 1ï¸âƒ£ æœ€ç®€æ´ï¼š`shutil.copy` / `shutil.copy2` ```python import shutil from pathlib import Path def copy_simple(src: str, dst: str): """ ç›´æ¥å¤åˆ¶æ–‡ä»¶ï¼ˆä¸ä¿ç•™å…ƒæ•°æ®ï¼‰ã€‚ å¦‚æœ dst æ˜¯ç›®å½•ï¼Œåˆ™æ–‡ä»¶ä¼šæ”¾è¿›è¯¥ç›®å½•å¹¶ä¿æŒåŸæ–‡ä»¶åã€‚ """ src_path = Path(src) dst_path = Path(dst) # ç›®æ ‡æ˜¯ç›®å½• â†’ è‡ªåŠ¨æ‹¼æ¥æ–‡ä»¶å if dst_path.is_dir(): dst_path = dst_path / src_path.name shutil.copy(src_path, dst_path) # åªæ‹·è´å†…å®¹ print(f"âœ… å·²å¤åˆ¶ {src_path} â†’ {dst_path}") def copy_with_meta(src: str, dst: str): """ å¤åˆ¶æ–‡ä»¶å¹¶å®Œæ•´ä¿ç•™å…ƒæ•°æ®ï¼ˆåˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ã€æƒé™ï¼‰ã€‚ ç›¸å½“äº Linux ä¸‹ `cp -p`ã€macOS/Windows ä¸‹çš„ â€œä¿ç•™å±æ€§â€ã€‚ """ src_path = Path(src) dst_path = Path(dst) if dst_path.is_dir(): dst_path = dst_path / src_path.name shutil.copy2(src_path, dst_path) # åŒæ—¶å¤åˆ¶æƒé™ã€æ—¶é—´æˆ³ç­‰ print(f"âœ… å·²å®Œæ•´å¤åˆ¶ï¼ˆä¿ç•™å…ƒæ•°æ®ï¼‰{src_path} â†’ {dst_path}") # ------------------- ç”¨æ³•ç¤ºä¾‹ ------------------- # if __name__ == "__main__": copy_simple("example.mp4", "backup/example_copy.mp4") copy_with_meta("example.mp4", "backup/example_copy2.mp4") ``` > **æ³¨æ„**ï¼š > - `shutil.copy` ä¼šåœ¨å¤åˆ¶å **è‡ªåŠ¨åˆ›å»ºç›®æ ‡æ–‡ä»¶çš„å†™æƒé™**ï¼Œä½†ä¸ä¼šä¿ç•™åŸæ–‡ä»¶çš„ **ä¿®æ”¹æ—¶é—´ã€è®¿é—®æ—¶é—´**ã€‚ > - `shutil.copy2` ä¼šä¿ç•™ **æƒé™ã€ä¿®æ”¹æ—¶é—´ã€è®¿é—®æ—¶é—´**ï¼ˆåœ¨ Windows ä¸Šä¹Ÿä¼šä¿ç•™ **æ–‡ä»¶å±æ€§**ï¼‰ï¼Œä½†ä¸ä¿è¯å¤åˆ¶ **ACL**ï¼ˆå¦‚ NTFS çš„ç‰¹æ®Šæƒé™ï¼‰ï¼Œå¦‚æœéœ€è¦æ›´ç»†ç²’åº¦çš„ ACLï¼Œè¯·ä½¿ç”¨ `os.system("xcopy ...")` æˆ–ç¬¬ä¸‰æ–¹åº“ `pywin32`ï¼ˆä»… Windowsï¼‰ã€‚ --- ## 2ï¸âƒ£ å¸¦è¿›åº¦æ¡çš„åˆ†å—å¤åˆ¶ï¼ˆæ¨èç”¨äºå‡ ç™¾ MBâ€‘å‡  GB çš„æ–‡ä»¶ï¼‰ ```python import os from pathlib import Path from tqdm import tqdm def copy_with_progress(src: str, dst: str, buf_size: int = 4 * 1024 * 1024): """ æŒ‰å—è¯»å–å¹¶å†™å…¥ï¼Œå®æ—¶æ˜¾ç¤º tqdm è¿›åº¦æ¡ã€‚ - buf_sizeï¼šæ¯æ¬¡è¯»å†™çš„å­—èŠ‚æ•°ï¼Œé»˜è®¤ 4â€¯MiBï¼ˆå¯æ ¹æ®ç£ç›˜/ç½‘ç»œè°ƒä¼˜ï¼‰ã€‚ """ src_path = Path(src) dst_path = Path(dst) if dst_path.is_dir(): dst_path = dst_path / src_path.name total_size = src_path.stat().st_size copied = 0 with src_path.open("rb") as f_src, dst_path.open("wb") as f_dst, tqdm( total=total_size, unit="B", unit_scale=True, unit_divisor=1024, desc=f"å¤åˆ¶ {src_path.name}" ) as pbar: while True: chunk = f_src.read(buf_size) if not chunk: break f_dst.write(chunk) copied += len(chunk) pbar.update(len(chunk)) # åŒæ­¥æ–‡ä»¶å±æ€§ï¼ˆæ—¶é—´æˆ³ã€æƒé™ï¼‰â€”â€”å¯é€‰ shutil.copystat(src_path, dst_path) print(f"\nâœ… å¤åˆ¶å®Œæˆï¼Œå¤§å° {copied:,} å­—èŠ‚ â†’ {dst_path}") # ------------------- ç”¨æ³•ç¤ºä¾‹ ------------------- # if __name__ == "__main__": copy_with_progress("example.mp4", "backup/example_copy_progress.mp4") ``` **ä¸ºä»€ä¹ˆè¦è‡ªå·±åˆ†å—ï¼Ÿ** - `shutil.copyfileobj` ä¹Ÿå¯ä»¥åˆ†å—ï¼Œä½†ä¸è‡ªå¸¦è¿›åº¦æ¡ï¼›è‡ªå·±å†™å¾ªç¯å¯ä»¥éšæ—¶åŠ å…¥ **æ—¥å¿—ã€æ ¡éªŒã€åŠ å¯†** ç­‰é¢å¤–é€»è¾‘ã€‚ - `tqdm` ä¼šè‡ªåŠ¨è®¡ç®— **ä¼ è¾“é€Ÿç‡**ã€**å·²ç”¨æ—¶é—´**ã€**é¢„è®¡å‰©ä½™æ—¶é—´**ï¼Œæå¤§æå‡ç”¨æˆ·ä½“éªŒã€‚ --- ## 3ï¸âƒ£ è¶…å¤§æ–‡ä»¶çš„ **é›¶æ‹·è´**ï¼ˆ`mmap`ï¼‰ > `mmap` åœ¨åº•å±‚åˆ©ç”¨æ“ä½œç³»ç»Ÿçš„ **å†…å­˜æ˜ å°„**ï¼ˆmemoryâ€‘mapped fileï¼‰æŠ€æœ¯ï¼Œè¯»å–å’Œå†™å…¥éƒ½ä¸éœ€è¦é¢å¤–çš„ç”¨æˆ·ç©ºé—´æ‹·è´ï¼Œé€‚åˆ **å•è¿›ç¨‹**ã€**å•æ ¸** ç¯å¢ƒä¸‹çš„ **GB çº§åˆ«** æ–‡ä»¶æ‹·è´ã€‚ > ï¼ˆåœ¨ Windows ä¸ŠåŒæ ·å¯ç”¨ï¼Œåªè¦æ–‡ä»¶ç³»ç»Ÿæ”¯æŒæ˜ å°„å³å¯ï¼‰ ```python import mmap from pathlib import Path def copy_mmap(src: str, dst: str): src_path = Path(src) dst_path = Path(dst) if dst_path.is_dir(): dst_path = dst_path / src_path.name # 1ï¸âƒ£ å…ˆåˆ›å»ºç›®æ ‡æ–‡ä»¶å¹¶é¢„åˆ†é…åŒæ ·å¤§å° with src_path.open("rb") as f_src, dst_path.open("wb") as f_dst: f_dst.truncate(src_path.stat().st_size) # é¢„åˆ†é…ç£ç›˜ç©ºé—´ # 2ï¸âƒ£ ä½¿ç”¨ mmap åŒæ—¶æ˜ å°„è¯»å†™ with open(src_path, "rb") as f_src, open(dst_path, "r+b") as f_dst: # å‚æ•° 0 è¡¨ç¤ºæ˜ å°„æ•´ä¸ªæ–‡ä»¶ with mmap.mmap(f_src.fileno(), 0, access=mmap.ACCESS_READ) as src_map, \ mmap.mmap(f_dst.fileno(), 0, access=mmap.ACCESS_WRITE) as dst_map: dst_map[:] = src_map[:] # ä¸€è¡Œä»£ç å®Œæˆæ‹·è´ï¼ˆåº•å±‚æ˜¯å†…æ ¸çº§æ‹·è´ï¼‰ print(f"âœ… mmap é›¶æ‹·è´å®Œæˆ â†’ {dst_path}") # ------------------- ç”¨æ³•ç¤ºä¾‹ ------------------- # if __name__ == "__main__": copy_mmap("example.mp4", "backup/example_copy_mmap.mp4") ``` **ä¼˜ç‚¹** - **é€Ÿåº¦å¿«**ï¼ˆå‡ ä¹åªå—ç£ç›˜ååé™åˆ¶ï¼‰ - **å†…å­˜å ç”¨ä½**ï¼ˆåªæ˜ å°„ä¸€æ¬¡ï¼Œä¸éœ€è¦åœ¨ Python é‡ŒæŒæœ‰æ•´ä¸ªæ–‡ä»¶ï¼‰ **ç¼ºç‚¹** - åªèƒ½åœ¨ **åŒä¸€å°æœºå™¨**å†…éƒ¨ä½¿ç”¨ï¼Œè·¨ç½‘ç»œéœ€è¦å…ˆæŠŠæ–‡ä»¶æ˜ å°„åˆ°ç½‘ç»œå…±äº«ç›˜ã€‚ - å¯¹ **æå°æ–‡ä»¶** æ²¡æœ‰ä¼˜åŠ¿ï¼Œåè€Œå¤šäº†æ‰“å¼€æ˜ å°„çš„å¼€é”€ã€‚ --- ## 4ï¸âƒ£ å¤šè¿›ç¨‹å¹¶è¡Œåˆ†å—å¤åˆ¶ï¼ˆé€‚åˆ **å¤šæ ¸æœåŠ¡å™¨** æˆ– **ç½‘ç»œç£ç›˜**ï¼‰ ä¸‹é¢çš„å®ç°æŠŠæ–‡ä»¶åˆ’åˆ†ä¸ºè‹¥å¹² **ç­‰å¤§å°å—**ï¼Œæ¯å—äº¤ç»™ç‹¬ç«‹çš„å­è¿›ç¨‹å¹¶è¡Œè¯»å–/å†™å…¥ã€‚é€‚åˆ **10â€¯GBâ€‘æ•°ç™¾â€¯GB** çš„è§†é¢‘ã€å¤‡ä»½é•œåƒç­‰åœºæ™¯ã€‚ ```python import os import math from pathlib import Path from multiprocessing import Process, Queue, cpu_count from tqdm import tqdm def _worker_copy(src_path: Path, dst_path: Path, start: int, size: int, q: Queue): """å­è¿›ç¨‹å®é™…æ‰§è¡Œåˆ†å—å¤åˆ¶""" with src_path.open("rb") as f_src, dst_path.open("r+b") as f_dst: f_src.seek(start) f_dst.seek(start) remaining = size buf = 1024 * 1024 # 1â€¯MiB ç¼“å†²åŒº while remaining: read_len = min(buf, remaining) data = f_src.read(read_len) f_dst.write(data) remaining -= read_len q.put(start) # æŠŠå·²ç»å®Œæˆçš„å—èµ·å§‹ä½ç½®å›æŠ¥ç»™ä¸»è¿›ç¨‹ï¼ˆç”¨äºè¿›åº¦æ˜¾ç¤ºï¼‰ def parallel_copy(src: str, dst: str, block_size: int = 64 * 1024 * 1024): """ å¤šè¿›ç¨‹å¹¶è¡Œå¤åˆ¶å¤§æ–‡ä»¶ã€‚ - block_sizeï¼šæ¯ä¸ªå­è¿›ç¨‹è´Ÿè´£çš„å—å¤§å°ï¼ˆé»˜è®¤ 64â€¯MiBï¼Œå¯è‡ªè¡Œè°ƒèŠ‚ï¼‰ã€‚ - ä½¿ç”¨ cpu_count() è®¡ç®—å¹¶è¡Œåº¦ã€‚ """ src_path = Path(src) dst_path = Path(dst) if dst_path.is_dir(): dst_path = dst_path / src_path.name total_size = src_path.stat().st_size # 1ï¸âƒ£ é¢„å…ˆåˆ›å»ºç›®æ ‡æ–‡ä»¶å¹¶åˆ†é…åŒæ ·å¤§å° with dst_path.open("wb") as f: f.truncate(total_size) # 2ï¸âƒ£ è®¡ç®—å—æ•° blocks = math.ceil(total_size / block_size) # 3ï¸âƒ£ å¯åŠ¨å­è¿›ç¨‹ q = Queue() processes = [] for i in range(blocks): start = i * block_size size = min(block_size, total_size - start) p = Process(target=_worker_copy, args=(src_path, dst_path, start, size, q), daemon=False) p.start() processes.append(p) # 4ï¸âƒ£ ä¸»è¿›ç¨‹æ˜¾ç¤ºè¿›åº¦æ¡ with tqdm(total=total_size, unit="B", unit_scale=True, desc=f"å¹¶è¡Œå¤åˆ¶ {src_path.name}", ncols=80) as pbar: completed = 0 while completed < total_size: finished_start = q.get() # é˜Ÿåˆ—é‡Œæ˜¯å—çš„èµ·å§‹åç§» # è®¡ç®—æœ¬å—å¤§å°ï¼ˆæœ€åä¸€å—å¯èƒ½å°äº block_sizeï¼‰ finished_size = min(block_size, total_size - finished_start) completed += finished_size pbar.update(finished_size) # 5ï¸âƒ£ ç­‰å¾…æ‰€æœ‰å­è¿›ç¨‹ç»“æŸ for p in processes: p.join() print(f"\nâœ… å¹¶è¡Œå¤åˆ¶å®Œæˆ â†’ {dst_path}") # ------------------- ç”¨æ³•ç¤ºä¾‹ ------------------- # if __name__ == "__main__": parallel_copy("example.mp4", "backup/example_parallel_copy.mp4") ``` **è°ƒä¼˜å»ºè®®** | å‚æ•° | è¯´æ˜ | æ¨èå€¼ | |------|------|--------| | `block_size` | æ¯ä¸ªå­è¿›ç¨‹ä¸€æ¬¡è¯»å–çš„å­—èŠ‚æ•° | SSDâ€¯â†’â€¯64â€¯MiB~128â€¯MiBï¼›æœºæ¢°ç¡¬ç›˜â€¯â†’â€¯32â€¯MiB~64â€¯MiB | | `cpu_count()` | å¹¶å‘å­è¿›ç¨‹æ•°ï¼ˆé»˜è®¤ç­‰äº CPU æ ¸å¿ƒæ•°ï¼‰ | è‹¥ç£ç›˜æ˜¯ **RAID/NVMe**ï¼Œå¯ä»¥æŠŠè¿›ç¨‹æ•°è°ƒåˆ° **2â€¯~â€¯4 å€** çš„ CPU æ ¸å¿ƒæ•°ä»¥æå‡ I/O å¹¶å‘ | | `daemon` | å­è¿›ç¨‹æ˜¯å¦éšä¸»è¿›ç¨‹é€€å‡ºè€Œå¼ºåˆ¶ç»ˆæ­¢ | è‹¥å¤åˆ¶è¿‡ç¨‹å¿…é¡» **å®Œæ•´**ï¼ˆé¿å…åŠæˆå“ï¼‰ï¼Œè¯·ä¿æŒ `daemon=False` å¹¶æ‰‹åŠ¨ `join()`ï¼›è‹¥åªåšä¸´æ—¶æ‹·è´ï¼Œå¯è®¾ `daemon=True` åŠ é€Ÿé€€å‡º | --- ## ğŸ“‚ å®é™…ä½¿ç”¨æ¡ˆä¾‹ï¼ˆæŠŠ MP4 å¤åˆ¶åˆ°å¦ä¸€ä¸ªç›®å½•ï¼‰ å‡è®¾ä½ æœ‰ä¸€ä¸ªåŸå§‹è§†é¢‘ `source/video.mp4`ï¼Œæƒ³æŠŠå®ƒ **å®Œæ•´å¤åˆ¶** åˆ° `backup/` ç›®å½•å¹¶åœ¨æ§åˆ¶å°çœ‹åˆ°è¿›åº¦æ¡ï¼š ```python from pathlib import Path import shutil from tqdm import tqdm def copy_file_with_progress(src: str, dst_dir: str, bufsize: int = 4 * 1024 * 1024): """ ç®€å•ç‰ˆï¼šåˆ†å—è¯»å–+tqdm è¿›åº¦æ¡ + shutil.copymodeï¼ˆä¿ç•™æƒé™ï¼‰ã€‚ é€‚åˆ 100â€¯MBâ€‘å‡ â€¯GB çš„å¸¸è§„æ–‡ä»¶ã€‚ """ src_path = Path(src) dst_dir = Path(dst_dir) dst_dir.mkdir(parents=True, exist_ok=True) dst_path = dst_dir / src_path.name total = src_path.stat().st_size with src_path.open('rb') as f_src, dst_path.open('wb') as f_dst, tqdm( total=total, unit='B', unit_scale=True, desc=f'å¤åˆ¶ {src_path.name}' ) as pbar: while True: data = f_src.read(bufsize) if not data: break f_dst.write(data) pbar.update(len(data)) # å¤åˆ¶æ–‡ä»¶æƒé™ã€æ—¶é—´æˆ³ï¼ˆå¯é€‰ï¼‰ shutil.copymode(src_path, dst_path) shutil.copystat(src_path, dst_path) # åŒæ—¶ä¿ç•™è®¿é—®/ä¿®æ”¹æ—¶é—´ print(f"âœ… å¤åˆ¶å®Œæˆ â†’ {dst_path}") # ------------------- ç”¨æ³• ------------------- # if __name__ == '__main__': copy_file_with_progress('source/video.mp4', 'backup') ``` --- ## ğŸ“Œ å°ç»“ & å¸¸è§é—®é¢˜ | é—®é¢˜ | è§£å†³æ–¹æ¡ˆ | |------|----------| | **â€œå¤åˆ¶åæ–‡ä»¶å¤§å°ä¸å¯¹â€** | 1ï¸âƒ£ ç¡®è®¤æ˜¯å¦ä½¿ç”¨äº† **äºŒè¿›åˆ¶æ¨¡å¼**ï¼ˆ`'rb'` / `'wb'`ï¼‰<br>2ï¸âƒ£ å¯¹ Windows ä¸Šçš„ **æ–‡æœ¬æ–‡ä»¶**ï¼ˆCRLFï¼‰è¯·ä¸€å®šä½¿ç”¨äºŒè¿›åˆ¶æ¨¡å¼ï¼Œå¦åˆ™ä¼šè‡ªåŠ¨è½¬æ¢å¯¼è‡´å¤§å°å˜åŒ– | | **â€œå¤åˆ¶åæƒé™ä¸¢å¤±â€** | ä½¿ç”¨ `shutil.copy2` æˆ–åœ¨å¤åˆ¶åæ‰‹åŠ¨ `shutil.copymode(src, dst)` | | **â€œå¤åˆ¶å¤§æ–‡ä»¶éå¸¸æ…¢â€** | â‘  æ£€æŸ¥ç£ç›˜æ˜¯å¦ä¸º **æœºæ¢° HDD**ï¼ˆç“¶é¢ˆåœ¨ I/Oï¼‰<br>â‘¡ ä½¿ç”¨ **`mmap`** æˆ– **å¤šè¿›ç¨‹åˆ†å—**ï¼ˆä¸Šé¢çš„ `parallel_copy`ï¼‰<br>â‘¢ è‹¥æ˜¯ç½‘ç»œç£ç›˜ï¼ˆNASã€SMBï¼‰ï¼Œè€ƒè™‘ **å…ˆæŠŠæ–‡ä»¶å…ˆæ‹‰åˆ°æœ¬åœ°** å†å¤åˆ¶ | | **â€œå¤åˆ¶è¿‡ç¨‹è¢«æ„å¤–ä¸­æ–­ï¼Œç•™ä¸‹æ®‹ç¼ºæ–‡ä»¶â€** | å¤åˆ¶å‰å…ˆåˆ›å»º **ä¸´æ—¶æ–‡ä»¶**ï¼ˆå¦‚ `dst_path.with_suffix('.part')`ï¼‰ï¼Œå¤åˆ¶æˆåŠŸå `os.replace(tmp, dst_path)`ï¼Œè¿™æ ·å³ä½¿ä¸­é€”å¼‚å¸¸ä¹Ÿä¸ä¼šç•™ä¸‹ä¸å®Œæ•´çš„ç›®æ ‡æ–‡ä»¶ | | **â€œè·¨ç›˜ç§»åŠ¨ï¼ˆåŒä¸€å°æœºå™¨ä¸åŒåˆ†åŒºï¼‰æƒ³ä¿ç•™å…ƒæ•°æ®â€** | `shutil.move`ï¼ˆä¼šè‡ªåŠ¨è°ƒç”¨ç³»ç»Ÿçš„ `rename`/`move`ï¼‰ï¼Œä½†è·¨åˆ†åŒºä¼šé€€åŒ–ä¸ºå¤åˆ¶+åˆ é™¤ï¼Œå»ºè®®ä»ä½¿ç”¨ `shutil.copy2` å† `os.remove(src)`ï¼Œä¿è¯å±æ€§å®Œæ•´ | | **â€œéœ€è¦å¤åˆ¶ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼ˆé€’å½’ï¼‰â€** | `shutil.copytree(src_dir, dst_dir, dirs_exist_ok=True)`ï¼ˆPythonâ€¯3.8+ï¼‰<br>æˆ–æ‰‹åŠ¨éå† `Path.rglob("*")` å¹¶é€ä¸ª `copy2` | --- ## ğŸš€ å¿«é€Ÿä¸Šæ‰‹ ```bash # 1ï¸âƒ£ åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆå¯é€‰ï¼‰ python -m venv venv source venv/bin/activate # Windows: venv\Scripts\activate # 2ï¸âƒ£ å®‰è£… tqdmï¼ˆè¿›åº¦æ¡åº“ï¼‰å’Œ pydubï¼ˆå¦‚æœéœ€è¦éŸ³é¢‘åˆ‡ç‰‡ï¼‰ pip install tqdm pydub # 3ï¸âƒ£ è¿è¡Œä½ é€‰ä¸­çš„è„šæœ¬ python copy_file_with_progress.py # æˆ–è€… python video_to_text.py ï¼ˆå‰é¢ç»™çš„ MP4 â†’ txt ç¤ºä¾‹ï¼‰ ``` > **ä¸€å¥è¯æ€»ç»“**ï¼š > - **å°æ–‡ä»¶** â†’ `shutil.copy2`ï¼ˆä¿ç•™å±æ€§ï¼‰ > - **æƒ³è¦è¿›åº¦** â†’ åˆ†å—è¯»å– + `tqdm` > - **å¤§æ–‡ä»¶/é«˜åå** â†’ `mmap` æˆ– **å¤šè¿›ç¨‹åˆ†å—**ï¼ˆ`parallel_copy`ï¼‰ è¿™æ ·ï¼Œä½ å°±å¯ä»¥ç”¨ Python è½»æ¾ã€å¯é åœ°æŠŠä»»æ„ MP4ï¼ˆæˆ–å…¶ä»–ä»»æ„æ–‡ä»¶ï¼‰å¤åˆ¶åˆ°ç›®æ ‡ä½ç½®äº†ã€‚ç¥ä½ ç©å¾—å¼€å¿ƒ ğŸ‰!
--------------------------------------------------------------------------- FileNotFoundError Traceback (most recent call last) Cell In[5], line 21 18 shutil.copy(src_path, dst_path) # åªæ‹·è´å†…å®¹ 19 print(f"âœ… å·²å¤åˆ¶ {src_path} â†’ {dst_path}") ---> 21 copy_simple("./files/video1.mp4", "backup/example_copy.mp4") Cell In[5], line 18, in copy_simple**(src, dst)** 15 if dst_path.is_dir(): 16 dst_path = dst_path / src_path.name ---> 18 shutil.copy(src_path, dst_path) # åªæ‹·è´å†…å®¹ 19 print(f"âœ… å·²å¤åˆ¶ {src_path} â†’ {dst_path}") File E:\tools\Anaconda3\lib\shutil.py:417, in copy**(src, dst, follow_symlinks)** 415 if os.path.isdir(dst): 416 dst = os.path.join(dst, os.path.basename(src)) --> 417 copyfile(src, dst, follow_symlinks=follow_symlinks) 418 copymode(src, dst, follow_symlinks=follow_symlinks) 419 return dst File E:\tools\Anaconda3\lib\shutil.py:256, in copyfile**(src, dst, follow_symlinks)** 254 with open(src, 'rb') as fsrc: 255 try: --> 256 with open(dst, 'wb') as fdst: 257 # macOS 258 if _HAS_FCOPYFILE: 259 try: FileNotFoundError: [Errno 2] No such file or directory: 'backup\example_copy.mp4'

profile
gpt-oss:120b
æ€è€ƒç”¨æ—¶ 1 ç§’
ğŸ” å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ
FileNotFoundError: No such file or directory: 'backup\\example_copy.mp4'
è¯´æ˜ ç›®æ ‡è·¯å¾„çš„çˆ¶ç›®å½• backup/ å¹¶ä¸å­˜åœ¨ï¼Œäºæ˜¯ shutil.copy() åœ¨å°è¯•æ‰“å¼€ç›®æ ‡æ–‡ä»¶è¿›è¡Œå†™å…¥æ—¶å¤±è´¥äº†ã€‚

shutil.copy(src, dst) åªä¼šåˆ›å»ºç›®æ ‡æ–‡ä»¶æœ¬èº«ï¼Œä¸ä¼šè‡ªåŠ¨åˆ›å»ºç¼ºå¤±çš„ç›®å½•ã€‚
å¦‚æœ dst æ˜¯ä¸€ä¸ªç›®å½•ï¼Œshutil.copy ä¼šæŠŠæ–‡ä»¶æ”¾è¿›å»ï¼›å¦‚æœ dst æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ–‡ä»¶è·¯å¾„ï¼Œè€Œå®ƒçš„ä¸Šå±‚ç›®å½•ä¸å­˜åœ¨ï¼Œå°±ä¼šæŠ›å‡ºä¸Šé¢çš„å¼‚å¸¸ã€‚ 

âœ… è§£å†³æ€è·¯
åœ¨å¤åˆ¶å‰ç¡®ä¿ç›®æ ‡ç›®å½•å·²åˆ›å»ºï¼ˆPath.mkdir(parents=True, exist_ok=True)ï¼‰ã€‚
ï¼ˆå¯é€‰ï¼‰æŠŠå¤åˆ¶ä»£ç åŒ…è£…æˆ å¼‚å¸¸å®‰å…¨ çš„å‡½æ•°ï¼Œæ–¹ä¾¿åœ¨é¡¹ç›®ä¸­å¤ç”¨ã€‚
å¦‚æœä½ æƒ³ä¸€æ¬¡æ€§å¤åˆ¶åˆ°åŒä¸€ç›®å½•ä¸‹çš„å¤šä¸ªæ–‡ä»¶ï¼Œå»ºè®®æŠŠç›®å½•è·¯å¾„å•ç‹¬ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚
ä¸‹é¢ç»™å‡ºå‡ ç§å¸¸ç”¨çš„ã€æ›´å¥å£®çš„å®ç°æ–¹å¼ã€‚

ğŸ› ï¸ å®Œæ•´ç¤ºä¾‹ 1ï¼šæœ€ç®€ç‰ˆï¼ˆåªä¿è¯ç›®å½•å­˜åœ¨ï¼‰
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
import shutil
from pathlib import Path

def copy_simple(src: str, dst_dir: str, dst_name: str | None = None):
    """
    å°† src æ–‡ä»¶å¤åˆ¶åˆ° dst_dir ç›®å½•ä¸‹ã€‚
    - å¦‚æœ dst_name ä¸º Noneï¼Œåˆ™ä¿æŒåŸæ–‡ä»¶åã€‚
    - è‡ªåŠ¨åˆ›å»º dst_dirï¼ˆåŒ…æ‹¬å¤šå±‚çˆ¶ç›®å½•ï¼‰ã€‚
    """
    src_path = Path(src).expanduser().resolve()
    dst_dir_path = Path(dst_dir).expanduser().resolve()

    # â‘  ç¡®ä¿æºæ–‡ä»¶çœŸçš„å­˜åœ¨
    if not src_path.is_file():
        raise FileNotFoundError(f"æºæ–‡ä»¶ä¸å­˜åœ¨ï¼š{src_path}")

    # â‘¡ è‡ªåŠ¨åˆ›å»ºç›®æ ‡ç›®å½•ï¼ˆåŒ…æ‹¬æ‰€æœ‰ç¼ºå¤±çš„çˆ¶ç›®å½•ï¼‰
    dst_dir_path.mkdir(parents=True, exist_ok=True)

    # â‘¢ ç›®æ ‡æ–‡ä»¶å®Œæ•´è·¯å¾„
    if dst_name is None:
        dst_path = dst_dir_path / src_path.name
    else:
        dst_path = dst_dir_path / dst_name

    # â‘£ å¤åˆ¶ï¼ˆåªæ‹·è´å†…å®¹ï¼Œä¸ä¿ç•™å…ƒæ•°æ®ï¼‰
    shutil.copy(src_path, dst_path)

    print(f"âœ… å·²å¤åˆ¶ {src_path} â†’ {dst_path}")

# ------------------- è°ƒç”¨ç¤ºä¾‹ -------------------
if __name__ == "__main__":
    # å‡è®¾å½“å‰å·¥ä½œç›®å½•ä¸‹æœ‰ ./files/video1.mp4
    copy_simple("./files/video1.mp4", "backup")                 # å¤åˆ¶ä¸º backup/video1.mp4
    # å¦‚æœæƒ³æ”¹åï¼š
    copy_simple("./files/video1.mp4", "backup", "example.mp4")   # å¤åˆ¶ä¸º backup/example.mp4
å…³é”®ç‚¹ï¼šdst_dir_path.mkdir(parents=True, exist_ok=True) ä¼šä¸€æ¬¡æ€§åˆ›å»º backup/ï¼Œå³ä½¿å®ƒçš„çˆ¶ç›®å½•ä¹Ÿä¸å­˜åœ¨ä¹Ÿæ²¡é—®é¢˜ã€‚ 

ğŸ› ï¸ å®Œæ•´ç¤ºä¾‹ 2ï¼šä¿ç•™å…ƒæ•°æ®ï¼ˆæ—¶é—´æˆ³ã€æƒé™ï¼‰å¹¶å¸¦è¿›åº¦æ¡
å¦‚æœä½ å¸Œæœ›å¤åˆ¶åä¿ç•™ åˆ›å»ºæ—¶é—´ / ä¿®æ”¹æ—¶é—´ / æƒé™ï¼Œä»¥åŠåœ¨å¤åˆ¶å¤§æ–‡ä»¶æ—¶çœ‹åˆ°è¿›åº¦æ¡ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å®ç°ï¼š

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
import shutil
from pathlib import Path
from tqdm import tqdm

def copy_with_progress(src: str, dst_dir: str, bufsize: int = 4 * 1024 * 1024):
    """
    - è‡ªåŠ¨åˆ›å»ºç›®æ ‡ç›®å½•
    - åˆ†å—è¯»å– + tqdm è¿›åº¦æ¡
    - å¤åˆ¶å®Œåä¿ç•™å…ƒæ•°æ®ï¼ˆç›¸å½“äº shutil.copy2ï¼‰
    """
    src_path = Path(src).expanduser().resolve()
    dst_dir_path = Path(dst_dir).expanduser().resolve()

    if not src_path.is_file():
        raise FileNotFoundError(f"æºæ–‡ä»¶ä¸å­˜åœ¨ï¼š{src_path}")

    dst_dir_path.mkdir(parents=True, exist_ok=True)
    dst_path = dst_dir_path / src_path.name

    total = src_path.stat().st_size
    with src_path.open('rb') as fsrc, dst_path.open('wb') as fdst, tqdm(
        total=total, unit='B', unit_scale=True,
        desc=f'å¤åˆ¶ {src_path.name}'
    ) as pbar:
        while True:
            chunk = fsrc.read(bufsize)
            if not chunk:
                break
            fdst.write(chunk)
            pbar.update(len(chunk))

    # ---- ä¿ç•™å…ƒæ•°æ®ï¼ˆæ—¶é—´æˆ³ã€æƒé™ï¼‰----
    shutil.copystat(src_path, dst_path)   # å¤åˆ¶è®¿é—®/ä¿®æ”¹æ—¶é—´ã€æƒé™ç­‰
    print(f"\nâœ… å·²å®Œæ•´å¤åˆ¶ï¼ˆä¿ç•™å…ƒæ•°æ®ï¼‰{src_path} â†’ {dst_path}")

# ------------------- è°ƒç”¨ç¤ºä¾‹ -------------------
if __name__ == "__main__":
    copy_with_progress("./files/video1.mp4", "backup")
ğŸ§© å°æŠ€å·§ä¸å¸¸è§å‘
åœºæ™¯
å¸¸è§é”™è¯¯
æ­£ç¡®åšæ³•
ç›¸å¯¹è·¯å¾„å†™é”™	
./files/video1.mp4 å®é™…åœ¨ä¸åŒå·¥ä½œç›®å½•ä¸‹æ‰¾ä¸åˆ°	
ä½¿ç”¨ Path(__file__).parent / "files/video1.mp4" æˆ– os.chdir() æ˜ç¡®å·¥ä½œç›®å½•
ç›®æ ‡æ˜¯æ–‡ä»¶è€Œä¸æ˜¯ç›®å½•	
shutil.copy(src, "backup/example.mp4") ä¸” backup/ ä¸å­˜åœ¨	
å…ˆåˆ›å»ºçˆ¶ç›®å½•ï¼šPath("backup").mkdir(parents=True, exist_ok=True)
è·¨ç›˜ç§»åŠ¨	
shutil.move è·¨åˆ†åŒºæ—¶ä¼šå…ˆå¤åˆ¶å†åˆ é™¤ï¼Œå¯èƒ½ä¸¢å¤±å±æ€§	
ä½¿ç”¨ shutil.copy2 + os.remove(src)ï¼Œæˆ– Path.renameï¼ˆåŒç›˜ï¼‰
éœ€è¦åŸå­æ€§ï¼ˆå¤åˆ¶è¿‡ç¨‹ä¸­ä¸æƒ³å‡ºç°åŠæˆå“ï¼‰	
ç›´æ¥å†™å…¥ç›®æ ‡æ–‡ä»¶ï¼Œè‹¥ä¸­é€”å¼‚å¸¸ä¼šç•™ä¸‹ä¸å®Œæ•´æ–‡ä»¶	
å…ˆå¤åˆ¶åˆ° dst_path.with_suffix('.part')ï¼Œå¤åˆ¶æˆåŠŸå os.replace(tmp, dst_path)
å¤§æ–‡ä»¶ï¼ˆ>â€¯10â€¯GBï¼‰å¤åˆ¶æ…¢	
ç”¨ shutil.copyï¼ˆå•çº¿ç¨‹ï¼‰	
ä½¿ç”¨ mmap æˆ– å¤šè¿›ç¨‹åˆ†å—ï¼ˆå‰æ–‡ parallel_copy ç¤ºä¾‹ï¼‰
ğŸ“¦ ç»„åˆè¿›ä½ è‡ªå·±çš„å·¥å…·åº“
ä¸‹é¢æ˜¯ä¸€æ®µ é€šç”¨çš„å¤åˆ¶å‡½æ•°ï¼ŒæŠŠå‰é¢çš„åŠŸèƒ½éƒ½å°è£…è¿›ä¸€ä¸ª APIï¼Œæ–¹ä¾¿åœ¨é¡¹ç›®é‡Œéšå¤„è°ƒç”¨ï¼š

python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
import shutil
from pathlib import Path
from tqdm import tqdm
import os

def robust_copy(
    src: str,
    dst: str,
    *,
    keep_meta: bool = True,
    show_progress: bool = True,
    bufsize: int = 4 * 1024 * 1024,
    atomic: bool = True,
) -> Path:
    """
    å‚æ•°è¯´æ˜
    ----------
    src : str
        æºæ–‡ä»¶è·¯å¾„ï¼ˆå¿…é¡»æ˜¯æ–‡ä»¶ï¼‰ã€‚
    dst : str
        ç›®æ ‡è·¯å¾„ï¼Œå¯ä»¥æ˜¯ç›®å½•ä¹Ÿå¯ä»¥æ˜¯å®Œæ•´æ–‡ä»¶åã€‚
    keep_meta : bool
        æ˜¯å¦ä¿ç•™æ—¶é—´æˆ³ã€æƒé™ç­‰å…ƒæ•°æ®ï¼ˆç­‰ä»·äº shutil.copy2ï¼‰ã€‚
    show_progress : bool
        æ˜¯å¦åœ¨ç»ˆç«¯æ˜¾ç¤º tqdm è¿›åº¦æ¡ï¼ˆé€‚åˆå¤§æ–‡ä»¶ï¼‰ã€‚
    bufsize : int
        åˆ†å—å¤§å°ï¼Œé»˜è®¤ 4MiBã€‚
    atomic : bool
        è‹¥ä¸º Trueï¼Œåˆ™å…ˆå†™å…¥ *.part* ä¸´æ—¶æ–‡ä»¶ï¼Œå¤åˆ¶æˆåŠŸåå†æ”¹åï¼Œé˜²æ­¢ä¸­é€”å¼‚å¸¸ç•™ä¸‹åŠæˆå“ã€‚

    è¿”å›å€¼
    ------
    pathlib.Path
        å®é™…å†™å…¥çš„ç›®æ ‡æ–‡ä»¶è·¯å¾„ï¼ˆå·²æ ‡å‡†åŒ–ä¸ºç»å¯¹è·¯å¾„ï¼‰ã€‚
    """
    src_path = Path(src).expanduser().resolve()
    if not src_path.is_file():
        raise FileNotFoundError(f"æºæ–‡ä»¶ä¸å­˜åœ¨ï¼š{src_path}")

    dst_path = Path(dst).expanduser().resolve()
    # å¦‚æœ dst æ˜¯ç›®å½•ï¼Œåˆ™åœ¨è¯¥ç›®å½•ä¸‹ä¿æŒåŸæ–‡ä»¶å
    if dst_path.is_dir() or dst_path.suffix == "":
        dst_path = dst_path / src_path.name

    # ç¡®ä¿çˆ¶ç›®å½•å­˜åœ¨
    dst_path.parent.mkdir(parents=True, exist_ok=True)

    # è‹¥è¦æ±‚åŸå­æ“ä½œï¼Œå…ˆå†™å…¥ .part ä¸´æ—¶æ–‡ä»¶
    final_path = dst_path
    if atomic:
        tmp_path = dst_path.with_suffix(dst_path.suffix + ".part")
    else:
        tmp_path = dst_path

    # ----------------- å¤åˆ¶è¿‡ç¨‹ -----------------
    total = src_path.stat().st_size
    if show_progress:
        iterator = tqdm(
            total=total,
            unit='B',
            unit_scale=True,
            desc=f'å¤åˆ¶ {src_path.name}'
        )
    else:
        iterator = None

    with src_path.open('rb') as fsrc, tmp_path.open('wb') as fdst:
        while True:
            chunk = fsrc.read(bufsize)
            if not chunk:
                break
            fdst.write(chunk)
            if iterator:
                iterator.update(len(chunk))

    if iterator:
        iterator.close()

    # ----------------- å…ƒæ•°æ® -----------------
    if keep_meta:
        shutil.copystat(src_path, tmp_path)

    # ----------------- åŸå­ rename -----------------
    if atomic:
        os.replace(tmp_path, final_path)   # Windowsã€Linux å‡å¯

    print(f"âœ… å¤åˆ¶å®Œæˆ â†’ {final_path}")
    return final_path

# ------------------- ä½¿ç”¨ç¤ºä¾‹ -------------------
if __name__ == "__main__":
    robust_copy("./files/video1.mp4", "backup")                     # è‡ªåŠ¨åˆ›å»ºç›®å½•ã€è¿›åº¦æ¡ã€ä¿ç•™å…ƒæ•°æ®
    robust_copy("./files/video1.mp4", "backup/example2.mp4", atomic=False)  # ä¸èµ° .part ä¸´æ—¶æ–‡ä»¶
ä¼˜ç‚¹ï¼š

ä¸€æ¬¡æ€§è§£å†³ï¼šç›®å½•åˆ›å»ºã€è¿›åº¦æ¡ã€å…ƒæ•°æ®ã€åŸå­æ€§å‡å¯è‡ªç”±å¼€å…³ã€‚
è¿”å› Pathï¼Œæ–¹ä¾¿åç»­ç»§ç»­é“¾å¼è°ƒç”¨ï¼ˆå¦‚ path.with_suffix('.txt')ï¼‰ã€‚
å¼‚å¸¸é€æ˜ï¼šå¦‚æœå¤åˆ¶è¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œä¸´æ—¶ .part æ–‡ä»¶ä¼šä¿ç•™ä¸‹æ¥ï¼Œä¾¿äºè°ƒè¯•æˆ–æ‰‹åŠ¨æ¸…ç†ã€‚
ğŸ“š å°ç»“
FileNotFoundError é€šå¸¸æ˜¯ç›®æ ‡ç›®å½•ä¸å­˜åœ¨å¯¼è‡´çš„ã€‚
ä½¿ç”¨ Path.mkdir(parents=True, exist_ok=True) å…ˆåˆ›å»ºç›®å½•ï¼Œå†è°ƒç”¨ shutil.copy æˆ–è‡ªå®šä¹‰çš„å—å¤åˆ¶ã€‚
è‹¥è¦ ä¿ç•™å…ƒæ•°æ® ç”¨ shutil.copy2 æˆ– shutil.copystatã€‚
å¤§æ–‡ä»¶å»ºè®® åˆ†å—å¤åˆ¶ + tqdmï¼Œç”šè‡³ä½¿ç”¨ mmap / å¤šè¿›ç¨‹ ä»¥æå‡ååã€‚
ä¸ºäº†å®‰å…¨èµ·è§ï¼ŒåŸå­å†™å…¥ï¼ˆå…ˆå†™ .part å† os.replaceï¼‰æ˜¯æœ€ä½³å®è·µã€‚
è¿™æ ·ï¼Œä½ çš„å¤åˆ¶è„šæœ¬å°±èƒ½åœ¨å„ç§ç¯å¢ƒï¼ˆWindows / macOS / Linuxï¼‰ä¸‹ç¨³ç¨³è¿è¡Œäº†ã€‚ç¥ä½ ç¼–ç é¡ºåˆ© ğŸš€!

<details type="reasoning" done="true" duration="1"> <summary>Thought for 1 seconds</summary> > The user posted an error traceback indicating FileNotFoundError when trying to copy a file to a destination directory that doesn't exist. They need guidance on fixing that: ensure destination directory exists, maybe create it. Also discuss using pathlib and shutil functions. Provide corrected code, explain error, and possibly show alternative methods with progress. Also maybe mention relative paths. Provide robust function that ensures directory. Provide suggestions for handling errors. > > Now craft answer in Chinese, with explanation, code snippets, and suggestions. </details> ## ğŸ” å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ `FileNotFoundError: No such file or directory: 'backup\\example_copy.mp4'` è¯´æ˜ **ç›®æ ‡è·¯å¾„çš„çˆ¶ç›®å½• `backup/` å¹¶ä¸å­˜åœ¨**ï¼Œäºæ˜¯ `shutil.copy()` åœ¨å°è¯•æ‰“å¼€ç›®æ ‡æ–‡ä»¶è¿›è¡Œå†™å…¥æ—¶å¤±è´¥äº†ã€‚ > `shutil.copy(src, dst)` **åªä¼šåˆ›å»ºç›®æ ‡æ–‡ä»¶æœ¬èº«**ï¼Œ**ä¸ä¼šè‡ªåŠ¨åˆ›å»ºç¼ºå¤±çš„ç›®å½•**ã€‚ > å¦‚æœ `dst` æ˜¯ä¸€ä¸ªç›®å½•ï¼Œ`shutil.copy` ä¼šæŠŠæ–‡ä»¶æ”¾è¿›å»ï¼›å¦‚æœ `dst` æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ–‡ä»¶è·¯å¾„ï¼Œè€Œå®ƒçš„ä¸Šå±‚ç›®å½•ä¸å­˜åœ¨ï¼Œå°±ä¼šæŠ›å‡ºä¸Šé¢çš„å¼‚å¸¸ã€‚ --- ## âœ… è§£å†³æ€è·¯ 1. **åœ¨å¤åˆ¶å‰ç¡®ä¿ç›®æ ‡ç›®å½•å·²åˆ›å»º**ï¼ˆ`Path.mkdir(parents=True, exist_ok=True)`ï¼‰ã€‚ 2. ï¼ˆå¯é€‰ï¼‰æŠŠå¤åˆ¶ä»£ç åŒ…è£…æˆ **å¼‚å¸¸å®‰å…¨** çš„å‡½æ•°ï¼Œæ–¹ä¾¿åœ¨é¡¹ç›®ä¸­å¤ç”¨ã€‚ 3. å¦‚æœä½ æƒ³ä¸€æ¬¡æ€§å¤åˆ¶åˆ°åŒä¸€ç›®å½•ä¸‹çš„å¤šä¸ªæ–‡ä»¶ï¼Œå»ºè®®æŠŠç›®å½•è·¯å¾„å•ç‹¬ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚ ä¸‹é¢ç»™å‡ºå‡ ç§å¸¸ç”¨çš„ã€**æ›´å¥å£®**çš„å®ç°æ–¹å¼ã€‚ --- ## ğŸ› ï¸ å®Œæ•´ç¤ºä¾‹ 1ï¼šæœ€ç®€ç‰ˆï¼ˆåªä¿è¯ç›®å½•å­˜åœ¨ï¼‰ ```python import shutil from pathlib import Path def copy_simple(src: str, dst_dir: str, dst_name: str | None = None): """ å°† src æ–‡ä»¶å¤åˆ¶åˆ° dst_dir ç›®å½•ä¸‹ã€‚ - å¦‚æœ dst_name ä¸º Noneï¼Œåˆ™ä¿æŒåŸæ–‡ä»¶åã€‚ - è‡ªåŠ¨åˆ›å»º dst_dirï¼ˆåŒ…æ‹¬å¤šå±‚çˆ¶ç›®å½•ï¼‰ã€‚ """ src_path = Path(src).expanduser().resolve() dst_dir_path = Path(dst_dir).expanduser().resolve() # â‘  ç¡®ä¿æºæ–‡ä»¶çœŸçš„å­˜åœ¨ if not src_path.is_file(): raise FileNotFoundError(f"æºæ–‡ä»¶ä¸å­˜åœ¨ï¼š{src_path}") # â‘¡ è‡ªåŠ¨åˆ›å»ºç›®æ ‡ç›®å½•ï¼ˆåŒ…æ‹¬æ‰€æœ‰ç¼ºå¤±çš„çˆ¶ç›®å½•ï¼‰ dst_dir_path.mkdir(parents=True, exist_ok=True) # â‘¢ ç›®æ ‡æ–‡ä»¶å®Œæ•´è·¯å¾„ if dst_name is None: dst_path = dst_dir_path / src_path.name else: dst_path = dst_dir_path / dst_name # â‘£ å¤åˆ¶ï¼ˆåªæ‹·è´å†…å®¹ï¼Œä¸ä¿ç•™å…ƒæ•°æ®ï¼‰ shutil.copy(src_path, dst_path) print(f"âœ… å·²å¤åˆ¶ {src_path} â†’ {dst_path}") # ------------------- è°ƒç”¨ç¤ºä¾‹ ------------------- if __name__ == "__main__": # å‡è®¾å½“å‰å·¥ä½œç›®å½•ä¸‹æœ‰ ./files/video1.mp4 copy_simple("./files/video1.mp4", "backup") # å¤åˆ¶ä¸º backup/video1.mp4 # å¦‚æœæƒ³æ”¹åï¼š copy_simple("./files/video1.mp4", "backup", "example.mp4") # å¤åˆ¶ä¸º backup/example.mp4 ``` > **å…³é”®ç‚¹**ï¼š`dst_dir_path.mkdir(parents=True, exist_ok=True)` ä¼šä¸€æ¬¡æ€§åˆ›å»º `backup/`ï¼Œå³ä½¿å®ƒçš„çˆ¶ç›®å½•ä¹Ÿä¸å­˜åœ¨ä¹Ÿæ²¡é—®é¢˜ã€‚ --- ## ğŸ› ï¸ å®Œæ•´ç¤ºä¾‹ 2ï¼šä¿ç•™å…ƒæ•°æ®ï¼ˆæ—¶é—´æˆ³ã€æƒé™ï¼‰å¹¶å¸¦è¿›åº¦æ¡ å¦‚æœä½ å¸Œæœ›å¤åˆ¶åä¿ç•™ **åˆ›å»ºæ—¶é—´ / ä¿®æ”¹æ—¶é—´ / æƒé™**ï¼Œä»¥åŠåœ¨å¤åˆ¶å¤§æ–‡ä»¶æ—¶çœ‹åˆ°è¿›åº¦æ¡ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å®ç°ï¼š ```python import shutil from pathlib import Path from tqdm import tqdm def copy_with_progress(src: str, dst_dir: str, bufsize: int = 4 * 1024 * 1024): """ - è‡ªåŠ¨åˆ›å»ºç›®æ ‡ç›®å½• - åˆ†å—è¯»å– + tqdm è¿›åº¦æ¡ - å¤åˆ¶å®Œåä¿ç•™å…ƒæ•°æ®ï¼ˆç›¸å½“äº shutil.copy2ï¼‰ """ src_path = Path(src).expanduser().resolve() dst_dir_path = Path(dst_dir).expanduser().resolve() if not src_path.is_file(): raise FileNotFoundError(f"æºæ–‡ä»¶ä¸å­˜åœ¨ï¼š{src_path}") dst_dir_path.mkdir(parents=True, exist_ok=True) dst_path = dst_dir_path / src_path.name total = src_path.stat().st_size with src_path.open('rb') as fsrc, dst_path.open('wb') as fdst, tqdm( total=total, unit='B', unit_scale=True, desc=f'å¤åˆ¶ {src_path.name}' ) as pbar: while True: chunk = fsrc.read(bufsize) if not chunk: break fdst.write(chunk) pbar.update(len(chunk)) # ---- ä¿ç•™å…ƒæ•°æ®ï¼ˆæ—¶é—´æˆ³ã€æƒé™ï¼‰---- shutil.copystat(src_path, dst_path) # å¤åˆ¶è®¿é—®/ä¿®æ”¹æ—¶é—´ã€æƒé™ç­‰ print(f"\nâœ… å·²å®Œæ•´å¤åˆ¶ï¼ˆä¿ç•™å…ƒæ•°æ®ï¼‰{src_path} â†’ {dst_path}") # ------------------- è°ƒç”¨ç¤ºä¾‹ ------------------- if __name__ == "__main__": copy_with_progress("./files/video1.mp4", "backup") ``` --- ## ğŸ§© å°æŠ€å·§ä¸å¸¸è§å‘ | åœºæ™¯ | å¸¸è§é”™è¯¯ | æ­£ç¡®åšæ³• | |------|----------|----------| | **ç›¸å¯¹è·¯å¾„å†™é”™** | `./files/video1.mp4` å®é™…åœ¨ä¸åŒå·¥ä½œç›®å½•ä¸‹æ‰¾ä¸åˆ° | ä½¿ç”¨ `Path(__file__).parent / "files/video1.mp4"` æˆ– `os.chdir()` æ˜ç¡®å·¥ä½œç›®å½• | | **ç›®æ ‡æ˜¯æ–‡ä»¶è€Œä¸æ˜¯ç›®å½•** | `shutil.copy(src, "backup/example.mp4")` ä¸” `backup/` ä¸å­˜åœ¨ | **å…ˆåˆ›å»ºçˆ¶ç›®å½•**ï¼š`Path("backup").mkdir(parents=True, exist_ok=True)` | | **è·¨ç›˜ç§»åŠ¨** | `shutil.move` è·¨åˆ†åŒºæ—¶ä¼šå…ˆå¤åˆ¶å†åˆ é™¤ï¼Œå¯èƒ½ä¸¢å¤±å±æ€§ | ä½¿ç”¨ `shutil.copy2` + `os.remove(src)`ï¼Œæˆ– `Path.rename`ï¼ˆåŒç›˜ï¼‰ | | **éœ€è¦åŸå­æ€§**ï¼ˆå¤åˆ¶è¿‡ç¨‹ä¸­ä¸æƒ³å‡ºç°åŠæˆå“ï¼‰ | ç›´æ¥å†™å…¥ç›®æ ‡æ–‡ä»¶ï¼Œè‹¥ä¸­é€”å¼‚å¸¸ä¼šç•™ä¸‹ä¸å®Œæ•´æ–‡ä»¶ | å…ˆå¤åˆ¶åˆ° `dst_path.with_suffix('.part')`ï¼Œå¤åˆ¶æˆåŠŸå `os.replace(tmp, dst_path)` | | **å¤§æ–‡ä»¶ï¼ˆ>â€¯10â€¯GBï¼‰å¤åˆ¶æ…¢** | ç”¨ `shutil.copy`ï¼ˆå•çº¿ç¨‹ï¼‰ | ä½¿ç”¨ **`mmap`** æˆ– **å¤šè¿›ç¨‹åˆ†å—**ï¼ˆå‰æ–‡ `parallel_copy` ç¤ºä¾‹ï¼‰ | --- ## ğŸ“¦ ç»„åˆè¿›ä½ è‡ªå·±çš„å·¥å…·åº“ ä¸‹é¢æ˜¯ä¸€æ®µ **é€šç”¨çš„å¤åˆ¶å‡½æ•°**ï¼ŒæŠŠå‰é¢çš„åŠŸèƒ½éƒ½å°è£…è¿›ä¸€ä¸ª APIï¼Œæ–¹ä¾¿åœ¨é¡¹ç›®é‡Œéšå¤„è°ƒç”¨ï¼š ```python import shutil from pathlib import Path from tqdm import tqdm import os def robust_copy( src: str, dst: str, *, keep_meta: bool = True, show_progress: bool = True, bufsize: int = 4 * 1024 * 1024, atomic: bool = True, ) -> Path: """ å‚æ•°è¯´æ˜ ---------- src : str æºæ–‡ä»¶è·¯å¾„ï¼ˆå¿…é¡»æ˜¯æ–‡ä»¶ï¼‰ã€‚ dst : str ç›®æ ‡è·¯å¾„ï¼Œå¯ä»¥æ˜¯ç›®å½•ä¹Ÿå¯ä»¥æ˜¯å®Œæ•´æ–‡ä»¶åã€‚ keep_meta : bool æ˜¯å¦ä¿ç•™æ—¶é—´æˆ³ã€æƒé™ç­‰å…ƒæ•°æ®ï¼ˆç­‰ä»·äº shutil.copy2ï¼‰ã€‚ show_progress : bool æ˜¯å¦åœ¨ç»ˆç«¯æ˜¾ç¤º tqdm è¿›åº¦æ¡ï¼ˆé€‚åˆå¤§æ–‡ä»¶ï¼‰ã€‚ bufsize : int åˆ†å—å¤§å°ï¼Œé»˜è®¤ 4MiBã€‚ atomic : bool è‹¥ä¸º Trueï¼Œåˆ™å…ˆå†™å…¥ *.part* ä¸´æ—¶æ–‡ä»¶ï¼Œå¤åˆ¶æˆåŠŸåå†æ”¹åï¼Œé˜²æ­¢ä¸­é€”å¼‚å¸¸ç•™ä¸‹åŠæˆå“ã€‚ è¿”å›å€¼ ------ pathlib.Path å®é™…å†™å…¥çš„ç›®æ ‡æ–‡ä»¶è·¯å¾„ï¼ˆå·²æ ‡å‡†åŒ–ä¸ºç»å¯¹è·¯å¾„ï¼‰ã€‚ """ src_path = Path(src).expanduser().resolve() if not src_path.is_file(): raise FileNotFoundError(f"æºæ–‡ä»¶ä¸å­˜åœ¨ï¼š{src_path}") dst_path = Path(dst).expanduser().resolve() # å¦‚æœ dst æ˜¯ç›®å½•ï¼Œåˆ™åœ¨è¯¥ç›®å½•ä¸‹ä¿æŒåŸæ–‡ä»¶å if dst_path.is_dir() or dst_path.suffix == "": dst_path = dst_path / src_path.name # ç¡®ä¿çˆ¶ç›®å½•å­˜åœ¨ dst_path.parent.mkdir(parents=True, exist_ok=True) # è‹¥è¦æ±‚åŸå­æ“ä½œï¼Œå…ˆå†™å…¥ .part ä¸´æ—¶æ–‡ä»¶ final_path = dst_path if atomic: tmp_path = dst_path.with_suffix(dst_path.suffix + ".part") else: tmp_path = dst_path # ----------------- å¤åˆ¶è¿‡ç¨‹ ----------------- total = src_path.stat().st_size if show_progress: iterator = tqdm( total=total, unit='B', unit_scale=True, desc=f'å¤åˆ¶ {src_path.name}' ) else: iterator = None with src_path.open('rb') as fsrc, tmp_path.open('wb') as fdst: while True: chunk = fsrc.read(bufsize) if not chunk: break fdst.write(chunk) if iterator: iterator.update(len(chunk)) if iterator: iterator.close() # ----------------- å…ƒæ•°æ® ----------------- if keep_meta: shutil.copystat(src_path, tmp_path) # ----------------- åŸå­ rename ----------------- if atomic: os.replace(tmp_path, final_path) # Windowsã€Linux å‡å¯ print(f"âœ… å¤åˆ¶å®Œæˆ â†’ {final_path}") return final_path # ------------------- ä½¿ç”¨ç¤ºä¾‹ ------------------- if __name__ == "__main__": robust_copy("./files/video1.mp4", "backup") # è‡ªåŠ¨åˆ›å»ºç›®å½•ã€è¿›åº¦æ¡ã€ä¿ç•™å…ƒæ•°æ® robust_copy("./files/video1.mp4", "backup/example2.mp4", atomic=False) # ä¸èµ° .part ä¸´æ—¶æ–‡ä»¶ ``` **ä¼˜ç‚¹**ï¼š - **ä¸€æ¬¡æ€§è§£å†³**ï¼šç›®å½•åˆ›å»ºã€è¿›åº¦æ¡ã€å…ƒæ•°æ®ã€åŸå­æ€§å‡å¯è‡ªç”±å¼€å…³ã€‚ - **è¿”å› `Path`**ï¼Œæ–¹ä¾¿åç»­ç»§ç»­é“¾å¼è°ƒç”¨ï¼ˆå¦‚ `path.with_suffix('.txt')`ï¼‰ã€‚ - **å¼‚å¸¸é€æ˜**ï¼šå¦‚æœå¤åˆ¶è¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œä¸´æ—¶ `.part` æ–‡ä»¶ä¼šä¿ç•™ä¸‹æ¥ï¼Œä¾¿äºè°ƒè¯•æˆ–æ‰‹åŠ¨æ¸…ç†ã€‚ --- ## ğŸ“š å°ç»“ 1. **`FileNotFoundError`** é€šå¸¸æ˜¯ç›®æ ‡ç›®å½•ä¸å­˜åœ¨å¯¼è‡´çš„ã€‚ 2. ä½¿ç”¨ `Path.mkdir(parents=True, exist_ok=True)` **å…ˆåˆ›å»ºç›®å½•**ï¼Œå†è°ƒç”¨ `shutil.copy` æˆ–è‡ªå®šä¹‰çš„å—å¤åˆ¶ã€‚ 3. è‹¥è¦ **ä¿ç•™å…ƒæ•°æ®** ç”¨ `shutil.copy2` æˆ– `shutil.copystat`ã€‚ 4. å¤§æ–‡ä»¶å»ºè®® **åˆ†å—å¤åˆ¶ + tqdm**ï¼Œç”šè‡³ä½¿ç”¨ **`mmap` / å¤šè¿›ç¨‹** ä»¥æå‡ååã€‚ 5. ä¸ºäº†å®‰å…¨èµ·è§ï¼Œ**åŸå­å†™å…¥**ï¼ˆå…ˆå†™ `.part` å† `os.replace`ï¼‰æ˜¯æœ€ä½³å®è·µã€‚ è¿™æ ·ï¼Œä½ çš„å¤åˆ¶è„šæœ¬å°±èƒ½åœ¨å„ç§ç¯å¢ƒï¼ˆWindows / macOS / Linuxï¼‰ä¸‹ç¨³ç¨³è¿è¡Œäº†ã€‚ç¥ä½ ç¼–ç é¡ºåˆ© ğŸš€!
python

æŠ˜å 

è¿è¡Œ
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
âŒ„
âŒ„
import time 
import shutil
from pathlib import Path
def copy_simple(src: str, dst: str):
    """
    ç›´æ¥å¤åˆ¶æ–‡ä»¶ï¼ˆä¸ä¿ç•™å…ƒæ•°æ®ï¼‰ã€‚
    å¦‚æœ dst æ˜¯ç›®å½•ï¼Œåˆ™æ–‡ä»¶ä¼šæ”¾è¿›è¯¥ç›®å½•å¹¶ä¿æŒåŸæ–‡ä»¶åã€‚
    """
    src_path = Path(src)
    dst_path = Path(dst)
    # ç›®æ ‡æ˜¯ç›®å½• â†’ è‡ªåŠ¨æ‹¼æ¥æ–‡ä»¶å
    if dst_path.is_dir():
        dst_path = dst_path / src_path.name
    shutil.copy(src_path, dst_path)          # åªæ‹·è´å†…å®¹
    print(f"âœ… å·²å¤åˆ¶ {src_path} â†’ {dst_path}")
copy_simple("./files/video1.mp4", "./backup/example_copy.mp4")
profile
gpt-oss:120b
æ€è€ƒç”¨æ—¶ 0 ç§’
ä¸‹é¢çš„ä»£ç æŠŠ â€œç›®æ ‡ç›®å½•ä¸å­˜åœ¨â€ çš„é—®é¢˜å½»åº•è§£å†³äº†ï¼ŒåŒæ—¶åŠ å…¥äº†ä¸€äº›å¸¸ç”¨çš„å¥å£®æ€§æ”¹è¿›ï¼š

âœ… å…ˆåˆ›å»ºç›®æ ‡çˆ¶ç›®å½•ï¼ˆmkdir(parents=True, exist_ok=True)ï¼‰
âœ… ä½¿ç”¨ Path.resolve() æŠŠç›¸å¯¹è·¯å¾„è½¬æˆç»å¯¹è·¯å¾„ï¼Œé¿å…å› ä¸ºå·¥ä½œç›®å½•å˜åŒ–å¯¼è‡´æ‰¾ä¸åˆ°æ–‡ä»¶
âœ… åŠ å…¥ å¼‚å¸¸æ•è·ï¼ŒæŠŠé”™è¯¯ä¿¡æ¯æ‰“å°å‡ºæ¥ï¼Œæ–¹ä¾¿è°ƒè¯•
âœ… æä¾› å¯é€‰çš„ä¿ç•™å…ƒæ•°æ®ï¼ˆshutil.copy2ï¼‰å’Œ è¿›åº¦æ¡ï¼ˆtqdmï¼‰ä¸¤ç§å®ç°ï¼Œä»»é€‰å…¶ä¸€
ğŸ“¦ å®Œæ•´ã€å¯ç›´æ¥è¿è¡Œçš„ç¤ºä¾‹
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
import shutil
from pathlib import Path
from tqdm import tqdm   # åªåœ¨éœ€è¦è¿›åº¦æ¡æ—¶ importï¼Œæ²¡è£…çš„è¯ pip install tqdm

def copy_simple(
    src: str,
    dst: str,
    *,
    keep_meta: bool = False,   # True â†’ shutil.copy2ï¼ˆä¿ç•™æ—¶é—´æˆ³ã€æƒé™ç­‰ï¼‰
    show_progress: bool = False,  # True â†’ åˆ†å—å¤åˆ¶å¹¶æ˜¾ç¤º tqdm è¿›åº¦æ¡
    bufsize: int = 4 * 1024 * 1024  # 4â€¯MiBï¼Œè¿›åº¦æ¡æ¨¡å¼ä¸‹çš„å—å¤§å°
) -> None:
    """
    æŠŠ src æ–‡ä»¶å¤åˆ¶åˆ° dstï¼ˆå¯ä»¥æ˜¯ç›®å½•æˆ–å®Œæ•´æ–‡ä»¶è·¯å¾„ï¼‰ã€‚
    - è‡ªåŠ¨åˆ›å»ºç¼ºå¤±çš„çˆ¶ç›®å½•
    - é»˜è®¤åªæ‹·è´å†…å®¹ï¼›å¦‚æœ keep_meta ä¸º Trueï¼Œåˆ™ä½¿ç”¨ copy2
    - å¦‚æœ show_progress ä¸º Trueï¼Œåˆ™ä½¿ç”¨ tqdm æ˜¾ç¤ºè¿›åº¦æ¡ï¼ˆé€‚åˆå¤§æ–‡ä»¶ï¼‰
    """
    # ----------------- 1ï¸âƒ£ å‚æ•°æ ‡å‡†åŒ– -----------------
    src_path = Path(src).expanduser().resolve()
    dst_path = Path(dst).expanduser().resolve()

    # æºæ–‡ä»¶å¿…é¡»å­˜åœ¨ä¸”æ˜¯æ™®é€šæ–‡ä»¶
    if not src_path.is_file():
        raise FileNotFoundError(f"æºæ–‡ä»¶ä¸å­˜åœ¨ï¼š{src_path}")

    # å¦‚æœ dst æœ¬èº«æ˜¯ç›®å½•ï¼Œæˆ–è€…åªç»™äº†ç›®å½•è·¯å¾„è€Œæ²¡æœ‰æ–‡ä»¶åï¼Œåˆ™ä¿æŒåŸæ–‡ä»¶å
    if dst_path.is_dir() or dst_path.suffix == "":
        dst_path = dst_path / src_path.name

    # ----------------- 2ï¸âƒ£ ç¡®ä¿ç›®æ ‡ç›®å½•å·²ç»åˆ›å»º -----------------
    dst_path.parent.mkdir(parents=True, exist_ok=True)

    # ----------------- 3ï¸âƒ£ å¤åˆ¶è¿‡ç¨‹ -----------------
    try:
        if show_progress:
            # ----- å¸¦è¿›åº¦æ¡çš„åˆ†å—å¤åˆ¶ -----
            total = src_path.stat().st_size
            with src_path.open('rb') as fsrc, dst_path.open('wb') as fdst, tqdm(
                total=total,
                unit='B',
                unit_scale=True,
                desc=f'å¤åˆ¶ {src_path.name}'
            ) as pbar:
                while True:
                    chunk = fsrc.read(bufsize)
                    if not chunk:
                        break
                    fdst.write(chunk)
                    pbar.update(len(chunk))
        else:
            # ----- æœ€ç®€ç‰ˆï¼šä¸€æ¬¡æ€§å¤åˆ¶ -----
            if keep_meta:
                shutil.copy2(src_path, dst_path)   # ä¿ç•™æ—¶é—´æˆ³ã€æƒé™ç­‰
            else:
                shutil.copy(src_path, dst_path)    # åªæ‹·è´å†…å®¹

        # å¦‚æœéœ€è¦ä¿ç•™å…ƒæ•°æ®è€Œç”¨äº† shutil.copyï¼ˆä¸ä¿ç•™ï¼‰ï¼Œæ‰‹åŠ¨è¡¥ä¸Š
        if keep_meta and not show_progress:
            shutil.copystat(src_path, dst_path)

        print(f"âœ… å·²å¤åˆ¶ {src_path} â†’ {dst_path}")

    except Exception as e:   # æ•è·æ‰€æœ‰å¼‚å¸¸å¹¶ç»™å‡ºå‹å¥½çš„æç¤º
        print(f"âŒ å¤åˆ¶å¤±è´¥ï¼{type(e).__name__}: {e}")
        # è¿™é‡Œå¯ä»¥æ ¹æ®éœ€æ±‚æŠŠå¼‚å¸¸å†æŠ›å‡ºæˆ–è®°å½•æ—¥å¿—
        raise


# ------------------- è°ƒç”¨ç¤ºä¾‹ -------------------
if __name__ == "__main__":
    # ç¤ºä¾‹ 1ï¼šæœ€ç®€ç‰ˆï¼ˆä¸ä¿ç•™å…ƒæ•°æ®ï¼Œä¸æ˜¾ç¤ºè¿›åº¦æ¡ï¼‰
    copy_simple("./files/video1.mp4", "./backup/example_copy.mp4")

    # ç¤ºä¾‹ 2ï¼šä¿ç•™å…ƒæ•°æ®ï¼ˆç›¸å½“äº shutil.copy2ï¼‰
    copy_simple("./files/video1.mp4", "./backup/example_copy_meta.mp4")
    # åªè¦æŠŠ `shutil.copy` æ”¹æˆ `shutil.copy2` å³å¯ï¼ˆä¸‹é¢çš„å®ç°å·²ç»æŠŠå¼€å…³å°è£…è¿›å‡½æ•°ï¼‰

    # ç¤ºä¾‹ 3ï¼šå¸¦è¿›åº¦æ¡çš„å¤§æ–‡ä»¶å¤åˆ¶
    copy_simple("./files/video1.mp4", "./backup/example_copy_progress.mp4")
å…³é”®ç‚¹è§£é‡Š
æ­¥éª¤
ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå†™
src_path = Path(src).expanduser().resolve()	
æŠŠ ./files/video1.mp4 è§£ææˆå®Œæ•´çš„ç»å¯¹è·¯å¾„ï¼Œé˜²æ­¢åœ¨ Jupyterã€IDE æˆ– os.chdir() ä¹‹åæ‰¾ä¸åˆ°æ–‡ä»¶ã€‚
dst_path.parent.mkdir(parents=True, exist_ok=True)	
shutil.copy åªä¼šåˆ›å»ºç›®æ ‡æ–‡ä»¶æœ¬èº«ï¼Œä¸ä¼šè‡ªåŠ¨åˆ›å»ºç¼ºå¤±çš„ç›®å½•ã€‚parents=True èƒ½ä¸€æ¬¡æ€§åˆ›å»ºå¤šå±‚ç›®å½•ï¼Œexist_ok=True åœ¨ç›®å½•å·²å­˜åœ¨æ—¶ä¸ä¼šæŠ¥é”™ã€‚
if dst_path.is_dir(): dst_path = dst_path / src_path.name	
å½“ç”¨æˆ·æŠŠ dst å½“æˆç›®å½•ä¼ å…¥æ—¶ï¼ˆå¦‚ ./backup/ï¼‰ï¼Œè‡ªåŠ¨æ‹¼æ¥ä¸Šæºæ–‡ä»¶åï¼Œä½¿ API æ›´ç›´è§‚ã€‚
shutil.copy vs shutil.copy2	
copy åªæ‹·è´æ–‡ä»¶å†…å®¹ï¼›copy2 åœ¨æ‹·è´å†…å®¹çš„åŒæ—¶ ä¿ç•™æ—¶é—´æˆ³ã€æƒé™ç­‰å…ƒæ•°æ®ã€‚ä½ å¯ä»¥æŠŠ keep_meta å‚æ•°è®¾ä¸º True æ¥åˆ‡æ¢ã€‚
tqdm è¿›åº¦æ¡	
å¯¹äºå‡ ç™¾ MBã€å‡  GB ç”šè‡³æ›´å¤§çš„æ–‡ä»¶ï¼Œåˆ†å—è¯»å–å¹¶å®æ—¶æ˜¾ç¤ºè¿›åº¦å¯ä»¥æ˜æ˜¾æå‡ç”¨æˆ·ä½“éªŒã€‚
try/except æ•è·	
å½“è·¯å¾„é”™è¯¯ã€ç£ç›˜ç©ºé—´ä¸è¶³ã€æ–‡ä»¶è¢«å ç”¨ç­‰å¼‚å¸¸å‡ºç°æ—¶ï¼Œèƒ½å¤Ÿç»™å‡ºæ˜ç¡®çš„é”™è¯¯ä¿¡æ¯è€Œä¸æ˜¯ç›´æ¥ä¸­æ–­æ•´ä¸ªè„šæœ¬ã€‚
ğŸš€ å¦‚ä½•æŠŠè¿™æ®µä»£ç ç›´æ¥æ¬è¿›ä½ çš„é¡¹ç›®
å¤åˆ¶ä¸Šé¢çš„ copy_simpleï¼ˆæˆ– robust_copyï¼‰å‡½æ•°åˆ°ä½ è‡ªå·±çš„æ¨¡å—ä¸­ã€‚
ç¡®ä¿é¡¹ç›®æ ¹ç›®å½•ä¸‹æœ‰ files/video1.mp4ï¼Œæˆ–è€…æŠŠè·¯å¾„æ”¹æˆå®é™…æ‰€åœ¨ä½ç½®ã€‚
è¿è¡Œï¼š
bash

æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
python your_script.py
å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼çš„è¾“å‡ºï¼š


æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
âœ… å·²å¤åˆ¶ /absolute/path/to/files/video1.mp4 â†’ /absolute/path/to/backup/example_copy.mp4
â“ ä½ å¯èƒ½è¿˜æœ‰çš„ç–‘é—®
| é—®é¢˜ | è§£ç­” |

<details type="reasoning" done="true" duration="0"> <summary>Thought for 0 seconds</summary> > User posted a Python code snippet that still errors due to missing directory. Need to respond with fix, explain issue, suggest improvements. Possibly show creating directory, handling errors, using pathlib, etc. Provide updated code. Also maybe ask for environment details. Provide final answer. </details> ä¸‹é¢çš„ä»£ç æŠŠ **â€œç›®æ ‡ç›®å½•ä¸å­˜åœ¨â€** çš„é—®é¢˜å½»åº•è§£å†³äº†ï¼ŒåŒæ—¶åŠ å…¥äº†ä¸€äº›å¸¸ç”¨çš„å¥å£®æ€§æ”¹è¿›ï¼š * âœ… **å…ˆåˆ›å»ºç›®æ ‡çˆ¶ç›®å½•**ï¼ˆ`mkdir(parents=True, exist_ok=True)`ï¼‰ * âœ… ä½¿ç”¨ **`Path.resolve()`** æŠŠç›¸å¯¹è·¯å¾„è½¬æˆç»å¯¹è·¯å¾„ï¼Œé¿å…å› ä¸ºå·¥ä½œç›®å½•å˜åŒ–å¯¼è‡´æ‰¾ä¸åˆ°æ–‡ä»¶ * âœ… åŠ å…¥ **å¼‚å¸¸æ•è·**ï¼ŒæŠŠé”™è¯¯ä¿¡æ¯æ‰“å°å‡ºæ¥ï¼Œæ–¹ä¾¿è°ƒè¯• * âœ… æä¾› **å¯é€‰çš„ä¿ç•™å…ƒæ•°æ®**ï¼ˆ`shutil.copy2`ï¼‰å’Œ **è¿›åº¦æ¡**ï¼ˆ`tqdm`ï¼‰ä¸¤ç§å®ç°ï¼Œä»»é€‰å…¶ä¸€ --- ## ğŸ“¦ å®Œæ•´ã€å¯ç›´æ¥è¿è¡Œçš„ç¤ºä¾‹ ```python import shutil from pathlib import Path from tqdm import tqdm # åªåœ¨éœ€è¦è¿›åº¦æ¡æ—¶ importï¼Œæ²¡è£…çš„è¯ pip install tqdm def copy_simple( src: str, dst: str, *, keep_meta: bool = False, # True â†’ shutil.copy2ï¼ˆä¿ç•™æ—¶é—´æˆ³ã€æƒé™ç­‰ï¼‰ show_progress: bool = False, # True â†’ åˆ†å—å¤åˆ¶å¹¶æ˜¾ç¤º tqdm è¿›åº¦æ¡ bufsize: int = 4 * 1024 * 1024 # 4â€¯MiBï¼Œè¿›åº¦æ¡æ¨¡å¼ä¸‹çš„å—å¤§å° ) -> None: """ æŠŠ src æ–‡ä»¶å¤åˆ¶åˆ° dstï¼ˆå¯ä»¥æ˜¯ç›®å½•æˆ–å®Œæ•´æ–‡ä»¶è·¯å¾„ï¼‰ã€‚ - è‡ªåŠ¨åˆ›å»ºç¼ºå¤±çš„çˆ¶ç›®å½• - é»˜è®¤åªæ‹·è´å†…å®¹ï¼›å¦‚æœ keep_meta ä¸º Trueï¼Œåˆ™ä½¿ç”¨ copy2 - å¦‚æœ show_progress ä¸º Trueï¼Œåˆ™ä½¿ç”¨ tqdm æ˜¾ç¤ºè¿›åº¦æ¡ï¼ˆé€‚åˆå¤§æ–‡ä»¶ï¼‰ """ # ----------------- 1ï¸âƒ£ å‚æ•°æ ‡å‡†åŒ– ----------------- src_path = Path(src).expanduser().resolve() dst_path = Path(dst).expanduser().resolve() # æºæ–‡ä»¶å¿…é¡»å­˜åœ¨ä¸”æ˜¯æ™®é€šæ–‡ä»¶ if not src_path.is_file(): raise FileNotFoundError(f"æºæ–‡ä»¶ä¸å­˜åœ¨ï¼š{src_path}") # å¦‚æœ dst æœ¬èº«æ˜¯ç›®å½•ï¼Œæˆ–è€…åªç»™äº†ç›®å½•è·¯å¾„è€Œæ²¡æœ‰æ–‡ä»¶åï¼Œåˆ™ä¿æŒåŸæ–‡ä»¶å if dst_path.is_dir() or dst_path.suffix == "": dst_path = dst_path / src_path.name # ----------------- 2ï¸âƒ£ ç¡®ä¿ç›®æ ‡ç›®å½•å·²ç»åˆ›å»º ----------------- dst_path.parent.mkdir(parents=True, exist_ok=True) # ----------------- 3ï¸âƒ£ å¤åˆ¶è¿‡ç¨‹ ----------------- try: if show_progress: # ----- å¸¦è¿›åº¦æ¡çš„åˆ†å—å¤åˆ¶ ----- total = src_path.stat().st_size with src_path.open('rb') as fsrc, dst_path.open('wb') as fdst, tqdm( total=total, unit='B', unit_scale=True, desc=f'å¤åˆ¶ {src_path.name}' ) as pbar: while True: chunk = fsrc.read(bufsize) if not chunk: break fdst.write(chunk) pbar.update(len(chunk)) else: # ----- æœ€ç®€ç‰ˆï¼šä¸€æ¬¡æ€§å¤åˆ¶ ----- if keep_meta: shutil.copy2(src_path, dst_path) # ä¿ç•™æ—¶é—´æˆ³ã€æƒé™ç­‰ else: shutil.copy(src_path, dst_path) # åªæ‹·è´å†…å®¹ # å¦‚æœéœ€è¦ä¿ç•™å…ƒæ•°æ®è€Œç”¨äº† shutil.copyï¼ˆä¸ä¿ç•™ï¼‰ï¼Œæ‰‹åŠ¨è¡¥ä¸Š if keep_meta and not show_progress: shutil.copystat(src_path, dst_path) print(f"âœ… å·²å¤åˆ¶ {src_path} â†’ {dst_path}") except Exception as e: # æ•è·æ‰€æœ‰å¼‚å¸¸å¹¶ç»™å‡ºå‹å¥½çš„æç¤º print(f"âŒ å¤åˆ¶å¤±è´¥ï¼{type(e).__name__}: {e}") # è¿™é‡Œå¯ä»¥æ ¹æ®éœ€æ±‚æŠŠå¼‚å¸¸å†æŠ›å‡ºæˆ–è®°å½•æ—¥å¿— raise # ------------------- è°ƒç”¨ç¤ºä¾‹ ------------------- if __name__ == "__main__": # ç¤ºä¾‹ 1ï¼šæœ€ç®€ç‰ˆï¼ˆä¸ä¿ç•™å…ƒæ•°æ®ï¼Œä¸æ˜¾ç¤ºè¿›åº¦æ¡ï¼‰ copy_simple("./files/video1.mp4", "./backup/example_copy.mp4") # ç¤ºä¾‹ 2ï¼šä¿ç•™å…ƒæ•°æ®ï¼ˆç›¸å½“äº shutil.copy2ï¼‰ copy_simple("./files/video1.mp4", "./backup/example_copy_meta.mp4") # åªè¦æŠŠ `shutil.copy` æ”¹æˆ `shutil.copy2` å³å¯ï¼ˆä¸‹é¢çš„å®ç°å·²ç»æŠŠå¼€å…³å°è£…è¿›å‡½æ•°ï¼‰ # ç¤ºä¾‹ 3ï¼šå¸¦è¿›åº¦æ¡çš„å¤§æ–‡ä»¶å¤åˆ¶ copy_simple("./files/video1.mp4", "./backup/example_copy_progress.mp4") ``` ### å…³é”®ç‚¹è§£é‡Š | æ­¥éª¤ | ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå†™ | |------|-----------------| | `src_path = Path(src).expanduser().resolve()` | æŠŠ `./files/video1.mp4` è§£ææˆå®Œæ•´çš„ç»å¯¹è·¯å¾„ï¼Œé˜²æ­¢åœ¨ Jupyterã€IDE æˆ– `os.chdir()` ä¹‹åæ‰¾ä¸åˆ°æ–‡ä»¶ã€‚ | | `dst_path.parent.mkdir(parents=True, exist_ok=True)` | `shutil.copy` åªä¼šåˆ›å»ºç›®æ ‡æ–‡ä»¶æœ¬èº«ï¼Œ**ä¸ä¼š**è‡ªåŠ¨åˆ›å»ºç¼ºå¤±çš„ç›®å½•ã€‚`parents=True` èƒ½ä¸€æ¬¡æ€§åˆ›å»ºå¤šå±‚ç›®å½•ï¼Œ`exist_ok=True` åœ¨ç›®å½•å·²å­˜åœ¨æ—¶ä¸ä¼šæŠ¥é”™ã€‚ | | `if dst_path.is_dir(): dst_path = dst_path / src_path.name` | å½“ç”¨æˆ·æŠŠ `dst` å½“æˆç›®å½•ä¼ å…¥æ—¶ï¼ˆå¦‚ `./backup/`ï¼‰ï¼Œè‡ªåŠ¨æ‹¼æ¥ä¸Šæºæ–‡ä»¶åï¼Œä½¿ API æ›´ç›´è§‚ã€‚ | | `shutil.copy` vs `shutil.copy2` | `copy` åªæ‹·è´æ–‡ä»¶å†…å®¹ï¼›`copy2` åœ¨æ‹·è´å†…å®¹çš„åŒæ—¶ **ä¿ç•™æ—¶é—´æˆ³ã€æƒé™ç­‰å…ƒæ•°æ®**ã€‚ä½ å¯ä»¥æŠŠ `keep_meta` å‚æ•°è®¾ä¸º `True` æ¥åˆ‡æ¢ã€‚ | | `tqdm` è¿›åº¦æ¡ | å¯¹äºå‡ ç™¾ MBã€å‡  GB ç”šè‡³æ›´å¤§çš„æ–‡ä»¶ï¼Œåˆ†å—è¯»å–å¹¶å®æ—¶æ˜¾ç¤ºè¿›åº¦å¯ä»¥æ˜æ˜¾æå‡ç”¨æˆ·ä½“éªŒã€‚ | | `try/except` æ•è· | å½“è·¯å¾„é”™è¯¯ã€ç£ç›˜ç©ºé—´ä¸è¶³ã€æ–‡ä»¶è¢«å ç”¨ç­‰å¼‚å¸¸å‡ºç°æ—¶ï¼Œèƒ½å¤Ÿç»™å‡ºæ˜ç¡®çš„é”™è¯¯ä¿¡æ¯è€Œä¸æ˜¯ç›´æ¥ä¸­æ–­æ•´ä¸ªè„šæœ¬ã€‚ | --- ## ğŸš€ å¦‚ä½•æŠŠè¿™æ®µä»£ç ç›´æ¥æ¬è¿›ä½ çš„é¡¹ç›® 1. **å¤åˆ¶**ä¸Šé¢çš„ `copy_simple`ï¼ˆæˆ– `robust_copy`ï¼‰å‡½æ•°åˆ°ä½ è‡ªå·±çš„æ¨¡å—ä¸­ã€‚ 2. **ç¡®ä¿**é¡¹ç›®æ ¹ç›®å½•ä¸‹æœ‰ `files/video1.mp4`ï¼Œæˆ–è€…æŠŠè·¯å¾„æ”¹æˆå®é™…æ‰€åœ¨ä½ç½®ã€‚ 3. è¿è¡Œï¼š ```bash python your_script.py ``` å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼çš„è¾“å‡ºï¼š ``` âœ… å·²å¤åˆ¶ /absolute/path/to/files/video1.mp4 â†’ /absolute/path/to/backup/example_copy.mp4 ``` --- ## â“ ä½ å¯èƒ½è¿˜æœ‰çš„ç–‘é—® | é—®é¢˜ | è§£ç­” |
ç°åœ¨æ˜¯ä½¿ç”¨å¤šçº¿ç¨‹å¤„ç†æ–‡ä»¶ï¼Œ éšä¾¿æŒ‘é€‰ä¸€ä¸ªç®€å•çš„ä»»åŠ¡ä»£ç 

profile
gpt-oss:120b
æ€è€ƒç”¨æ—¶ 1 ç§’
ä¸‹é¢ç»™å‡ºä¸€ä¸ª â€œå¤šçº¿ç¨‹æ‰¹é‡å¤„ç†æ–‡ä»¶â€ çš„å®Œæ•´ã€å¯ç›´æ¥è¿è¡Œçš„ç¤ºä¾‹ã€‚
ç¤ºä¾‹ä»»åŠ¡éå¸¸è½»é‡â€”â€”éå†ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œè®¡ç®—æ¯ä¸ªæ–‡ä»¶çš„ SHAâ€‘256 å“ˆå¸Œå€¼å¹¶æŠŠç»“æœå†™å…¥ CSVã€‚
è¿™ç±» I/Oâ€‘boundï¼ˆç£ç›˜è¯»å†™ï¼‰ä»»åŠ¡éå¸¸é€‚åˆç”¨ çº¿ç¨‹ æ¥å¹¶è¡Œï¼ŒåŠ é€Ÿæ•´ä½“è€—æ—¶ã€‚

ğŸ“ ç¤ºä¾‹ç›®å½•ç»“æ„ï¼ˆä½ å¯ä»¥è‡ªè¡Œåˆ›å»ºï¼‰

æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
project/
â”œâ”€ data/                 # å¾…å¤„ç†çš„æ–‡ä»¶ï¼ˆéšæ„æ”¾å‡ ä¸ª txtã€jpgã€mp4 â€¦ï¼‰
â”‚   â”œâ”€ a.txt
â”‚   â”œâ”€ b.jpg
â”‚   â””â”€ c.mp4
â””â”€ multithread_hash.py   # ä¸‹é¢çš„ä»£ç ä¿å­˜ä¸ºè¿™ä¸ªæ–‡ä»¶
è¯´æ˜ï¼šå¦‚æœ data/ é‡Œåªæœ‰å‡ ç™¾ MB çš„æ–‡ä»¶ï¼Œå•çº¿ç¨‹å¤§çº¦ 1â€‘2â€¯ç§’/GBï¼›ä½¿ç”¨ 8â€¯çº¿ç¨‹æ—¶é€šå¸¸å¯ä»¥æŠŠè€—æ—¶ç¼©çŸ­åˆ° 30â€‘40%ã€‚ 

ğŸ§© ä»£ç  â€”â€” multithread_hash.py
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
å¤šçº¿ç¨‹æ‰¹é‡è®¡ç®—æ–‡ä»¶ SHAâ€‘256 å“ˆå¸Œå¹¶å†™å…¥ CSVã€‚

- ä½¿ç”¨ ThreadPoolExecutorï¼ˆæ ‡å‡†åº“ concurrent.futuresï¼‰å®ç°çº¿ç¨‹æ± ã€‚
- åªåš I/Oâ€‘bound å·¥ä½œï¼ˆè¯»å–ç£ç›˜ï¼‰ï¼Œå› æ­¤å¤šçº¿ç¨‹èƒ½å¤Ÿæ˜¾è‘—æå‡é€Ÿåº¦ã€‚
- æ”¯æŒé€’å½’éå†å­ç›®å½•ã€è‡ªåŠ¨åˆ›å»ºè¾“å‡ºç›®å½•ã€å¼‚å¸¸æ•è·ä¸æ—¥å¿—ã€‚
"""

import csv
import hashlib
import os
from pathlib import Path
from concurrent.futures import ThreadPoolExecutor, as_completed
from typing import List, Tuple
import time


# --------------------------------------------------------------
# é…ç½®åŒºï¼ˆå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚è‡ªè¡Œä¿®æ”¹ï¼‰
# --------------------------------------------------------------
ROOT_DIR   = Path("./data")               # å¾…å¤„ç†çš„æ ¹ç›®å½•
OUT_DIR    = Path("./output")             # ç»“æœæ–‡ä»¶å­˜æ”¾ç›®å½•
CSV_NAME   = "hashes.csv"                 # CSV æ–‡ä»¶å
MAX_WORKERS = os.cpu_count() or 4         # çº¿ç¨‹æ± å¤§å°ï¼ˆé»˜è®¤ CPU æ ¸æ•°ï¼ŒI/O ä»»åŠ¡å¯é€‚å½“è°ƒå¤§ï¼‰
CHUNK_SIZE = 4 * 1024 * 1024              # è¯»å–æ–‡ä»¶æ—¶çš„å—å¤§å°ï¼ˆ4â€¯MiBï¼‰  
# --------------------------------------------------------------


def compute_sha256(file_path: Path) -> Tuple[Path, str]:
    """
    è¯»å– *file_path* å¹¶è¿”å› (file_path, hex_digest)ã€‚
    è‹¥è¯»å–è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ï¼Œè¿”å› (file_path, "ERROR:<msg>")ã€‚
    """
    try:
        h = hashlib.sha256()
        with file_path.open("rb") as f:
            while chunk := f.read(CHUNK_SIZE):
                h.update(chunk)
        return file_path, h.hexdigest()
    except Exception as exc:                 # æ•è·æ‰€æœ‰å¼‚å¸¸ï¼Œé˜²æ­¢çº¿ç¨‹å´©æºƒ
        return file_path, f"ERROR:{exc}"


def gather_file_list(root: Path) -> List[Path]:
    """é€’å½’æ”¶é›†æ‰€æœ‰æ™®é€šæ–‡ä»¶ï¼ˆæ’é™¤ç¬¦å·é“¾æ¥ã€ç›®å½•ç­‰ï¼‰ã€‚"""
    return [p for p in root.rglob("*") if p.is_file() and not p.is_symlink()]


def write_csv(results: List[Tuple[Path, str]], out_csv: Path) -> None:
    """æŠŠ [(Path, hash), â€¦] å†™å…¥ CSVï¼Œä½¿ç”¨ utfâ€‘8â€‘sig é˜²æ­¢ Windows æ‰“å¼€ä¹±ç ã€‚"""
    out_csv.parent.mkdir(parents=True, exist_ok=True)
    with out_csv.open("w", newline="", encoding="utf-8-sig") as fp:
        writer = csv.writer(fp)
        writer.writerow(["relative_path", "sha256"])
        for path, digest in results:
            # ä¸ºäº† CSV å¯è¯»ï¼Œå†™å…¥ç›¸å¯¹äº ROOT_DIR çš„ç›¸å¯¹è·¯å¾„
            writer.writerow([path.relative_to(ROOT_DIR).as_posix(), digest])


def main() -> None:
    start = time.time()
    print(f"ğŸ” æ­£åœ¨æ”¶é›† {ROOT_DIR} ä¸‹çš„æ‰€æœ‰æ–‡ä»¶â€¦")
    all_files = gather_file_list(ROOT_DIR)
    print(f"âœ… æ‰¾åˆ° {len(all_files)} ä¸ªæ–‡ä»¶ï¼Œå‡†å¤‡ä½¿ç”¨ {MAX_WORKERS} çº¿ç¨‹å¹¶è¡Œè®¡ç®—å“ˆå¸Œâ€¦")

    # ----------------------------------------------------------
    # â‘  åˆ›å»ºçº¿ç¨‹æ± å¹¶æäº¤ä»»åŠ¡
    # ----------------------------------------------------------
    results: List[Tuple[Path, str]] = []
    with ThreadPoolExecutor(max_workers=MAX_WORKERS) as executor:
        # submit() è¿”å› Future å¯¹è±¡ï¼Œä½¿ç”¨ as_completed() æŒ‰å®Œæˆé¡ºåºè¿­ä»£
        future_to_path = {executor.submit(compute_sha256, p): p for p in all_files}
        for future in as_completed(future_to_path):
            path, digest = future.result()
            results.append((path, digest))

    # ----------------------------------------------------------
    # â‘¡ å†™å…¥ CSV
    # ----------------------------------------------------------
    out_csv = OUT_DIR / CSV_NAME
    write_csv(results, out_csv)

    elapsed = time.time() - start
    print(f"\nğŸ‰ å®Œæˆï¼å…±å¤„ç† {len(all_files)} æ–‡ä»¶ï¼Œç”¨æ—¶ {elapsed:.2f} ç§’")
    print(f"ğŸ”— ç»“æœå·²å†™å…¥ï¼š{out_csv.resolve()}")


if __name__ == "__main__":
    main()
ğŸš€ å¦‚ä½•è¿è¡Œ
bash

æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
2
# 1ï¸âƒ£ ç¡®ä¿ä½ å·²ç»åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼ˆå³åŒçº§æœ‰ data/ ç›®å½•ï¼‰
python multithread_hash.py
è¿è¡Œåä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¾“å‡º

æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
ğŸ” æ­£åœ¨æ”¶é›† ./data ä¸‹çš„æ‰€æœ‰æ–‡ä»¶â€¦
âœ… æ‰¾åˆ° 37 ä¸ªæ–‡ä»¶ï¼Œå‡†å¤‡ä½¿ç”¨ 8 çº¿ç¨‹å¹¶è¡Œè®¡ç®—å“ˆå¸Œâ€¦
âœ… å·²å¤åˆ¶ /abs/path/to/data/a.txt â†’ /abs/path/to/output/example_copy.mp4
...
ğŸ‰ å®Œæˆï¼å…±å¤„ç† 37 æ–‡ä»¶ï¼Œç”¨æ—¶ 3.87 ç§’
ğŸ”— ç»“æœå·²å†™å…¥ï¼š/abs/path/to/output/hashes.csv
æ‰“å¼€ output/hashes.csvï¼Œå†…å®¹ç±»ä¼¼ï¼š


æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
2
3
4
relative_path,sha256
a.txt,3a7bd3e2360a5b...
subdir/b.jpg,4b825dc642cb...
c.mp4,8f14e45fceeaâ€¦
ğŸ§© ä»£ç è¦ç‚¹è§£é‡Š
ä»£ç å—
å…³é”®ç‚¹
ä¸ºä»€ä¹ˆé‡è¦
ThreadPoolExecutor(max_workers=MAX_WORKERS)	
ä½¿ç”¨æ ‡å‡†åº“çš„çº¿ç¨‹æ± ï¼Œè‡ªåŠ¨ç®¡ç†çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ	
ç®€æ´ã€è·¨å¹³å°ã€æ— éœ€æ‰‹åŠ¨ threading.Thread ç®¡ç†
CHUNK_SIZE = 4â€¯MiB	
åˆ†å—è¯»å–æ–‡ä»¶	
è¯»å–å¤§æ–‡ä»¶æ—¶é¿å…ä¸€æ¬¡æ€§æŠŠå…¨éƒ¨å†…å®¹è£…è¿›å†…å­˜
as_completed	
æŒ‰å®Œæˆé¡ºåºè·å–ç»“æœ	
èƒ½å³æ—¶æŠŠå·²ç»ç®—å¥½çš„å“ˆå¸Œå†™è¿›åˆ—è¡¨ï¼Œé˜²æ­¢å› å•ä¸ªæ…¢æ–‡ä»¶æ‹–æ…¢æ•´ä½“
å¼‚å¸¸æ•è· (except Exception as exc)	
ä»»ä½•è¯»å–é”™è¯¯éƒ½è¿”å› "ERROR:â€¦" è€Œä¸æ˜¯è®©çº¿ç¨‹å´©æºƒ	
ä¿è¯æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šå¾—åˆ°ä¸€æ¡è®°å½•ï¼Œè°ƒè¯•æ›´å®¹æ˜“
Path.rglob("*") + is_file()	
é€’å½’éå†æ‰€æœ‰å­ç›®å½•	
åªå¤„ç†çœŸå®æ–‡ä»¶ï¼Œè‡ªåŠ¨è·³è¿‡ç›®å½•å’Œè½¯é“¾æ¥
out_csv.parent.mkdir(parents=True, exist_ok=True)	
è‡ªåŠ¨åˆ›å»º output/ ç›®å½•	
é˜²æ­¢ FileNotFoundError
utf-8-sig	
CSV é‡‡ç”¨ UTFâ€‘8 å¸¦ BOM ç¼–ç 	
åœ¨ Windows è®°äº‹æœ¬é‡Œæ‰“å¼€ä¸ä¼šå‡ºç°ä¹±ç 
ğŸ“ˆ æ€§èƒ½å°å®éªŒï¼ˆå¯é€‰ï¼‰
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
import time, os, random, string
from pathlib import Path

def gen_dummy_files(root: Path, n: int, size_mb: int = 5):
    """å¿«é€Ÿç”Ÿæˆ n ä¸ªå¤§å°ä¸º size_mb çš„éšæœºæ–‡ä»¶ï¼Œä¾¿äºæ€§èƒ½å¯¹æ¯”ã€‚"""
    root.mkdir(parents=True, exist_ok=True)
    for i in range(n):
        p = root / f"dummy_{i}.bin"
        with p.open("wb") as f:
            for _ in range(size_mb):
                f.write(os.urandom(1024 * 1024))   # å†™ 1â€¯MiB éšæœºæ•°æ®

# ç”Ÿæˆ 20 ä¸ª 10â€¯MiB çš„æ–‡ä»¶ï¼ˆçº¦ 200â€¯MiBï¼‰
gen_dummy_files(Path("./data"), n=20, size_mb=10)

# è¿è¡Œä¸€æ¬¡åŸºå‡†ï¼ˆå•çº¿ç¨‹ï¼‰ï¼š
start = time.time()
_ = [compute_sha256(p) for p in gather_file_list(Path("./data"))]
print("å•çº¿ç¨‹è€—æ—¶:", time.time() - start)

# å†è·‘ä¸€æ¬¡å¤šçº¿ç¨‹ï¼ˆé»˜è®¤ CPU æ ¸æ•°ï¼‰ï¼š
start = time.time()
with ThreadPoolExecutor(max_workers=os.cpu_count() or 4) as ex:
    list(ex.map(compute_sha256, gather_file_list(Path("./data"))))
print("å¤šçº¿ç¨‹è€—æ—¶:", time.time() - start)
åœ¨å¤§å¤šæ•° SSD / HDD ç¯å¢ƒä¸‹ï¼Œä½ ä¼šçœ‹åˆ° å¤šçº¿ç¨‹è€—æ—¶çº¦ä¸ºå•çº¿ç¨‹çš„ 30â€‘60%ï¼ˆå–å†³äºç£ç›˜å¹¶å‘è¯»å†™èƒ½åŠ›ï¼‰ã€‚

ğŸ¯ é€‚ç”¨åœºæ™¯æ‰©å±•
æ–‡ä»¶å‹ç¼©ï¼šæŠŠ compute_sha256 æ¢æˆ gzip.compress æˆ– shutil.make_archiveï¼ŒåŒæ ·å¯ä»¥å¹¶è¡Œã€‚
å›¾ç‰‡/éŸ³è§†é¢‘è½¬ç ï¼šåªè¦å†…éƒ¨å®ç°æ˜¯ I/Oâ€‘boundï¼ˆè°ƒç”¨å¤–éƒ¨ CLI å·¥å…·ï¼‰ï¼Œä¹Ÿå¯ä»¥ç”¨åŒæ ·çš„çº¿ç¨‹æ± åŒ…è£…ã€‚
æ‰¹é‡ä¸Šä¼ /ä¸‹è½½ï¼šæŠŠ compute_sha256 æ›¿æ¢ä¸º requests.put æˆ– boto3.upload_fileobjï¼Œå³å¯å®ç°å¹¶å‘ç½‘ç»œ I/Oã€‚
æ³¨æ„ï¼šå¦‚æœä½ çš„ä»»åŠ¡æ˜¯ CPUâ€‘boundï¼ˆä¾‹å¦‚å¤§é‡å›¾ç‰‡è§£ç ã€åŠ å¯†ã€å¤æ‚è®¡ç®—ï¼‰ï¼Œè¯·æ”¹ç”¨ ProcessPoolExecutor æˆ– multiprocessingï¼Œå› ä¸º CPython çš„ GIL ä¼šé™åˆ¶çº¿ç¨‹çš„å¹¶è¡Œåº¦ã€‚ 

âœ… å°ç»“
ä½¿ç”¨ ThreadPoolExecutor å¯ä»¥éå¸¸ç®€æ´åœ°å®ç°å¤šçº¿ç¨‹æ–‡ä»¶å¤„ç†ã€‚
åªè¦æ˜¯ I/Oâ€‘boundï¼ˆç£ç›˜è¯»å†™ã€ç½‘ç»œè¯·æ±‚ï¼‰ï¼Œçº¿ç¨‹æ•°è®¾ç½®ä¸º CPU æ ¸æ•°çš„ 2â€‘4 å€ å¾€å¾€èƒ½å¾—åˆ°æœ€ä½³ååã€‚
ä»£ç é‡Œå·²ç»è€ƒè™‘äº† å¼‚å¸¸å®‰å…¨ã€ç›®å½•è‡ªåŠ¨åˆ›å»ºã€è¿›åº¦æ—¥å¿—ï¼Œç›´æ¥æ‹·è´åˆ°é¡¹ç›®ä¸­å³å¯ä½¿ç”¨ã€‚
ç¥ä½ ç©å¾—å¼€å¿ƒ ğŸš€ï¼Œå¦‚æœè¿˜æœ‰åˆ«çš„éœ€æ±‚ï¼ˆæ¯”å¦‚æ”¹æˆè¿›åº¦æ¡ç‰ˆã€æ”¹æˆå¤šè¿›ç¨‹ç‰ˆã€æˆ–è€…æƒ³æŠŠç»“æœå†™å…¥æ•°æ®åº“ï¼‰ï¼Œéšæ—¶å‘Šè¯‰æˆ‘ï¼

<details type="reasoning" done="true" duration="1"> <summary>Thought for 1 seconds</summary> > User asks: "ç°åœ¨æ˜¯ä½¿ç”¨å¤šçº¿ç¨‹å¤„ç†æ–‡ä»¶ï¼Œ éšä¾¿æŒ‘é€‰ä¸€ä¸ªç®€å•çš„ä»»åŠ¡ä»£ç ". They want a simple multi-threaded file processing example. Should provide Python code using threading or concurrent.futures ThreadPoolExecutor, maybe processing a list of files (e.g., compute hash, copy, compress). Provide explanation. Also ensure thread safety. Provide complete example. </details> ä¸‹é¢ç»™å‡ºä¸€ä¸ª **â€œå¤šçº¿ç¨‹æ‰¹é‡å¤„ç†æ–‡ä»¶â€** çš„å®Œæ•´ã€å¯ç›´æ¥è¿è¡Œçš„ç¤ºä¾‹ã€‚ ç¤ºä¾‹ä»»åŠ¡éå¸¸è½»é‡â€”â€”**éå†ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œè®¡ç®—æ¯ä¸ªæ–‡ä»¶çš„ SHAâ€‘256 å“ˆå¸Œå€¼å¹¶æŠŠç»“æœå†™å…¥ CSV**ã€‚ è¿™ç±» I/Oâ€‘boundï¼ˆç£ç›˜è¯»å†™ï¼‰ä»»åŠ¡éå¸¸é€‚åˆç”¨ **çº¿ç¨‹** æ¥å¹¶è¡Œï¼ŒåŠ é€Ÿæ•´ä½“è€—æ—¶ã€‚ --- ## ğŸ“ ç¤ºä¾‹ç›®å½•ç»“æ„ï¼ˆä½ å¯ä»¥è‡ªè¡Œåˆ›å»ºï¼‰ ``` project/ â”œâ”€ data/ # å¾…å¤„ç†çš„æ–‡ä»¶ï¼ˆéšæ„æ”¾å‡ ä¸ª txtã€jpgã€mp4 â€¦ï¼‰ â”‚ â”œâ”€ a.txt â”‚ â”œâ”€ b.jpg â”‚ â””â”€ c.mp4 â””â”€ multithread_hash.py # ä¸‹é¢çš„ä»£ç ä¿å­˜ä¸ºè¿™ä¸ªæ–‡ä»¶ ``` > **è¯´æ˜**ï¼šå¦‚æœ `data/` é‡Œåªæœ‰å‡ ç™¾ MB çš„æ–‡ä»¶ï¼Œå•çº¿ç¨‹å¤§çº¦ 1â€‘2â€¯ç§’/GBï¼›ä½¿ç”¨ 8â€¯çº¿ç¨‹æ—¶é€šå¸¸å¯ä»¥æŠŠè€—æ—¶ç¼©çŸ­åˆ° 30â€‘40%ã€‚ --- ## ğŸ§© ä»£ç  â€”â€” `multithread_hash.py` ```python #!/usr/bin/env python # -*- coding: utf-8 -*- """ å¤šçº¿ç¨‹æ‰¹é‡è®¡ç®—æ–‡ä»¶ SHAâ€‘256 å“ˆå¸Œå¹¶å†™å…¥ CSVã€‚ - ä½¿ç”¨ ThreadPoolExecutorï¼ˆæ ‡å‡†åº“ concurrent.futuresï¼‰å®ç°çº¿ç¨‹æ± ã€‚ - åªåš I/Oâ€‘bound å·¥ä½œï¼ˆè¯»å–ç£ç›˜ï¼‰ï¼Œå› æ­¤å¤šçº¿ç¨‹èƒ½å¤Ÿæ˜¾è‘—æå‡é€Ÿåº¦ã€‚ - æ”¯æŒé€’å½’éå†å­ç›®å½•ã€è‡ªåŠ¨åˆ›å»ºè¾“å‡ºç›®å½•ã€å¼‚å¸¸æ•è·ä¸æ—¥å¿—ã€‚ """ import csv import hashlib import os from pathlib import Path from concurrent.futures import ThreadPoolExecutor, as_completed from typing import List, Tuple import time # -------------------------------------------------------------- # é…ç½®åŒºï¼ˆå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚è‡ªè¡Œä¿®æ”¹ï¼‰ # -------------------------------------------------------------- ROOT_DIR = Path("./data") # å¾…å¤„ç†çš„æ ¹ç›®å½• OUT_DIR = Path("./output") # ç»“æœæ–‡ä»¶å­˜æ”¾ç›®å½• CSV_NAME = "hashes.csv" # CSV æ–‡ä»¶å MAX_WORKERS = os.cpu_count() or 4 # çº¿ç¨‹æ± å¤§å°ï¼ˆé»˜è®¤ CPU æ ¸æ•°ï¼ŒI/O ä»»åŠ¡å¯é€‚å½“è°ƒå¤§ï¼‰ CHUNK_SIZE = 4 * 1024 * 1024 # è¯»å–æ–‡ä»¶æ—¶çš„å—å¤§å°ï¼ˆ4â€¯MiBï¼‰ # -------------------------------------------------------------- def compute_sha256(file_path: Path) -> Tuple[Path, str]: """ è¯»å– *file_path* å¹¶è¿”å› (file_path, hex_digest)ã€‚ è‹¥è¯»å–è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ï¼Œè¿”å› (file_path, "ERROR:<msg>")ã€‚ """ try: h = hashlib.sha256() with file_path.open("rb") as f: while chunk := f.read(CHUNK_SIZE): h.update(chunk) return file_path, h.hexdigest() except Exception as exc: # æ•è·æ‰€æœ‰å¼‚å¸¸ï¼Œé˜²æ­¢çº¿ç¨‹å´©æºƒ return file_path, f"ERROR:{exc}" def gather_file_list(root: Path) -> List[Path]: """é€’å½’æ”¶é›†æ‰€æœ‰æ™®é€šæ–‡ä»¶ï¼ˆæ’é™¤ç¬¦å·é“¾æ¥ã€ç›®å½•ç­‰ï¼‰ã€‚""" return [p for p in root.rglob("*") if p.is_file() and not p.is_symlink()] def write_csv(results: List[Tuple[Path, str]], out_csv: Path) -> None: """æŠŠ [(Path, hash), â€¦] å†™å…¥ CSVï¼Œä½¿ç”¨ utfâ€‘8â€‘sig é˜²æ­¢ Windows æ‰“å¼€ä¹±ç ã€‚""" out_csv.parent.mkdir(parents=True, exist_ok=True) with out_csv.open("w", newline="", encoding="utf-8-sig") as fp: writer = csv.writer(fp) writer.writerow(["relative_path", "sha256"]) for path, digest in results: # ä¸ºäº† CSV å¯è¯»ï¼Œå†™å…¥ç›¸å¯¹äº ROOT_DIR çš„ç›¸å¯¹è·¯å¾„ writer.writerow([path.relative_to(ROOT_DIR).as_posix(), digest]) def main() -> None: start = time.time() print(f"ğŸ” æ­£åœ¨æ”¶é›† {ROOT_DIR} ä¸‹çš„æ‰€æœ‰æ–‡ä»¶â€¦") all_files = gather_file_list(ROOT_DIR) print(f"âœ… æ‰¾åˆ° {len(all_files)} ä¸ªæ–‡ä»¶ï¼Œå‡†å¤‡ä½¿ç”¨ {MAX_WORKERS} çº¿ç¨‹å¹¶è¡Œè®¡ç®—å“ˆå¸Œâ€¦") # ---------------------------------------------------------- # â‘  åˆ›å»ºçº¿ç¨‹æ± å¹¶æäº¤ä»»åŠ¡ # ---------------------------------------------------------- results: List[Tuple[Path, str]] = [] with ThreadPoolExecutor(max_workers=MAX_WORKERS) as executor: # submit() è¿”å› Future å¯¹è±¡ï¼Œä½¿ç”¨ as_completed() æŒ‰å®Œæˆé¡ºåºè¿­ä»£ future_to_path = {executor.submit(compute_sha256, p): p for p in all_files} for future in as_completed(future_to_path): path, digest = future.result() results.append((path, digest)) # ---------------------------------------------------------- # â‘¡ å†™å…¥ CSV # ---------------------------------------------------------- out_csv = OUT_DIR / CSV_NAME write_csv(results, out_csv) elapsed = time.time() - start print(f"\nğŸ‰ å®Œæˆï¼å…±å¤„ç† {len(all_files)} æ–‡ä»¶ï¼Œç”¨æ—¶ {elapsed:.2f} ç§’") print(f"ğŸ”— ç»“æœå·²å†™å…¥ï¼š{out_csv.resolve()}") if __name__ == "__main__": main() ``` --- ## ğŸš€ å¦‚ä½•è¿è¡Œ ```bash # 1ï¸âƒ£ ç¡®ä¿ä½ å·²ç»åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼ˆå³åŒçº§æœ‰ data/ ç›®å½•ï¼‰ python multithread_hash.py ``` ### è¿è¡Œåä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¾“å‡º ``` ğŸ” æ­£åœ¨æ”¶é›† ./data ä¸‹çš„æ‰€æœ‰æ–‡ä»¶â€¦ âœ… æ‰¾åˆ° 37 ä¸ªæ–‡ä»¶ï¼Œå‡†å¤‡ä½¿ç”¨ 8 çº¿ç¨‹å¹¶è¡Œè®¡ç®—å“ˆå¸Œâ€¦ âœ… å·²å¤åˆ¶ /abs/path/to/data/a.txt â†’ /abs/path/to/output/example_copy.mp4 ... ğŸ‰ å®Œæˆï¼å…±å¤„ç† 37 æ–‡ä»¶ï¼Œç”¨æ—¶ 3.87 ç§’ ğŸ”— ç»“æœå·²å†™å…¥ï¼š/abs/path/to/output/hashes.csv ``` æ‰“å¼€ `output/hashes.csv`ï¼Œå†…å®¹ç±»ä¼¼ï¼š ``` relative_path,sha256 a.txt,3a7bd3e2360a5b... subdir/b.jpg,4b825dc642cb... c.mp4,8f14e45fceeaâ€¦ ``` --- ## ğŸ§© ä»£ç è¦ç‚¹è§£é‡Š | ä»£ç å— | å…³é”®ç‚¹ | ä¸ºä»€ä¹ˆé‡è¦ | |--------|--------|------------| | **`ThreadPoolExecutor(max_workers=MAX_WORKERS)`** | ä½¿ç”¨æ ‡å‡†åº“çš„çº¿ç¨‹æ± ï¼Œè‡ªåŠ¨ç®¡ç†çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ | ç®€æ´ã€è·¨å¹³å°ã€æ— éœ€æ‰‹åŠ¨ `threading.Thread` ç®¡ç† | | **`CHUNK_SIZE = 4â€¯MiB`** | åˆ†å—è¯»å–æ–‡ä»¶ | è¯»å–å¤§æ–‡ä»¶æ—¶é¿å…ä¸€æ¬¡æ€§æŠŠå…¨éƒ¨å†…å®¹è£…è¿›å†…å­˜ | | **`as_completed`** | æŒ‰å®Œæˆé¡ºåºè·å–ç»“æœ | èƒ½å³æ—¶æŠŠå·²ç»ç®—å¥½çš„å“ˆå¸Œå†™è¿›åˆ—è¡¨ï¼Œé˜²æ­¢å› å•ä¸ªæ…¢æ–‡ä»¶æ‹–æ…¢æ•´ä½“ | | **å¼‚å¸¸æ•è· (`except Exception as exc`)** | ä»»ä½•è¯»å–é”™è¯¯éƒ½è¿”å› `"ERROR:â€¦"` è€Œä¸æ˜¯è®©çº¿ç¨‹å´©æºƒ | ä¿è¯æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šå¾—åˆ°ä¸€æ¡è®°å½•ï¼Œè°ƒè¯•æ›´å®¹æ˜“ | | **`Path.rglob("*")`** + `is_file()` | é€’å½’éå†æ‰€æœ‰å­ç›®å½• | åªå¤„ç†çœŸå®æ–‡ä»¶ï¼Œè‡ªåŠ¨è·³è¿‡ç›®å½•å’Œè½¯é“¾æ¥ | | **`out_csv.parent.mkdir(parents=True, exist_ok=True)`** | è‡ªåŠ¨åˆ›å»º `output/` ç›®å½• | é˜²æ­¢ `FileNotFoundError` | | **`utf-8-sig`** | CSV é‡‡ç”¨ UTFâ€‘8 å¸¦ BOM ç¼–ç  | åœ¨ Windows è®°äº‹æœ¬é‡Œæ‰“å¼€ä¸ä¼šå‡ºç°ä¹±ç  | --- ## ğŸ“ˆ æ€§èƒ½å°å®éªŒï¼ˆå¯é€‰ï¼‰ ```python import time, os, random, string from pathlib import Path def gen_dummy_files(root: Path, n: int, size_mb: int = 5): """å¿«é€Ÿç”Ÿæˆ n ä¸ªå¤§å°ä¸º size_mb çš„éšæœºæ–‡ä»¶ï¼Œä¾¿äºæ€§èƒ½å¯¹æ¯”ã€‚""" root.mkdir(parents=True, exist_ok=True) for i in range(n): p = root / f"dummy_{i}.bin" with p.open("wb") as f: for _ in range(size_mb): f.write(os.urandom(1024 * 1024)) # å†™ 1â€¯MiB éšæœºæ•°æ® # ç”Ÿæˆ 20 ä¸ª 10â€¯MiB çš„æ–‡ä»¶ï¼ˆçº¦ 200â€¯MiBï¼‰ gen_dummy_files(Path("./data"), n=20, size_mb=10) # è¿è¡Œä¸€æ¬¡åŸºå‡†ï¼ˆå•çº¿ç¨‹ï¼‰ï¼š start = time.time() _ = [compute_sha256(p) for p in gather_file_list(Path("./data"))] print("å•çº¿ç¨‹è€—æ—¶:", time.time() - start) # å†è·‘ä¸€æ¬¡å¤šçº¿ç¨‹ï¼ˆé»˜è®¤ CPU æ ¸æ•°ï¼‰ï¼š start = time.time() with ThreadPoolExecutor(max_workers=os.cpu_count() or 4) as ex: list(ex.map(compute_sha256, gather_file_list(Path("./data")))) print("å¤šçº¿ç¨‹è€—æ—¶:", time.time() - start) ``` åœ¨å¤§å¤šæ•° SSD / HDD ç¯å¢ƒä¸‹ï¼Œä½ ä¼šçœ‹åˆ° **å¤šçº¿ç¨‹è€—æ—¶çº¦ä¸ºå•çº¿ç¨‹çš„ 30â€‘60%**ï¼ˆå–å†³äºç£ç›˜å¹¶å‘è¯»å†™èƒ½åŠ›ï¼‰ã€‚ --- ## ğŸ¯ é€‚ç”¨åœºæ™¯æ‰©å±• - **æ–‡ä»¶å‹ç¼©**ï¼šæŠŠ `compute_sha256` æ¢æˆ `gzip.compress` æˆ– `shutil.make_archive`ï¼ŒåŒæ ·å¯ä»¥å¹¶è¡Œã€‚ - **å›¾ç‰‡/éŸ³è§†é¢‘è½¬ç **ï¼šåªè¦å†…éƒ¨å®ç°æ˜¯ I/Oâ€‘boundï¼ˆè°ƒç”¨å¤–éƒ¨ CLI å·¥å…·ï¼‰ï¼Œä¹Ÿå¯ä»¥ç”¨åŒæ ·çš„çº¿ç¨‹æ± åŒ…è£…ã€‚ - **æ‰¹é‡ä¸Šä¼ /ä¸‹è½½**ï¼šæŠŠ `compute_sha256` æ›¿æ¢ä¸º `requests.put` æˆ– `boto3.upload_fileobj`ï¼Œå³å¯å®ç°å¹¶å‘ç½‘ç»œ I/Oã€‚ > **æ³¨æ„**ï¼šå¦‚æœä½ çš„ä»»åŠ¡æ˜¯ **CPUâ€‘bound**ï¼ˆä¾‹å¦‚å¤§é‡å›¾ç‰‡è§£ç ã€åŠ å¯†ã€å¤æ‚è®¡ç®—ï¼‰ï¼Œè¯·æ”¹ç”¨ `ProcessPoolExecutor` æˆ– `multiprocessing`ï¼Œå› ä¸º CPython çš„ GIL ä¼šé™åˆ¶çº¿ç¨‹çš„å¹¶è¡Œåº¦ã€‚ --- ## âœ… å°ç»“ - ä½¿ç”¨ **`ThreadPoolExecutor`** å¯ä»¥éå¸¸ç®€æ´åœ°å®ç°å¤šçº¿ç¨‹æ–‡ä»¶å¤„ç†ã€‚ - åªè¦æ˜¯ **I/Oâ€‘bound**ï¼ˆç£ç›˜è¯»å†™ã€ç½‘ç»œè¯·æ±‚ï¼‰ï¼Œçº¿ç¨‹æ•°è®¾ç½®ä¸º **CPU æ ¸æ•°çš„ 2â€‘4 å€** å¾€å¾€èƒ½å¾—åˆ°æœ€ä½³ååã€‚ - ä»£ç é‡Œå·²ç»è€ƒè™‘äº† **å¼‚å¸¸å®‰å…¨ã€ç›®å½•è‡ªåŠ¨åˆ›å»ºã€è¿›åº¦æ—¥å¿—**ï¼Œç›´æ¥æ‹·è´åˆ°é¡¹ç›®ä¸­å³å¯ä½¿ç”¨ã€‚ ç¥ä½ ç©å¾—å¼€å¿ƒ ğŸš€ï¼Œå¦‚æœè¿˜æœ‰åˆ«çš„éœ€æ±‚ï¼ˆæ¯”å¦‚æ”¹æˆè¿›åº¦æ¡ç‰ˆã€æ”¹æˆå¤šè¿›ç¨‹ç‰ˆã€æˆ–è€…æƒ³æŠŠç»“æœå†™å…¥æ•°æ®åº“ï¼‰ï¼Œéšæ—¶å‘Šè¯‰æˆ‘ï¼
æ›´ç®€æ´çš„ä»»åŠ¡

profile
gpt-oss:120b
æ€è€ƒç”¨æ—¶ 0 ç§’
ä¸‹é¢ç»™å‡º æœ€ç®€ç‰ˆ çš„å¤šçº¿ç¨‹æ–‡ä»¶ä»»åŠ¡â€”â€”ç»Ÿè®¡æŒ‡å®šç›®å½•ï¼ˆå«å­ç›®å½•ï¼‰ä¸‹æ‰€æœ‰æ™®é€šæ–‡ä»¶çš„å¤§å°ï¼Œå¹¶æŠŠã€Œæ–‡ä»¶ç›¸å¯¹è·¯å¾„ + å¤§å°ï¼ˆå­—èŠ‚ï¼‰ã€å†™å…¥ä¸€è¡Œ CSVã€‚
ä»£ç åªç”¨äº†å‡ è¡Œæ ‡å‡†åº“ï¼Œå‡ ä¹æ²¡æœ‰ä»»ä½•é¢å¤–ä¾èµ–ï¼Œé€‚åˆä½œä¸ºã€Œå¤šçº¿ç¨‹ç¤ºä¾‹ã€ç›´æ¥å¤åˆ¶ç²˜è´´è¿è¡Œã€‚

ğŸ“„ ä»£ç ï¼ˆä¿å­˜ä¸º simple_threaded_size.pyï¼‰
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
#!/usr/bin/env python
# -*- coding: utf-8 -*-

import csv
from pathlib import Path
from concurrent.futures import ThreadPoolExecutor, as_completed

# ------------------- é…ç½® -------------------
ROOT_DIR   = Path("./data")          # å¾…éå†çš„æ ¹ç›®å½•
OUT_CSV    = Path("./output/size.csv")
MAX_WORKERS = 8                     # çº¿ç¨‹æ•°ï¼ˆå¯æ”¹æˆ os.cpu_count()ï¼‰
# -------------------------------------------

def file_size(p: Path) -> tuple[Path, int]:
    """è¿”å› (æ–‡ä»¶Path, å¤§å°ï¼ˆå­—èŠ‚ï¼‰)ã€‚å¼‚å¸¸è¿”å› (Path, -1)ã€‚"""
    try:
        return p, p.stat().st_size
    except Exception:
        return p, -1                     # -1 ä»£è¡¨è¯»å–å¤±è´¥

def all_files(root: Path) -> list[Path]:
    """é€’å½’æ”¶é›†æ‰€æœ‰æ™®é€šæ–‡ä»¶ï¼ˆä¸åŒ…æ‹¬ç›®å½•ã€è½¯é“¾æ¥ï¼‰ã€‚"""
    return [p for p in root.rglob("*") if p.is_file() and not p.is_symlink()]

def write_csv(results: list[tuple[Path, int]], csv_path: Path) -> None:
    csv_path.parent.mkdir(parents=True, exist_ok=True)
    with csv_path.open("w", newline="", encoding="utf-8-sig") as f:
        writer = csv.writer(f)
        writer.writerow(["relative_path", "size_bytes"])
        for p, size in results:
            writer.writerow([p.relative_to(ROOT_DIR).as_posix(), size])

def main() -> None:
    files = all_files(ROOT_DIR)
    print(f"ğŸ” æ‰¾åˆ° {len(files)} ä¸ªæ–‡ä»¶ï¼Œä½¿ç”¨ {MAX_WORKERS} çº¿ç¨‹è®¡ç®—å¤§å°â€¦")

    results = []
    with ThreadPoolExecutor(max_workers=MAX_WORKERS) as pool:
        # æŠŠæ¯ä¸ªæ–‡ä»¶äº¤ç»™çº¿ç¨‹æ± å¤„ç†ï¼Œas_completed èƒ½å³æ—¶æ‹¿åˆ°å·²å®Œæˆçš„ä»»åŠ¡
        future_to_path = {pool.submit(file_size, p): p for p in files}
        for fut in as_completed(future_to_path):
            results.append(fut.result())

    write_csv(results, OUT_CSV)
    print(f"âœ… å®Œæˆï¼ç»“æœå†™å…¥ {OUT_CSV.resolve()}")

if __name__ == "__main__":
    main()
ğŸ“¦ å¦‚ä½•ä½¿ç”¨
bash

æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
2
3
# 1ï¸âƒ£ æŠŠå¾…å¤„ç†æ–‡ä»¶æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ data/ï¼ˆå¯ä»¥æ˜¯ä»»æ„å­ç›®å½•ç»“æ„ï¼‰
# 2ï¸âƒ£ è¿è¡Œè„šæœ¬
python simple_threaded_size.py
è¿è¡Œç»“æŸåï¼Œä¼šåœ¨ output/size.csv ä¸­å¾—åˆ°ç±»ä¼¼å†…å®¹ï¼š


æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
relative_path,size_bytes
a.txt,1245
subdir/b.jpg,587231
c.mp4,10485760
...
ğŸ” ä¸ºä»€ä¹ˆè¿™æ®µä»£ç ç®—ã€Œæ›´ç®€æ´ã€ï¼Ÿ
æ­¥éª¤
ä»£ç è¡Œæ•°
è¯´æ˜
æ”¶é›†æ–‡ä»¶	
all_files()ï¼ˆ2 è¡Œï¼‰	
Path.rglob("*") è‡ªåŠ¨é€’å½’
å¹¶è¡Œè®¡ç®—	
ThreadPoolExecutor + as_completedï¼ˆ5 è¡Œï¼‰	
åªæäº¤ä¸€æ¬¡å‡½æ•° file_sizeï¼Œçº¿ç¨‹æ± è´Ÿè´£è°ƒåº¦
å†™ CSV	
write_csv()ï¼ˆ5 è¡Œï¼‰	
è‡ªåŠ¨åˆ›å»ºçˆ¶ç›®å½•ï¼Œä½¿ç”¨ UTFâ€‘8â€‘sig é˜²æ­¢ Windows ä¹±ç 
ä¸»æµç¨‹	
main()ï¼ˆçº¦ 10 è¡Œï¼‰	
è¯»å–ã€å¹¶è¡Œã€å†™å‡ºï¼Œä¸€ç›®äº†ç„¶
æ•´æ®µè„šæœ¬ â‰ˆ 30 è¡Œï¼ˆå«æ³¨é‡Šï¼‰ï¼Œä¸éœ€è¦é¢å¤–åº“ã€ä¹Ÿä¸æ¶‰åŠå¤æ‚å¼‚å¸¸å¤„ç†ï¼Œè¶³ä»¥æ¼”ç¤ºã€Œå¤šçº¿ç¨‹ + æ–‡ä»¶ I/Oã€çš„æ ¸å¿ƒæ¦‚å¿µã€‚

ğŸ“ˆ å°å®éªŒï¼ˆå¯é€‰ï¼‰
å¦‚æœæƒ³æ„Ÿå—å¤šçº¿ç¨‹å¸¦æ¥çš„é€Ÿåº¦æå‡ï¼Œåªéœ€è¦æŠŠ MAX_WORKERS æ”¹æˆ 1ï¼ˆå•çº¿ç¨‹ï¼‰å†è·‘ä¸€æ¬¡ï¼Œå¯¹æ¯”è€—æ—¶å³å¯ã€‚
åœ¨ SSD ä¸Šå¯¹å‡ åƒä¸ªå°æ–‡ä»¶æˆ–å‡ ä¸ª GB çš„å¤§æ–‡ä»¶ï¼Œé€šå¸¸èƒ½çœ‹åˆ° 30â€‘50% çš„åŠ é€Ÿã€‚

ç¥ä½ ç©å¾—å¼€å¿ƒ ğŸš€ï¼å¦‚æœè¿˜æœ‰å…¶ä»–æƒ³è¦å®ç°çš„ç®€æ˜“ä»»åŠ¡ï¼ˆæ¯”å¦‚è¡Œæ•°ç»Ÿè®¡ã€MD5ã€å›¾ç‰‡ç¼©æ”¾ç­‰ï¼‰ï¼Œéšæ—¶å‘Šè¯‰æˆ‘ï¼

<details type="reasoning" done="true" duration="0"> <summary>Thought for 0 seconds</summary> > The user wants a simpler task for multithreading file processing. Provide minimal code: maybe count lines in text files, or compute file size, using ThreadPoolExecutor. Provide explanation. Keep concise. </details> ä¸‹é¢ç»™å‡º **æœ€ç®€ç‰ˆ** çš„å¤šçº¿ç¨‹æ–‡ä»¶ä»»åŠ¡â€”â€”**ç»Ÿè®¡æŒ‡å®šç›®å½•ï¼ˆå«å­ç›®å½•ï¼‰ä¸‹æ‰€æœ‰æ™®é€šæ–‡ä»¶çš„å¤§å°**ï¼Œå¹¶æŠŠã€Œæ–‡ä»¶ç›¸å¯¹è·¯å¾„ + å¤§å°ï¼ˆå­—èŠ‚ï¼‰ã€å†™å…¥ä¸€è¡Œ CSVã€‚ ä»£ç åªç”¨äº†å‡ è¡Œæ ‡å‡†åº“ï¼Œå‡ ä¹æ²¡æœ‰ä»»ä½•é¢å¤–ä¾èµ–ï¼Œé€‚åˆä½œä¸ºã€Œå¤šçº¿ç¨‹ç¤ºä¾‹ã€ç›´æ¥å¤åˆ¶ç²˜è´´è¿è¡Œã€‚ --- ## ğŸ“„ ä»£ç ï¼ˆä¿å­˜ä¸º `simple_threaded_size.py`ï¼‰ ```python #!/usr/bin/env python # -*- coding: utf-8 -*- import csv from pathlib import Path from concurrent.futures import ThreadPoolExecutor, as_completed # ------------------- é…ç½® ------------------- ROOT_DIR = Path("./data") # å¾…éå†çš„æ ¹ç›®å½• OUT_CSV = Path("./output/size.csv") MAX_WORKERS = 8 # çº¿ç¨‹æ•°ï¼ˆå¯æ”¹æˆ os.cpu_count()ï¼‰ # ------------------------------------------- def file_size(p: Path) -> tuple[Path, int]: """è¿”å› (æ–‡ä»¶Path, å¤§å°ï¼ˆå­—èŠ‚ï¼‰)ã€‚å¼‚å¸¸è¿”å› (Path, -1)ã€‚""" try: return p, p.stat().st_size except Exception: return p, -1 # -1 ä»£è¡¨è¯»å–å¤±è´¥ def all_files(root: Path) -> list[Path]: """é€’å½’æ”¶é›†æ‰€æœ‰æ™®é€šæ–‡ä»¶ï¼ˆä¸åŒ…æ‹¬ç›®å½•ã€è½¯é“¾æ¥ï¼‰ã€‚""" return [p for p in root.rglob("*") if p.is_file() and not p.is_symlink()] def write_csv(results: list[tuple[Path, int]], csv_path: Path) -> None: csv_path.parent.mkdir(parents=True, exist_ok=True) with csv_path.open("w", newline="", encoding="utf-8-sig") as f: writer = csv.writer(f) writer.writerow(["relative_path", "size_bytes"]) for p, size in results: writer.writerow([p.relative_to(ROOT_DIR).as_posix(), size]) def main() -> None: files = all_files(ROOT_DIR) print(f"ğŸ” æ‰¾åˆ° {len(files)} ä¸ªæ–‡ä»¶ï¼Œä½¿ç”¨ {MAX_WORKERS} çº¿ç¨‹è®¡ç®—å¤§å°â€¦") results = [] with ThreadPoolExecutor(max_workers=MAX_WORKERS) as pool: # æŠŠæ¯ä¸ªæ–‡ä»¶äº¤ç»™çº¿ç¨‹æ± å¤„ç†ï¼Œas_completed èƒ½å³æ—¶æ‹¿åˆ°å·²å®Œæˆçš„ä»»åŠ¡ future_to_path = {pool.submit(file_size, p): p for p in files} for fut in as_completed(future_to_path): results.append(fut.result()) write_csv(results, OUT_CSV) print(f"âœ… å®Œæˆï¼ç»“æœå†™å…¥ {OUT_CSV.resolve()}") if __name__ == "__main__": main() ``` --- ## ğŸ“¦ å¦‚ä½•ä½¿ç”¨ ```bash # 1ï¸âƒ£ æŠŠå¾…å¤„ç†æ–‡ä»¶æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ data/ï¼ˆå¯ä»¥æ˜¯ä»»æ„å­ç›®å½•ç»“æ„ï¼‰ # 2ï¸âƒ£ è¿è¡Œè„šæœ¬ python simple_threaded_size.py ``` è¿è¡Œç»“æŸåï¼Œä¼šåœ¨ `output/size.csv` ä¸­å¾—åˆ°ç±»ä¼¼å†…å®¹ï¼š ``` relative_path,size_bytes a.txt,1245 subdir/b.jpg,587231 c.mp4,10485760 ... ``` --- ## ğŸ” ä¸ºä»€ä¹ˆè¿™æ®µä»£ç ç®—ã€Œæ›´ç®€æ´ã€ï¼Ÿ | æ­¥éª¤ | ä»£ç è¡Œæ•° | è¯´æ˜ | |------|----------|------| | æ”¶é›†æ–‡ä»¶ | `all_files()`ï¼ˆ2 è¡Œï¼‰ | `Path.rglob("*")` è‡ªåŠ¨é€’å½’ | | å¹¶è¡Œè®¡ç®— | `ThreadPoolExecutor` + `as_completed`ï¼ˆ5 è¡Œï¼‰ | åªæäº¤ä¸€æ¬¡å‡½æ•° `file_size`ï¼Œçº¿ç¨‹æ± è´Ÿè´£è°ƒåº¦ | | å†™ CSV | `write_csv()`ï¼ˆ5 è¡Œï¼‰ | è‡ªåŠ¨åˆ›å»ºçˆ¶ç›®å½•ï¼Œä½¿ç”¨ UTFâ€‘8â€‘sig é˜²æ­¢ Windows ä¹±ç  | | ä¸»æµç¨‹ | `main()`ï¼ˆçº¦ 10 è¡Œï¼‰ | è¯»å–ã€å¹¶è¡Œã€å†™å‡ºï¼Œä¸€ç›®äº†ç„¶ | æ•´æ®µè„šæœ¬ **â‰ˆ 30 è¡Œ**ï¼ˆå«æ³¨é‡Šï¼‰ï¼Œä¸éœ€è¦é¢å¤–åº“ã€ä¹Ÿä¸æ¶‰åŠå¤æ‚å¼‚å¸¸å¤„ç†ï¼Œè¶³ä»¥æ¼”ç¤ºã€Œå¤šçº¿ç¨‹ + æ–‡ä»¶ I/Oã€çš„æ ¸å¿ƒæ¦‚å¿µã€‚ --- ## ğŸ“ˆ å°å®éªŒï¼ˆå¯é€‰ï¼‰ å¦‚æœæƒ³æ„Ÿå—å¤šçº¿ç¨‹å¸¦æ¥çš„é€Ÿåº¦æå‡ï¼Œåªéœ€è¦æŠŠ `MAX_WORKERS` æ”¹æˆ `1`ï¼ˆå•çº¿ç¨‹ï¼‰å†è·‘ä¸€æ¬¡ï¼Œå¯¹æ¯”è€—æ—¶å³å¯ã€‚ åœ¨ SSD ä¸Šå¯¹å‡ åƒä¸ªå°æ–‡ä»¶æˆ–å‡ ä¸ª GB çš„å¤§æ–‡ä»¶ï¼Œé€šå¸¸èƒ½çœ‹åˆ° **30â€‘50%** çš„åŠ é€Ÿã€‚ ç¥ä½ ç©å¾—å¼€å¿ƒ ğŸš€ï¼å¦‚æœè¿˜æœ‰å…¶ä»–æƒ³è¦å®ç°çš„ç®€æ˜“ä»»åŠ¡ï¼ˆæ¯”å¦‚è¡Œæ•°ç»Ÿè®¡ã€MD5ã€å›¾ç‰‡ç¼©æ”¾ç­‰ï¼‰ï¼Œéšæ—¶å‘Šè¯‰æˆ‘ï¼
ä¸ç”¨çº¿ç¨‹å¤„ç†çš„ä»»åŠ¡

profile
gpt-oss:120b
æ€è€ƒç”¨æ—¶ 0 ç§’
ä¸‹é¢ç»™å‡º æœ€ç®€æ´ã€å•çº¿ç¨‹ çš„æ–‡ä»¶æ‰¹å¤„ç†ç¤ºä¾‹â€”â€”
ç»Ÿè®¡æŒ‡å®šç›®å½•ï¼ˆåŒ…æ‹¬å­ç›®å½•ï¼‰ä¸‹æ‰€æœ‰æ™®é€šæ–‡ä»¶çš„è¡Œæ•°ï¼Œå¹¶æŠŠã€Œç›¸å¯¹è·¯å¾„ + è¡Œæ•°ã€å†™å…¥ CSVã€‚
ä»£ç åªä½¿ç”¨ Python æ ‡å‡†åº“ï¼Œä¸æ¶‰åŠä»»ä½•å¹¶å‘/çº¿ç¨‹ï¼Œä¸€æ­¥ä¸€æ­¥å°±èƒ½è·‘é€šã€‚

ğŸ“‚ ç›®å½•ç»“æ„ï¼ˆè‡ªè¡Œåˆ›å»ºæˆ–è‡ªè¡Œæ›¿æ¢è·¯å¾„ï¼‰

æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
project/
â”œâ”€ data/                # å¾…å¤„ç†çš„æ–‡æœ¬æ–‡ä»¶ï¼ˆå¯ä»¥æ··åˆå­ç›®å½•ï¼‰
â”‚   â”œâ”€ a.txt
â”‚   â”œâ”€ sub/
â”‚   â”‚   â””â”€ b.log
â”‚   â””â”€ c.md
â””â”€ count_lines.py       # ä¸‹é¢çš„ä»£ç ä¿å­˜ä¸ºæ­¤æ–‡ä»¶
ğŸ ä»£ç  â€“ count_lines.py
python

æŠ˜å 

è¿è¡Œ
ä¿å­˜
å¤åˆ¶
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
âŒ„
#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
å•çº¿ç¨‹æ‰¹é‡ç»Ÿè®¡æ–‡ä»¶è¡Œæ•°å¹¶å†™å…¥ CSVã€‚

åŠŸèƒ½ï¼š
  1. é€’å½’éå† data/ ç›®å½•ï¼Œæ”¶é›†æ‰€æœ‰æ™®é€šæ–‡ä»¶ï¼ˆæ’é™¤ç›®å½•ã€è½¯é“¾æ¥ï¼‰ã€‚
  2. é€ä¸ªæ‰“å¼€æ–‡ä»¶ï¼Œé€è¡Œè®¡æ•°ï¼ˆä½¿ç”¨æœ€çœå†…å­˜çš„æ–¹å¼ï¼‰ã€‚
  3. æŠŠ â€œç›¸å¯¹è·¯å¾„, è¡Œæ•°â€ å†™å…¥ output/lines.csvï¼ˆè‡ªåŠ¨åˆ›å»º output/ ç›®å½•ï¼‰ã€‚
"""

import csv
from pathlib import Path

# -------------------------------------------------
# â˜… é…ç½®ï¼ˆæ ¹æ®å®é™…éœ€æ±‚è‡ªè¡Œä¿®æ”¹ï¼‰ â˜…
# -------------------------------------------------
ROOT_DIR   = Path("./data")          # å¾…éå†çš„æ ¹ç›®å½•
OUT_CSV    = Path("./output/lines.csv")
# -------------------------------------------------


def count_file_lines(p: Path) -> tuple[Path, int]:
    """
    è¿”å› (æ–‡ä»¶Path, è¡Œæ•°)ã€‚
    å¦‚æœæ‰“å¼€æˆ–è¯»å–è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ï¼Œè¿”å› (Path, -1) è¡¨ç¤ºâ€œå‡ºé”™â€ã€‚
    """
    try:
        with p.open("r", encoding="utf-8", errors="ignore") as f:
            # é€è¡Œéå†æ¯”ä¸€æ¬¡æ€§ read().splitlines() æ›´çœå†…å­˜
            return p, sum(1 for _ in f)
    except Exception:
        return p, -1                     # -1 ä»£è¡¨è¯»å–å¤±è´¥


def gather_files(root: Path) -> list[Path]:
    """é€’å½’æ”¶é›†æ‰€æœ‰æ™®é€šæ–‡ä»¶ï¼ˆä¸åŒ…æ‹¬ç›®å½•ã€è½¯é“¾æ¥ï¼‰ã€‚"""
    return [p for p in root.rglob("*") if p.is_file() and not p.is_symlink()]


def write_csv(results: list[tuple[Path, int]], csv_path: Path) -> None:
    """æŠŠ [(Path, è¡Œæ•°), â€¦] å†™å…¥ CSVï¼Œä½¿ç”¨ UTFâ€‘8â€‘sig é˜²æ­¢ Windows æ‰“å¼€ä¹±ç ã€‚"""
    csv_path.parent.mkdir(parents=True, exist_ok=True)
    with csv_path.open("w", newline="", encoding="utf-8-sig") as fp:
        writer = csv.writer(fp)
        writer.writerow(["relative_path", "line_count"])
        for p, cnt in results:
            writer.writerow([p.relative_to(ROOT_DIR).as_posix(), cnt])


def main() -> None:
    files = gather_files(ROOT_DIR)
    print(f"ğŸ” æ‰¾åˆ° {len(files)} ä¸ªæ–‡ä»¶ï¼Œå¼€å§‹é€ä¸ªè®¡æ•°â€¦")

    results = []
    for p in files:                     # ğŸ‘‰ **å•çº¿ç¨‹é¡ºåºå¤„ç†**
        results.append(count_file_lines(p))

    write_csv(results, OUT_CSV)
    print(f"âœ… å®Œæˆï¼ç»“æœå·²å†™å…¥ {OUT_CSV.resolve()}")


if __name__ == "__main__":
    main()
è¿è¡Œæ–¹å¼
bash

æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
2
# ç¡®ä¿ data/ ç›®å½•å·²ç»å­˜åœ¨å¹¶æ”¾å…¥ä¸€äº›æ–‡æœ¬æ–‡ä»¶
python count_lines.py
è¿è¡Œåä¼šåœ¨ output/lines.csv ä¸­å¾—åˆ°ç±»ä¼¼å†…å®¹ï¼š


æŠ˜å 
ä¿å­˜
å¤åˆ¶
1
2
3
4
relative_path,line_count
a.txt,42
sub/b.log,118
c.md,7
âœ¨ ä¸ºä»€ä¹ˆè¿™æ®µä»£ç ç®—ã€Œä¸ç”¨çº¿ç¨‹ã€ï¼Ÿ
æ­¥éª¤
ä»£ç è¡Œæ•°
è¯´æ˜
æ”¶é›†æ–‡ä»¶	
gather_files()ï¼ˆ2 è¡Œï¼‰	
Path.rglob("*") è‡ªåŠ¨é€’å½’ï¼Œæ— éœ€å¹¶å‘
è®¡æ•°	
for p in files: å¾ªç¯ + count_file_lines()ï¼ˆ3 è¡Œï¼‰	
é€ä¸ªé¡ºåºæ‰“å¼€ã€é€è¡Œè®¡æ•°ï¼Œæœ€ç›´æ¥çš„ I/O æ–¹å¼
å†™ CSV	
write_csv()ï¼ˆ5 è¡Œï¼‰	
è‡ªåŠ¨åˆ›å»ºçˆ¶ç›®å½•ï¼Œä½¿ç”¨ UTFâ€‘8â€‘sig é˜²æ­¢ Windows ä¹±ç 
ä¸»æµç¨‹	
main()ï¼ˆçº¦ 10 è¡Œï¼‰	
è¯»å– â†’ è®¡æ•° â†’ å†™å‡ºï¼Œä¸€ç›®äº†ç„¶
æ•´æ®µè„šæœ¬ â‰ˆ 30 è¡Œï¼ˆå«æ³¨é‡Šï¼‰ï¼Œä¸ä¾èµ– concurrent.futuresã€threadingã€multiprocessingï¼Œå®Œå…¨æ˜¯ é¡ºåºæ‰§è¡Œã€‚

ğŸ“ˆ å°å®éªŒï¼ˆéªŒè¯å•çº¿ç¨‹çš„è€—æ—¶ï¼‰
å¦‚æœä½ æƒ³æ„Ÿå—å•çº¿ç¨‹çš„æ‰§è¡Œæ—¶é—´ï¼Œåªéœ€è¦ç›´æ¥è¿è¡Œè„šæœ¬å³å¯ã€‚
åœ¨æ™®é€šæœºæ¢°ç¡¬ç›˜ä¸Šç»Ÿè®¡å‡ åƒä¸ªå°æ–‡ä»¶çš„è¡Œæ•°ï¼Œå¤§çº¦ 0.1â€‘0.3â€¯ç§’/åƒæ–‡ä»¶ï¼›
åœ¨ SSD ä¸Šåˆ™æ›´å¿«ï¼Œé€šå¸¸ 1â€¯ç§’ä»¥å†… å®Œæˆå‡ ä¸‡è¡Œæ–‡æœ¬çš„ç»Ÿè®¡ã€‚

ğŸ¯ é€‚ç”¨åœºæ™¯æ‰©å±•ï¼ˆä»ä¿æŒå•çº¿ç¨‹ï¼‰
æ–‡ä»¶å¤§å°ç»Ÿè®¡ â†’ æŠŠ count_file_lines æ”¹æˆ p.stat().st_sizeã€‚
æ–‡ä»¶ MD5 / SHAâ€‘256 â†’ æ›¿æ¢å‡½æ•°ä½“ä¸ºç›¸åº”çš„ hashlib è®¡ç®—ã€‚
ç®€å•å¤åˆ¶/ç§»åŠ¨ â†’ ç”¨ shutil.copy2(p, dest) ä»£æ›¿è®¡æ•°ã€‚
æç¤ºï¼šå¦‚æœä½ çš„ä»»åŠ¡æ˜¯ CPUâ€‘boundï¼ˆæ¯”å¦‚å¤æ‚æ–‡æœ¬è§£æã€å›¾ç‰‡å¤„ç†ç­‰ï¼‰ï¼Œå•çº¿ç¨‹ä¼šå—é™äº CPUã€‚æ­¤æ—¶å¯ä»¥è€ƒè™‘æ”¹ä¸ºå¤šè¿›ç¨‹æˆ–çº¿ç¨‹ï¼Œä½†å¦‚æœåªæ˜¯ I/Oâ€‘boundï¼ˆè¯»å–ç£ç›˜ã€å†™ CSVï¼‰â€”â€”å•çº¿ç¨‹å·²ç»è¶³å¤Ÿå¿«ä¸”ä»£ç æœ€ç®€æ´ã€‚ 

ç¥ä½ ç©å¾—å¼€å¿ƒ ğŸš€ï¼Œæœ‰å…¶ä»–æƒ³è¦çš„ç®€æ˜“å•çº¿ç¨‹ä»»åŠ¡ï¼ˆæ¯”å¦‚è¯é¢‘ç»Ÿè®¡ã€JSON åˆå¹¶ã€å›¾ç‰‡è½¬ç°åº¦ç­‰ï¼‰ï¼Œéšæ—¶å‘Šè¯‰æˆ‘ï¼









è¿½é—®
èƒ½å¦ç»™ä¸€ä¸ªåªåˆ—å‡ºæ–‡ä»¶è·¯å¾„è€Œä¸åšä»»ä½•ç»Ÿè®¡çš„æœ€ç®€è„šæœ¬ï¼Ÿ
æˆ‘æƒ³åœ¨å•çº¿ç¨‹å¤„ç†æ—¶åŠ å…¥è¿›åº¦æ¡æ˜¾ç¤ºï¼Œåº”è¯¥æ€ä¹ˆå®ç°ï¼Ÿ
å¦‚æœåªæƒ³ç»Ÿè®¡ç‰¹å®šåç¼€ï¼ˆæ¯”å¦‚ .txtï¼‰çš„æ–‡ä»¶è¡Œæ•°ï¼Œè¯¥æ€ä¹ˆè¿‡æ»¤ï¼Ÿ
èƒ½å¦æŠŠè„šæœ¬æ”¹æˆæ¥å—å‘½ä»¤è¡Œå‚æ•°ï¼Œä¾‹å¦‚ç›®å½•å’Œè¾“å‡ºæ–‡ä»¶åï¼Ÿ
å¯¹äºè¶…å¤§æ–‡ä»¶ï¼Œæœ‰æ²¡æœ‰æ›´çœå†…å­˜çš„è¯»å–æ–¹å¼å¯ä»¥æ¨èï¼Ÿ
<details type="reasoning" done="true" duration="0"> <summary>Thought for 0 seconds</summary> > We need to provide a simple task without threading. Possibly a script that processes files sequentially. Should be simple. Provide example: count lines, compute hash, copy files, etc. Provide code and explanation. Ensure no threading. Provide concise. </details> ä¸‹é¢ç»™å‡º **æœ€ç®€æ´ã€å•çº¿ç¨‹** çš„æ–‡ä»¶æ‰¹å¤„ç†ç¤ºä¾‹â€”â€” **ç»Ÿè®¡æŒ‡å®šç›®å½•ï¼ˆåŒ…æ‹¬å­ç›®å½•ï¼‰ä¸‹æ‰€æœ‰æ™®é€šæ–‡ä»¶çš„è¡Œæ•°**ï¼Œå¹¶æŠŠã€Œç›¸å¯¹è·¯å¾„ + è¡Œæ•°ã€å†™å…¥ CSVã€‚ ä»£ç åªä½¿ç”¨ Python æ ‡å‡†åº“ï¼Œ**ä¸æ¶‰åŠä»»ä½•å¹¶å‘/çº¿ç¨‹**ï¼Œä¸€æ­¥ä¸€æ­¥å°±èƒ½è·‘é€šã€‚ --- ## ğŸ“‚ ç›®å½•ç»“æ„ï¼ˆè‡ªè¡Œåˆ›å»ºæˆ–è‡ªè¡Œæ›¿æ¢è·¯å¾„ï¼‰ ``` project/ â”œâ”€ data/ # å¾…å¤„ç†çš„æ–‡æœ¬æ–‡ä»¶ï¼ˆå¯ä»¥æ··åˆå­ç›®å½•ï¼‰ â”‚ â”œâ”€ a.txt â”‚ â”œâ”€ sub/ â”‚ â”‚ â””â”€ b.log â”‚ â””â”€ c.md â””â”€ count_lines.py # ä¸‹é¢çš„ä»£ç ä¿å­˜ä¸ºæ­¤æ–‡ä»¶ ``` --- ## ğŸ ä»£ç  â€“ `count_lines.py` ```python #!/usr/bin/env python # -*- coding: utf-8 -*- """ å•çº¿ç¨‹æ‰¹é‡ç»Ÿè®¡æ–‡ä»¶è¡Œæ•°å¹¶å†™å…¥ CSVã€‚ åŠŸèƒ½ï¼š 1. é€’å½’éå† data/ ç›®å½•ï¼Œæ”¶é›†æ‰€æœ‰æ™®é€šæ–‡ä»¶ï¼ˆæ’é™¤ç›®å½•ã€è½¯é“¾æ¥ï¼‰ã€‚ 2. é€ä¸ªæ‰“å¼€æ–‡ä»¶ï¼Œé€è¡Œè®¡æ•°ï¼ˆä½¿ç”¨æœ€çœå†…å­˜çš„æ–¹å¼ï¼‰ã€‚ 3. æŠŠ â€œç›¸å¯¹è·¯å¾„, è¡Œæ•°â€ å†™å…¥ output/lines.csvï¼ˆè‡ªåŠ¨åˆ›å»º output/ ç›®å½•ï¼‰ã€‚ """ import csv from pathlib import Path # ------------------------------------------------- # â˜… é…ç½®ï¼ˆæ ¹æ®å®é™…éœ€æ±‚è‡ªè¡Œä¿®æ”¹ï¼‰ â˜… # ------------------------------------------------- ROOT_DIR = Path("./data") # å¾…éå†çš„æ ¹ç›®å½• OUT_CSV = Path("./output/lines.csv") # ------------------------------------------------- def count_file_lines(p: Path) -> tuple[Path, int]: """ è¿”å› (æ–‡ä»¶Path, è¡Œæ•°)ã€‚ å¦‚æœæ‰“å¼€æˆ–è¯»å–è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ï¼Œè¿”å› (Path, -1) è¡¨ç¤ºâ€œå‡ºé”™â€ã€‚ """ try: with p.open("r", encoding="utf-8", errors="ignore") as f: # é€è¡Œéå†æ¯”ä¸€æ¬¡æ€§ read().splitlines() æ›´çœå†…å­˜ return p, sum(1 for _ in f) except Exception: return p, -1 # -1 ä»£è¡¨è¯»å–å¤±è´¥ def gather_files(root: Path) -> list[Path]: """é€’å½’æ”¶é›†æ‰€æœ‰æ™®é€šæ–‡ä»¶ï¼ˆä¸åŒ…æ‹¬ç›®å½•ã€è½¯é“¾æ¥ï¼‰ã€‚""" return [p for p in root.rglob("*") if p.is_file() and not p.is_symlink()] def write_csv(results: list[tuple[Path, int]], csv_path: Path) -> None: """æŠŠ [(Path, è¡Œæ•°), â€¦] å†™å…¥ CSVï¼Œä½¿ç”¨ UTFâ€‘8â€‘sig é˜²æ­¢ Windows æ‰“å¼€ä¹±ç ã€‚""" csv_path.parent.mkdir(parents=True, exist_ok=True) with csv_path.open("w", newline="", encoding="utf-8-sig") as fp: writer = csv.writer(fp) writer.writerow(["relative_path", "line_count"]) for p, cnt in results: writer.writerow([p.relative_to(ROOT_DIR).as_posix(), cnt]) def main() -> None: files = gather_files(ROOT_DIR) print(f"ğŸ” æ‰¾åˆ° {len(files)} ä¸ªæ–‡ä»¶ï¼Œå¼€å§‹é€ä¸ªè®¡æ•°â€¦") results = [] for p in files: # ğŸ‘‰ **å•çº¿ç¨‹é¡ºåºå¤„ç†** results.append(count_file_lines(p)) write_csv(results, OUT_CSV) print(f"âœ… å®Œæˆï¼ç»“æœå·²å†™å…¥ {OUT_CSV.resolve()}") if __name__ == "__main__": main() ``` ### è¿è¡Œæ–¹å¼ ```bash # ç¡®ä¿ data/ ç›®å½•å·²ç»å­˜åœ¨å¹¶æ”¾å…¥ä¸€äº›æ–‡æœ¬æ–‡ä»¶ python count_lines.py ``` è¿è¡Œåä¼šåœ¨ `output/lines.csv` ä¸­å¾—åˆ°ç±»ä¼¼å†…å®¹ï¼š ``` relative_path,line_count a.txt,42 sub/b.log,118 c.md,7 ``` --- ## âœ¨ ä¸ºä»€ä¹ˆè¿™æ®µä»£ç ç®—ã€Œä¸ç”¨çº¿ç¨‹ã€ï¼Ÿ | æ­¥éª¤ | ä»£ç è¡Œæ•° | è¯´æ˜ | |------|----------|------| | æ”¶é›†æ–‡ä»¶ | `gather_files()`ï¼ˆ2 è¡Œï¼‰ | `Path.rglob("*")` è‡ªåŠ¨é€’å½’ï¼Œæ— éœ€å¹¶å‘ | | è®¡æ•° | `for p in files:` å¾ªç¯ + `count_file_lines()`ï¼ˆ3 è¡Œï¼‰ | é€ä¸ªé¡ºåºæ‰“å¼€ã€é€è¡Œè®¡æ•°ï¼Œæœ€ç›´æ¥çš„ I/O æ–¹å¼ | | å†™ CSV | `write_csv()`ï¼ˆ5 è¡Œï¼‰ | è‡ªåŠ¨åˆ›å»ºçˆ¶ç›®å½•ï¼Œä½¿ç”¨ UTFâ€‘8â€‘sig é˜²æ­¢ Windows ä¹±ç  | | ä¸»æµç¨‹ | `main()`ï¼ˆçº¦ 10 è¡Œï¼‰ | è¯»å– â†’ è®¡æ•° â†’ å†™å‡ºï¼Œä¸€ç›®äº†ç„¶ | æ•´æ®µè„šæœ¬ **â‰ˆ 30 è¡Œ**ï¼ˆå«æ³¨é‡Šï¼‰ï¼Œä¸ä¾èµ– `concurrent.futures`ã€`threading`ã€`multiprocessing`ï¼Œå®Œå…¨æ˜¯ **é¡ºåºæ‰§è¡Œ**ã€‚ --- ## ğŸ“ˆ å°å®éªŒï¼ˆéªŒè¯å•çº¿ç¨‹çš„è€—æ—¶ï¼‰ å¦‚æœä½ æƒ³æ„Ÿå—å•çº¿ç¨‹çš„æ‰§è¡Œæ—¶é—´ï¼Œåªéœ€è¦ç›´æ¥è¿è¡Œè„šæœ¬å³å¯ã€‚ åœ¨æ™®é€šæœºæ¢°ç¡¬ç›˜ä¸Šç»Ÿè®¡å‡ åƒä¸ªå°æ–‡ä»¶çš„è¡Œæ•°ï¼Œå¤§çº¦ **0.1â€‘0.3â€¯ç§’/åƒæ–‡ä»¶**ï¼› åœ¨ SSD ä¸Šåˆ™æ›´å¿«ï¼Œé€šå¸¸ **1â€¯ç§’ä»¥å†…** å®Œæˆå‡ ä¸‡è¡Œæ–‡æœ¬çš„ç»Ÿè®¡ã€‚ --- ## ğŸ¯ é€‚ç”¨åœºæ™¯æ‰©å±•ï¼ˆä»ä¿æŒå•çº¿ç¨‹ï¼‰ - **æ–‡ä»¶å¤§å°ç»Ÿè®¡** â†’ æŠŠ `count_file_lines` æ”¹æˆ `p.stat().st_size`ã€‚ - **æ–‡ä»¶ MD5 / SHAâ€‘256** â†’ æ›¿æ¢å‡½æ•°ä½“ä¸ºç›¸åº”çš„ `hashlib` è®¡ç®—ã€‚ - **ç®€å•å¤åˆ¶/ç§»åŠ¨** â†’ ç”¨ `shutil.copy2(p, dest)` ä»£æ›¿è®¡æ•°ã€‚ > **æç¤º**ï¼šå¦‚æœä½ çš„ä»»åŠ¡æ˜¯ **CPUâ€‘bound**ï¼ˆæ¯”å¦‚å¤æ‚æ–‡æœ¬è§£æã€å›¾ç‰‡å¤„ç†ç­‰ï¼‰ï¼Œå•çº¿ç¨‹ä¼šå—é™äº CPUã€‚æ­¤æ—¶å¯ä»¥è€ƒè™‘æ”¹ä¸ºå¤šè¿›ç¨‹æˆ–çº¿ç¨‹ï¼Œä½†å¦‚æœåªæ˜¯ **I/Oâ€‘bound**ï¼ˆè¯»å–ç£ç›˜ã€å†™ CSVï¼‰â€”â€”å•çº¿ç¨‹å·²ç»è¶³å¤Ÿå¿«ä¸”ä»£ç æœ€ç®€æ´ã€‚ ç¥ä½ ç©å¾—å¼€å¿ƒ ğŸš€ï¼Œæœ‰å…¶ä»–æƒ³è¦çš„ç®€æ˜“å•çº¿ç¨‹ä»»åŠ¡ï¼ˆæ¯”å¦‚è¯é¢‘ç»Ÿè®¡ã€JSON åˆå¹¶ã€å›¾ç‰‡è½¬ç°åº¦ç­‰ï¼‰ï¼Œéšæ—¶å‘Šè¯‰æˆ‘ï¼





è”ç½‘æœç´¢

ä»£ç è§£é‡Šå™¨


Open WebUI
